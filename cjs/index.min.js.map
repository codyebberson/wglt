{"version":3,"file":"index.min.js","sources":["../../../../src/blendmode.ts","../../../../src/boxutils.ts","../../node_modules/tslib/tslib.es6.js","../../../../src/color.ts","../../../../src/palettes/colors.ts","../../../../src/serialize.ts","../../../../src/chars.ts","../../../../src/utils.ts","../../../../src/cell.ts","../../../../src/console.ts","../../../../src/font.ts","../../../../src/fov.ts","../../../../src/point.ts","../../../../src/rect.ts","../../../../src/gui/dialogstate.ts","../../../../src/gui/defaultdialogrenderer.ts","../../../../src/gui/dialog.ts","../../../../src/gui/message.ts","../../../../src/input.ts","../../../../src/keys.ts","../../../../src/image.ts","../../../../src/mouse.ts","../../../../src/palettes/c64.ts","../../../../src/palettes/colodore.ts","../../../../src/palettes/pico8.ts","../../../../src/path.ts","../../../../src/rng.ts","../../../../src/terminal.ts","../../../../src/shaders.ts","../../../../src/gui.ts","../../../../src/gui/messagedialog.ts","../../../../src/gui/scrollablemessagedialog.ts","../../../../src/gui/selectdialog.ts"],"sourcesContent":["/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nexport enum BlendMode {\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None = 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend = 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add = 2,\n}\n","import { Console } from './console';\n\n/**\n * Details about box characters.\n * The first element is the array of details for the first box char (0xB3).\n * Each sub array is the count of stems for top, right, bottom, and left.\n */\nconst BOX_CHAR_DETAILS = [\n  [1, 0, 1, 0], // 0xB3\n  [1, 0, 1, 1], // 0xB4\n  [1, 0, 1, 2], // 0xB5\n  [2, 0, 2, 1], // 0xB6\n  [0, 0, 2, 1], // 0xB7\n  [0, 0, 1, 2], // 0xB8\n  [2, 0, 2, 2], // 0xB9\n  [2, 0, 2, 0], // 0xBA\n  [0, 0, 2, 2], // 0xBB\n  [2, 0, 0, 2], // 0xBC\n  [2, 0, 0, 1], // 0xBD\n  [1, 0, 0, 2], // 0xBE\n  [0, 0, 1, 1], // 0xBF\n  [1, 1, 0, 0], // 0xC0\n  [1, 1, 0, 1], // 0xC1\n  [0, 1, 1, 1], // 0xC2\n  [1, 1, 1, 0], // 0xC3\n  [0, 1, 0, 1], // 0xC4\n  [1, 1, 1, 1], // 0xC5\n  [1, 2, 1, 0], // 0xC6\n  [2, 1, 2, 0], // 0xC7\n  [2, 2, 0, 0], // 0xC8\n  [0, 2, 2, 0], // 0xC9\n  [2, 2, 0, 2], // 0xCA\n  [0, 2, 2, 2], // 0xCB\n  [2, 2, 2, 0], // 0xCC\n  [0, 2, 0, 2], // 0xCD\n  [2, 2, 2, 2], // 0xCE\n  [1, 2, 0, 2], // 0xCF\n  [2, 1, 0, 1], // 0xD0\n  [0, 2, 1, 2], // 0xD1\n  [0, 1, 2, 1], // 0xD2\n  [2, 1, 0, 0], // 0xD3\n  [1, 2, 0, 0], // 0xD4\n  [0, 2, 1, 0], // 0xD5\n  [0, 1, 2, 0], // 0xD6\n  [2, 1, 2, 1], // 0xD7\n  [1, 2, 1, 2], // 0xD8\n  [1, 0, 0, 1], // 0xD9\n  [0, 1, 1, 0], // 0xDA\n];\n\nfunction isBoxCell(con: Console, x: number, y: number): boolean {\n  const charCode = con.getCharCode(x, y);\n  return charCode !== undefined && charCode >= 0xb3 && charCode <= 0xda;\n}\n\nfunction getBoxCount(con: Console, x: number, y: number, index: number): number {\n  if (x < 0 || y < 0 || x >= con.width || y >= con.height) {\n    return 0;\n  }\n  const charCode = con.getCharCode(x, y);\n  if (charCode === undefined || charCode < 0xb3 || charCode > 0xda) {\n    return 0;\n  }\n  return BOX_CHAR_DETAILS[charCode - 0xb3][index];\n}\n\nfunction getBoxCell(up: number, right: number, down: number, left: number): number {\n  for (let i = 0; i < BOX_CHAR_DETAILS.length; i++) {\n    const row = BOX_CHAR_DETAILS[i];\n    if (row[0] === up && row[1] === right && row[2] === down && row[3] === left) {\n      return 0xb3 + i;\n    }\n  }\n  return 0;\n}\n\nexport function fixBoxCells(con: Console): void {\n  for (let y = 0; y < con.height; y++) {\n    for (let x = 0; x < con.width; x++) {\n      if (isBoxCell(con, x, y)) {\n        let up = getBoxCount(con, x, y - 1, 2);\n        let right = getBoxCount(con, x + 1, y, 3);\n        let down = getBoxCount(con, x, y + 1, 0);\n        let left = getBoxCount(con, x - 1, y, 1);\n\n        // There are no single-direction stubs.\n        // If we need one, then we create a full vertical or horizontal pipe.\n        if (up > 0 && right === 0 && down === 0 && left === 0) {\n          down = up;\n        } else if (up === 0 && right > 0 && down === 0 && left === 0) {\n          left = right;\n        } else if (up === 0 && right === 0 && down > 0 && left === 0) {\n          up = down;\n        } else if (up === 0 && right === 0 && down === 0 && left > 0) {\n          right = left;\n        }\n\n        // Vertical and horizontal axis must have same width.\n        if (left > 0 && right > 0) {\n          left = right = Math.max(left, right);\n        }\n        if (up > 0 && down > 0) {\n          up = down = Math.max(up, down);\n        }\n\n        const charCode = getBoxCell(up, right, down, left);\n\n        if ((up || right || down || left) && !(charCode >= 0xb3 && charCode <= 0xda)) {\n          throw new Error(\n            'invalid char code! (up=' + up + ', right=' + right + ', down=' + down + ', left=' + left + ')'\n          );\n        }\n\n        con.drawChar(x, y, charCode);\n      }\n    }\n  }\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","export type Color = number;\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromRgb(r: number, g: number, b: number, a?: number): Color {\n  if (a === undefined) {\n    a = 255;\n  }\n  return (r << 24) + (g << 16) + (b << 8) + a;\n}\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromHsv(h: number, s: number, v: number, a?: number): Color {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      (r = v), (g = t), (b = p);\n      break;\n    case 1:\n      (r = q), (g = v), (b = p);\n      break;\n    case 2:\n      (r = p), (g = v), (b = t);\n      break;\n    case 3:\n      (r = p), (g = q), (b = v);\n      break;\n    case 4:\n      (r = t), (g = p), (b = v);\n      break;\n    case 5:\n      (r = v), (g = p), (b = q);\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n","import { fromRgb } from '../color';\n\n/**\n * Orignal CGA palette.\n * See: https://en.wikipedia.org/wiki/Color_Graphics_Adapter\n * See: https://lospec.com/palette-list/color-graphics-adapter\n */\nexport const Colors = {\n  BLACK: fromRgb(0, 0, 0),\n  WHITE: fromRgb(0xff, 0xff, 0xff),\n  LIGHT_GRAY: fromRgb(0xaa, 0xaa, 0xaa),\n  DARK_GRAY: fromRgb(0x55, 0x55, 0x55),\n  YELLOW: fromRgb(0xff, 0xff, 0x55),\n  BROWN: fromRgb(0xaa, 0x55, 0x00),\n  LIGHT_RED: fromRgb(0xff, 0x55, 0x55),\n  DARK_RED: fromRgb(0xaa, 0x00, 0x00),\n  LIGHT_GREEN: fromRgb(0x55, 0xff, 0x55),\n  DARK_GREEN: fromRgb(0x00, 0xaa, 0x00),\n  LIGHT_CYAN: fromRgb(0x55, 0xff, 0xff),\n  DARK_CYAN: fromRgb(0x00, 0xaa, 0xaa),\n  LIGHT_BLUE: fromRgb(0x55, 0x55, 0xff),\n  DARK_BLUE: fromRgb(0x00, 0x00, 0xaa),\n  LIGHT_MAGENTA: fromRgb(0xff, 0x55, 0xff),\n  DARK_MAGENTA: fromRgb(0xaa, 0x00, 0xaa),\n  ORANGE: fromRgb(0xff, 0x88, 0x00),\n};\n","interface SerializationBundle {\n  instances: InstancePlaceholder[];\n  root: unknown;\n}\n\ninterface InstancePlaceholder {\n  $type?: string;\n}\n\ninterface ReferencePlaceholder {\n  $ref: number;\n}\n\nconst classDefinitions = new Map<string, ObjectConstructor>();\n\n/**\n * Decorates a class to make serializable.\n * Any class with the @serializable decorator will be serialized and deserialized.\n * @param value The TypeScript class to mark as serializable.\n */\nexport function serializable(value: { name: string }): void {\n  classDefinitions.set(value.name, value as ObjectConstructor);\n}\n\n/**\n * Serializes a value to JSON.\n * Handles circular references and class instances.\n * @param obj The root object to serialize.\n * @returns A string representation of the object graph.\n */\nexport function serialize(obj: unknown): string {\n  const instances: InstancePlaceholder[] = [];\n  const instancesMap = new WeakMap<object, number>();\n  const root = replace(obj);\n  return JSON.stringify({ instances, root });\n\n  function replace(input: unknown): unknown {\n    if (Array.isArray(input)) {\n      return replaceArray(input);\n    } else if (input && typeof input === 'object') {\n      return replaceObject(input as Record<string, unknown>);\n    } else {\n      return input;\n    }\n  }\n\n  function replaceArray(input: unknown[]): unknown[] {\n    const result = [];\n    for (let i = 0; i < input.length; i++) {\n      result[i] = replace(input[i]);\n    }\n    return result;\n  }\n\n  function replaceObject(input: Record<string, unknown>): Record<string, unknown> {\n    if (input && input.constructor.name && input.constructor.name !== 'Object') {\n      if (!classDefinitions.has(input.constructor.name)) {\n        throw new Error(`Class ${input.constructor.name} is not serializable.`);\n      }\n      if (instancesMap.has(input)) {\n        return { $ref: instancesMap.get(input) };\n      }\n      const $ref = instances.length;\n      instances.push({ $type: input.constructor.name });\n      instancesMap.set(input, $ref);\n      instances[$ref] = { ...replaceObjectProperties(input), $type: input.constructor.name };\n      return { $ref };\n    }\n    return replaceObjectProperties(input);\n  }\n\n  function replaceObjectProperties(input: Record<string, unknown>): Record<string, unknown> {\n    const result: Record<string, unknown> = {};\n    for (const key of Object.keys(input)) {\n      result[key] = replace(input[key]);\n    }\n    return result;\n  }\n}\n\n/**\n * Deserializes a JSON string to an object graph.\n * Handles circular references and class instances.\n * @param str The JSON string to deserialize.\n * @returns The deserialized object graph.\n */\nexport function deserialize(str: string): unknown {\n  const input = JSON.parse(str) as SerializationBundle;\n  const instances = input.instances;\n\n  // First, replace all objects with class instances\n  for (let i = 0; i < instances.length; i++) {\n    const instance = instances[i];\n    const classDefinition = classDefinitions.get(instance.$type as string) as ObjectConstructor;\n    delete instance.$type;\n    instances[i] = Object.create(classDefinition.prototype, Object.getOwnPropertyDescriptors(instance));\n  }\n\n  // Second, replace all references in the list of class instances\n  for (let i = 0; i < instances.length; i++) {\n    replaceObjectProperties(instances[i] as unknown as Record<string, unknown>);\n  }\n\n  // Finally, replace all references in the root object graph\n  return replace(input.root);\n\n  function replace(input: unknown): unknown {\n    if (Array.isArray(input)) {\n      return replaceArray(input);\n    } else if (input && typeof input === 'object') {\n      return replaceObject(input as Record<string, unknown>);\n    } else {\n      return input;\n    }\n  }\n\n  function replaceArray(input: unknown[]): unknown[] {\n    for (let i = 0; i < input.length; i++) {\n      input[i] = replace(input[i]);\n    }\n    return input;\n  }\n\n  function replaceObject(input: Record<string, unknown>): InstancePlaceholder | Record<string, unknown> {\n    if (isRef(input)) {\n      return instances[input.$ref];\n    }\n    replaceObjectProperties(input);\n    return input;\n  }\n\n  function replaceObjectProperties(input: Record<string, unknown>): void {\n    for (const [key, value] of Object.entries(input)) {\n      input[key] = replace(value);\n    }\n  }\n}\n\nfunction isRef(value: unknown): value is ReferencePlaceholder {\n  return !!(value && typeof value === 'object' && '$ref' in value);\n}\n","// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nexport enum Chars {\n  SMILEY = 1,\n  INVERSE_SMILEY = 2,\n  HEART = 3,\n  DIAMOND = 4,\n  CLUB = 5,\n  SPADE = 6,\n  BULLET = 7,\n  INVERSE_BULLET = 8,\n\n  LIGHT_SHADE = 176,\n  MEDIUM_SHADE = 177,\n  DARK_SHADE = 178,\n\n  BOX_SINGLE_VERTICAL = 179,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT = 180,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT = 185,\n  BOX_DOUBLE_VERTICAL = 186,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT = 187,\n  BOX_DOUBLE_UP_AND_DOUBLE_LEFT = 188,\n  BOX_SINGLE_DOWN_AND_SINGLE_LEFT = 191,\n  BOX_SINGLE_UP_AND_SINGLE_RIGHT = 192,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP = 193,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN = 194,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT = 195,\n  BOX_SINGLE_HORIZONTAL = 196,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL = 197,\n  BOX_DOUBLE_UP_AND_DOUBLE_RIGHT = 200,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT = 201,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP = 202,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN = 203,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT = 204,\n  BOX_DOUBLE_HORIZONTAL = 205,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL = 206,\n  BOX_SINGLE_UP_AND_SINGLE_LEFT = 13 * 16 + 9,\n  BOX_SINGLE_DOWN_AND_SINGLE_RIGHT = 13 * 16 + 10,\n\n  BLOCK_FULL = 219,\n  BLOCK_BOTTOM_HALF = 13 * 16 + 12,\n  BLOCK_LEFT_HALF = 13 * 16 + 13,\n  BLOCK_RIGHT_HALF = 13 * 16 + 14,\n  BLOCK_TOP_HALF = 13 * 16 + 15,\n}\n","/**\n * Returns the input string wrapped to the maximum line length.\n * @param str The original input string.\n * @param maxLength The maximum length of a single line.\n * @returns Array of word wrapped lines.\n */\nexport function wordWrap(str: string, maxLength: number): string[] {\n  const regex = new RegExp('(\\\\S(.{0,' + maxLength + '}\\\\S)?)\\\\s+', 'g');\n  return (str + ' ')\n    .replace(regex, '$1\\n')\n    .trim()\n    .split('\\n')\n    .map((line) => line.trim());\n}\n\n/**\n * Capitalizes the first letter of the input string.\n * @param str The original input string.\n * @returns The capitalized string.\n */\nexport function capitalize(str: string): string {\n  if (!str) {\n    return str;\n  }\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n","import { BlendMode } from './blendmode';\nimport { Color, fromRgb } from './color';\nimport { Colors } from './palettes/colors';\nimport { serializable } from './serialize';\n\nfunction convertCharCode(charCode: string | number): number {\n  if (typeof charCode === 'string' && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode as number;\n  }\n}\n\n@serializable\nexport class Cell {\n  readonly x: number;\n  readonly y: number;\n  charCode: number;\n  fg: Color;\n  bg: Color;\n  dirty: boolean;\n  blocked: boolean;\n  blockedSight: boolean;\n  explored: boolean;\n  visible: boolean;\n  pathId: number;\n  g: number;\n  h: number;\n  prev: Cell | null;\n\n  constructor(x: number, y: number, charCode?: string | number, fg?: Color, bg?: Color) {\n    this.x = x;\n    this.y = y;\n\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode);\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = Colors.WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = Colors.BLACK;\n    }\n\n    this.dirty = true;\n    this.blocked = false;\n    this.blockedSight = false;\n    this.explored = false;\n    this.visible = false;\n    this.pathId = -1;\n    this.g = 0;\n    this.h = 0;\n    this.prev = null;\n  }\n\n  setCharCode(charCode: number): void {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg: Color): void {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg: Color): void {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setValue(charCode: string | number, fg?: Color, bg?: Color): boolean {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n\n      if (fg !== undefined) {\n        this.setForeground(fg);\n      }\n      if (bg !== undefined) {\n        this.setBackground(bg);\n      }\n    } else {\n      this.drawCell(charCode, BlendMode.None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell: Cell, blendMode?: BlendMode): void {\n    const alpha = otherCell.bg & 0xff;\n\n    if (blendMode === BlendMode.None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === BlendMode.None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n  }\n\n  private blendColors(c1: Color, c2: Color, blendMode?: BlendMode): Color {\n    const alpha = c2 & 0xff;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xff;\n    const g1 = (c1 >> 16) & 0xff;\n    const b1 = (c1 >> 8) & 0xff;\n    const r2 = (c2 >> 24) & 0xff;\n    const g2 = (c2 >> 16) & 0xff;\n    const b2 = (c2 >> 8) & 0xff;\n\n    switch (blendMode) {\n      case BlendMode.Blend:\n        return fromRgb((w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0, (w1 * b1 + w2 * b2) | 0);\n\n      case BlendMode.Add:\n        return fromRgb(this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0), this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  private clamp(x: number): number {\n    return Math.min(255, x);\n  }\n}\n","import { BlendMode } from './blendmode';\nimport { Cell } from './cell';\nimport { Chars } from './chars';\nimport { Color } from './color';\nimport { Message } from './gui/message';\nimport { Rect } from './rect';\nimport { serializable } from './serialize';\nimport { wordWrap } from './utils';\n\n@serializable\nexport class Console {\n  readonly width: number;\n  readonly height: number;\n  readonly grid: Cell[][];\n  originX: number;\n  originY: number;\n  minX: number;\n  maxX: number;\n  minY: number;\n  maxY: number;\n  radius: number;\n  clip?: Rect;\n\n  constructor(width: number, height: number, blockedFunc?: (x: number, y: number) => boolean) {\n    this.width = width;\n    this.height = height;\n    this.grid = [];\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    for (let y = 0; y < height; y++) {\n      const row = [];\n      for (let x = 0; x < width; x++) {\n        row.push(new Cell(x, y));\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = this.grid[y][x].blockedSight = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  clear(): void {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x: number, y: number): Cell | undefined {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  getCharCode(x: number, y: number): number | undefined {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x].charCode;\n  }\n\n  drawChar(x: number, y: number, c: string | number, fg?: Color, bg?: Color): void {\n    if (this.clip && !this.clip.contains({ x, y })) {\n      return;\n    }\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y | 0][x | 0].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x: number, y: number, str: string, fg?: Color, bg?: Color): void {\n    const lines = str.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      this.drawStringLine(x, y + i, lines[i], fg, bg);\n    }\n  }\n\n  drawStringLine(x: number, y: number, line: string, fg?: Color, bg?: Color): void {\n    for (let j = 0; j < line.length; j++) {\n      this.drawChar(x + j, y, line.charCodeAt(j), fg, bg);\n    }\n  }\n\n  drawCenteredString(x: number, y: number, str: string, fg?: Color, bg?: Color): void {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawMessage(x: number, y: number, message: Message, maxWidth?: number): number {\n    if (message.text) {\n      const lines = wordWrap(message.text, maxWidth || this.width - x);\n      for (const line of lines) {\n        this.drawStringLine(x, y, line, message.fg, message.bg);\n        y++;\n      }\n    }\n    if (message.children) {\n      for (const child of message.children) {\n        y = this.drawMessage(x, y, child, maxWidth);\n      }\n    }\n    return y;\n  }\n\n  drawHLine(x: number, y: number, width: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(x: number, y: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(x: number, y: number, width: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    topChar: number,\n    rightChar: number,\n    bottomChar: number,\n    leftChar: number,\n    topLeftChar: number,\n    topRightChar: number,\n    bottomRightChar: number,\n    bottomLeftChar: number,\n    fg?: Color,\n    bg?: Color\n  ): void {\n    this.drawHLine(x, y, width, topChar, fg, bg);\n    this.drawHLine(x, y + height - 1, width, bottomChar, fg, bg);\n\n    this.drawVLine(x, y, height, leftChar, fg, bg);\n    this.drawVLine(x + width - 1, y, height, rightChar, fg, bg);\n\n    this.drawChar(x, y, topLeftChar, fg, bg);\n    this.drawChar(x + width - 1, y, topRightChar, fg, bg);\n    this.drawChar(x, y + height - 1, bottomLeftChar, fg, bg);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar, fg, bg);\n  }\n\n  drawSingleBox(x: number, y: number, width: number, height: number, fg?: Color, bg?: Color): void {\n    this.drawBox(\n      x,\n      y,\n      width,\n      height,\n      Chars.BOX_SINGLE_HORIZONTAL,\n      Chars.BOX_SINGLE_VERTICAL,\n      Chars.BOX_SINGLE_HORIZONTAL,\n      Chars.BOX_SINGLE_VERTICAL,\n      Chars.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n      Chars.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n      Chars.BOX_SINGLE_UP_AND_SINGLE_LEFT,\n      Chars.BOX_SINGLE_UP_AND_SINGLE_RIGHT,\n      fg,\n      bg\n    );\n  }\n\n  drawDoubleBox(x: number, y: number, width: number, height: number, fg?: Color, bg?: Color): void {\n    this.drawBox(\n      x,\n      y,\n      width,\n      height,\n      Chars.BOX_DOUBLE_HORIZONTAL,\n      Chars.BOX_DOUBLE_VERTICAL,\n      Chars.BOX_DOUBLE_HORIZONTAL,\n      Chars.BOX_DOUBLE_VERTICAL,\n      Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n      Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n      Chars.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n      Chars.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,\n      fg,\n      bg\n    );\n  }\n\n  fillRect(x: number, y: number, width: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n    dstX: number,\n    dstY: number,\n    srcConsole: Console,\n    srcX: number,\n    srcY: number,\n    srcWidth: number,\n    srcHeight: number,\n    blendMode?: BlendMode\n  ): void {\n    blendMode = blendMode || BlendMode.None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  drawCell(x: number, y: number, cell: Cell, blendMode?: BlendMode): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n\n  setBlocked(x: number, y: number, blocked: boolean): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  setBlockedSight(x: number, y: number, blockedSight: boolean): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blockedSight = blockedSight;\n    }\n  }\n\n  isVisible(x: number, y: number): boolean {\n    if (x < this.minX || x > this.maxX || y < this.minY || y > this.maxY) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  isBlocked(x: number, y: number): boolean {\n    if (x < 0 || x > this.width || y < 0 || y > this.height) {\n      return true;\n    }\n    return this.grid[y][x].blocked;\n  }\n\n  isBlockedSight(x: number, y: number): boolean {\n    if (x < 0 || x > this.width || y < 0 || y > this.height) {\n      return true;\n    }\n    return this.grid[y][x].blockedSight;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  private computeOctantY(deltaX: number, deltaY: number): void {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (\n      y = this.originY + deltaY;\n      y >= this.minY && y <= this.maxY;\n      y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration\n    ) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (\n        processedCell = Math.floor(minSlope * iteration + 0.5), x = this.originX + processedCell * deltaX;\n        processedCell <= iteration && x >= this.minX && x <= this.maxX;\n        x += deltaX, ++processedCell, previousEndSlope = endSlope\n      ) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (\n            !(this.grid[y - deltaY][x].visible && !this.grid[y - deltaY][x].blockedSight) &&\n            !(this.grid[y - deltaY][x - deltaX].visible && !this.grid[y - deltaY][x - deltaX].blockedSight)\n          ) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] && endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockedSight) {\n                  if (centreSlope > startSlopes[idx] && centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] && endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockedSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  private computeOctantX(deltaX: number, deltaY: number): void {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (\n      x = this.originX + deltaX;\n      x >= this.minX && x <= this.maxX;\n      x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration\n    ) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (\n        processedCell = Math.floor(minSlope * iteration + 0.5), y = this.originY + processedCell * deltaY;\n        processedCell <= iteration && y >= this.minY && y <= this.maxY;\n        y += deltaY, ++processedCell, previousEndSlope = endSlope\n      ) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (\n            !(this.grid[y][x - deltaX].visible && !this.grid[y][x - deltaX].blockedSight) &&\n            !(this.grid[y - deltaY][x - deltaX].visible && !this.grid[y - deltaY][x - deltaX].blockedSight)\n          ) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] && endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockedSight) {\n                  if (centreSlope > startSlopes[idx] && centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] && endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockedSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX: number, originY: number, radius: number, opt_noClear?: boolean, opt_octants?: number): void {\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n\n    if (opt_noClear) {\n      this.minX = Math.min(this.minX, Math.max(0, originX - radius));\n      this.minY = Math.min(this.minY, Math.max(0, originY - radius));\n      this.maxX = Math.max(this.maxX, Math.min(this.width - 1, originX + radius));\n      this.maxY = Math.max(this.maxY, Math.min(this.height - 1, originY + radius));\n    } else {\n      this.minX = Math.max(0, originX - radius);\n      this.minY = Math.max(0, originY - radius);\n      this.maxX = Math.min(this.width - 1, originX + radius);\n      this.maxY = Math.min(this.height - 1, originY + radius);\n\n      for (let y = this.minY; y <= this.maxY; y++) {\n        for (let x = this.minX; x <= this.maxX; x++) {\n          this.grid[y][x].visible = false;\n        }\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n\n    if (opt_octants === undefined) {\n      this.computeOctantY(1, 1);\n      this.computeOctantX(1, 1);\n      this.computeOctantX(1, -1);\n      this.computeOctantY(1, -1);\n      this.computeOctantY(-1, -1);\n      this.computeOctantX(-1, -1);\n      this.computeOctantX(-1, 1);\n      this.computeOctantY(-1, 1);\n    } else {\n      //   \\ 4 | 3 /\n      //    \\  |  /\n      //  5  \\ | /  2\n      //      \\|/\n      // ------+-------\n      //      /|\\\n      //  6  / | \\  1\n      //    /  |  \\\n      //   / 7 | 0 \\\n      if (opt_octants & 0x001) {\n        this.computeOctantY(1, 1);\n      }\n\n      if (opt_octants & 0x002) {\n        this.computeOctantX(1, 1);\n      }\n\n      if (opt_octants & 0x004) {\n        this.computeOctantX(1, -1);\n      }\n\n      if (opt_octants & 0x008) {\n        this.computeOctantY(1, -1);\n      }\n\n      if (opt_octants & 0x010) {\n        this.computeOctantY(-1, -1);\n      }\n\n      if (opt_octants & 0x020) {\n        this.computeOctantX(-1, -1);\n      }\n\n      if (opt_octants & 0x040) {\n        this.computeOctantX(-1, 1);\n      }\n\n      if (opt_octants & 0x080) {\n        this.computeOctantY(-1, 1);\n      }\n    }\n  }\n\n  /**\n   * All visible tiles are marked as explored.\n   */\n  updateExplored(): void {\n    for (let y = this.minY; y <= this.maxY; y++) {\n      for (let x = this.minX; x <= this.maxX; x++) {\n        const tile = this.grid[y][x];\n        tile.explored = tile.explored || tile.visible;\n      }\n    }\n  }\n}\n","export class Font {\n  readonly url: string;\n  readonly charWidth: number;\n  readonly charHeight: number;\n  readonly scale: number;\n\n  constructor(url: string, charWidth: number, charHeight: number, scale?: number) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQ' +\n  'MAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8' +\n  'QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY' +\n  '09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1' +\n  'zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eIC' +\n  'JsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBq' +\n  'ucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqh' +\n  'JRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvh' +\n  'A1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL' +\n  '0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu' +\n  '2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIz' +\n  'CAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsW' +\n  'IE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBW' +\n  'l5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h' +\n  '5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtL' +\n  'ji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb' +\n  '2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O' +\n  '3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2f' +\n  'otTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZ' +\n  'UghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2G' +\n  'AzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc' +\n  '4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJ' +\n  'G199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJI' +\n  'lipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC';\n\nexport const DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n","/**\n * The FovOctants constants provide bitmasks for various directions.\n *\n *     \\ 4 | 3 /\n *      \\  |  /\n *    5  \\ | /  2\n *        \\|/\n *   ------+-------\n *        /|\\\n *    6  / | \\  1\n *      /  |  \\\n *     / 7 | 0 \\\n *\n */\nexport enum FovOctants {\n  OCTANT_SOUTH_SOUTHEAST = 0x001,\n  OCTANT_EAST_SOUTHEAST = 0x002,\n  OCTANT_EAST_NORTHTHEAST = 0x004,\n  OCTANT_NORTH_NORTHEAST = 0x008,\n  OCTANT_NORTH_NORTHWEST = 0x010,\n  OCTANT_WEST_NORTHEAST = 0x020,\n  OCTANT_WEST_SOUTHWEST = 0x040,\n  OCTANT_SOUTH_SOUTHWEST = 0x080,\n}\n\nexport enum FovQuadrants {\n  QUADRANT_SOUTHEAST = 0x001 + 0x002,\n  QUADRANT_EAST = 0x002 + 0x004,\n  QUADRANT_NORTHEAST = 0x004 + 0x008,\n  QUADRANT_NORTH = 0x008 + 0x010,\n  QUADRANT_NORTHWEST = 0x010 + 0x020,\n  QUADRANT_WEST = 0x020 + 0x040,\n  QUADRANT_SOUTHWEST = 0x040 + 0x080,\n  QUADRANT_SOUTH = 0x080 + 0x001,\n}\n\nexport function getFovQuadrant(dx: number, dy: number): FovQuadrants {\n  if (dx > 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHEAST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_EAST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHEAST;\n    }\n  } else if (dx < 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHWEST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_WEST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHWEST;\n    }\n  } else {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTH;\n    } else {\n      return FovQuadrants.QUADRANT_NORTH;\n    }\n  }\n}\n","import { serializable } from './serialize';\n\nexport interface PointLike {\n  readonly x: number;\n  readonly y: number;\n}\n\n@serializable\nexport class Point implements PointLike {\n  readonly x: number;\n  readonly y: number;\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n}\n","import { Point } from './point';\nimport { serializable } from './serialize';\n\n@serializable\nexport class Rect {\n  readonly x: number;\n  readonly y: number;\n  readonly width: number;\n  readonly height: number;\n  readonly left: number;\n  readonly top: number;\n  readonly x2: number;\n  readonly y2: number;\n\n  constructor(x: number, y: number, width: number, height: number) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n    this.x2 = x + width;\n    this.y2 = y + height;\n  }\n\n  getCenter(): Point {\n    return new Point((this.x + this.width / 2) | 0, (this.y + this.height / 2) | 0);\n  }\n\n  intersects(other: Rect): boolean {\n    return this.x <= other.x2 && this.x2 >= other.x && this.y <= other.y2 && this.y2 >= other.y;\n  }\n\n  contains(point: Point | Rect): boolean {\n    return point.x >= this.x && point.x < this.x2 && point.y >= this.y && point.y < this.y2;\n  }\n}\n","import { Console } from '../console';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Dialog } from './dialog';\n\nexport class DialogState {\n  readonly dialog: Dialog;\n  readonly rect: Rect;\n  readonly contentsOffset: Point;\n  open: boolean;\n  count: number;\n  buffer?: Console;\n\n  constructor(dialog: Dialog, rect: Rect, contentsOffset: Point) {\n    this.dialog = dialog;\n    this.rect = rect;\n    this.contentsOffset = contentsOffset;\n    this.open = false;\n    this.count = 0;\n  }\n}\n","import { Colors } from '../palettes/colors';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Terminal } from '../terminal';\nimport { Dialog } from './dialog';\nimport { DialogState } from './dialogstate';\n\nexport class DefaultDialogRenderer {\n  getState(terminal: Terminal, dialog: Dialog): DialogState {\n    const width = dialog.contentsRect.width + 4;\n    const height = dialog.contentsRect.height + 4;\n    const x = ((terminal.width - width) / 2) | 0;\n    const y = ((terminal.height - height) / 2) | 0;\n    return new DialogState(dialog, new Rect(x, y, width, height), new Point(x + 2, y + 2));\n  }\n\n  draw(term: Terminal, dialogState: DialogState): void {\n    const dialog = dialogState.dialog;\n    const { x, y, width, height } = dialogState.rect;\n    term.fillRect(x, y, width, height, 0, Colors.WHITE, Colors.BLACK);\n    term.drawSingleBox(x, y, width, height);\n    term.drawCenteredString((x + width / 2) | 0, y, ' ' + dialog.title + ' ');\n    dialog.drawContents(term, dialogState.contentsOffset);\n  }\n}\n","import { Console } from '../console';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Terminal } from '../terminal';\n\nexport abstract class Dialog {\n  readonly contentsRect: Rect;\n  readonly title: string;\n\n  constructor(contentsRect: Rect, title: string) {\n    this.contentsRect = contentsRect;\n    this.title = title;\n  }\n\n  abstract drawContents(console: Console, offset: Point): void;\n\n  abstract handleInput(terminal: Terminal, offset: Point): boolean;\n}\n","import { Color } from '../color';\nimport { serializable } from '../serialize';\n\n@serializable\nexport class Message {\n  constructor(\n    readonly text: string | undefined,\n    readonly fg?: Color | undefined,\n    readonly bg?: Color | undefined,\n    readonly children?: Message[]\n  ) {}\n\n  getWidth(): number {\n    let width = 0;\n\n    if (this.text) {\n      for (const line of this.text.split('\\n')) {\n        width = Math.max(width, line.length);\n      }\n    }\n\n    if (this.children) {\n      for (const child of this.children) {\n        width = Math.max(width, child.getWidth());\n      }\n    }\n\n    return width;\n  }\n\n  getHeight(): number {\n    let result = 0;\n\n    if (this.text) {\n      result += this.text.split('\\n').length;\n    }\n\n    if (this.children) {\n      for (const child of this.children) {\n        result += child.getHeight();\n      }\n    }\n\n    return result;\n  }\n}\n","/**\n * The delay in frames before input repeating.\n * Time in milliseconds.\n */\nconst INPUT_REPEAT_DELAY = 200.0;\n\n/**\n * The delay between subsequent repeat firing.\n * Time in milliseconds.\n */\nconst INPUT_REPEAT_RATE = 1000.0 / 15.0;\n\n/**\n * The Input class represents a pysical input.\n * Example: keyboard key or mouse button.\n */\nexport class Input {\n  down: boolean;\n  downTime: number;\n  repeat: boolean;\n  repeatTime: number;\n  downCount: number;\n  upCount: number;\n\n  constructor() {\n    this.down = false;\n    this.downTime = 0;\n    this.repeat = false;\n    this.repeatTime = 0;\n    this.downCount = 0;\n    this.upCount = 100;\n  }\n\n  setDown(down: boolean): void {\n    if (this.down !== down) {\n      this.down = down;\n      this.repeat = false;\n      this.downTime = this.repeatTime = performance.now();\n    }\n  }\n\n  update(time: number): void {\n    this.repeat = false;\n    if (this.down) {\n      this.downCount++;\n      this.upCount = 0;\n      if (time - this.downTime >= INPUT_REPEAT_DELAY && time - this.repeatTime >= INPUT_REPEAT_RATE) {\n        this.repeat = true;\n        this.repeatTime = time;\n      }\n    } else {\n      this.downCount = 0;\n      this.upCount++;\n    }\n  }\n\n  /**\n   * Returns true if the input is \"pressed\".\n   * Pressed is a one time event when the input first goes down.\n   * It then repeats on repeat delay.\n   */\n  isPressed(): boolean {\n    return this.downCount === 1 || this.repeat;\n  }\n\n  /**\n   * Returns true if the input is \"clicked\".\n   * Clicked is a one time event when the input first goes up.\n   */\n  isClicked(): boolean {\n    return this.upCount === 1;\n  }\n}\n\nexport class InputSet<T> {\n  readonly inputs = new Map<T, Input>();\n\n  clear(): void {\n    this.inputs.clear();\n  }\n\n  get(key: T): Input {\n    let input = this.inputs.get(key);\n    if (!input) {\n      input = new Input();\n      this.inputs.set(key, input);\n    }\n    return input;\n  }\n\n  updateAll(time: number): void {\n    this.inputs.forEach((input) => input.update(time));\n  }\n}\n","import { Input, InputSet } from './input';\n\nexport class Keyboard {\n  readonly keys = new InputSet<Key>();\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el: HTMLElement) {\n    el.addEventListener('keydown', (e) => this.setKey(e, true));\n    el.addEventListener('keyup', (e) => this.setKey(e, false));\n  }\n\n  clear(): void {\n    this.keys.clear();\n  }\n\n  getKey(key: Key): Input {\n    return this.keys.get(key);\n  }\n\n  setKey(e: KeyboardEvent, state: boolean): void {\n    const key = e.code as Key;\n    if (key === Key.VK_F11) {\n      // Allow fullscreen requests to go through\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    this.keys.get(key).setDown(state);\n  }\n\n  updateKeys(time: number): void {\n    this.keys.updateAll(time);\n  }\n}\n\nexport enum Key {\n  VK_CANCEL = 'Pause',\n  VK_BACKSPACE = 'Backspace',\n  VK_TAB = 'Tab',\n  VK_ENTER = 'Enter',\n  VK_SHIFT_LEFT = 'ShiftLeft',\n  VK_SHIFT_RIGHT = 'ShiftLeft',\n  VK_CONTROL_LEFT = 'ControlLeft',\n  VK_CONTROL_RIGHT = 'ControlRight',\n  VK_ALT_LEFT = 'AltLeft',\n  VK_ALT_RIGHT = 'AltRight',\n  VK_PAUSE = 'Pause',\n  VK_CAPS_LOCK = 'CapsLock',\n  VK_ESCAPE = 'Escape',\n  VK_SPACE = 'Space',\n  VK_PAGE_UP = 'PageUp',\n  VK_PAGE_DOWN = 'PageDown',\n  VK_END = 'End',\n  VK_HOME = 'Home',\n  VK_LEFT = 'ArrowLeft',\n  VK_UP = 'ArrowUp',\n  VK_RIGHT = 'ArrowRight',\n  VK_DOWN = 'ArrowDown',\n  VK_INSERT = 'Insert',\n  VK_DELETE = 'Delete',\n  VK_0 = 'Digit0',\n  VK_1 = 'Digit1',\n  VK_2 = 'Digit2',\n  VK_3 = 'Digit3',\n  VK_4 = 'Digit4',\n  VK_5 = 'Digit5',\n  VK_6 = 'Digit6',\n  VK_7 = 'Digit7',\n  VK_8 = 'Digit8',\n  VK_9 = 'Digit9',\n  VK_SEMICOLON = 'Semicolon',\n  VK_EQUALS = 'Equal',\n  VK_A = 'KeyA',\n  VK_B = 'KeyB',\n  VK_C = 'KeyC',\n  VK_D = 'KeyD',\n  VK_E = 'KeyE',\n  VK_F = 'KeyF',\n  VK_G = 'KeyG',\n  VK_H = 'KeyH',\n  VK_I = 'KeyI',\n  VK_J = 'KeyJ',\n  VK_K = 'KeyK',\n  VK_L = 'KeyL',\n  VK_M = 'KeyM',\n  VK_N = 'KeyN',\n  VK_O = 'KeyO',\n  VK_P = 'KeyP',\n  VK_Q = 'KeyQ',\n  VK_R = 'KeyR',\n  VK_S = 'KeyS',\n  VK_T = 'KeyT',\n  VK_U = 'KeyU',\n  VK_V = 'KeyV',\n  VK_W = 'KeyW',\n  VK_X = 'KeyX',\n  VK_Y = 'KeyY',\n  VK_Z = 'KeyZ',\n  VK_CONTEXT_MENU = 'ContextMenu',\n  VK_NUMPAD0 = 'Numpad0',\n  VK_NUMPAD1 = 'Numpad1',\n  VK_NUMPAD2 = 'Numpad2',\n  VK_NUMPAD3 = 'Numpad3',\n  VK_NUMPAD4 = 'Numpad4',\n  VK_NUMPAD5 = 'Numpad5',\n  VK_NUMPAD6 = 'Numpad6',\n  VK_NUMPAD7 = 'Numpad7',\n  VK_NUMPAD8 = 'Numpad8',\n  VK_NUMPAD9 = 'Numpad9',\n  VK_NUMPAD_ENTER = 'NumpadEnter',\n  VK_MULTIPLY = 'NumpadMultiply',\n  VK_ADD = 'NumpadAdd',\n  VK_SEPARATOR = 'NumpadDecimal',\n  VK_SUBTRACT = 'NumpadSubtract',\n  VK_DECIMAL = 'NumpadDecimal',\n  VK_DIVIDE = 'NumpadDivide',\n  VK_F1 = 'F1',\n  VK_F2 = 'F2',\n  VK_F3 = 'F3',\n  VK_F4 = 'F4',\n  VK_F5 = 'F5',\n  VK_F6 = 'F6',\n  VK_F7 = 'F7',\n  VK_F8 = 'F8',\n  VK_F9 = 'F9',\n  VK_F10 = 'F10',\n  VK_F11 = 'F11',\n  VK_F12 = 'F12',\n  VK_F13 = 'F13',\n  VK_F14 = 'F14',\n  VK_F15 = 'F15',\n  VK_F16 = 'F16',\n  VK_F17 = 'F17',\n  VK_F18 = 'F18',\n  VK_F19 = 'F19',\n  VK_F20 = 'F20',\n  VK_F21 = 'F21',\n  VK_F22 = 'F22',\n  VK_F23 = 'F23',\n  VK_F24 = 'F24',\n  VK_NUM_LOCK = 'NumLock',\n  VK_SCROLL_LOCK = 'ScrollLock',\n  VK_COMMA = 'Comma',\n  VK_PERIOD = 'Period',\n  VK_SLASH = 'Slash',\n  VK_BACKQUOTE = 'Backquote',\n  VK_OPEN_BRACKET = 'BracketLeft',\n  VK_BACK_SLASH = 'Backslash',\n  VK_CLOSE_BRACKET = 'BracketRight',\n  VK_QUOTE = 'Quote',\n  VK_META = 'OSLeft',\n}\n","import { Cell } from './cell';\nimport { Chars } from './chars';\nimport { Color, fromRgb } from './color';\nimport { Console } from './console';\n\n/**\n * All available 2x2 patterns for 2x image loading.\n * Note: The strict IBM CGA font only has halves, not quadrants.\n */\nconst PATTERNS = [\n  { charCode: Chars.BLOCK_TOP_HALF, active: [1, 1, 0, 0] },\n  { charCode: Chars.BLOCK_RIGHT_HALF, active: [0, 1, 0, 1] },\n];\n\nexport function loadImage(url: string, callback: (img: Console) => void): void {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w, h);\n    let i = 0;\n\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        const cell = result.getCell(x, y) as Cell;\n        cell.setBackground(fromRgb(data[i++], data[i++], data[i++], data[i++]));\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nexport function loadImage2x(url: string, callback: (img: Console) => void): void {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w / 2, h / 2);\n\n    for (let y = 0; y < h; y += 2) {\n      for (let x = 0; x < w; x += 2) {\n        draw2x2(result, data, x, y, w);\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nfunction getImageData(img: HTMLImageElement): Uint8ClampedArray {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n  ctx.drawImage(img, 0, 0);\n\n  return ctx.getImageData(0, 0, img.width, img.height).data;\n}\n\nfunction draw2x2(con: Console, data: Uint8ClampedArray, x: number, y: number, w: number): void {\n  // Top left\n  const i1 = 4 * (y * w + x);\n  const r1 = data[i1];\n  const g1 = data[i1 + 1];\n  const b1 = data[i1 + 2];\n\n  // Top right\n  const i2 = 4 * (y * w + x + 1);\n  const r2 = data[i2];\n  const g2 = data[i2 + 1];\n  const b2 = data[i2 + 2];\n\n  // Bottom left\n  const i3 = 4 * ((y + 1) * w + x);\n  const r3 = data[i3];\n  const g3 = data[i3 + 1];\n  const b3 = data[i3 + 2];\n\n  // Bottom right\n  const i4 = 4 * ((y + 1) * w + x + 1);\n  const r4 = data[i4];\n  const g4 = data[i4 + 1];\n  const b4 = data[i4 + 2];\n\n  const colors = [\n    [r1, g1, b1],\n    [r2, g2, b2],\n    [r3, g3, b3],\n    [r4, g4, b4],\n  ];\n\n  // For each possible pattern, calculate the total error\n  // Find the pattern with minum error\n\n  let minError = Number.MAX_VALUE;\n  let bestCharCode = 0;\n  let bestBg = null;\n  let bestFg = null;\n\n  for (let i = 0; i < PATTERNS.length; i++) {\n    const pattern = PATTERNS[i];\n    const patternColors = computeColors(pattern.active, colors);\n    if (patternColors.error < minError) {\n      minError = patternColors.error;\n      bestCharCode = pattern.charCode;\n      bestBg = patternColors.bg;\n      bestFg = patternColors.fg;\n    }\n  }\n\n  con.drawChar(x / 2, y / 2, bestCharCode, arrayToColor(bestFg as number[]), arrayToColor(bestBg as number[]));\n}\n\nfunction computeColors(pattern: number[], colors: number[][]): { error: number; bg: number[]; fg: number[] } {\n  const sum = [\n    [0, 0, 0],\n    [0, 0, 0],\n  ];\n  const avg = [\n    [0, 0, 0],\n    [0, 0, 0],\n  ];\n  const count = [0, 0];\n\n  for (let i = 0; i < 4; i++) {\n    for (let j = 0; j < 3; j++) {\n      sum[pattern[i]][j] += colors[i][j];\n    }\n    count[pattern[i]]++;\n  }\n\n  for (let i = 0; i < 2; i++) {\n    for (let j = 0; j < 3; j++) {\n      avg[i][j] = sum[i][j] / count[i];\n    }\n  }\n\n  let error = 0.0;\n\n  for (let i = 0; i < 4; i++) {\n    let cellError = 0.0;\n    for (let j = 0; j < 3; j++) {\n      const delta = colors[i][j] - avg[pattern[i]][j];\n      cellError += delta * delta;\n    }\n    error += Math.sqrt(cellError);\n  }\n\n  return { bg: avg[0], fg: avg[1], error };\n}\n\nfunction arrayToColor(rgb: number[]): Color {\n  return fromRgb(rgb[0], rgb[1], rgb[2]);\n}\n","import { InputSet } from './input';\nimport { Rect } from './rect';\nimport { Terminal } from './terminal';\n\nexport class Mouse {\n  readonly el: HTMLCanvasElement;\n  readonly width: number;\n  readonly height: number;\n  readonly buttons = new InputSet<number>();\n  private prevX: number;\n  private prevY: number;\n  x: number;\n  y: number;\n  dx: number;\n  dy: number;\n  wheelDeltaX: number;\n  wheelDeltaY: number;\n\n  constructor(terminal: Terminal) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.wheelDeltaX = 0;\n    this.wheelDeltaY = 0;\n\n    const el = this.el;\n    el.addEventListener('mousedown', (e) => this.handleEvent(e));\n    el.addEventListener('mouseup', (e) => this.handleEvent(e));\n    el.addEventListener('mousemove', (e) => this.handleEvent(e));\n    el.addEventListener('contextmenu', (e) => this.handleEvent(e));\n    el.addEventListener('touchstart', (e) => this.handleTouchEvent(e));\n    el.addEventListener('touchend', (e) => this.handleTouchEvent(e));\n    el.addEventListener('touchcancel', (e) => this.handleTouchEvent(e));\n    el.addEventListener('touchmove', (e) => this.handleTouchEvent(e));\n    el.addEventListener('wheel', (e) => this.handleWheelEvent(e));\n  }\n\n  private handleTouchEvent(e: TouchEvent): void {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons.get(0).setDown(true);\n    } else {\n      this.buttons.get(0).setDown(false);\n    }\n  }\n\n  private handleEvent(e: MouseEvent): void {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons.get(e.button).setDown(true);\n      this.el.focus();\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons.get(e.button).setDown(false);\n    }\n  }\n\n  private handleWheelEvent(e: WheelEvent): void {\n    e.stopPropagation();\n    e.preventDefault();\n    this.wheelDeltaX = e.deltaX;\n    this.wheelDeltaY = e.deltaY;\n  }\n\n  private updatePosition(clientX: number, clientY: number): void {\n    let rect: Rect | DOMRect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new Rect(Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new Rect(0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = ((this.width * (clientX - rect.left)) / rect.width) | 0;\n    this.y = ((this.height * (clientY - rect.top)) / rect.height) | 0;\n  }\n\n  update(time: number): void {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n    this.buttons.updateAll(time);\n  }\n}\n","import { fromRgb } from '../color';\n\n/**\n * Commodore 64 palette.\n * See: https://www.c64-wiki.com/wiki/Color\n * See: https://lospec.com/palette-list/commodore64\n */\nexport const Commodore64Palette = {\n  BLACK: fromRgb(0, 0, 0),\n  WHITE: fromRgb(255, 255, 255),\n  RED: fromRgb(136, 0, 0),\n  CYAN: fromRgb(170, 255, 238),\n  VIOLET: fromRgb(204, 68, 204),\n  GREEN: fromRgb(0, 204, 85),\n  BLUE: fromRgb(0, 0, 170),\n  YELLOW: fromRgb(238, 238, 119),\n  ORANGE: fromRgb(221, 136, 85),\n  BROWN: fromRgb(102, 68, 0),\n  LIGHT_RED: fromRgb(255, 119, 119),\n  DARK_GRAY: fromRgb(51, 51, 51),\n  GRAY: fromRgb(119, 119, 119),\n  LIGHT_GREEN: fromRgb(170, 255, 102),\n  LIGHT_BLUE: fromRgb(0, 136, 255),\n  LIGHT_GRAY: fromRgb(187, 187, 187),\n};\n","import { fromRgb } from '../color';\n\n/**\n * Colodore palette.\n * Recalculated palette for the VIC II (Commodore 64) by Pepto.\n * See: https://www.pepto.de/projects/colorvic/\n * See: https://lospec.com/palette-list/colodore\n */\nexport const ColodorePalette = {\n  BLACK: fromRgb(0, 0, 0),\n  WHITE: fromRgb(255, 255, 255),\n  RED: fromRgb(136, 0, 0),\n  CYAN: fromRgb(170, 255, 238),\n  VIOLET: fromRgb(204, 68, 204),\n  GREEN: fromRgb(0, 204, 85),\n  BLUE: fromRgb(0, 0, 170),\n  YELLOW: fromRgb(238, 238, 119),\n  ORANGE: fromRgb(221, 136, 85),\n  BROWN: fromRgb(102, 68, 0),\n  LIGHT_RED: fromRgb(255, 119, 119),\n  DARK_GRAY: fromRgb(51, 51, 51),\n  GRAY: fromRgb(119, 119, 119),\n  LIGHT_GREEN: fromRgb(170, 255, 102),\n  LIGHT_BLUE: fromRgb(0, 136, 255),\n  LIGHT_GRAY: fromRgb(187, 187, 187),\n};\n","import { fromRgb } from '../color';\n\n/**\n * PICO 8 palette.\n * See: https://pico-8.fandom.com/wiki/Palette\n * See: https://lospec.com/palette-list/pico-8\n */\nexport const Pico8Palette = {\n  BLACK: fromRgb(0, 0, 0),\n  DARK_BLUE: fromRgb(29, 43, 83),\n  DARK_PURPLE: fromRgb(126, 37, 83),\n  DARK_GREEN: fromRgb(0, 135, 81),\n  BROWN: fromRgb(171, 82, 54),\n  DARK_GRAY: fromRgb(95, 87, 79),\n  LIGHT_GRAY: fromRgb(194, 195, 199),\n  WHITE: fromRgb(255, 241, 232),\n  RED: fromRgb(255, 0, 77),\n  ORANGE: fromRgb(255, 163, 0),\n  YELLOW: fromRgb(255, 236, 39),\n  GREEN: fromRgb(0, 228, 54),\n  BLUE: fromRgb(41, 173, 255),\n  LAVENDER: fromRgb(131, 118, 156),\n  PINK: fromRgb(255, 119, 168),\n  LIGHT_PEACH: fromRgb(255, 204, 170),\n};\n","import { Cell } from './cell';\nimport { Console } from './console';\nimport { PointLike } from './point';\n\nconst dxs = [-1, 0, 1, -1, 1, -1, 0, 1];\nconst dys = [-1, -1, -1, 0, 0, 1, 1, 1];\nconst costs = [1.4, 1, 1.4, 1, 1, 1.4, 1, 1.4];\nlet pathId = 0;\n\n/**\n * Calculates path between two points using Dijkstra's algorithm.\n *\n * @param source Starting point, must have x and y properties.\n * @param dest Destination point, must have x and y properties.\n * @param maxDist Maximum distance to examine.\n * @return Array of steps if destination found; undefined otherwise.\n */\nexport function computePath(map: Console, source: PointLike, dest: PointLike, maxDist: number): Cell[] | undefined {\n  pathId++;\n\n  const sourceCell = map.grid[source.y][source.x];\n  sourceCell.pathId = pathId;\n  sourceCell.g = 0.0;\n  sourceCell.h = Math.hypot(source.x - dest.x, source.y - dest.y);\n  sourceCell.prev = null;\n\n  const q = new SortedSet([sourceCell]);\n\n  while (q.size() > 0) {\n    const u = q.pop() as Cell;\n\n    if (u.x === dest.x && u.y === dest.y) {\n      return buildPath(u);\n    }\n\n    for (let i = 0; i < dxs.length; i++) {\n      const x = u.x + dxs[i];\n      const y = u.y + dys[i];\n      if (x >= 0 && x < map.width && y >= 0 && y < map.height) {\n        const v = map.grid[y][x];\n        if (v.blocked && v.explored && (x !== dest.x || y !== dest.y)) {\n          continue;\n        }\n        if (v.pathId !== pathId) {\n          v.pathId = pathId;\n          v.g = Infinity;\n          v.h = Math.hypot(x - dest.x, y - dest.y);\n          v.prev = null;\n        }\n        const alt = u.g + costs[i];\n        if (alt < v.g && alt <= maxDist) {\n          v.g = alt;\n          v.prev = u;\n          q.insert(v);\n        }\n      }\n    }\n  }\n  return undefined;\n}\n\nfunction buildPath(cell: Cell): Cell[] {\n  const result = [];\n  let curr: Cell | null = cell;\n  while (curr) {\n    result.push(curr);\n    curr = curr.prev;\n  }\n  result.reverse();\n  return result;\n}\n\nclass SortedSet {\n  private readonly values: Cell[];\n\n  constructor(initialValues: Cell[]) {\n    this.values = initialValues;\n  }\n\n  insert(cell: Cell): void {\n    const array = this.values;\n    let low = 0;\n    let high = array.length;\n    let index = 0;\n\n    while (low < high) {\n      const mid = (low + high) >>> 1;\n      const midCell = array[mid];\n      if (midCell.g + midCell.h > cell.g + cell.h) {\n        low = mid + 1;\n        index = low;\n      } else {\n        high = mid;\n        index = high;\n      }\n    }\n    array.splice(index, 0, cell);\n  }\n\n  pop(): Cell | undefined {\n    return this.values.pop();\n  }\n\n  size(): number {\n    return this.values.length;\n  }\n}\n","import { serializable } from './serialize';\n\n/**\n * Random number generator.\n *\n * LCG\n * https://stackoverflow.com/a/424445/2051724\n */\n@serializable\nexport class RNG {\n  private m: number;\n  private a: number;\n  private c: number;\n  private state: number;\n\n  /**\n   * Creates a new random number generator.\n   *\n   * @param seed The integer seed.\n   */\n  constructor(seed?: number) {\n    // LCG using GCC's constants\n    this.m = 0x80000000; // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n    this.state = seed || 1;\n  }\n\n  nextInt(): number {\n    this.state = (this.a * this.state + this.c) % this.m;\n    return this.state;\n  }\n\n  /**\n   * Returns a floating point number between 0.0 and 1.0.\n   */\n  nextFloat(): number {\n    // returns in range [0,1]\n    return this.nextInt() / (this.m - 1);\n  }\n\n  /**\n   * Returns an integer in the range start (inclusive) to end (exclusive).\n   * @param start Lower bound, inclusive.\n   * @param end Upper bound, exclusive.\n   */\n  nextRange(start: number, end: number): number {\n    // returns in range [start, end): including start, excluding end\n    // can't modulu nextInt because of weak randomness in lower bits\n    const rangeSize = end - start;\n    const randomUnder1 = this.nextInt() / this.m;\n    const result = start + ((randomUnder1 * rangeSize) | 0);\n    if (isNaN(result)) {\n      throw new Error('rand nan');\n    }\n    return result;\n  }\n\n  chooseIndex(chances: number[]): number {\n    const total = chances.reduce((a, b) => a + b);\n    const roll = this.nextRange(1, total + 1);\n    let runningTotal = 0;\n\n    for (let i = 0; i < chances.length; i++) {\n      runningTotal += chances[i];\n      if (roll <= runningTotal) {\n        return i;\n      }\n    }\n\n    return chances.length - 1;\n  }\n\n  chooseKey(chancesMap: Record<string, number>): string {\n    const values = Object.keys(chancesMap);\n    const chances = values.map((value) => chancesMap[value]);\n    return values[this.chooseIndex(chances)];\n  }\n}\n","import { Cell } from './cell';\nimport { Console } from './console';\nimport { DEFAULT_FONT, Font } from './font';\nimport { Key, Keyboard } from './keys';\nimport { Mouse } from './mouse';\nimport { Point } from './point';\nimport {\n  CRT_FRAGMENT_SHADER_SOURCE,\n  CRT_VERTEX_SHADER_SOURCE,\n  FRAGMENT_SHADER_SOURCE,\n  VERTEX_SHADER_SOURCE,\n} from './shaders';\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i: number, max: number): number {\n  return -1.0 + 2.0 * (i / max);\n}\n\ninterface TerminalOptions {\n  font?: Font;\n  crt?: CrtOptions;\n}\n\ninterface CrtOptions {\n  scale: number;\n  blur: number;\n  curvature: number;\n  chroma: number;\n  vignette: number;\n  scanlineWidth: number;\n  scanlineIntensity: number;\n}\n\nconst DEFAULT_OPTIONS = {\n  font: DEFAULT_FONT,\n};\n\nexport class Terminal extends Console {\n  readonly canvas: HTMLCanvasElement;\n  readonly font: Font;\n  readonly crt?: CrtOptions;\n  readonly pixelWidth: number;\n  readonly pixelHeight: number;\n  readonly pixelScale: number;\n  readonly keys: Keyboard;\n  readonly mouse: Mouse;\n  readonly gl: WebGLRenderingContext;\n  readonly program: WebGLProgram;\n  readonly positionAttribLocation: number;\n  readonly textureAttribLocation: number;\n  readonly fgColorAttribLocation: number;\n  readonly bgColorAttribLocation: number;\n  readonly positionsArray: Float32Array;\n  readonly indexArray: Uint16Array;\n  readonly textureArray: Float32Array;\n  readonly foregroundUint8Array: Uint8Array;\n  readonly foregroundDataView: DataView;\n  readonly backgroundUint8Array: Uint8Array;\n  readonly backgroundDataView: DataView;\n  readonly positionBuffer: WebGLBuffer;\n  readonly indexBuffer: WebGLBuffer;\n  readonly textureBuffer: WebGLBuffer;\n  readonly foregroundBuffer: WebGLBuffer;\n  readonly backgroundBuffer: WebGLBuffer;\n  readonly texture: WebGLTexture;\n  readonly frameBufferTexture: WebGLTexture;\n  readonly frameBuffer: WebGLFramebuffer;\n  readonly crtProgram: WebGLProgram;\n  readonly crtBlurLocation: WebGLUniformLocation;\n  readonly crtCurvatureLocation: WebGLUniformLocation;\n  readonly crtChromaLocation: WebGLUniformLocation;\n  readonly crtScanlineWidthLocation: WebGLUniformLocation;\n  readonly crtScanlineIntensityLocation: WebGLUniformLocation;\n  readonly crtVignetteLocation: WebGLUniformLocation;\n  readonly crtPositionLocation: number;\n  readonly crtTexCoordLocation: number;\n  readonly crtPositionBuffer: WebGLBuffer;\n  readonly crtTexCoordBuffer: WebGLBuffer;\n  private lastRenderTime: number;\n  private renderDelta: number;\n  fps: number;\n  averageFps: number;\n  update?: () => void;\n\n  constructor(canvas: HTMLCanvasElement, width: number, height: number, options?: TerminalOptions) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || DEFAULT_FONT;\n    this.crt = options.crt;\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n    this.pixelScale = options?.crt?.scale || 1.0;\n\n    canvas.width = this.pixelWidth * this.pixelScale;\n    canvas.height = this.pixelHeight * this.pixelScale;\n    canvas.style.imageRendering = 'pixelated';\n    canvas.style.outline = 'none';\n    canvas.tabIndex = 0;\n    this.handleResize();\n    window.addEventListener('resize', () => this.handleResize());\n\n    this.keys = new Keyboard(canvas);\n    this.mouse = new Mouse(this);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext('webgl2', { antialias: false });\n    if (!gl) {\n      throw new Error('Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error('Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(program, this.buildShader(gl.VERTEX_SHADER, VERTEX_SHADER_SOURCE));\n    gl.attachShader(program, this.buildShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER_SOURCE));\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    this.crtProgram = gl.createProgram() as WebGLProgram;\n    gl.attachShader(this.crtProgram, this.buildShader(gl.VERTEX_SHADER, CRT_VERTEX_SHADER_SOURCE));\n    gl.attachShader(this.crtProgram, this.buildShader(gl.FRAGMENT_SHADER, CRT_FRAGMENT_SHADER_SOURCE));\n    gl.linkProgram(this.crtProgram);\n    gl.useProgram(this.crtProgram);\n\n    this.crtBlurLocation = gl.getUniformLocation(this.crtProgram, 'u_blur') as WebGLUniformLocation;\n    this.crtCurvatureLocation = gl.getUniformLocation(this.crtProgram, 'u_curvature') as WebGLUniformLocation;\n    this.crtChromaLocation = gl.getUniformLocation(this.crtProgram, 'u_chroma') as WebGLUniformLocation;\n    this.crtScanlineWidthLocation = gl.getUniformLocation(this.crtProgram, 'u_scanlineWidth') as WebGLUniformLocation;\n    this.crtScanlineIntensityLocation = gl.getUniformLocation(\n      this.crtProgram,\n      'u_scanlineIntensity'\n    ) as WebGLUniformLocation;\n    this.crtVignetteLocation = gl.getUniformLocation(this.crtProgram, 'u_vignette') as WebGLUniformLocation;\n\n    this.crtPositionLocation = gl.getAttribLocation(this.crtProgram, 'a_position');\n    this.crtPositionBuffer = gl.createBuffer() as WebGLBuffer;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.crtPositionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), gl.STATIC_DRAW);\n    gl.enableVertexAttribArray(this.crtPositionLocation);\n    gl.vertexAttribPointer(this.crtPositionLocation, 2, gl.FLOAT, false, 0, 0);\n\n    this.crtTexCoordLocation = gl.getAttribLocation(this.crtProgram, 'a_texCoord');\n    this.crtTexCoordBuffer = gl.createBuffer() as WebGLBuffer;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.crtTexCoordBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n    gl.enableVertexAttribArray(this.crtTexCoordLocation);\n    gl.vertexAttribPointer(this.crtTexCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n    this.positionAttribLocation = this.getAttribLocation('a');\n    this.textureAttribLocation = this.getAttribLocation('b');\n    this.fgColorAttribLocation = this.getAttribLocation('c');\n    this.bgColorAttribLocation = this.getAttribLocation('d');\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the frame buffer\n    this.frameBufferTexture = gl.createTexture() as WebGLTexture;\n    gl.bindTexture(gl.TEXTURE_2D, this.frameBufferTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.pixelWidth, this.pixelHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    this.frameBuffer = gl.createFramebuffer() as WebGLFramebuffer;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.frameBufferTexture, 0);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer() as WebGLBuffer;\n    this.indexBuffer = gl.createBuffer() as WebGLBuffer;\n    this.textureBuffer = gl.createBuffer() as WebGLBuffer;\n    this.foregroundBuffer = gl.createBuffer() as WebGLBuffer;\n    this.backgroundBuffer = gl.createBuffer() as WebGLBuffer;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url);\n\n    this.lastRenderTime = 0;\n    this.renderDelta = 0;\n    this.fps = 0;\n    this.averageFps = 0;\n\n    this.requestAnimationFrame();\n  }\n\n  private handleResize(): void {\n    const parent = this.canvas.parentElement;\n    if (!parent) {\n      return;\n    }\n    const widthFactor = parent.offsetWidth / this.pixelWidth;\n    const heightFactor = parent.offsetHeight / this.pixelHeight;\n    const factor = Math.min(widthFactor, heightFactor);\n    const width = (factor * this.pixelWidth) | 0;\n    const height = (factor * this.pixelHeight) | 0;\n    this.canvas.style.width = width + 'px';\n    this.canvas.style.height = height + 'px';\n  }\n\n  private getAttribLocation(name: string): number {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  private flush(): void {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y) as Cell;\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = cell.charCode % 16;\n        const textureY = (cell.charCode / 16) | 0;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(key: Key): boolean {\n    return this.keys.getKey(key).down;\n  }\n\n  isKeyPressed(key: Key): boolean {\n    return this.keys.getKey(key).isPressed();\n  }\n\n  getKeyDownCount(key: Key): number {\n    return this.keys.getKey(key).downCount;\n  }\n\n  /**\n   * Returns a standard roguelike movement key if pressed.\n   * Implemented control systems:\n   * 1) Numpad arrows\n   * 2) VIM keys\n   * 3) Normal arrows (4 directions only)\n   * 4) Numpad 5 and '.' (period) for \"wait\"\n   * If a key is pressed, returns the movement delta.\n   * If no key is pressed, returns undefined.\n   * See: http://www.roguebasin.com/index.php?title=Preferred_Key_Controls\n   */\n  getMovementKey(): Point | undefined {\n    if (this.isKeyPressed(Key.VK_NUMPAD1) || this.isKeyPressed(Key.VK_B)) {\n      return new Point(-1, 1);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD2) || this.isKeyPressed(Key.VK_J) || this.isKeyPressed(Key.VK_DOWN)) {\n      return new Point(0, 1);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD3) || this.isKeyPressed(Key.VK_N)) {\n      return new Point(1, 1);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD4) || this.isKeyPressed(Key.VK_H) || this.isKeyPressed(Key.VK_LEFT)) {\n      return new Point(-1, 0);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD5) || this.isKeyPressed(Key.VK_PERIOD)) {\n      return new Point(0, 0);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD6) || this.isKeyPressed(Key.VK_L) || this.isKeyPressed(Key.VK_RIGHT)) {\n      return new Point(1, 0);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD7) || this.isKeyPressed(Key.VK_Y)) {\n      return new Point(-1, -1);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD8) || this.isKeyPressed(Key.VK_K) || this.isKeyPressed(Key.VK_UP)) {\n      return new Point(0, -1);\n    }\n    if (this.isKeyPressed(Key.VK_NUMPAD9) || this.isKeyPressed(Key.VK_U)) {\n      return new Point(1, -1);\n    }\n    return undefined;\n  }\n\n  private buildShader(type: number, source: string): WebGLShader {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error('An error occurred compiling the shader: ');\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error('An error occurred compiling the shader: ' + gl.getShaderInfoLog(sh));\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  private loadTexture(url: string): WebGLTexture {\n    const gl = this.gl;\n    const texture = gl.createTexture() as WebGLTexture;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]); // opaque black\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat, srcType, pixel);\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  private render(): void {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    if (this.crt) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.frameBuffer);\n    } else {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(this.positionAttribLocation, numComponents, type, normalize, stride, offset);\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(this.textureAttribLocation, numComponents, type, normalize, stride, offset);\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.foregroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(this.fgColorAttribLocation, numComponents, type, normalize, stride, offset);\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.backgroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(this.bgColorAttribLocation, numComponents, type, normalize, stride, offset);\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  private renderCrt(): void {\n    const crt = this.crt;\n    if (!crt) {\n      return;\n    }\n    const gl = this.gl;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, this.pixelWidth * this.pixelScale, this.pixelHeight * this.pixelScale);\n    gl.useProgram(this.crtProgram);\n    gl.uniform1f(this.crtBlurLocation, crt.blur);\n    gl.uniform1f(this.crtCurvatureLocation, crt.curvature);\n    gl.uniform1f(this.crtChromaLocation, crt.chroma);\n    gl.uniform1f(this.crtVignetteLocation, crt.vignette);\n    gl.uniform1f(this.crtScanlineWidthLocation, crt.scanlineWidth);\n    gl.uniform1f(this.crtScanlineIntensityLocation, crt.scanlineIntensity);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.crtPositionBuffer);\n    gl.vertexAttribPointer(this.crtPositionLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.crtTexCoordBuffer);\n    gl.vertexAttribPointer(this.crtTexCoordLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.frameBufferTexture);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  private requestAnimationFrame(): void {\n    window.requestAnimationFrame((t) => this.renderLoop(t));\n  }\n\n  private renderLoop(time: number): void {\n    if (this.lastRenderTime === 0) {\n      this.lastRenderTime = time;\n      this.fps = 0;\n    } else {\n      this.renderDelta = time - this.lastRenderTime;\n      this.lastRenderTime = time;\n      this.fps = 1000.0 / this.renderDelta;\n      this.averageFps = 0.95 * this.averageFps + 0.05 * this.fps;\n    }\n\n    this.keys.updateKeys(time);\n    this.mouse.update(time);\n    if (this.update) {\n      this.update();\n    }\n    this.flush();\n    this.render();\n    if (this.crt) {\n      this.renderCrt();\n    }\n    this.requestAnimationFrame();\n  }\n}\n","/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nexport const VERTEX_SHADER_SOURCE =\n  '#version 300 es\\n' +\n  'precision highp float;' +\n  'in vec2 a;' +\n  'in vec2 b;' +\n  'in vec3 c;' +\n  'in vec3 d;' +\n  'out vec2 e;' +\n  'out vec4 f;' +\n  'out vec4 g;' +\n  'void main(void){' +\n  'gl_Position=vec4(a.x,a.y,0,1);' +\n  'e=b/16.0;' +\n  'f=vec4(c.r,c.g,c.b,1);' +\n  'g=vec4(d.r,d.g,d.b,1);' +\n  '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * s = uniform sampler2D uSampler;\n * o = out vec4 oColor;\n */\nexport const FRAGMENT_SHADER_SOURCE =\n  '#version 300 es\\n' +\n  'precision highp float;' +\n  'in vec2 e;' +\n  'in vec4 f;' +\n  'in vec4 g;' +\n  'uniform sampler2D s;' +\n  'out vec4 o;' +\n  'void main(void){' +\n  'o=texture(s,e);' +\n  // Using ASCII characters\n  'if(o.r<0.1) {' +\n  // Black background, so use bgColor\n  'o=g;' +\n  '} else {' +\n  // White background, so use fgColor\n  'o=f;' +\n  '}' +\n  '}';\n\nexport const CRT_VERTEX_SHADER_SOURCE = `#version 300 es\nprecision highp float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_texCoord;\nvoid main(void) {\n  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);\n  v_texCoord = a_texCoord;\n}`;\n\nexport const CRT_FRAGMENT_SHADER_SOURCE = `#version 300 es\n#define PI 3.1415926535897932384626433832795\nprecision highp float;\nin vec2 v_texCoord;\nuniform sampler2D u_texture;\nuniform float u_blur;\nuniform float u_curvature;\nuniform float u_chroma;\nuniform float u_scanlineWidth;\nuniform float u_scanlineIntensity;\nuniform float u_vignette;\nout vec4 outputColor;\n\nvec2 curve(vec2 uv) {\n  uv = (uv - 0.5) * 2.0;\n  uv *= 1.1;\n  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);\n  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);\n  uv /= 1.1;\n  uv = (uv / 2.0) + 0.5;\n  return uv;\n}\n\nvoid main() {\n  vec2 iResolution = vec2(640.0, 360.0);\n  vec2 q = v_texCoord;\n  vec2 fragCoord = v_texCoord;\n  vec2 uv = q;\n  uv = curve(uv);\n\n  // Outside of range is black\n  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n    outputColor = vec4(0.0, 0.0, 0.0, 1.0);\n    return;\n  }\n\n  vec4 col;\n\n  // Chromatic aberration\n  // col = texture(u_texture, uv.xy);\n  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;\n  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;\n  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;\n  \n  // Blur\n  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));\n  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));\n  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));\n  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));\n\n  // Vignette\n  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);\n\n  // Scanlines\n  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);\n\n  outputColor = vec4(col.rgb, 1.0);\n}`;\n","import { DefaultDialogRenderer } from './gui/defaultdialogrenderer';\nimport { Dialog } from './gui/dialog';\nimport { DialogRenderer } from './gui/dialogrenderer';\nimport { DialogState } from './gui/dialogstate';\nimport { Terminal } from './terminal';\n\nexport class GUI {\n  readonly terminal: Terminal;\n  readonly renderer: DialogRenderer;\n  readonly dialogs: DialogState[];\n\n  constructor(terminal: Terminal, renderer?: DialogRenderer) {\n    this.terminal = terminal;\n    this.renderer = renderer || new DefaultDialogRenderer();\n    this.dialogs = [];\n  }\n\n  add(dialog: Dialog): void {\n    this.dialogs.push(this.renderer.getState(this.terminal, dialog));\n  }\n\n  /**\n   * Handles input for currently active dialog.\n   * Returns true if the input was handled.\n   * Returns false otherwise.\n   */\n  handleInput(): boolean {\n    if (this.dialogs.length === 0) {\n      return false;\n    }\n\n    const activeIndex = this.dialogs.length - 1;\n    const activeState = this.dialogs[this.dialogs.length - 1];\n    const activeDialog = activeState.dialog;\n    if (activeDialog.handleInput(this.terminal, activeState.contentsOffset)) {\n      this.dialogs.splice(activeIndex, 1);\n    }\n\n    return true;\n  }\n\n  draw(): void {\n    for (let i = 0; i < this.dialogs.length; i++) {\n      this.renderer.draw(this.terminal, this.dialogs[i]);\n    }\n  }\n}\n","import { Console } from '../console';\nimport { Key } from '../keys';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Terminal } from '../terminal';\nimport { Dialog } from './dialog';\nimport { Message } from './message';\n\nexport class MessageDialog extends Dialog {\n  constructor(title: string, readonly message: string | Message) {\n    let rect;\n    if (message instanceof Message) {\n      rect = new Rect(0, 0, message.getWidth(), message.getHeight());\n    } else {\n      rect = new Rect(0, 0, message.length, 1);\n    }\n    super(rect, title);\n  }\n\n  drawContents(console: Console, offset: Point): void {\n    if (this.message instanceof Message) {\n      console.drawMessage(offset.x, offset.y, this.message);\n    } else {\n      console.drawString(offset.x, offset.y, this.message);\n    }\n  }\n\n  handleInput(terminal: Terminal): boolean {\n    return terminal.isKeyPressed(Key.VK_ESCAPE);\n  }\n}\n","import { Chars } from '../chars';\nimport { Console } from '../console';\nimport { Key } from '../keys';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Terminal } from '../terminal';\nimport { Dialog } from './dialog';\nimport { Message } from './message';\n\nexport class ScrollableMessageDialog extends Dialog {\n  readonly messagesHeight: number;\n  readonly scrollMax: number;\n  readonly scrollbarHeight: number;\n  scrollY = 0;\n\n  constructor(rect: Rect, title: string, readonly message: Message) {\n    super(rect, title);\n    this.messagesHeight = message.getHeight();\n    this.scrollMax = Math.max(1, this.messagesHeight - this.contentsRect.height);\n    this.scrollbarHeight = (this.contentsRect.height * this.contentsRect.height) / (this.messagesHeight + 1);\n  }\n\n  drawContents(console: Console, offset: Point): void {\n    console.clip = this.contentsRect;\n    console.drawMessage(offset.x, offset.y - this.scrollY, this.message);\n    console.clip = undefined;\n\n    // Draw scrollbar\n    const scrollbarY = (this.scrollY / this.scrollMax) * (this.contentsRect.height - this.scrollbarHeight);\n    console.drawVLine(\n      this.contentsRect.x + this.contentsRect.width + 1,\n      this.contentsRect.y + scrollbarY,\n      this.scrollbarHeight,\n      Chars.MEDIUM_SHADE\n    );\n  }\n\n  handleInput(terminal: Terminal): boolean {\n    const moveKey = terminal.getMovementKey();\n    if (moveKey) {\n      this.scrollY += moveKey.y;\n    }\n    if (terminal.isKeyPressed(Key.VK_PAGE_DOWN)) {\n      this.scrollY += this.contentsRect.height;\n    }\n    if (terminal.isKeyPressed(Key.VK_PAGE_UP)) {\n      this.scrollY -= this.contentsRect.height;\n    }\n    if (terminal.mouse.wheelDeltaY !== 0) {\n      this.scrollY += terminal.mouse.wheelDeltaY < 0 ? -5 : 5;\n      terminal.mouse.wheelDeltaY = 0;\n    }\n    this.scrollY = Math.max(0, Math.min(this.scrollMax, this.scrollY));\n    return terminal.isKeyPressed(Key.VK_ESCAPE);\n  }\n}\n","import { Console } from '../console';\nimport { Key } from '../keys';\nimport { Colors } from '../palettes/colors';\nimport { Point } from '../point';\nimport { Rect } from '../rect';\nimport { Terminal } from '../terminal';\nimport { Dialog } from './dialog';\n\nexport class SelectDialog extends Dialog {\n  readonly options: string[];\n  readonly callback: (i: number) => void;\n  private hoverIndex: number;\n\n  constructor(title: string, options: string[], callback: (i: number) => void) {\n    let width = title.length;\n    for (let i = 0; i < options.length; i++) {\n      width = Math.max(width, options[i].length + 4);\n    }\n\n    const height = options.length;\n    const rect = new Rect(0, 0, width, height);\n    super(rect, title);\n    this.options = options;\n    this.callback = callback;\n    this.hoverIndex = -1;\n  }\n\n  drawContents(console: Console, offset: Point): void {\n    for (let i = 0; i < this.options.length; i++) {\n      const str = String.fromCharCode(65 + i) + ' - ' + this.options[i];\n      if (i === this.hoverIndex) {\n        console.drawString(offset.x, offset.y + i, str, Colors.BLACK, Colors.WHITE);\n      } else {\n        console.drawString(offset.x, offset.y + i, str, Colors.WHITE, Colors.BLACK);\n      }\n    }\n  }\n\n  handleInput(terminal: Terminal, offset: Point): boolean {\n    const moveKey = terminal.getMovementKey();\n    if (moveKey && moveKey.y !== 0) {\n      this.hoverIndex = (this.hoverIndex + this.options.length + moveKey.y) % this.options.length;\n    }\n    if (this.hoverIndex >= 0 && (terminal.isKeyPressed(Key.VK_ENTER) || terminal.isKeyPressed(Key.VK_NUMPAD_ENTER))) {\n      this.callback(this.hoverIndex);\n      return true;\n    }\n    if (\n      terminal.mouse.x >= offset.x &&\n      terminal.mouse.x < offset.x + this.contentsRect.width &&\n      terminal.mouse.y >= offset.y &&\n      terminal.mouse.y < offset.y + this.contentsRect.height\n    ) {\n      this.hoverIndex = terminal.mouse.y - offset.y;\n      if (terminal.mouse.buttons.get(0).isClicked()) {\n        terminal.mouse.buttons.clear();\n        this.callback(this.hoverIndex);\n        return true;\n      }\n    }\n    const startCharCode = 'A'.charCodeAt(0);\n    for (let i = 0; i < this.options.length; i++) {\n      if (terminal.isKeyPressed(('Key' + String.fromCharCode(startCharCode + i)) as Key)) {\n        this.callback(i);\n        return true;\n      }\n    }\n    return terminal.isKeyPressed(Key.VK_ESCAPE);\n  }\n\n  isMouseOverOption(terminal: Terminal, offset: Point, index: number): boolean {\n    return (\n      terminal.mouse.x >= offset.x &&\n      terminal.mouse.x < offset.x + this.contentsRect.width &&\n      terminal.mouse.y === offset.y + index\n    );\n  }\n}\n"],"names":["BlendMode","exports","BOX_CHAR_DETAILS","isBoxCell","con","x","y","charCode","getCharCode","undefined","getBoxCount","index","width","height","getBoxCell","up","right","down","left","i","length","row","__decorate","decorators","target","key","desc","d","c","arguments","r","Object","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","fromRgb","g","b","a","Colors","BLACK","WHITE","LIGHT_GRAY","DARK_GRAY","YELLOW","BROWN","LIGHT_RED","DARK_RED","LIGHT_GREEN","DARK_GREEN","LIGHT_CYAN","DARK_CYAN","LIGHT_BLUE","DARK_BLUE","LIGHT_MAGENTA","DARK_MAGENTA","ORANGE","classDefinitions","Map","serializable","value","set","name","Chars","wordWrap","str","maxLength","regex","RegExp","replace","trim","split","map","line","Cell","constructor","fg","bg","this","charCodeAt","convertCharCode","dirty","blocked","blockedSight","explored","visible","pathId","h","prev","setCharCode","setForeground","setBackground","setValue","drawCell","None","otherCell","blendMode","alpha","blendColors","c1","c2","w1","w2","r1","g1","b1","r2","g2","b2","Blend","Add","clamp","Math","min","Console","blockedFunc","grid","originX","originY","minX","maxX","minY","maxY","radius","push","clear","drawChar","getCell","clip","contains","drawString","lines","drawStringLine","j","drawCenteredString","floor","drawMessage","message","maxWidth","text","children","child","drawHLine","xi","drawVLine","yi","drawRect","drawBox","topChar","rightChar","bottomChar","leftChar","topLeftChar","topRightChar","bottomRightChar","bottomLeftChar","drawSingleBox","BOX_SINGLE_HORIZONTAL","BOX_SINGLE_VERTICAL","BOX_SINGLE_DOWN_AND_SINGLE_RIGHT","BOX_SINGLE_DOWN_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_RIGHT","drawDoubleBox","BOX_DOUBLE_HORIZONTAL","BOX_DOUBLE_VERTICAL","BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT","BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_RIGHT","fillRect","drawConsole","dstX","dstY","srcConsole","srcX","srcY","srcWidth","srcHeight","cell","setBlocked","setBlockedSight","isVisible","isBlocked","isBlockedSight","computeOctantY","deltaX","deltaY","startSlopes","endSlopes","halfSlope","processedCell","extended","centreSlope","startSlope","endSlope","previousEndSlope","iteration","totalObstacles","obstaclesInLastLine","minSlope","idx","max","computeOctantX","computeFov","opt_noClear","opt_octants","updateExplored","tile","Font","url","charWidth","charHeight","scale","DEFAULT_FONT","FovOctants","FovQuadrants","Point","Rect","top","x2","y2","getCenter","intersects","other","point","DialogState","dialog","rect","contentsOffset","open","count","DefaultDialogRenderer","getState","terminal","contentsRect","draw","term","dialogState","title","drawContents","Dialog","Message","getWidth","getHeight","result","Input","downTime","repeat","repeatTime","downCount","upCount","setDown","performance","now","update","time","isPressed","isClicked","InputSet","inputs","get","input","updateAll","forEach","Keyboard","el","keys","addEventListener","e","setKey","getKey","state","code","Key","VK_F11","stopPropagation","preventDefault","updateKeys","PATTERNS","BLOCK_TOP_HALF","active","BLOCK_RIGHT_HALF","getImageData","img","canvas","document","createElement","ctx","getContext","drawImage","data","draw2x2","w","i1","i2","i3","i4","colors","minError","Number","MAX_VALUE","bestCharCode","bestBg","bestFg","pattern","patternColors","computeColors","error","arrayToColor","sum","avg","cellError","delta","sqrt","rgb","Mouse","buttons","prevX","prevY","dx","dy","wheelDeltaX","wheelDeltaY","handleEvent","handleTouchEvent","handleWheelEvent","touches","touch","updatePosition","clientX","clientY","type","button","focus","getBoundingClientRect","terminalAspectRatio","rectAspectRatio","actualWidth","excess","actualHeight","Commodore64Palette","RED","CYAN","VIOLET","GREEN","BLUE","GRAY","ColodorePalette","Pico8Palette","DARK_PURPLE","LAVENDER","PINK","LIGHT_PEACH","dxs","dys","costs","buildPath","curr","reverse","SortedSet","initialValues","values","insert","array","low","high","mid","midCell","splice","pop","size","RNG","seed","m","nextInt","nextFloat","nextRange","start","end","rangeSize","isNaN","Error","chooseIndex","chances","total","reduce","roll","runningTotal","chooseKey","chancesMap","interpolate","DEFAULT_OPTIONS","font","Terminal","options","super","crt","pixelWidth","pixelHeight","pixelScale","_a","style","imageRendering","outline","tabIndex","handleResize","window","mouse","gl","antialias","program","createProgram","attachShader","buildShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","useProgram","crtProgram","crtBlurLocation","getUniformLocation","crtCurvatureLocation","crtChromaLocation","crtScanlineWidthLocation","crtScanlineIntensityLocation","crtVignetteLocation","crtPositionLocation","getAttribLocation","crtPositionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","crtTexCoordLocation","crtTexCoordBuffer","positionAttribLocation","textureAttribLocation","fgColorAttribLocation","bgColorAttribLocation","cellCount","positionsArray","indexArray","Uint16Array","textureArray","foregroundUint8Array","Uint8Array","foregroundDataView","DataView","buffer","backgroundUint8Array","backgroundDataView","frameBufferTexture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","frameBuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","k","positionBuffer","indexBuffer","textureBuffer","foregroundBuffer","backgroundBuffer","ELEMENT_ARRAY_BUFFER","texture","loadTexture","lastRenderTime","renderDelta","fps","averageFps","requestAnimationFrame","parent","parentElement","widthFactor","offsetWidth","heightFactor","offsetHeight","factor","location","flush","textureArrayIndex","colorArrayIndex","textureX","textureY","setUint32","isKeyDown","isKeyPressed","getKeyDownCount","getMovementKey","VK_NUMPAD1","VK_B","VK_NUMPAD2","VK_J","VK_DOWN","VK_NUMPAD3","VK_N","VK_NUMPAD4","VK_H","VK_LEFT","VK_NUMPAD5","VK_PERIOD","VK_NUMPAD6","VK_L","VK_RIGHT","VK_NUMPAD7","VK_Y","VK_NUMPAD8","VK_K","VK_UP","VK_NUMPAD9","VK_U","source","sh","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","internalFormat","srcFormat","srcType","pixel","image","Image","onload","TEXTURE_MAG_FILTER","src","render","clearColor","clearDepth","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","viewport","numComponents","normalize","stride","offset","DYNAMIC_DRAW","activeTexture","TEXTURE0","vertexCount","UNSIGNED_SHORT","drawElements","TRIANGLES","renderCrt","uniform1f","blur","curvature","chroma","vignette","scanlineWidth","scanlineIntensity","drawArrays","t","renderLoop","renderer","dialogs","add","handleInput","activeIndex","activeState","console","VK_ESCAPE","scrollY","messagesHeight","scrollMax","scrollbarHeight","scrollbarY","MEDIUM_SHADE","moveKey","VK_PAGE_DOWN","VK_PAGE_UP","callback","hoverIndex","String","fromCharCode","VK_ENTER","VK_NUMPAD_ENTER","startCharCode","isMouseOverOption","charAt","toUpperCase","slice","dest","maxDist","sourceCell","hypot","q","u","v","Infinity","alt","JSON","parse","instances","instance","classDefinition","$type","create","prototype","getOwnPropertyDescriptors","replaceObjectProperties","root","Array","isArray","replaceArray","$ref","replaceObject","entries","s","f","p","QUADRANT_SOUTHEAST","QUADRANT_EAST","QUADRANT_NORTHEAST","QUADRANT_SOUTHWEST","QUADRANT_WEST","QUADRANT_NORTHWEST","QUADRANT_SOUTH","QUADRANT_NORTH","obj","instancesMap","WeakMap","stringify","has","assign"],"mappings":"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"}