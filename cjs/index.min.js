!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).wglt={})}(this,(function(t){"use strict";var e;t.BlendMode=void 0,(e=t.BlendMode||(t.BlendMode={}))[e.None=0]="None",e[e.Blend=1]="Blend",e[e.Add=2]="Add";const i=[[1,0,1,0],[1,0,1,1],[1,0,1,2],[2,0,2,1],[0,0,2,1],[0,0,1,2],[2,0,2,2],[2,0,2,0],[0,0,2,2],[2,0,0,2],[2,0,0,1],[1,0,0,2],[0,0,1,1],[1,1,0,0],[1,1,0,1],[0,1,1,1],[1,1,1,0],[0,1,0,1],[1,1,1,1],[1,2,1,0],[2,1,2,0],[2,2,0,0],[0,2,2,0],[2,2,0,2],[0,2,2,2],[2,2,2,0],[0,2,0,2],[2,2,2,2],[1,2,0,2],[2,1,0,1],[0,2,1,2],[0,1,2,1],[2,1,0,0],[1,2,0,0],[0,2,1,0],[0,1,2,0],[2,1,2,1],[1,2,1,2],[1,0,0,1],[0,1,1,0]];function s(t,e,i){const s=t.getCharCode(e,i);return void 0!==s&&s>=179&&s<=218}function r(t,e,s,r){if(e<0||s<0||e>=t.width||s>=t.height)return 0;const n=t.getCharCode(e,s);return void 0===n||n<179||n>218?0:i[n-179][r]}function n(t,e,s,r){for(let n=0;n<i.length;n++){const o=i[n];if(o[0]===t&&o[1]===e&&o[2]===s&&o[3]===r)return 179+n}return 0}function o(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(r=t[h])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function h(t,e,i,s){return void 0===s&&(s=255),(t<<24)+(e<<16)+(i<<8)+s}const a={BLACK:h(0,0,0),WHITE:h(255,255,255),LIGHT_GRAY:h(170,170,170),DARK_GRAY:h(85,85,85),YELLOW:h(255,255,85),BROWN:h(170,85,0),LIGHT_RED:h(255,85,85),DARK_RED:h(170,0,0),LIGHT_GREEN:h(85,255,85),DARK_GREEN:h(0,170,0),LIGHT_CYAN:h(85,255,255),DARK_CYAN:h(0,170,170),LIGHT_BLUE:h(85,85,255),DARK_BLUE:h(0,0,170),LIGHT_MAGENTA:h(255,85,255),DARK_MAGENTA:h(170,0,170),ORANGE:h(255,136,0)},c=new Map;function _(t){c.set(t.name,t)}var d;function l(t,e){const i=new RegExp("(\\S(.{0,"+e+"}\\S)?)\\s+","g");return(t+" ").replace(i,"$1\n").trim().split("\n").map((t=>t.trim()))}t.Cell=class{constructor(t,e,i,s,r){this.x=t,this.y=e,this.charCode=void 0!==i?function(t){return"string"==typeof t&&t.length>0?t.charCodeAt(0):t}(i):" ".charCodeAt(0),this.fg=void 0!==s?s:a.WHITE,this.bg=void 0!==r?r:a.BLACK,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(t){this.charCode!==t&&(this.charCode=t,this.dirty=!0)}setForeground(t){null!=t&&t!==this.fg&&(this.fg=t,this.dirty=!0)}setBackground(t){null!=t&&t!==this.bg&&(this.bg=t,this.dirty=!0)}setValue(e,i,s){return"string"==typeof e&&(e=e.charCodeAt(0)),"number"==typeof e?(this.setCharCode(e),void 0!==i&&this.setForeground(i),void 0!==s&&this.setBackground(s)):this.drawCell(e,t.BlendMode.None),this.dirty}drawCell(e,i){const s=255&e.bg;i===t.BlendMode.None||e.charCode>0?(this.setCharCode(e.charCode),this.setForeground(e.fg)):s>0&&s<255&&this.setForeground(this.blendColors(this.fg,e.bg,i)),i===t.BlendMode.None||255===s?this.setBackground(e.bg):s>0&&this.setBackground(this.blendColors(this.bg,e.bg,i))}blendColors(e,i,s){const r=(255-(255&i))/255,n=1-r,o=e>>24&255,a=e>>16&255,c=e>>8&255,_=i>>24&255,d=i>>16&255,l=i>>8&255;switch(s){case t.BlendMode.Blend:return h(r*o+n*_|0,r*a+n*d|0,r*c+n*l|0);case t.BlendMode.Add:return h(this.clamp(o+n*_|0),this.clamp(a+n*d|0),this.clamp(c+n*l|0));default:return i}}clamp(t){return Math.min(255,t)}},t.Cell=o([_],t.Cell),t.Chars=void 0,(d=t.Chars||(t.Chars={}))[d.SMILEY=1]="SMILEY",d[d.INVERSE_SMILEY=2]="INVERSE_SMILEY",d[d.HEART=3]="HEART",d[d.DIAMOND=4]="DIAMOND",d[d.CLUB=5]="CLUB",d[d.SPADE=6]="SPADE",d[d.BULLET=7]="BULLET",d[d.INVERSE_BULLET=8]="INVERSE_BULLET",d[d.LIGHT_SHADE=176]="LIGHT_SHADE",d[d.MEDIUM_SHADE=177]="MEDIUM_SHADE",d[d.DARK_SHADE=178]="DARK_SHADE",d[d.BOX_SINGLE_VERTICAL=179]="BOX_SINGLE_VERTICAL",d[d.BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT=180]="BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT",d[d.BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT=185]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT",d[d.BOX_DOUBLE_VERTICAL=186]="BOX_DOUBLE_VERTICAL",d[d.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT=187]="BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT",d[d.BOX_DOUBLE_UP_AND_DOUBLE_LEFT=188]="BOX_DOUBLE_UP_AND_DOUBLE_LEFT",d[d.BOX_SINGLE_DOWN_AND_SINGLE_LEFT=191]="BOX_SINGLE_DOWN_AND_SINGLE_LEFT",d[d.BOX_SINGLE_UP_AND_SINGLE_RIGHT=192]="BOX_SINGLE_UP_AND_SINGLE_RIGHT",d[d.BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP=193]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP",d[d.BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN=194]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN",d[d.BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT=195]="BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT",d[d.BOX_SINGLE_HORIZONTAL=196]="BOX_SINGLE_HORIZONTAL",d[d.BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL=197]="BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL",d[d.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT=200]="BOX_DOUBLE_UP_AND_DOUBLE_RIGHT",d[d.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT=201]="BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT",d[d.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP=202]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP",d[d.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN=203]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN",d[d.BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT=204]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT",d[d.BOX_DOUBLE_HORIZONTAL=205]="BOX_DOUBLE_HORIZONTAL",d[d.BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL=206]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL",d[d.BOX_SINGLE_UP_AND_SINGLE_LEFT=217]="BOX_SINGLE_UP_AND_SINGLE_LEFT",d[d.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT=218]="BOX_SINGLE_DOWN_AND_SINGLE_RIGHT",d[d.BLOCK_FULL=219]="BLOCK_FULL",d[d.BLOCK_BOTTOM_HALF=220]="BLOCK_BOTTOM_HALF",d[d.BLOCK_LEFT_HALF=221]="BLOCK_LEFT_HALF",d[d.BLOCK_RIGHT_HALF=222]="BLOCK_RIGHT_HALF",d[d.BLOCK_TOP_HALF=223]="BLOCK_TOP_HALF",t.Console=class{constructor(e,i,s){this.width=e,this.height=i,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let s=0;s<i;s++){const i=[];for(let r=0;r<e;r++)i.push(new t.Cell(r,s));this.grid.push(i)}if(this.clear(),s)for(let t=0;t<i;t++)for(let i=0;i<e;i++)this.grid[t][i].blocked=this.grid[t][i].blockedSight=s(i,t)}clear(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.drawChar(e,t,0)}getCell(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t]}getCharCode(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t].charCode}drawChar(t,e,i,s,r){this.clip&&!this.clip.contains({x:t,y:e})||t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[0|e][0|t].setValue(i,s,r)}drawString(t,e,i,s,r){const n=i.split("\n");for(let i=0;i<n.length;i++)this.drawStringLine(t,e+i,n[i],s,r)}drawStringLine(t,e,i,s,r){for(let n=0;n<i.length;n++)this.drawChar(t+n,e,i.charCodeAt(n),s,r)}drawCenteredString(t,e,i,s,r){this.drawString(t-Math.floor(i.length/2),e,i,s,r)}drawMessage(t,e,i,s){if(i.text){const r=l(i.text,s||this.width-t);for(const s of r)this.drawStringLine(t,e,s,i.fg,i.bg),e++}if(i.children)for(const r of i.children)e=this.drawMessage(t,e,r,s);return e}drawHLine(t,e,i,s,r,n){for(let o=t;o<t+i;o++)this.drawChar(o,e,s,r,n)}drawVLine(t,e,i,s,r,n){for(let o=e;o<e+i;o++)this.drawChar(t,o,s,r,n)}drawRect(t,e,i,s,r,n,o){this.drawHLine(t,e,i,r,n,o),this.drawHLine(t,e+s-1,i,r,n,o),this.drawVLine(t,e,s,r,n,o),this.drawVLine(t+i-1,e,s,r,n,o)}drawBox(t,e,i,s,r,n,o,h,a,c,_,d,l,u){this.drawHLine(t,e,i,r,l,u),this.drawHLine(t,e+s-1,i,o,l,u),this.drawVLine(t,e,s,h,l,u),this.drawVLine(t+i-1,e,s,n,l,u),this.drawChar(t,e,a,l,u),this.drawChar(t+i-1,e,c,l,u),this.drawChar(t,e+s-1,d,l,u),this.drawChar(t+i-1,e+s-1,_,l,u)}drawSingleBox(e,i,s,r,n,o){this.drawBox(e,i,s,r,t.Chars.BOX_SINGLE_HORIZONTAL,t.Chars.BOX_SINGLE_VERTICAL,t.Chars.BOX_SINGLE_HORIZONTAL,t.Chars.BOX_SINGLE_VERTICAL,t.Chars.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,t.Chars.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,t.Chars.BOX_SINGLE_UP_AND_SINGLE_LEFT,t.Chars.BOX_SINGLE_UP_AND_SINGLE_RIGHT,n,o)}drawDoubleBox(e,i,s,r,n,o){this.drawBox(e,i,s,r,t.Chars.BOX_DOUBLE_HORIZONTAL,t.Chars.BOX_DOUBLE_VERTICAL,t.Chars.BOX_DOUBLE_HORIZONTAL,t.Chars.BOX_DOUBLE_VERTICAL,t.Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,t.Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,t.Chars.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,t.Chars.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,n,o)}fillRect(t,e,i,s,r,n,o){for(let h=e;h<e+s;h++)this.drawHLine(t,h,i,r,n,o)}drawConsole(e,i,s,r,n,o,h,a){a=a||t.BlendMode.None;for(let t=0;t<h;t++)for(let h=0;h<o;h++){const o=s.getCell(r+h,n+t);o&&this.drawCell(e+h,i+t,o,a)}}drawCell(t,e,i,s){t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[e][t].drawCell(i,s)}setBlocked(t,e,i){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blocked=i)}setBlockedSight(t,e,i){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blockedSight=i)}isVisible(t,e){return!(t<this.minX||t>this.maxX||e<this.minY||e>this.maxY)&&this.grid[e][t].visible}isBlocked(t,e){return t<0||t>this.width||e<0||e>this.height||this.grid[e][t].blocked}isBlockedSight(t,e){return t<0||t>this.width||e<0||e>this.height||this.grid[e][t].blockedSight}computeOctantY(t,e){const i=[],s=[];let r,n,o,h,a,c,_,d,l,u,A=1,E=0,g=0,T=0;for(n=this.originY+e;n>=this.minY&&n<=this.maxY;n+=e,g=E,++A)for(o=.5/A,u=-1,h=Math.floor(T*A+.5),r=this.originX+h*t;h<=A&&r>=this.minX&&r<=this.maxX;r+=t,++h,u=l){if(a=!0,c=!1,_=h/A,d=u,l=_+o,g>0)if(this.grid[n-e][r].visible&&!this.grid[n-e][r].blockedSight||this.grid[n-e][r-t].visible&&!this.grid[n-e][r-t].blockedSight){for(let t=0;t<g&&a;++t)if(d<=s[t]&&l>=i[t])if(this.grid[n][r].blockedSight){if(d>=i[t]&&l<=s[t]){a=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],l),c=!0}else if(_>i[t]&&_<s[t]){a=!1;break}}else a=!1;a&&(this.grid[n][r].visible=!0,this.grid[n][r].blockedSight&&(T>=d?T=l:c||(i[E]=d,s[E++]=l)))}}computeOctantX(t,e){const i=[],s=[];let r,n,o,h,a,c,_,d,l,u,A=1,E=0,g=0,T=0;for(r=this.originX+t;r>=this.minX&&r<=this.maxX;r+=t,g=E,++A)for(o=.5/A,u=-1,h=Math.floor(T*A+.5),n=this.originY+h*e;h<=A&&n>=this.minY&&n<=this.maxY;n+=e,++h,u=l){if(a=!0,c=!1,_=h/A,d=u,l=_+o,g>0)if(this.grid[n][r-t].visible&&!this.grid[n][r-t].blockedSight||this.grid[n-e][r-t].visible&&!this.grid[n-e][r-t].blockedSight){for(let t=0;t<g&&a;++t)if(d<=s[t]&&l>=i[t])if(this.grid[n][r].blockedSight){if(d>=i[t]&&l<=s[t]){a=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],l),c=!0}else if(_>i[t]&&_<s[t]){a=!1;break}}else a=!1;a&&(this.grid[n][r].visible=!0,this.grid[n][r].blockedSight&&(T>=d?T=l:c||(i[E]=d,s[E++]=l)))}}computeFov(t,e,i,s,r){if(this.originX=t,this.originY=e,this.radius=i,s)this.minX=Math.min(this.minX,Math.max(0,t-i)),this.minY=Math.min(this.minY,Math.max(0,e-i)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,t+i)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,e+i));else{this.minX=Math.max(0,t-i),this.minY=Math.max(0,e-i),this.maxX=Math.min(this.width-1,t+i),this.maxY=Math.min(this.height-1,e+i);for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++)this.grid[t][e].visible=!1}this.grid[e][t].visible=!0,void 0===r?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(1&r&&this.computeOctantY(1,1),2&r&&this.computeOctantX(1,1),4&r&&this.computeOctantX(1,-1),8&r&&this.computeOctantY(1,-1),16&r&&this.computeOctantY(-1,-1),32&r&&this.computeOctantX(-1,-1),64&r&&this.computeOctantX(-1,1),128&r&&this.computeOctantY(-1,1))}updateExplored(){for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++){const i=this.grid[t][e];i.explored=i.explored||i.visible}}},t.Console=o([_],t.Console);class u{constructor(t,e,i,s){this.url=t,this.charWidth=e,this.charHeight=i,this.scale=s||1}}const A=new u("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);var E,g;t.FovOctants=void 0,(E=t.FovOctants||(t.FovOctants={}))[E.OCTANT_SOUTH_SOUTHEAST=1]="OCTANT_SOUTH_SOUTHEAST",E[E.OCTANT_EAST_SOUTHEAST=2]="OCTANT_EAST_SOUTHEAST",E[E.OCTANT_EAST_NORTHTHEAST=4]="OCTANT_EAST_NORTHTHEAST",E[E.OCTANT_NORTH_NORTHEAST=8]="OCTANT_NORTH_NORTHEAST",E[E.OCTANT_NORTH_NORTHWEST=16]="OCTANT_NORTH_NORTHWEST",E[E.OCTANT_WEST_NORTHEAST=32]="OCTANT_WEST_NORTHEAST",E[E.OCTANT_WEST_SOUTHWEST=64]="OCTANT_WEST_SOUTHWEST",E[E.OCTANT_SOUTH_SOUTHWEST=128]="OCTANT_SOUTH_SOUTHWEST",t.FovQuadrants=void 0,(g=t.FovQuadrants||(t.FovQuadrants={}))[g.QUADRANT_SOUTHEAST=3]="QUADRANT_SOUTHEAST",g[g.QUADRANT_EAST=6]="QUADRANT_EAST",g[g.QUADRANT_NORTHEAST=12]="QUADRANT_NORTHEAST",g[g.QUADRANT_NORTH=24]="QUADRANT_NORTH",g[g.QUADRANT_NORTHWEST=48]="QUADRANT_NORTHWEST",g[g.QUADRANT_WEST=96]="QUADRANT_WEST",g[g.QUADRANT_SOUTHWEST=192]="QUADRANT_SOUTHWEST",g[g.QUADRANT_SOUTH=129]="QUADRANT_SOUTH",t.Point=class{constructor(t,e){this.x=t,this.y=e}},t.Point=o([_],t.Point),t.Rect=class{constructor(t,e,i,s){this.x=this.left=t,this.y=this.top=e,this.width=i,this.height=s,this.x2=t+i,this.y2=e+s}getCenter(){return new t.Point(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<this.x2&&t.y>=this.y&&t.y<this.y2}},t.Rect=o([_],t.Rect);class T{constructor(t,e,i){this.dialog=t,this.rect=e,this.contentsOffset=i,this.open=!1,this.count=0}}class f{getState(e,i){const s=i.contentsRect.width+4,r=i.contentsRect.height+4,n=(e.width-s)/2|0,o=(e.height-r)/2|0;return new T(i,new t.Rect(n,o,s,r),new t.Point(n+2,o+2))}draw(t,e){const i=e.dialog,{x:s,y:r,width:n,height:o}=e.rect;t.fillRect(s,r,n,o,0,a.WHITE,a.BLACK),t.drawSingleBox(s,r,n,o),t.drawCenteredString(s+n/2|0,r," "+i.title+" "),i.drawContents(t,e.contentsOffset)}}class L{constructor(t,e){this.contentsRect=t,this.title=e}}t.Message=class{constructor(t,e,i,s){this.text=t,this.fg=e,this.bg=i,this.children=s}getWidth(){let t=0;if(this.text)for(const e of this.text.split("\n"))t=Math.max(t,e.length);if(this.children)for(const e of this.children)t=Math.max(t,e.getWidth());return t}getHeight(){let t=0;if(this.text&&(t+=this.text.split("\n").length),this.children)for(const e of this.children)t+=e.getHeight();return t}},t.Message=o([_],t.Message);class R{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(t){this.down!==t&&(this.down=t,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(t){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,t-this.downTime>=200&&t-this.repeatTime>=66.66666666666667&&(this.repeat=!0,this.repeatTime=t)):(this.downCount=0,this.upCount++)}isPressed(){return 1===this.downCount||this.repeat}isClicked(){return 1===this.upCount}}class O{constructor(){this.inputs=new Map}clear(){this.inputs.clear()}get(t){let e=this.inputs.get(t);return e||(e=new R,this.inputs.set(t,e)),e}updateAll(t){this.inputs.forEach((e=>e.update(t)))}}class D{constructor(t){this.keys=new O,t.addEventListener("keydown",(t=>this.setKey(t,!0))),t.addEventListener("keyup",(t=>this.setKey(t,!1)))}clear(){this.keys.clear()}getKey(t){return this.keys.get(t)}setKey(e,i){const s=e.code;s!==t.Key.VK_F11&&(e.stopPropagation(),e.preventDefault(),this.keys.get(s).setDown(i))}updateKeys(t){this.keys.updateAll(t)}}var N;t.Key=void 0,(N=t.Key||(t.Key={})).VK_CANCEL="Pause",N.VK_BACKSPACE="Backspace",N.VK_TAB="Tab",N.VK_ENTER="Enter",N.VK_SHIFT_LEFT="ShiftLeft",N.VK_SHIFT_RIGHT="ShiftLeft",N.VK_CONTROL_LEFT="ControlLeft",N.VK_CONTROL_RIGHT="ControlRight",N.VK_ALT_LEFT="AltLeft",N.VK_ALT_RIGHT="AltRight",N.VK_PAUSE="Pause",N.VK_CAPS_LOCK="CapsLock",N.VK_ESCAPE="Escape",N.VK_SPACE="Space",N.VK_PAGE_UP="PageUp",N.VK_PAGE_DOWN="PageDown",N.VK_END="End",N.VK_HOME="Home",N.VK_LEFT="ArrowLeft",N.VK_UP="ArrowUp",N.VK_RIGHT="ArrowRight",N.VK_DOWN="ArrowDown",N.VK_INSERT="Insert",N.VK_DELETE="Delete",N.VK_0="Digit0",N.VK_1="Digit1",N.VK_2="Digit2",N.VK_3="Digit3",N.VK_4="Digit4",N.VK_5="Digit5",N.VK_6="Digit6",N.VK_7="Digit7",N.VK_8="Digit8",N.VK_9="Digit9",N.VK_SEMICOLON="Semicolon",N.VK_EQUALS="Equal",N.VK_A="KeyA",N.VK_B="KeyB",N.VK_C="KeyC",N.VK_D="KeyD",N.VK_E="KeyE",N.VK_F="KeyF",N.VK_G="KeyG",N.VK_H="KeyH",N.VK_I="KeyI",N.VK_J="KeyJ",N.VK_K="KeyK",N.VK_L="KeyL",N.VK_M="KeyM",N.VK_N="KeyN",N.VK_O="KeyO",N.VK_P="KeyP",N.VK_Q="KeyQ",N.VK_R="KeyR",N.VK_S="KeyS",N.VK_T="KeyT",N.VK_U="KeyU",N.VK_V="KeyV",N.VK_W="KeyW",N.VK_X="KeyX",N.VK_Y="KeyY",N.VK_Z="KeyZ",N.VK_CONTEXT_MENU="ContextMenu",N.VK_NUMPAD0="Numpad0",N.VK_NUMPAD1="Numpad1",N.VK_NUMPAD2="Numpad2",N.VK_NUMPAD3="Numpad3",N.VK_NUMPAD4="Numpad4",N.VK_NUMPAD5="Numpad5",N.VK_NUMPAD6="Numpad6",N.VK_NUMPAD7="Numpad7",N.VK_NUMPAD8="Numpad8",N.VK_NUMPAD9="Numpad9",N.VK_NUMPAD_ENTER="NumpadEnter",N.VK_MULTIPLY="NumpadMultiply",N.VK_ADD="NumpadAdd",N.VK_SEPARATOR="NumpadDecimal",N.VK_SUBTRACT="NumpadSubtract",N.VK_DECIMAL="NumpadDecimal",N.VK_DIVIDE="NumpadDivide",N.VK_F1="F1",N.VK_F2="F2",N.VK_F3="F3",N.VK_F4="F4",N.VK_F5="F5",N.VK_F6="F6",N.VK_F7="F7",N.VK_F8="F8",N.VK_F9="F9",N.VK_F10="F10",N.VK_F11="F11",N.VK_F12="F12",N.VK_F13="F13",N.VK_F14="F14",N.VK_F15="F15",N.VK_F16="F16",N.VK_F17="F17",N.VK_F18="F18",N.VK_F19="F19",N.VK_F20="F20",N.VK_F21="F21",N.VK_F22="F22",N.VK_F23="F23",N.VK_F24="F24",N.VK_NUM_LOCK="NumLock",N.VK_SCROLL_LOCK="ScrollLock",N.VK_COMMA="Comma",N.VK_PERIOD="Period",N.VK_SLASH="Slash",N.VK_BACKQUOTE="Backquote",N.VK_OPEN_BRACKET="BracketLeft",N.VK_BACK_SLASH="Backslash",N.VK_CLOSE_BRACKET="BracketRight",N.VK_QUOTE="Quote",N.VK_META="OSLeft";const K=[{charCode:t.Chars.BLOCK_TOP_HALF,active:[1,1,0,0]},{charCode:t.Chars.BLOCK_RIGHT_HALF,active:[0,1,0,1]}];function m(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data}function B(t,e,i,s,r){const n=4*(s*r+i),o=4*(s*r+i+1),h=4*((s+1)*r+i),a=4*((s+1)*r+i+1),c=[[e[n],e[n+1],e[n+2]],[e[o],e[o+1],e[o+2]],[e[h],e[h+1],e[h+2]],[e[a],e[a+1],e[a+2]]];let _=Number.MAX_VALUE,d=0,l=null,u=null;for(let t=0;t<K.length;t++){const e=K[t],i=p(e.active,c);i.error<_&&(_=i.error,d=e.charCode,l=i.bg,u=i.fg)}t.drawChar(i/2,s/2,d,y(u),y(l))}function p(t,e){const i=[[0,0,0],[0,0,0]],s=[[0,0,0],[0,0,0]],r=[0,0];for(let s=0;s<4;s++){for(let r=0;r<3;r++)i[t[s]][r]+=e[s][r];r[t[s]]++}for(let t=0;t<2;t++)for(let e=0;e<3;e++)s[t][e]=i[t][e]/r[t];let n=0;for(let i=0;i<4;i++){let r=0;for(let n=0;n<3;n++){const o=e[i][n]-s[t[i]][n];r+=o*o}n+=Math.sqrt(r)}return{bg:s[0],fg:s[1],error:n}}function y(t){return h(t[0],t[1],t[2])}class x{constructor(t){this.buttons=new O,this.el=t.canvas,this.width=t.width,this.height=t.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0;const e=this.el;e.addEventListener("mousedown",(t=>this.handleEvent(t))),e.addEventListener("mouseup",(t=>this.handleEvent(t))),e.addEventListener("mousemove",(t=>this.handleEvent(t))),e.addEventListener("contextmenu",(t=>this.handleEvent(t))),e.addEventListener("touchstart",(t=>this.handleTouchEvent(t))),e.addEventListener("touchend",(t=>this.handleTouchEvent(t))),e.addEventListener("touchcancel",(t=>this.handleTouchEvent(t))),e.addEventListener("touchmove",(t=>this.handleTouchEvent(t))),e.addEventListener("wheel",(t=>this.handleWheelEvent(t)))}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.updatePosition(e.clientX,e.clientY),this.buttons.get(0).setDown(!0)}else this.buttons.get(0).setDown(!1)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons.get(t.button).setDown(!0),this.el.focus()),"mouseup"===t.type&&this.buttons.get(t.button).setDown(!1)}handleWheelEvent(t){t.stopPropagation(),t.preventDefault(),this.wheelDeltaX=t.deltaX,this.wheelDeltaY=t.deltaY}updatePosition(e,i){let s=this.el.getBoundingClientRect();const r=this.width/this.height,n=s.width/s.height;if(n-r>.01){const e=r*s.height,i=s.width-e;s=new t.Rect(Math.floor(i/2),0,e,s.height)}if(n-r<-.01){const e=s.width/r,i=s.height-e;s=new t.Rect(0,Math.floor(i/2),s.width,e)}this.x=this.width*(e-s.left)/s.width|0,this.y=this.height*(i-s.top)/s.height|0}update(t){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y,this.buttons.updateAll(t)}}const C={BLACK:h(0,0,0),WHITE:h(255,255,255),RED:h(136,0,0),CYAN:h(170,255,238),VIOLET:h(204,68,204),GREEN:h(0,204,85),BLUE:h(0,0,170),YELLOW:h(238,238,119),ORANGE:h(221,136,85),BROWN:h(102,68,0),LIGHT_RED:h(255,119,119),DARK_GRAY:h(51,51,51),GRAY:h(119,119,119),LIGHT_GREEN:h(170,255,102),LIGHT_BLUE:h(0,136,255),LIGHT_GRAY:h(187,187,187)},U={BLACK:h(0,0,0),WHITE:h(255,255,255),RED:h(136,0,0),CYAN:h(170,255,238),VIOLET:h(204,68,204),GREEN:h(0,204,85),BLUE:h(0,0,170),YELLOW:h(238,238,119),ORANGE:h(221,136,85),BROWN:h(102,68,0),LIGHT_RED:h(255,119,119),DARK_GRAY:h(51,51,51),GRAY:h(119,119,119),LIGHT_GREEN:h(170,255,102),LIGHT_BLUE:h(0,136,255),LIGHT_GRAY:h(187,187,187)},I={BLACK:h(0,0,0),DARK_BLUE:h(29,43,83),DARK_PURPLE:h(126,37,83),DARK_GREEN:h(0,135,81),BROWN:h(171,82,54),DARK_GRAY:h(95,87,79),LIGHT_GRAY:h(194,195,199),WHITE:h(255,241,232),RED:h(255,0,77),ORANGE:h(255,163,0),YELLOW:h(255,236,39),GREEN:h(0,228,54),BLUE:h(41,173,255),LAVENDER:h(131,118,156),PINK:h(255,119,168),LIGHT_PEACH:h(255,204,170)},v=[-1,0,1,-1,1,-1,0,1],S=[-1,-1,-1,0,0,1,1,1],w=[1.4,1,1.4,1,1,1.4,1,1.4];let b=0;function F(t){const e=[];let i=t;for(;i;)e.push(i),i=i.prev;return e.reverse(),e}class V{constructor(t){this.values=t}insert(t){const e=this.values;let i=0,s=e.length,r=0;for(;i<s;){const n=i+s>>>1,o=e[n];o.g+o.h>t.g+t.h?(i=n+1,r=i):(s=n,r=s)}e.splice(r,0,t)}pop(){return this.values.pop()}size(){return this.values.length}}t.RNG=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const i=e-t,s=t+(this.nextInt()/this.m*i|0);if(isNaN(s))throw new Error("rand nan");return s}chooseIndex(t){const e=t.reduce(((t,e)=>t+e)),i=this.nextRange(1,e+1);let s=0;for(let e=0;e<t.length;e++)if(s+=t[e],i<=s)return e;return t.length-1}chooseKey(t){const e=Object.keys(t),i=e.map((e=>t[e]));return e[this.chooseIndex(i)]}},t.RNG=o([_],t.RNG);function P(t,e){return t/e*2-1}const H={font:A};class G extends t.Console{constructor(t,e,i,s){var r;super(e,i),s=s||H,this.canvas=t,this.font=s.font||A,this.crt=s.crt,this.maxFps=s.maxFps,this.pixelWidth=e*this.font.charWidth,this.pixelHeight=i*this.font.charHeight,this.pixelScale=(null===(r=s.crt)||void 0===r?void 0:r.scale)||1,t.width=this.pixelWidth*this.pixelScale,t.height=this.pixelHeight*this.pixelScale,t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.handleResize(),window.addEventListener("resize",(()=>this.handleResize())),this.keys=new D(t),this.mouse=new x(this);const n=t.getContext("webgl2",{antialias:!1});if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const o=n.createProgram();if(!o)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=n,this.program=o,n.attachShader(o,this.buildShader(n.VERTEX_SHADER,"#version 300 es\nprecision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),n.attachShader(o,this.buildShader(n.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;in vec2 e;in vec4 f;in vec4 g;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(o.r<0.1) {o=g;} else {o=f;}}")),n.linkProgram(o),n.useProgram(o),this.crtProgram=n.createProgram(),n.attachShader(this.crtProgram,this.buildShader(n.VERTEX_SHADER,"#version 300 es\nprecision highp float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_texCoord;\nvoid main(void) {\n  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);\n  v_texCoord = a_texCoord;\n}")),n.attachShader(this.crtProgram,this.buildShader(n.FRAGMENT_SHADER,"#version 300 es\n#define PI 3.1415926535897932384626433832795\nprecision highp float;\nin vec2 v_texCoord;\nuniform sampler2D u_texture;\nuniform float u_blur;\nuniform float u_curvature;\nuniform float u_chroma;\nuniform float u_scanlineWidth;\nuniform float u_scanlineIntensity;\nuniform float u_vignette;\nout vec4 outputColor;\n\nvec2 curve(vec2 uv) {\n  uv = (uv - 0.5) * 2.0;\n  uv *= 1.1;\n  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);\n  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);\n  uv /= 1.1;\n  uv = (uv / 2.0) + 0.5;\n  return uv;\n}\n\nvoid main() {\n  vec2 iResolution = vec2(640.0, 360.0);\n  vec2 q = v_texCoord;\n  vec2 fragCoord = v_texCoord;\n  vec2 uv = q;\n  uv = curve(uv);\n\n  // Outside of range is black\n  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n    outputColor = vec4(0.0, 0.0, 0.0, 1.0);\n    return;\n  }\n\n  vec4 col;\n\n  // Chromatic aberration\n  // col = texture(u_texture, uv.xy);\n  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;\n  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;\n  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;\n  \n  // Blur\n  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));\n  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));\n  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));\n  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));\n\n  // Vignette\n  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);\n\n  // Scanlines\n  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);\n\n  outputColor = vec4(col.rgb, 1.0);\n}")),n.linkProgram(this.crtProgram),n.useProgram(this.crtProgram),this.crtBlurLocation=n.getUniformLocation(this.crtProgram,"u_blur"),this.crtCurvatureLocation=n.getUniformLocation(this.crtProgram,"u_curvature"),this.crtChromaLocation=n.getUniformLocation(this.crtProgram,"u_chroma"),this.crtScanlineWidthLocation=n.getUniformLocation(this.crtProgram,"u_scanlineWidth"),this.crtScanlineIntensityLocation=n.getUniformLocation(this.crtProgram,"u_scanlineIntensity"),this.crtVignetteLocation=n.getUniformLocation(this.crtProgram,"u_vignette"),this.crtPositionLocation=n.getAttribLocation(this.crtProgram,"a_position"),this.crtPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.crtPositionBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(this.crtPositionLocation),n.vertexAttribPointer(this.crtPositionLocation,2,n.FLOAT,!1,0,0),this.crtTexCoordLocation=n.getAttribLocation(this.crtProgram,"a_texCoord"),this.crtTexCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.crtTexCoordBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(this.crtTexCoordLocation),n.vertexAttribPointer(this.crtTexCoordLocation,2,n.FLOAT,!1,0,0),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const h=e*i;this.positionsArray=new Float32Array(3*h*4),this.indexArray=new Uint16Array(6*h),this.textureArray=new Float32Array(2*h*4),this.foregroundUint8Array=new Uint8Array(4*h*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(4*h*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer),this.frameBufferTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.frameBufferTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.pixelWidth,this.pixelHeight,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.frameBuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.frameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.frameBufferTexture,0);let a=0,c=0,_=0;for(let t=0;t<i;t++)for(let s=0;s<e;s++)this.positionsArray[a++]=P(s,e),this.positionsArray[a++]=-P(t,i),this.positionsArray[a++]=P(s+1,e),this.positionsArray[a++]=-P(t,i),this.positionsArray[a++]=P(s+1,e),this.positionsArray[a++]=-P(t+1,i),this.positionsArray[a++]=P(s,e),this.positionsArray[a++]=-P(t+1,i),this.indexArray[c++]=_+0,this.indexArray[c++]=_+1,this.indexArray[c++]=_+2,this.indexArray[c++]=_+0,this.indexArray[c++]=_+2,this.indexArray[c++]=_+3,_+=4;this.positionBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.textureBuffer=n.createBuffer(),this.foregroundBuffer=n.createBuffer(),this.backgroundBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.bufferData(n.ARRAY_BUFFER,this.positionsArray,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexArray,n.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,void 0===this.maxFps?this.requestAnimationFrame():window.setInterval((()=>this.renderLoop(performance.now())),1e3/this.maxFps)}handleResize(){const t=this.canvas.parentElement;if(!t)return;const e=t.offsetWidth/this.pixelWidth,i=t.offsetHeight/this.pixelHeight,s=Math.min(e,i),r=s*this.pixelWidth|0,n=s*this.pixelHeight|0;this.canvas.style.width=r+"px",this.canvas.style.height=n+"px"}getAttribLocation(t){const e=this.gl.getAttribLocation(this.program,t);return this.gl.enableVertexAttribArray(e),e}flush(){let t=0,e=0;for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++){const r=this.getCell(s,i);if(!r.dirty){t+=8,e+=16;continue}const n=r.charCode%16,o=r.charCode/16|0;this.textureArray[t++]=n,this.textureArray[t++]=o,this.textureArray[t++]=n+1,this.textureArray[t++]=o,this.textureArray[t++]=n+1,this.textureArray[t++]=o+1,this.textureArray[t++]=n,this.textureArray[t++]=o+1;for(let t=0;t<4;t++)this.foregroundDataView.setUint32(e,r.fg,!1),this.backgroundDataView.setUint32(e,r.bg,!1),e+=4;r.dirty=!1}}isKeyDown(t){return this.keys.getKey(t).down}isKeyPressed(t){return this.keys.getKey(t).isPressed()}getKeyDownCount(t){return this.keys.getKey(t).downCount}getMovementKey(){return this.isKeyPressed(t.Key.VK_NUMPAD1)||this.isKeyPressed(t.Key.VK_B)?new t.Point(-1,1):this.isKeyPressed(t.Key.VK_NUMPAD2)||this.isKeyPressed(t.Key.VK_J)||this.isKeyPressed(t.Key.VK_DOWN)?new t.Point(0,1):this.isKeyPressed(t.Key.VK_NUMPAD3)||this.isKeyPressed(t.Key.VK_N)?new t.Point(1,1):this.isKeyPressed(t.Key.VK_NUMPAD4)||this.isKeyPressed(t.Key.VK_H)||this.isKeyPressed(t.Key.VK_LEFT)?new t.Point(-1,0):this.isKeyPressed(t.Key.VK_NUMPAD5)||this.isKeyPressed(t.Key.VK_PERIOD)?new t.Point(0,0):this.isKeyPressed(t.Key.VK_NUMPAD6)||this.isKeyPressed(t.Key.VK_L)||this.isKeyPressed(t.Key.VK_RIGHT)?new t.Point(1,0):this.isKeyPressed(t.Key.VK_NUMPAD7)||this.isKeyPressed(t.Key.VK_Y)?new t.Point(-1,-1):this.isKeyPressed(t.Key.VK_NUMPAD8)||this.isKeyPressed(t.Key.VK_K)||this.isKeyPressed(t.Key.VK_UP)?new t.Point(0,-1):this.isKeyPressed(t.Key.VK_NUMPAD9)||this.isKeyPressed(t.Key.VK_U)?new t.Point(1,-1):void 0}buildShader(t,e){const i=this.gl,s=i.createShader(t);if(!s)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(s,e),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(s));return s}loadTexture(t){const e=this.gl,i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.RGBA,r=e.RGBA,n=e.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,0,s,1,1,0,r,n,o);const h=new Image;return h.onload=()=>{e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,s,r,n,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},h.src=t,i}render(){const t=this.gl;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.crt?t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const e=2,i=t.FLOAT,s=!1,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(this.positionAttribLocation,e,i,s,r,n)}{const e=2,i=t.FLOAT,s=!1,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.textureAttribLocation,e,i,s,r,n)}{const e=4,i=t.UNSIGNED_BYTE,s=!0,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.foregroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.foregroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.fgColorAttribLocation,e,i,s,r,n)}{const e=4,i=t.UNSIGNED_BYTE,s=!0,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.backgroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.bgColorAttribLocation,e,i,s,r,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture);{const e=this.width*this.height*6,i=t.UNSIGNED_SHORT,s=0;t.drawElements(t.TRIANGLES,e,i,s)}}renderCrt(){const t=this.crt;if(!t)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.pixelWidth*this.pixelScale,this.pixelHeight*this.pixelScale),e.useProgram(this.crtProgram),e.uniform1f(this.crtBlurLocation,t.blur),e.uniform1f(this.crtCurvatureLocation,t.curvature),e.uniform1f(this.crtChromaLocation,t.chroma),e.uniform1f(this.crtVignetteLocation,t.vignette),e.uniform1f(this.crtScanlineWidthLocation,t.scanlineWidth),e.uniform1f(this.crtScanlineIntensityLocation,t.scanlineIntensity),e.bindBuffer(e.ARRAY_BUFFER,this.crtPositionBuffer),e.vertexAttribPointer(this.crtPositionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.crtTexCoordBuffer),e.vertexAttribPointer(this.crtTexCoordLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.frameBufferTexture),e.drawArrays(e.TRIANGLES,0,6)}requestAnimationFrame(){window.requestAnimationFrame((t=>this.renderLoop(t)))}renderLoop(t){0===this.lastRenderTime?(this.lastRenderTime=t,this.fps=0):(this.renderDelta=t-this.lastRenderTime,this.lastRenderTime=t,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(t),this.mouse.update(t),this.update&&this.update(),this.flush(),this.render(),this.crt&&this.renderCrt(),void 0===this.maxFps&&this.requestAnimationFrame()}}t.ColodorePalette=U,t.Colors=a,t.Commodore64Palette=C,t.DEFAULT_FONT=A,t.DefaultDialogRenderer=f,t.Dialog=L,t.DialogState=T,t.Font=u,t.GUI=class{constructor(t,e){this.terminal=t,this.renderer=e||new f,this.dialogs=[]}add(t){this.dialogs.push(this.renderer.getState(this.terminal,t))}handleInput(){if(0===this.dialogs.length)return!1;const t=this.dialogs.length-1,e=this.dialogs[this.dialogs.length-1];return e.dialog.handleInput(this.terminal,e.contentsOffset)&&this.dialogs.splice(t,1),!0}draw(){for(let t=0;t<this.dialogs.length;t++)this.renderer.draw(this.terminal,this.dialogs[t])}},t.Keyboard=D,t.MessageDialog=class extends L{constructor(e,i){let s;s=i instanceof t.Message?new t.Rect(0,0,i.getWidth(),i.getHeight()):new t.Rect(0,0,i.length,1),super(s,e),this.message=i}drawContents(e,i){this.message instanceof t.Message?e.drawMessage(i.x,i.y,this.message):e.drawString(i.x,i.y,this.message)}handleInput(e){return e.isKeyPressed(t.Key.VK_ESCAPE)}},t.Mouse=x,t.Pico8Palette=I,t.ScrollableMessageDialog=class extends L{constructor(t,e,i){super(t,e),this.message=i,this.scrollY=0,this.messagesHeight=i.getHeight(),this.scrollMax=Math.max(1,this.messagesHeight-this.contentsRect.height),this.scrollbarHeight=this.contentsRect.height*this.contentsRect.height/(this.messagesHeight+1)}drawContents(e,i){e.clip=this.contentsRect,e.drawMessage(i.x,i.y-this.scrollY,this.message),e.clip=void 0;const s=this.scrollY/this.scrollMax*(this.contentsRect.height-this.scrollbarHeight);e.drawVLine(this.contentsRect.x+this.contentsRect.width+1,this.contentsRect.y+s,this.scrollbarHeight,t.Chars.MEDIUM_SHADE)}handleInput(e){const i=e.getMovementKey();return i&&(this.scrollY+=i.y),e.isKeyPressed(t.Key.VK_PAGE_DOWN)&&(this.scrollY+=this.contentsRect.height),e.isKeyPressed(t.Key.VK_PAGE_UP)&&(this.scrollY-=this.contentsRect.height),0!==e.mouse.wheelDeltaY&&(this.scrollY+=e.mouse.wheelDeltaY<0?-5:5,e.mouse.wheelDeltaY=0),this.scrollY=Math.max(0,Math.min(this.scrollMax,this.scrollY)),e.isKeyPressed(t.Key.VK_ESCAPE)}},t.SelectDialog=class extends L{constructor(e,i,s){let r=e.length;for(let t=0;t<i.length;t++)r=Math.max(r,i[t].length+4);const n=i.length;super(new t.Rect(0,0,r,n),e),this.options=i,this.callback=s,this.hoverIndex=-1}drawContents(t,e){for(let i=0;i<this.options.length;i++){const s=String.fromCharCode(65+i)+" - "+this.options[i];i===this.hoverIndex?t.drawString(e.x,e.y+i,s,a.BLACK,a.WHITE):t.drawString(e.x,e.y+i,s,a.WHITE,a.BLACK)}}handleInput(e,i){const s=e.getMovementKey();if(s&&0!==s.y&&(this.hoverIndex=(this.hoverIndex+this.options.length+s.y)%this.options.length),this.hoverIndex>=0&&(e.isKeyPressed(t.Key.VK_ENTER)||e.isKeyPressed(t.Key.VK_NUMPAD_ENTER)))return this.callback(this.hoverIndex),!0;if(e.mouse.x>=i.x&&e.mouse.x<i.x+this.contentsRect.width&&e.mouse.y>=i.y&&e.mouse.y<i.y+this.contentsRect.height&&(this.hoverIndex=e.mouse.y-i.y,e.mouse.buttons.get(0).isClicked()))return e.mouse.buttons.clear(),this.callback(this.hoverIndex),!0;const r="A".charCodeAt(0);for(let t=0;t<this.options.length;t++)if(e.isKeyPressed("Key"+String.fromCharCode(r+t)))return this.callback(t),!0;return e.isKeyPressed(t.Key.VK_ESCAPE)}isMouseOverOption(t,e,i){return t.mouse.x>=e.x&&t.mouse.x<e.x+this.contentsRect.width&&t.mouse.y===e.y+i}},t.Terminal=G,t.capitalize=function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):t},t.computePath=function(t,e,i,s){b++;const r=t.grid[e.y][e.x];r.pathId=b,r.g=0,r.h=Math.hypot(e.x-i.x,e.y-i.y),r.prev=null;const n=new V([r]);for(;n.size()>0;){const e=n.pop();if(e.x===i.x&&e.y===i.y)return F(e);for(let r=0;r<v.length;r++){const o=e.x+v[r],h=e.y+S[r];if(o>=0&&o<t.width&&h>=0&&h<t.height){const a=t.grid[h][o];if(a.blocked&&a.explored&&(o!==i.x||h!==i.y))continue;a.pathId!==b&&(a.pathId=b,a.g=1/0,a.h=Math.hypot(o-i.x,h-i.y),a.prev=null);const c=e.g+w[r];c<a.g&&c<=s&&(a.g=c,a.prev=e,n.insert(a))}}}},t.deserialize=function(t){const e=JSON.parse(t),i=e.instances;for(let t=0;t<i.length;t++){const e=i[t],s=c.get(e.$type);delete e.$type,i[t]=Object.create(s.prototype,Object.getOwnPropertyDescriptors(e))}for(let t=0;t<i.length;t++)r(i[t]);return s(e.root);function s(t){return Array.isArray(t)?function(t){for(let e=0;e<t.length;e++)t[e]=s(t[e]);return t}(t):t&&"object"==typeof t?function(t){if(e=t,e&&"object"==typeof e&&"$ref"in e)return i[t.$ref];var e;return r(t),t}(t):t}function r(t){for(const[e,i]of Object.entries(t))t[e]=s(i)}},t.fixBoxCells=function(t){for(let e=0;e<t.height;e++)for(let i=0;i<t.width;i++)if(s(t,i,e)){let s=r(t,i,e-1,2),o=r(t,i+1,e,3),h=r(t,i,e+1,0),a=r(t,i-1,e,1);s>0&&0===o&&0===h&&0===a?h=s:0===s&&o>0&&0===h&&0===a?a=o:0===s&&0===o&&h>0&&0===a?s=h:0===s&&0===o&&0===h&&a>0&&(o=a),a>0&&o>0&&(a=o=Math.max(a,o)),s>0&&h>0&&(s=h=Math.max(s,h));const c=n(s,o,h,a);if((s||o||h||a)&&!(c>=179&&c<=218))throw new Error("invalid char code! (up="+s+", right="+o+", down="+h+", left="+a+")");t.drawChar(i,e,c)}},t.fromHsv=function(t,e,i,s){const r=6*t|0,n=6*t-r,o=i*(1-e),a=i*(1-n*e),c=i*(1-(1-n)*e);let _,d,l;switch(r%6){case 0:_=i,d=c,l=o;break;case 1:_=a,d=i,l=o;break;case 2:_=o,d=i,l=c;break;case 3:_=o,d=a,l=i;break;case 4:_=c,d=o,l=i;break;case 5:_=i,d=o,l=a;break;default:_=0,d=0,l=0}return void 0===s&&(s=1),h(255*_|0,255*d|0,255*l|0,255*s|0)},t.fromRgb=h,t.getFovQuadrant=function(e,i){return e>0?i>0?t.FovQuadrants.QUADRANT_SOUTHEAST:0===i?t.FovQuadrants.QUADRANT_EAST:t.FovQuadrants.QUADRANT_NORTHEAST:e<0?i>0?t.FovQuadrants.QUADRANT_SOUTHWEST:0===i?t.FovQuadrants.QUADRANT_WEST:t.FovQuadrants.QUADRANT_NORTHWEST:i>0?t.FovQuadrants.QUADRANT_SOUTH:t.FovQuadrants.QUADRANT_NORTH},t.loadImage=function(e,i){const s=new Image;s.onload=()=>{const e=s.width,r=s.height,n=m(s),o=new t.Console(e,r);let a=0;for(let t=0;t<r;t++)for(let i=0;i<e;i++){o.getCell(i,t).setBackground(h(n[a++],n[a++],n[a++],n[a++]))}i(o)},s.src=e},t.loadImage2x=function(e,i){const s=new Image;s.onload=()=>{const e=s.width,r=s.height,n=m(s),o=new t.Console(e/2,r/2);for(let t=0;t<r;t+=2)for(let i=0;i<e;i+=2)B(o,n,i,t,e);i(o)},s.src=e},t.serializable=_,t.serialize=function(t){const e=[],i=new WeakMap,s=r(t);return JSON.stringify({instances:e,root:s});function r(t){return Array.isArray(t)?function(t){const e=[];for(let i=0;i<t.length;i++)e[i]=r(t[i]);return e}(t):t&&"object"==typeof t?function(t){if(t&&t.constructor.name&&"Object"!==t.constructor.name){if(!c.has(t.constructor.name))throw new Error(`Class ${t.constructor.name} is not serializable.`);if(i.has(t))return{$ref:i.get(t)};const s=e.length;return e.push({$type:t.constructor.name}),i.set(t,s),e[s]=Object.assign(Object.assign({},n(t)),{$type:t.constructor.name}),{$ref:s}}return n(t)}(t):t}function n(t){const e={};for(const i of Object.keys(t))e[i]=r(t[i]);return e}},t.wordWrap=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
