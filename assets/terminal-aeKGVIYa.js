(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();function p(i,t,e,s){return s===void 0&&(s=255),(i<<24)+(t<<16)+(e<<8)+s}function ct(i,t,e,s){const o=i*6|0,r=i*6-o,n=e*(1-t),c=e*(1-r*t),a=e*(1-(1-r)*t);let h,u,_;switch(o%6){case 0:h=e,u=a,_=n;break;case 1:h=c,u=e,_=n;break;case 2:h=n,u=e,_=a;break;case 3:h=n,u=c,_=e;break;case 4:h=a,u=n,_=e;break;case 5:h=e,u=n,_=c;break;default:h=0,u=0,_=0}return s===void 0&&(s=1),p(h*255|0,u*255|0,_*255|0,s*255|0)}const B={BLACK:p(0,0,0),WHITE:p(255,255,255),LIGHT_GRAY:p(170,170,170),DARK_GRAY:p(85,85,85),YELLOW:p(255,255,85),BROWN:p(170,85,0),LIGHT_RED:p(255,85,85),DARK_RED:p(170,0,0),LIGHT_GREEN:p(85,255,85),DARK_GREEN:p(0,170,0),LIGHT_CYAN:p(85,255,255),DARK_CYAN:p(0,170,170),LIGHT_BLUE:p(85,85,255),DARK_BLUE:p(0,0,170),LIGHT_MAGENTA:p(255,85,255),DARK_MAGENTA:p(170,0,170),ORANGE:p(255,136,0)},U=new Map;function O(i){U.set(i.name,i)}var V=Object.defineProperty,S=Object.getOwnPropertyDescriptor,y=(i,t,e,s)=>{for(var o=s>1?void 0:s?S(t,e):t,r=i.length-1,n;r>=0;r--)(n=i[r])&&(o=(s?n(t,e,o):n(o))||o);return s&&o&&V(t,e,o),o};function I(i){return typeof i=="string"&&i.length>0?i.charCodeAt(0):i}let K=class{constructor(i,t,e,s=B.WHITE,o=B.BLACK){this.x=i,this.y=t,e!==void 0?this.charCode=I(e):this.charCode=32,this.fg=s,this.bg=o,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(i){this.charCode!==i&&(this.charCode=i,this.dirty=!0)}setForeground(i){i!=null&&i!==this.fg&&(this.fg=i,this.dirty=!0)}setBackground(i){i!=null&&i!==this.bg&&(this.bg=i,this.dirty=!0)}setValue(i,t,e){return typeof i=="string"&&(i=i.charCodeAt(0)),typeof i=="number"?(this.setCharCode(i),t!==void 0&&this.setForeground(t),e!==void 0&&this.setBackground(e)):this.drawCell(i),this.dirty}drawCell(i,t){const e=i.bg&255;!t||i.charCode>0?(this.setCharCode(i.charCode),this.setForeground(i.fg)):e>0&&e<255&&this.setForeground(this.blendColors(this.fg,i.bg,t)),!t||e===255?this.setBackground(i.bg):e>0&&this.setBackground(this.blendColors(this.bg,i.bg,t))}blendColors(i,t,e){const o=(255-(t&255))/255,r=1-o,n=i>>24&255,c=i>>16&255,a=i>>8&255,h=t>>24&255,u=t>>16&255,_=t>>8&255;switch(e){case"blend":return p(o*n+r*h|0,o*c+r*u|0,o*a+r*_|0);case"add":return p(this.clamp(n+r*h|0),this.clamp(c+r*u|0),this.clamp(a+r*_|0));default:return t}}clamp(i){return Math.min(255,i)}};K=y([O],K);const g={SMILEY:1,INVERSE_SMILEY:2,HEART:3,DIAMOND:4,CLUB:5,SPADE:6,BULLET:7,INVERSE_BULLET:8,LIGHT_SHADE:176,MEDIUM_SHADE:177,DARK_SHADE:178,BOX_SINGLE_VERTICAL:179,BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT:180,BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT:185,BOX_DOUBLE_VERTICAL:186,BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT:187,BOX_DOUBLE_UP_AND_DOUBLE_LEFT:188,BOX_SINGLE_DOWN_AND_SINGLE_LEFT:191,BOX_SINGLE_UP_AND_SINGLE_RIGHT:192,BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP:193,BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN:194,BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT:195,BOX_SINGLE_HORIZONTAL:196,BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL:197,BOX_DOUBLE_UP_AND_DOUBLE_RIGHT:200,BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT:201,BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP:202,BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN:203,BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT:204,BOX_DOUBLE_HORIZONTAL:205,BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL:206,BOX_SINGLE_UP_AND_SINGLE_LEFT:13*16+9,BOX_SINGLE_DOWN_AND_SINGLE_RIGHT:13*16+10,BLOCK_FULL:219,BLOCK_BOTTOM_HALF:13*16+12,BLOCK_LEFT_HALF:13*16+13,BLOCK_RIGHT_HALF:13*16+14,BLOCK_TOP_HALF:13*16+15};var P=Object.defineProperty,M=Object.getOwnPropertyDescriptor,G=(i,t,e,s)=>{for(var o=s>1?void 0:s?M(t,e):t,r=i.length-1,n;r>=0;r--)(n=i[r])&&(o=(s?n(t,e,o):n(o))||o);return s&&o&&P(t,e,o),o};const w={LEFT:"left",CENTER:"center",RIGHT:"right"};let N=class{constructor(i,t,e,s,o){this.text=i,this.fg=t,this.bg=e,this.children=s,this.align=o}getWidth(){let i=0;if(this.text)for(const t of this.text.split(`
`))i=Math.max(i,t.length);if(this.children)for(const t of this.children)i=Math.max(i,t.getWidth());return i}getHeight(){let i=0;if(this.text&&(i+=this.text.split(`
`).length),this.children)for(const t of this.children)i+=t.getHeight();return i}};N=G([O],N);function X(i,t){const e=new RegExp("(\\S(.{0,"+t+"}\\S)?)\\s+","g");return(i+" ").replace(e,`$1
`).trim().split(`
`).map(s=>s.trim())}var H=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,W=(i,t,e,s)=>{for(var o=s>1?void 0:s?Y(t,e):t,r=i.length-1,n;r>=0;r--)(n=i[r])&&(o=(s?n(t,e,o):n(o))||o);return s&&o&&H(t,e,o),o};let x=class{constructor(i,t,e){this.width=i,this.height=t,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let s=0;s<t;s++){const o=[];for(let r=0;r<i;r++)o.push(new K(r,s));this.grid.push(o)}if(this.clear(),e)for(let s=0;s<t;s++)for(let o=0;o<i;o++)this.grid[s][o].blocked=this.grid[s][o].blockedSight=e(o,s)}clear(){for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++)this.drawChar(t,i,0)}getCell(i,t){if(!(i<0||t<0||i>=this.width||t>=this.height))return this.grid[t][i]}getCharCode(i,t){if(!(i<0||t<0||i>=this.width||t>=this.height))return this.grid[t][i].charCode}drawChar(i,t,e,s,o){this.clip&&!this.clip.contains({x:i,y:t})||i>=0&&i<this.width&&t>=0&&t<this.height&&this.grid[t|0][i|0].setValue(e,s,o)}drawString(i,t,e,s,o){const r=e.split(`
`);for(let n=0;n<r.length;n++)this.drawStringLine(i,t+n,r[n],s,o)}drawStringLine(i,t,e,s,o){for(let r=0;r<e.length;r++)this.drawChar(i+r,t,e.charCodeAt(r),s,o)}drawCenteredString(i,t,e,s,o){this.drawString(i-Math.floor(e.length/2),t,e,s,o)}drawMessage(i,t,e,s){if(e.text){e.align===w.RIGHT?i+=s-e.text.length:e.align===w.CENTER&&(i+=s/2-e.text.length/2);const o=X(e.text,s||this.width-i);for(const r of o)this.drawStringLine(i,t,r,e.fg,e.bg),t++}if(e.children)for(const o of e.children)t=this.drawMessage(i,t,o,s);return t}drawHLine(i,t,e,s,o,r){for(let n=i;n<i+e;n++)this.drawChar(n,t,s,o,r)}drawVLine(i,t,e,s,o,r){for(let n=t;n<t+e;n++)this.drawChar(i,n,s,o,r)}drawRect(i,t,e,s,o,r,n){this.drawHLine(i,t,e,o,r,n),this.drawHLine(i,t+s-1,e,o,r,n),this.drawVLine(i,t,s,o,r,n),this.drawVLine(i+e-1,t,s,o,r,n)}drawBox(i,t,e,s,o,r,n,c,a,h,u,_,l,A){this.drawHLine(i,t,e,o,l,A),this.drawHLine(i,t+s-1,e,n,l,A),this.drawVLine(i,t,s,c,l,A),this.drawVLine(i+e-1,t,s,r,l,A),this.drawChar(i,t,a,l,A),this.drawChar(i+e-1,t,h,l,A),this.drawChar(i,t+s-1,_,l,A),this.drawChar(i+e-1,t+s-1,u,l,A)}drawSingleBox(i,t,e,s,o,r){this.drawBox(i,t,e,s,g.BOX_SINGLE_HORIZONTAL,g.BOX_SINGLE_VERTICAL,g.BOX_SINGLE_HORIZONTAL,g.BOX_SINGLE_VERTICAL,g.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,g.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,g.BOX_SINGLE_UP_AND_SINGLE_LEFT,g.BOX_SINGLE_UP_AND_SINGLE_RIGHT,o,r)}drawDoubleBox(i,t,e,s,o,r){this.drawBox(i,t,e,s,g.BOX_DOUBLE_HORIZONTAL,g.BOX_DOUBLE_VERTICAL,g.BOX_DOUBLE_HORIZONTAL,g.BOX_DOUBLE_VERTICAL,g.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,g.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,g.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,g.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,o,r)}fillRect(i,t,e,s,o,r,n){for(let c=t;c<t+s;c++)this.drawHLine(i,c,e,o,r,n)}drawConsole(i,t,e,s,o,r,n,c){for(let a=0;a<n;a++)for(let h=0;h<r;h++){const u=e.getCell(s+h,o+a);u&&this.drawCell(i+h,t+a,u,c)}}drawCell(i,t,e,s){i>=0&&i<this.width&&t>=0&&t<this.height&&this.grid[t][i].drawCell(e,s)}setBlocked(i,t,e){i>=0&&i<this.width&&t>=0&&t<this.height&&(this.grid[t][i].blocked=e)}setBlockedSight(i,t,e){i>=0&&i<this.width&&t>=0&&t<this.height&&(this.grid[t][i].blockedSight=e)}isVisible(i,t){return i<this.minX||i>this.maxX||t<this.minY||t>this.maxY?!1:this.grid[t][i].visible}isBlocked(i,t){return i<0||i>this.width||t<0||t>this.height?!0:this.grid[t][i].blocked}isBlockedSight(i,t){return i<0||i>this.width||t<0||t>this.height?!0:this.grid[t][i].blockedSight}computeOctantY(i,t){const e=[],s=[];let o=1,r=0,n=0,c=0,a,h,u,_,l,A,T,m,L,D;for(h=this.originY+t;h>=this.minY&&h<=this.maxY;h+=t,n=r,++o)for(u=.5/o,D=-1,_=Math.floor(c*o+.5),a=this.originX+_*i;_<=o&&a>=this.minX&&a<=this.maxX;a+=i,++_,D=L){if(l=!0,A=!1,T=_/o,m=D,L=T+u,n>0){if(!(this.grid[h-t][a].visible&&!this.grid[h-t][a].blockedSight)&&!(this.grid[h-t][a-i].visible&&!this.grid[h-t][a-i].blockedSight))l=!1;else for(let f=0;f<n&&l;++f)if(m<=s[f]&&L>=e[f]){if(this.grid[h][a].blockedSight)if(m>=e[f]&&L<=s[f]){l=!1;break}else e[f]=Math.min(e[f],m),s[f]=Math.max(s[f],L),A=!0;else if(T>e[f]&&T<s[f]){l=!1;break}}}l&&(this.grid[h][a].visible=!0,this.grid[h][a].blockedSight&&(c>=m?c=L:A||(e[r]=m,s[r++]=L)))}}computeOctantX(i,t){const e=[],s=[];let o=1,r=0,n=0,c=0,a,h,u,_,l,A,T,m,L,D;for(a=this.originX+i;a>=this.minX&&a<=this.maxX;a+=i,n=r,++o)for(u=.5/o,D=-1,_=Math.floor(c*o+.5),h=this.originY+_*t;_<=o&&h>=this.minY&&h<=this.maxY;h+=t,++_,D=L){if(l=!0,A=!1,T=_/o,m=D,L=T+u,n>0){if(!(this.grid[h][a-i].visible&&!this.grid[h][a-i].blockedSight)&&!(this.grid[h-t][a-i].visible&&!this.grid[h-t][a-i].blockedSight))l=!1;else for(let f=0;f<n&&l;++f)if(m<=s[f]&&L>=e[f]){if(this.grid[h][a].blockedSight)if(m>=e[f]&&L<=s[f]){l=!1;break}else e[f]=Math.min(e[f],m),s[f]=Math.max(s[f],L),A=!0;else if(T>e[f]&&T<s[f]){l=!1;break}}}l&&(this.grid[h][a].visible=!0,this.grid[h][a].blockedSight&&(c>=m?c=L:A||(e[r]=m,s[r++]=L)))}}computeFov(i,t,e,s,o){if(this.originX=i,this.originY=t,this.radius=e,s)this.minX=Math.min(this.minX,Math.max(0,i-e)),this.minY=Math.min(this.minY,Math.max(0,t-e)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,i+e)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,t+e));else{this.minX=Math.max(0,i-e),this.minY=Math.max(0,t-e),this.maxX=Math.min(this.width-1,i+e),this.maxY=Math.min(this.height-1,t+e);for(let r=this.minY;r<=this.maxY;r++)for(let n=this.minX;n<=this.maxX;n++)this.grid[r][n].visible=!1}this.grid[t][i].visible=!0,o===void 0?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(o&1&&this.computeOctantY(1,1),o&2&&this.computeOctantX(1,1),o&4&&this.computeOctantX(1,-1),o&8&&this.computeOctantY(1,-1),o&16&&this.computeOctantY(-1,-1),o&32&&this.computeOctantX(-1,-1),o&64&&this.computeOctantX(-1,1),o&128&&this.computeOctantY(-1,1))}updateExplored(){for(let i=this.minY;i<=this.maxY;i++)for(let t=this.minX;t<=this.maxX;t++){const e=this.grid[i][t];e.explored=e.explored||e.visible}}};x=W([O],x);class k{constructor(t,e,s,o=1){this.url=t,this.charWidth=e,this.charHeight=s,this.scale=o}}const z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",F=new k(z,8,8);var Q=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,j=(i,t,e,s)=>{for(var o=s>1?void 0:s?Z(t,e):t,r=i.length-1,n;r>=0;r--)(n=i[r])&&(o=(s?n(t,e,o):n(o))||o);return s&&o&&Q(t,e,o),o};let d=class{constructor(i,t){this.x=i,this.y=t}};d=j([O],d);var q=Object.defineProperty,J=Object.getOwnPropertyDescriptor,$=(i,t,e,s)=>{for(var o=s>1?void 0:s?J(t,e):t,r=i.length-1,n;r>=0;r--)(n=i[r])&&(o=(s?n(t,e,o):n(o))||o);return s&&o&&q(t,e,o),o};let v=class{constructor(i,t,e,s){this.x=i,this.y=t,this.width=e,this.height=s}get left(){return this.x}get top(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}getCenter(){return new d(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(i){return this.x<=i.x2&&this.x2>=i.x&&this.y<=i.y2&&this.y2>=i.y}contains(i){return i.x>=this.x&&i.x<this.x2&&i.y>=this.y&&i.y<this.y2}};v=$([O],v);const tt=200,et=1e3/15;class it{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(t){this.down!==t&&(this.down=t,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(t){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,t-this.downTime>=tt&&t-this.repeatTime>=et&&(this.repeat=!0,this.repeatTime=t)):(this.downCount=0,this.upCount++)}isPressed(){return this.downCount===1||this.repeat}isClicked(){return this.upCount===1}}class b{constructor(){this.inputs=new Map}clear(){this.inputs.clear()}get(t){let e=this.inputs.get(t);return e||(e=new it,this.inputs.set(t,e)),e}updateAll(t){this.inputs.forEach(e=>e.update(t))}}class rt{constructor(t){this.keys=new b,t.addEventListener("keydown",e=>this.setKey(e,!0)),t.addEventListener("keyup",e=>this.setKey(e,!1))}clear(){this.keys.clear()}getKey(t){return this.keys.get(t)}setKey(t,e){const s=t.code;s!==E.VK_F11&&(t.stopPropagation(),t.preventDefault(),this.keys.get(s).setDown(e))}updateKeys(t){this.keys.updateAll(t)}}const E={VK_BACKSPACE:"Backspace",VK_TAB:"Tab",VK_ENTER:"Enter",VK_SHIFT_LEFT:"ShiftLeft",VK_SHIFT_RIGHT:"ShiftRight",VK_CONTROL_LEFT:"ControlLeft",VK_CONTROL_RIGHT:"ControlRight",VK_ALT_LEFT:"AltLeft",VK_ALT_RIGHT:"AltRight",VK_PAUSE:"Pause",VK_CAPS_LOCK:"CapsLock",VK_ESCAPE:"Escape",VK_SPACE:"Space",VK_PAGE_UP:"PageUp",VK_PAGE_DOWN:"PageDown",VK_END:"End",VK_HOME:"Home",VK_LEFT:"ArrowLeft",VK_UP:"ArrowUp",VK_RIGHT:"ArrowRight",VK_DOWN:"ArrowDown",VK_INSERT:"Insert",VK_DELETE:"Delete",VK_0:"Digit0",VK_1:"Digit1",VK_2:"Digit2",VK_3:"Digit3",VK_4:"Digit4",VK_5:"Digit5",VK_6:"Digit6",VK_7:"Digit7",VK_8:"Digit8",VK_9:"Digit9",VK_SEMICOLON:"Semicolon",VK_EQUALS:"Equal",VK_A:"KeyA",VK_B:"KeyB",VK_C:"KeyC",VK_D:"KeyD",VK_E:"KeyE",VK_F:"KeyF",VK_G:"KeyG",VK_H:"KeyH",VK_I:"KeyI",VK_J:"KeyJ",VK_K:"KeyK",VK_L:"KeyL",VK_M:"KeyM",VK_N:"KeyN",VK_O:"KeyO",VK_P:"KeyP",VK_Q:"KeyQ",VK_R:"KeyR",VK_S:"KeyS",VK_T:"KeyT",VK_U:"KeyU",VK_V:"KeyV",VK_W:"KeyW",VK_X:"KeyX",VK_Y:"KeyY",VK_Z:"KeyZ",VK_CONTEXT_MENU:"ContextMenu",VK_NUMPAD0:"Numpad0",VK_NUMPAD1:"Numpad1",VK_NUMPAD2:"Numpad2",VK_NUMPAD3:"Numpad3",VK_NUMPAD4:"Numpad4",VK_NUMPAD5:"Numpad5",VK_NUMPAD6:"Numpad6",VK_NUMPAD7:"Numpad7",VK_NUMPAD8:"Numpad8",VK_NUMPAD9:"Numpad9",VK_NUMPAD_ENTER:"NumpadEnter",VK_MULTIPLY:"NumpadMultiply",VK_ADD:"NumpadAdd",VK_SEPARATOR:"NumpadSeparator",VK_SUBTRACT:"NumpadSubtract",VK_DECIMAL:"NumpadDecimal",VK_DIVIDE:"NumpadDivide",VK_F1:"F1",VK_F2:"F2",VK_F3:"F3",VK_F4:"F4",VK_F5:"F5",VK_F6:"F6",VK_F7:"F7",VK_F8:"F8",VK_F9:"F9",VK_F10:"F10",VK_F11:"F11",VK_F12:"F12",VK_F13:"F13",VK_F14:"F14",VK_F15:"F15",VK_F16:"F16",VK_F17:"F17",VK_F18:"F18",VK_F19:"F19",VK_F20:"F20",VK_F21:"F21",VK_F22:"F22",VK_F23:"F23",VK_F24:"F24",VK_NUM_LOCK:"NumLock",VK_SCROLL_LOCK:"ScrollLock",VK_COMMA:"Comma",VK_PERIOD:"Period",VK_SLASH:"Slash",VK_BACKQUOTE:"Backquote",VK_OPEN_BRACKET:"BracketLeft",VK_BACK_SLASH:"Backslash",VK_CLOSE_BRACKET:"BracketRight",VK_QUOTE:"Quote",VK_META:"OSLeft"};class st{constructor(t){this.buttons=new b,this.el=t.canvas,this.width=t.width,this.height=t.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0;const e=this.el;e.addEventListener("mousedown",s=>this.handleEvent(s)),e.addEventListener("mouseup",s=>this.handleEvent(s)),e.addEventListener("mousemove",s=>this.handleEvent(s)),e.addEventListener("contextmenu",s=>this.handleEvent(s)),e.addEventListener("touchstart",s=>this.handleTouchEvent(s)),e.addEventListener("touchend",s=>this.handleTouchEvent(s)),e.addEventListener("touchcancel",s=>this.handleTouchEvent(s)),e.addEventListener("touchmove",s=>this.handleTouchEvent(s)),e.addEventListener("wheel",s=>this.handleWheelEvent(s))}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.updatePosition(e.clientX,e.clientY),this.buttons.get(0).setDown(!0)}else this.buttons.get(0).setDown(!1)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),t.type==="mousedown"&&(this.buttons.get(t.button).setDown(!0),this.el.focus()),t.type==="mouseup"&&this.buttons.get(t.button).setDown(!1)}handleWheelEvent(t){t.stopPropagation(),t.preventDefault(),this.wheelDeltaX=t.deltaX,this.wheelDeltaY=t.deltaY}updatePosition(t,e){let s=this.el.getBoundingClientRect();const o=this.width/this.height,r=s.width/s.height;if(r-o>.01){const n=o*s.height,c=s.width-n;s=new v(Math.floor(c/2),0,n,s.height)}if(r-o<-.01){const n=s.width/o,c=s.height-n;s=new v(0,Math.floor(c/2),s.width,n)}this.x=this.width*(t-s.left)/s.width|0,this.y=this.height*(e-s.top)/s.height|0}update(t){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y,this.buttons.updateAll(t)}}const ot=`#version 300 es
precision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}`,nt=`#version 300 es
precision highp float;in vec2 e;in vec4 f;in vec4 g;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(o.r<0.1) {o=g;} else {o=f;}}`,ht=`#version 300 es
precision highp float;
in vec2 a_position;
in vec2 a_texCoord;
out vec2 v_texCoord;
void main(void) {
  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);
  v_texCoord = a_texCoord;
}`,at=`#version 300 es
#define PI 3.1415926535897932384626433832795
precision highp float;
in vec2 v_texCoord;
uniform sampler2D u_texture;
uniform float u_blur;
uniform float u_curvature;
uniform float u_chroma;
uniform float u_scanlineWidth;
uniform float u_scanlineIntensity;
uniform float u_vignette;
out vec4 outputColor;

vec2 curve(vec2 uv) {
  uv = (uv - 0.5) * 2.0;
  uv *= 1.1;
  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);
  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);
  uv /= 1.1;
  uv = (uv / 2.0) + 0.5;
  return uv;
}

void main() {
  vec2 iResolution = vec2(640.0, 360.0);
  vec2 q = v_texCoord;
  vec2 fragCoord = v_texCoord;
  vec2 uv = q;
  uv = curve(uv);

  // Outside of range is black
  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    outputColor = vec4(0.0, 0.0, 0.0, 1.0);
    return;
  }

  vec4 col;

  // Chromatic aberration
  // col = texture(u_texture, uv.xy);
  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;
  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;
  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;
  
  // Blur
  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));

  // Vignette
  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);

  // Scanlines
  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);

  outputColor = vec4(col.rgb, 1.0);
}`;function R(i,t){return-1+2*(i/t)}const C={font:F,movementKeys:{[E.VK_K]:new d(0,-1),[E.VK_UP]:new d(0,-1),[E.VK_NUMPAD8]:new d(0,-1),[E.VK_J]:new d(0,1),[E.VK_DOWN]:new d(0,1),[E.VK_NUMPAD2]:new d(0,1),[E.VK_H]:new d(-1,0),[E.VK_LEFT]:new d(-1,0),[E.VK_NUMPAD4]:new d(-1,0),[E.VK_L]:new d(1,0),[E.VK_RIGHT]:new d(1,0),[E.VK_NUMPAD6]:new d(1,0),[E.VK_Y]:new d(-1,-1),[E.VK_NUMPAD7]:new d(-1,-1),[E.VK_U]:new d(1,-1),[E.VK_NUMPAD9]:new d(1,-1),[E.VK_B]:new d(-1,1),[E.VK_NUMPAD1]:new d(-1,1),[E.VK_N]:new d(1,1),[E.VK_NUMPAD3]:new d(1,1),[E.VK_PERIOD]:new d(0,0),[E.VK_NUMPAD5]:new d(0,0)}};class ut extends x{constructor(t,e,s,o=C){var _;super(e,s),this.canvas=t,this.font=o.font??F,this.crt=o.crt,this.maxFps=o.maxFps,this.pixelWidth=e*this.font.charWidth,this.pixelHeight=s*this.font.charHeight,this.pixelScale=((_=o.crt)==null?void 0:_.scale)??1,t.width=this.pixelWidth*this.pixelScale,t.height=this.pixelHeight*this.pixelScale,t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.keys=new rt(t),this.mouse=new st(this);const r=t.getContext("webgl2",{antialias:!1});if(!r)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=r.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=r,this.program=n,r.attachShader(n,this.buildShader(r.VERTEX_SHADER,ot)),r.attachShader(n,this.buildShader(r.FRAGMENT_SHADER,nt)),r.linkProgram(n),r.useProgram(n),this.crtProgram=r.createProgram(),r.attachShader(this.crtProgram,this.buildShader(r.VERTEX_SHADER,ht)),r.attachShader(this.crtProgram,this.buildShader(r.FRAGMENT_SHADER,at)),r.linkProgram(this.crtProgram),r.useProgram(this.crtProgram),this.crtBlurLocation=r.getUniformLocation(this.crtProgram,"u_blur"),this.crtCurvatureLocation=r.getUniformLocation(this.crtProgram,"u_curvature"),this.crtChromaLocation=r.getUniformLocation(this.crtProgram,"u_chroma"),this.crtScanlineWidthLocation=r.getUniformLocation(this.crtProgram,"u_scanlineWidth"),this.crtScanlineIntensityLocation=r.getUniformLocation(this.crtProgram,"u_scanlineIntensity"),this.crtVignetteLocation=r.getUniformLocation(this.crtProgram,"u_vignette"),this.crtPositionLocation=r.getAttribLocation(this.crtProgram,"a_position"),this.crtPositionBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.crtPositionBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(this.crtPositionLocation),r.vertexAttribPointer(this.crtPositionLocation,2,r.FLOAT,!1,0,0),this.crtTexCoordLocation=r.getAttribLocation(this.crtProgram,"a_texCoord"),this.crtTexCoordBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.crtTexCoordBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(this.crtTexCoordLocation),r.vertexAttribPointer(this.crtTexCoordLocation,2,r.FLOAT,!1,0,0),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const c=e*s;this.positionsArray=new Float32Array(c*3*4),this.indexArray=new Uint16Array(c*6),this.textureArray=new Float32Array(c*2*4),this.foregroundUint8Array=new Uint8Array(c*4*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(c*4*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer),this.frameBufferTexture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.frameBufferTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.pixelWidth,this.pixelHeight,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.frameBuffer=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.frameBufferTexture,0);let a=0,h=0,u=0;for(let l=0;l<s;l++)for(let A=0;A<e;A++)this.positionsArray[a++]=R(A,e),this.positionsArray[a++]=-R(l,s),this.positionsArray[a++]=R(A+1,e),this.positionsArray[a++]=-R(l,s),this.positionsArray[a++]=R(A+1,e),this.positionsArray[a++]=-R(l+1,s),this.positionsArray[a++]=R(A,e),this.positionsArray[a++]=-R(l+1,s),this.indexArray[h++]=u+0,this.indexArray[h++]=u+1,this.indexArray[h++]=u+2,this.indexArray[h++]=u+0,this.indexArray[h++]=u+2,this.indexArray[h++]=u+3,u+=4;this.positionBuffer=r.createBuffer(),this.indexBuffer=r.createBuffer(),this.textureBuffer=r.createBuffer(),this.foregroundBuffer=r.createBuffer(),this.backgroundBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferData(r.ARRAY_BUFFER,this.positionsArray,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,this.indexArray,r.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,this.maxFps===void 0?this.requestAnimationFrame():window.setInterval(()=>this.renderLoop(performance.now()),1e3/this.maxFps)}handleResize(){const t=this.canvas.parentElement;if(!t)return;const e=t.offsetWidth/this.pixelWidth,s=t.offsetHeight/this.pixelHeight,o=Math.min(e,s),r=o*this.pixelWidth|0,n=o*this.pixelHeight|0;this.canvas.style.width=r+"px",this.canvas.style.height=n+"px"}getAttribLocation(t){const e=this.gl.getAttribLocation(this.program,t);return this.gl.enableVertexAttribArray(e),e}flush(){let t=0,e=0;for(let s=0;s<this.height;s++)for(let o=0;o<this.width;o++){const r=this.getCell(o,s);if(!r.dirty){t+=8,e+=16;continue}const n=r.charCode%16,c=r.charCode/16|0;this.textureArray[t++]=n,this.textureArray[t++]=c,this.textureArray[t++]=n+1,this.textureArray[t++]=c,this.textureArray[t++]=n+1,this.textureArray[t++]=c+1,this.textureArray[t++]=n,this.textureArray[t++]=c+1;for(let a=0;a<4;a++)this.foregroundDataView.setUint32(e,r.fg,!1),this.backgroundDataView.setUint32(e,r.bg,!1),e+=4;r.dirty=!1}}isKeyDown(t){return this.keys.getKey(t).down}isKeyPressed(t){return this.keys.getKey(t).isPressed()}getKeyDownCount(t){return this.keys.getKey(t).downCount}getMovementKey(t=C.movementKeys){for(const e in t)if(this.isKeyPressed(e))return t[e]}buildShader(t,e){const s=this.gl,o=s.createShader(t);if(!o)throw new Error("An error occurred compiling the shader: ");if(s.shaderSource(o,e),s.compileShader(o),!s.getShaderParameter(o,s.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+s.getShaderInfoLog(o));return o}loadTexture(t){const e=this.gl,s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const o=0,r=e.RGBA,n=1,c=1,a=0,h=e.RGBA,u=e.UNSIGNED_BYTE,_=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,o,r,n,c,a,h,u,_);const l=new Image;return l.onload=()=>{e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,o,r,h,u,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},l.src=t,s}render(){const t=this.gl;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.crt?t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=t.FLOAT,o=!1,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(this.positionAttribLocation,2,s,o,r,n)}{const s=t.FLOAT,o=!1,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.textureAttribLocation,2,s,o,r,n)}{const s=t.UNSIGNED_BYTE,o=!0,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.foregroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.foregroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.fgColorAttribLocation,4,s,o,r,n)}{const s=t.UNSIGNED_BYTE,o=!0,r=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.backgroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.bgColorAttribLocation,4,s,o,r,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture);{const e=this.width*this.height*6,s=t.UNSIGNED_SHORT,o=0;t.drawElements(t.TRIANGLES,e,s,o)}}renderCrt(){const t=this.crt;if(!t)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.pixelWidth*this.pixelScale,this.pixelHeight*this.pixelScale),e.useProgram(this.crtProgram),e.uniform1f(this.crtBlurLocation,t.blur),e.uniform1f(this.crtCurvatureLocation,t.curvature),e.uniform1f(this.crtChromaLocation,t.chroma),e.uniform1f(this.crtVignetteLocation,t.vignette),e.uniform1f(this.crtScanlineWidthLocation,t.scanlineWidth),e.uniform1f(this.crtScanlineIntensityLocation,t.scanlineIntensity),e.bindBuffer(e.ARRAY_BUFFER,this.crtPositionBuffer),e.vertexAttribPointer(this.crtPositionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.crtTexCoordBuffer),e.vertexAttribPointer(this.crtTexCoordLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.frameBufferTexture),e.drawArrays(e.TRIANGLES,0,6)}requestAnimationFrame(){window.requestAnimationFrame(t=>this.renderLoop(t))}renderLoop(t){this.lastRenderTime===0?(this.lastRenderTime=t,this.fps=0):(this.renderDelta=t-this.lastRenderTime,this.lastRenderTime=t,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(t),this.mouse.update(t),this.update&&this.update(),this.flush(),this.render(),this.crt&&this.renderCrt(),this.maxFps===void 0&&this.requestAnimationFrame()}}export{B as C,k as F,E as K,N as M,d as P,v as R,ut as T,x as a,g as b,w as c,ct as d,p as f,O as s};
