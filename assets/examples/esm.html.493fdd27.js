import"../modulepreload-polyfill.b7f2da20.js";/* empty css                */var B;(function(e){e[e.None=0]="None",e[e.Blend=1]="Blend",e[e.Add=2]="Add"})(B||(B={}));function p(e,t,i,r){var n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var _=e.length-1;_>=0;_--)(s=e[_])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function h(e,t,i,r){return r===void 0&&(r=255),(e<<24)+(t<<16)+(i<<8)+r}const U={BLACK:h(0,0,0),WHITE:h(255,255,255),LIGHT_GRAY:h(170,170,170),DARK_GRAY:h(85,85,85),YELLOW:h(255,255,85),BROWN:h(170,85,0),LIGHT_RED:h(255,85,85),DARK_RED:h(170,0,0),LIGHT_GREEN:h(85,255,85),DARK_GREEN:h(0,170,0),LIGHT_CYAN:h(85,255,255),DARK_CYAN:h(0,170,170),LIGHT_BLUE:h(85,85,255),DARK_BLUE:h(0,0,170),LIGHT_MAGENTA:h(255,85,255),DARK_MAGENTA:h(170,0,170),ORANGE:h(255,136,0)},X=new Map;function S(e){X.set(e.name,e)}function M(e){return typeof e=="string"&&e.length>0?e.charCodeAt(0):e}let V=class{constructor(t,i,r,n,o){this.x=t,this.y=i,r!==void 0?this.charCode=M(r):this.charCode=" ".charCodeAt(0),n!==void 0?this.fg=n:this.fg=U.WHITE,o!==void 0?this.bg=o:this.bg=U.BLACK,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(t){this.charCode!==t&&(this.charCode=t,this.dirty=!0)}setForeground(t){t!=null&&t!==this.fg&&(this.fg=t,this.dirty=!0)}setBackground(t){t!=null&&t!==this.bg&&(this.bg=t,this.dirty=!0)}setValue(t,i,r){return typeof t=="string"&&(t=t.charCodeAt(0)),typeof t=="number"?(this.setCharCode(t),i!==void 0&&this.setForeground(i),r!==void 0&&this.setBackground(r)):this.drawCell(t,B.None),this.dirty}drawCell(t,i){const r=t.bg&255;i===B.None||t.charCode>0?(this.setCharCode(t.charCode),this.setForeground(t.fg)):r>0&&r<255&&this.setForeground(this.blendColors(this.fg,t.bg,i)),i===B.None||r===255?this.setBackground(t.bg):r>0&&this.setBackground(this.blendColors(this.bg,t.bg,i))}blendColors(t,i,r){const n=i&255,o=(255-n)/255,s=1-o,_=t>>24&255,l=t>>16&255,a=t>>8&255,u=i>>24&255,d=i>>16&255,A=i>>8&255;switch(r){case B.Blend:return h(o*_+s*u|0,o*l+s*d|0,o*a+s*A|0);case B.Add:return h(this.clamp(_+s*u|0),this.clamp(l+s*d|0),this.clamp(a+s*A|0));default:return i}}clamp(t){return Math.min(255,t)}};V=p([S],V);var T;(function(e){e[e.SMILEY=1]="SMILEY",e[e.INVERSE_SMILEY=2]="INVERSE_SMILEY",e[e.HEART=3]="HEART",e[e.DIAMOND=4]="DIAMOND",e[e.CLUB=5]="CLUB",e[e.SPADE=6]="SPADE",e[e.BULLET=7]="BULLET",e[e.INVERSE_BULLET=8]="INVERSE_BULLET",e[e.LIGHT_SHADE=176]="LIGHT_SHADE",e[e.MEDIUM_SHADE=177]="MEDIUM_SHADE",e[e.DARK_SHADE=178]="DARK_SHADE",e[e.BOX_SINGLE_VERTICAL=179]="BOX_SINGLE_VERTICAL",e[e.BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT=180]="BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT",e[e.BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT=185]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT",e[e.BOX_DOUBLE_VERTICAL=186]="BOX_DOUBLE_VERTICAL",e[e.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT=187]="BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT",e[e.BOX_DOUBLE_UP_AND_DOUBLE_LEFT=188]="BOX_DOUBLE_UP_AND_DOUBLE_LEFT",e[e.BOX_SINGLE_DOWN_AND_SINGLE_LEFT=191]="BOX_SINGLE_DOWN_AND_SINGLE_LEFT",e[e.BOX_SINGLE_UP_AND_SINGLE_RIGHT=192]="BOX_SINGLE_UP_AND_SINGLE_RIGHT",e[e.BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP=193]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP",e[e.BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN=194]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN",e[e.BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT=195]="BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT",e[e.BOX_SINGLE_HORIZONTAL=196]="BOX_SINGLE_HORIZONTAL",e[e.BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL=197]="BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL",e[e.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT=200]="BOX_DOUBLE_UP_AND_DOUBLE_RIGHT",e[e.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT=201]="BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT",e[e.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP=202]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP",e[e.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN=203]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN",e[e.BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT=204]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT",e[e.BOX_DOUBLE_HORIZONTAL=205]="BOX_DOUBLE_HORIZONTAL",e[e.BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL=206]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL",e[e.BOX_SINGLE_UP_AND_SINGLE_LEFT=217]="BOX_SINGLE_UP_AND_SINGLE_LEFT",e[e.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT=218]="BOX_SINGLE_DOWN_AND_SINGLE_RIGHT",e[e.BLOCK_FULL=219]="BLOCK_FULL",e[e.BLOCK_BOTTOM_HALF=220]="BLOCK_BOTTOM_HALF",e[e.BLOCK_LEFT_HALF=221]="BLOCK_LEFT_HALF",e[e.BLOCK_RIGHT_HALF=222]="BLOCK_RIGHT_HALF",e[e.BLOCK_TOP_HALF=223]="BLOCK_TOP_HALF"})(T||(T={}));function W(e,t){const i=new RegExp("(\\S(.{0,"+t+"}\\S)?)\\s+","g");return(e+" ").replace(i,`$1
`).trim().split(`
`).map(r=>r.trim())}let w=class{constructor(t,i,r){this.width=t,this.height=i,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let n=0;n<i;n++){const o=[];for(let s=0;s<t;s++)o.push(new V(s,n));this.grid.push(o)}if(this.clear(),r)for(let n=0;n<i;n++)for(let o=0;o<t;o++)this.grid[n][o].blocked=this.grid[n][o].blockedSight=r(o,n)}clear(){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.drawChar(i,t,0)}getCell(t,i){if(!(t<0||i<0||t>=this.width||i>=this.height))return this.grid[i][t]}getCharCode(t,i){if(!(t<0||i<0||t>=this.width||i>=this.height))return this.grid[i][t].charCode}drawChar(t,i,r,n,o){this.clip&&!this.clip.contains({x:t,y:i})||t>=0&&t<this.width&&i>=0&&i<this.height&&this.grid[i|0][t|0].setValue(r,n,o)}drawString(t,i,r,n,o){const s=r.split(`
`);for(let _=0;_<s.length;_++)this.drawStringLine(t,i+_,s[_],n,o)}drawStringLine(t,i,r,n,o){for(let s=0;s<r.length;s++)this.drawChar(t+s,i,r.charCodeAt(s),n,o)}drawCenteredString(t,i,r,n,o){this.drawString(t-Math.floor(r.length/2),i,r,n,o)}drawMessage(t,i,r,n){if(r.text){const o=W(r.text,n||this.width-t);for(const s of o)this.drawStringLine(t,i,s,r.fg,r.bg),i++}if(r.children)for(const o of r.children)i=this.drawMessage(t,i,o,n);return i}drawHLine(t,i,r,n,o,s){for(let _=t;_<t+r;_++)this.drawChar(_,i,n,o,s)}drawVLine(t,i,r,n,o,s){for(let _=i;_<i+r;_++)this.drawChar(t,_,n,o,s)}drawRect(t,i,r,n,o,s,_){this.drawHLine(t,i,r,o,s,_),this.drawHLine(t,i+n-1,r,o,s,_),this.drawVLine(t,i,n,o,s,_),this.drawVLine(t+r-1,i,n,o,s,_)}drawBox(t,i,r,n,o,s,_,l,a,u,d,A,c,L){this.drawHLine(t,i,r,o,c,L),this.drawHLine(t,i+n-1,r,_,c,L),this.drawVLine(t,i,n,l,c,L),this.drawVLine(t+r-1,i,n,s,c,L),this.drawChar(t,i,a,c,L),this.drawChar(t+r-1,i,u,c,L),this.drawChar(t,i+n-1,A,c,L),this.drawChar(t+r-1,i+n-1,d,c,L)}drawSingleBox(t,i,r,n,o,s){this.drawBox(t,i,r,n,T.BOX_SINGLE_HORIZONTAL,T.BOX_SINGLE_VERTICAL,T.BOX_SINGLE_HORIZONTAL,T.BOX_SINGLE_VERTICAL,T.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,T.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,T.BOX_SINGLE_UP_AND_SINGLE_LEFT,T.BOX_SINGLE_UP_AND_SINGLE_RIGHT,o,s)}drawDoubleBox(t,i,r,n,o,s){this.drawBox(t,i,r,n,T.BOX_DOUBLE_HORIZONTAL,T.BOX_DOUBLE_VERTICAL,T.BOX_DOUBLE_HORIZONTAL,T.BOX_DOUBLE_VERTICAL,T.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,T.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,T.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,T.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,o,s)}fillRect(t,i,r,n,o,s,_){for(let l=i;l<i+n;l++)this.drawHLine(t,l,r,o,s,_)}drawConsole(t,i,r,n,o,s,_,l){l=l||B.None;for(let a=0;a<_;a++)for(let u=0;u<s;u++){const d=r.getCell(n+u,o+a);d&&this.drawCell(t+u,i+a,d,l)}}drawCell(t,i,r,n){t>=0&&t<this.width&&i>=0&&i<this.height&&this.grid[i][t].drawCell(r,n)}setBlocked(t,i,r){t>=0&&t<this.width&&i>=0&&i<this.height&&(this.grid[i][t].blocked=r)}setBlockedSight(t,i,r){t>=0&&t<this.width&&i>=0&&i<this.height&&(this.grid[i][t].blockedSight=r)}isVisible(t,i){return t<this.minX||t>this.maxX||i<this.minY||i>this.maxY?!1:this.grid[i][t].visible}isBlocked(t,i){return t<0||t>this.width||i<0||i>this.height?!0:this.grid[i][t].blocked}isBlockedSight(t,i){return t<0||t>this.width||i<0||i>this.height?!0:this.grid[i][t].blockedSight}computeOctantY(t,i){const r=[],n=[];let o=1,s=0,_=0,l=0,a,u,d,A,c,L,N,O,R,m;for(u=this.originY+i;u>=this.minY&&u<=this.maxY;u+=i,_=s,++o)for(d=.5/o,m=-1,A=Math.floor(l*o+.5),a=this.originX+A*t;A<=o&&a>=this.minX&&a<=this.maxX;a+=t,++A,m=R){if(c=!0,L=!1,N=A/o,O=m,R=N+d,_>0){if(!(this.grid[u-i][a].visible&&!this.grid[u-i][a].blockedSight)&&!(this.grid[u-i][a-t].visible&&!this.grid[u-i][a-t].blockedSight))c=!1;else for(let E=0;E<_&&c;++E)if(O<=n[E]&&R>=r[E]){if(this.grid[u][a].blockedSight)if(O>=r[E]&&R<=n[E]){c=!1;break}else r[E]=Math.min(r[E],O),n[E]=Math.max(n[E],R),L=!0;else if(N>r[E]&&N<n[E]){c=!1;break}}}c&&(this.grid[u][a].visible=!0,this.grid[u][a].blockedSight&&(l>=O?l=R:L||(r[s]=O,n[s++]=R)))}}computeOctantX(t,i){const r=[],n=[];let o=1,s=0,_=0,l=0,a,u,d,A,c,L,N,O,R,m;for(a=this.originX+t;a>=this.minX&&a<=this.maxX;a+=t,_=s,++o)for(d=.5/o,m=-1,A=Math.floor(l*o+.5),u=this.originY+A*i;A<=o&&u>=this.minY&&u<=this.maxY;u+=i,++A,m=R){if(c=!0,L=!1,N=A/o,O=m,R=N+d,_>0){if(!(this.grid[u][a-t].visible&&!this.grid[u][a-t].blockedSight)&&!(this.grid[u-i][a-t].visible&&!this.grid[u-i][a-t].blockedSight))c=!1;else for(let E=0;E<_&&c;++E)if(O<=n[E]&&R>=r[E]){if(this.grid[u][a].blockedSight)if(O>=r[E]&&R<=n[E]){c=!1;break}else r[E]=Math.min(r[E],O),n[E]=Math.max(n[E],R),L=!0;else if(N>r[E]&&N<n[E]){c=!1;break}}}c&&(this.grid[u][a].visible=!0,this.grid[u][a].blockedSight&&(l>=O?l=R:L||(r[s]=O,n[s++]=R)))}}computeFov(t,i,r,n,o){if(this.originX=t,this.originY=i,this.radius=r,n)this.minX=Math.min(this.minX,Math.max(0,t-r)),this.minY=Math.min(this.minY,Math.max(0,i-r)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,t+r)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,i+r));else{this.minX=Math.max(0,t-r),this.minY=Math.max(0,i-r),this.maxX=Math.min(this.width-1,t+r),this.maxY=Math.min(this.height-1,i+r);for(let s=this.minY;s<=this.maxY;s++)for(let _=this.minX;_<=this.maxX;_++)this.grid[s][_].visible=!1}this.grid[i][t].visible=!0,o===void 0?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(o&1&&this.computeOctantY(1,1),o&2&&this.computeOctantX(1,1),o&4&&this.computeOctantX(1,-1),o&8&&this.computeOctantY(1,-1),o&16&&this.computeOctantY(-1,-1),o&32&&this.computeOctantX(-1,-1),o&64&&this.computeOctantX(-1,1),o&128&&this.computeOctantY(-1,1))}updateExplored(){for(let t=this.minY;t<=this.maxY;t++)for(let i=this.minX;i<=this.maxX;i++){const r=this.grid[t][i];r.explored=r.explored||r.visible}}};w=p([S],w);class Y{constructor(t,i,r,n){this.url=t,this.charWidth=i,this.charHeight=r,this.scale=n||1}}const y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",C=new Y(y,8,8);var P;(function(e){e[e.OCTANT_SOUTH_SOUTHEAST=1]="OCTANT_SOUTH_SOUTHEAST",e[e.OCTANT_EAST_SOUTHEAST=2]="OCTANT_EAST_SOUTHEAST",e[e.OCTANT_EAST_NORTHTHEAST=4]="OCTANT_EAST_NORTHTHEAST",e[e.OCTANT_NORTH_NORTHEAST=8]="OCTANT_NORTH_NORTHEAST",e[e.OCTANT_NORTH_NORTHWEST=16]="OCTANT_NORTH_NORTHWEST",e[e.OCTANT_WEST_NORTHEAST=32]="OCTANT_WEST_NORTHEAST",e[e.OCTANT_WEST_SOUTHWEST=64]="OCTANT_WEST_SOUTHWEST",e[e.OCTANT_SOUTH_SOUTHWEST=128]="OCTANT_SOUTH_SOUTHWEST"})(P||(P={}));var v;(function(e){e[e.QUADRANT_SOUTHEAST=3]="QUADRANT_SOUTHEAST",e[e.QUADRANT_EAST=6]="QUADRANT_EAST",e[e.QUADRANT_NORTHEAST=12]="QUADRANT_NORTHEAST",e[e.QUADRANT_NORTH=24]="QUADRANT_NORTH",e[e.QUADRANT_NORTHWEST=48]="QUADRANT_NORTHWEST",e[e.QUADRANT_WEST=96]="QUADRANT_WEST",e[e.QUADRANT_SOUTHWEST=192]="QUADRANT_SOUTHWEST",e[e.QUADRANT_SOUTH=129]="QUADRANT_SOUTH"})(v||(v={}));let D=class{constructor(t,i){this.x=t,this.y=i}};D=p([S],D);let I=class{constructor(t,i,r,n){this.x=this.left=t,this.y=this.top=i,this.width=r,this.height=n,this.x2=t+r,this.y2=i+n}getCenter(){return new D(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<this.x2&&t.y>=this.y&&t.y<this.y2}};I=p([S],I);let F=class{constructor(t,i,r,n){this.text=t,this.fg=i,this.bg=r,this.children=n}getWidth(){let t=0;if(this.text)for(const i of this.text.split(`
`))t=Math.max(t,i.length);if(this.children)for(const i of this.children)t=Math.max(t,i.getWidth());return t}getHeight(){let t=0;if(this.text&&(t+=this.text.split(`
`).length),this.children)for(const i of this.children)t+=i.getHeight();return t}};F=p([S],F);const k=200,z=1e3/15;class Q{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(t){this.down!==t&&(this.down=t,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(t){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,t-this.downTime>=k&&t-this.repeatTime>=z&&(this.repeat=!0,this.repeatTime=t)):(this.downCount=0,this.upCount++)}isPressed(){return this.downCount===1||this.repeat}isClicked(){return this.upCount===1}}class K{constructor(){this.inputs=new Map}clear(){this.inputs.clear()}get(t){let i=this.inputs.get(t);return i||(i=new Q,this.inputs.set(t,i)),i}updateAll(t){this.inputs.forEach(i=>i.update(t))}}class Z{constructor(t){this.keys=new K,t.addEventListener("keydown",i=>this.setKey(i,!0)),t.addEventListener("keyup",i=>this.setKey(i,!1))}clear(){this.keys.clear()}getKey(t){return this.keys.get(t)}setKey(t,i){const r=t.code;r!==f.VK_F11&&(t.stopPropagation(),t.preventDefault(),this.keys.get(r).setDown(i))}updateKeys(t){this.keys.updateAll(t)}}var f;(function(e){e.VK_CANCEL="Pause",e.VK_BACKSPACE="Backspace",e.VK_TAB="Tab",e.VK_ENTER="Enter",e.VK_SHIFT_LEFT="ShiftLeft",e.VK_SHIFT_RIGHT="ShiftLeft",e.VK_CONTROL_LEFT="ControlLeft",e.VK_CONTROL_RIGHT="ControlRight",e.VK_ALT_LEFT="AltLeft",e.VK_ALT_RIGHT="AltRight",e.VK_PAUSE="Pause",e.VK_CAPS_LOCK="CapsLock",e.VK_ESCAPE="Escape",e.VK_SPACE="Space",e.VK_PAGE_UP="PageUp",e.VK_PAGE_DOWN="PageDown",e.VK_END="End",e.VK_HOME="Home",e.VK_LEFT="ArrowLeft",e.VK_UP="ArrowUp",e.VK_RIGHT="ArrowRight",e.VK_DOWN="ArrowDown",e.VK_INSERT="Insert",e.VK_DELETE="Delete",e.VK_0="Digit0",e.VK_1="Digit1",e.VK_2="Digit2",e.VK_3="Digit3",e.VK_4="Digit4",e.VK_5="Digit5",e.VK_6="Digit6",e.VK_7="Digit7",e.VK_8="Digit8",e.VK_9="Digit9",e.VK_SEMICOLON="Semicolon",e.VK_EQUALS="Equal",e.VK_A="KeyA",e.VK_B="KeyB",e.VK_C="KeyC",e.VK_D="KeyD",e.VK_E="KeyE",e.VK_F="KeyF",e.VK_G="KeyG",e.VK_H="KeyH",e.VK_I="KeyI",e.VK_J="KeyJ",e.VK_K="KeyK",e.VK_L="KeyL",e.VK_M="KeyM",e.VK_N="KeyN",e.VK_O="KeyO",e.VK_P="KeyP",e.VK_Q="KeyQ",e.VK_R="KeyR",e.VK_S="KeyS",e.VK_T="KeyT",e.VK_U="KeyU",e.VK_V="KeyV",e.VK_W="KeyW",e.VK_X="KeyX",e.VK_Y="KeyY",e.VK_Z="KeyZ",e.VK_CONTEXT_MENU="ContextMenu",e.VK_NUMPAD0="Numpad0",e.VK_NUMPAD1="Numpad1",e.VK_NUMPAD2="Numpad2",e.VK_NUMPAD3="Numpad3",e.VK_NUMPAD4="Numpad4",e.VK_NUMPAD5="Numpad5",e.VK_NUMPAD6="Numpad6",e.VK_NUMPAD7="Numpad7",e.VK_NUMPAD8="Numpad8",e.VK_NUMPAD9="Numpad9",e.VK_NUMPAD_ENTER="NumpadEnter",e.VK_MULTIPLY="NumpadMultiply",e.VK_ADD="NumpadAdd",e.VK_SEPARATOR="NumpadDecimal",e.VK_SUBTRACT="NumpadSubtract",e.VK_DECIMAL="NumpadDecimal",e.VK_DIVIDE="NumpadDivide",e.VK_F1="F1",e.VK_F2="F2",e.VK_F3="F3",e.VK_F4="F4",e.VK_F5="F5",e.VK_F6="F6",e.VK_F7="F7",e.VK_F8="F8",e.VK_F9="F9",e.VK_F10="F10",e.VK_F11="F11",e.VK_F12="F12",e.VK_F13="F13",e.VK_F14="F14",e.VK_F15="F15",e.VK_F16="F16",e.VK_F17="F17",e.VK_F18="F18",e.VK_F19="F19",e.VK_F20="F20",e.VK_F21="F21",e.VK_F22="F22",e.VK_F23="F23",e.VK_F24="F24",e.VK_NUM_LOCK="NumLock",e.VK_SCROLL_LOCK="ScrollLock",e.VK_COMMA="Comma",e.VK_PERIOD="Period",e.VK_SLASH="Slash",e.VK_BACKQUOTE="Backquote",e.VK_OPEN_BRACKET="BracketLeft",e.VK_BACK_SLASH="Backslash",e.VK_CLOSE_BRACKET="BracketRight",e.VK_QUOTE="Quote",e.VK_META="OSLeft"})(f||(f={}));T.BLOCK_TOP_HALF,T.BLOCK_RIGHT_HALF;class q{constructor(t){this.buttons=new K,this.el=t.canvas,this.width=t.width,this.height=t.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0;const i=this.el;i.addEventListener("mousedown",r=>this.handleEvent(r)),i.addEventListener("mouseup",r=>this.handleEvent(r)),i.addEventListener("mousemove",r=>this.handleEvent(r)),i.addEventListener("contextmenu",r=>this.handleEvent(r)),i.addEventListener("touchstart",r=>this.handleTouchEvent(r)),i.addEventListener("touchend",r=>this.handleTouchEvent(r)),i.addEventListener("touchcancel",r=>this.handleTouchEvent(r)),i.addEventListener("touchmove",r=>this.handleTouchEvent(r)),i.addEventListener("wheel",r=>this.handleWheelEvent(r))}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const i=t.touches[0];this.updatePosition(i.clientX,i.clientY),this.buttons.get(0).setDown(!0)}else this.buttons.get(0).setDown(!1)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),t.type==="mousedown"&&(this.buttons.get(t.button).setDown(!0),this.el.focus()),t.type==="mouseup"&&this.buttons.get(t.button).setDown(!1)}handleWheelEvent(t){t.stopPropagation(),t.preventDefault(),this.wheelDeltaX=t.deltaX,this.wheelDeltaY=t.deltaY}updatePosition(t,i){let r=this.el.getBoundingClientRect();const n=this.width/this.height,o=r.width/r.height;if(o-n>.01){const s=n*r.height,_=r.width-s;r=new I(Math.floor(_/2),0,s,r.height)}if(o-n<-.01){const s=r.width/n,_=r.height-s;r=new I(0,Math.floor(_/2),r.width,s)}this.x=this.width*(t-r.left)/r.width|0,this.y=this.height*(i-r.top)/r.height|0}update(t){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y,this.buttons.updateAll(t)}}h(0,0,0),h(255,255,255),h(136,0,0),h(170,255,238),h(204,68,204),h(0,204,85),h(0,0,170),h(238,238,119),h(221,136,85),h(102,68,0),h(255,119,119),h(51,51,51),h(119,119,119),h(170,255,102),h(0,136,255),h(187,187,187);h(0,0,0),h(255,255,255),h(136,0,0),h(170,255,238),h(204,68,204),h(0,204,85),h(0,0,170),h(238,238,119),h(221,136,85),h(102,68,0),h(255,119,119),h(51,51,51),h(119,119,119),h(170,255,102),h(0,136,255),h(187,187,187);h(0,0,0),h(29,43,83),h(126,37,83),h(0,135,81),h(171,82,54),h(95,87,79),h(194,195,199),h(255,241,232),h(255,0,77),h(255,163,0),h(255,236,39),h(0,228,54),h(41,173,255),h(131,118,156),h(255,119,168),h(255,204,170);let H=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,i){const r=i-t,n=this.nextInt()/this.m,o=t+(n*r|0);if(isNaN(o))throw new Error("rand nan");return o}chooseIndex(t){const i=t.reduce((o,s)=>o+s),r=this.nextRange(1,i+1);let n=0;for(let o=0;o<t.length;o++)if(n+=t[o],r<=n)return o;return t.length-1}chooseKey(t){const i=Object.keys(t),r=i.map(n=>t[n]);return i[this.chooseIndex(r)]}};H=p([S],H);const J=`#version 300 es
precision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}`,j=`#version 300 es
precision highp float;in vec2 e;in vec4 f;in vec4 g;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(o.r<0.1) {o=g;} else {o=f;}}`,$=`#version 300 es
precision highp float;
in vec2 a_position;
in vec2 a_texCoord;
out vec2 v_texCoord;
void main(void) {
  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);
  v_texCoord = a_texCoord;
}`,tt=`#version 300 es
#define PI 3.1415926535897932384626433832795
precision highp float;
in vec2 v_texCoord;
uniform sampler2D u_texture;
uniform float u_blur;
uniform float u_curvature;
uniform float u_chroma;
uniform float u_scanlineWidth;
uniform float u_scanlineIntensity;
uniform float u_vignette;
out vec4 outputColor;

vec2 curve(vec2 uv) {
  uv = (uv - 0.5) * 2.0;
  uv *= 1.1;
  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);
  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);
  uv /= 1.1;
  uv = (uv / 2.0) + 0.5;
  return uv;
}

void main() {
  vec2 iResolution = vec2(640.0, 360.0);
  vec2 q = v_texCoord;
  vec2 fragCoord = v_texCoord;
  vec2 uv = q;
  uv = curve(uv);

  // Outside of range is black
  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    outputColor = vec4(0.0, 0.0, 0.0, 1.0);
    return;
  }

  vec4 col;

  // Chromatic aberration
  // col = texture(u_texture, uv.xy);
  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;
  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;
  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;
  
  // Blur
  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));

  // Vignette
  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);

  // Scanlines
  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);

  outputColor = vec4(col.rgb, 1.0);
}`;function x(e,t){return-1+2*(e/t)}const et={font:C};class it extends w{constructor(t,i,r,n){var o;super(i,r),n=n||et,this.canvas=t,this.font=n.font||C,this.crt=n.crt,this.maxFps=n.maxFps,this.pixelWidth=i*this.font.charWidth,this.pixelHeight=r*this.font.charHeight,this.pixelScale=((o=n.crt)===null||o===void 0?void 0:o.scale)||1,t.width=this.pixelWidth*this.pixelScale,t.height=this.pixelHeight*this.pixelScale,t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.keys=new Z(t),this.mouse=new q(this);const s=t.getContext("webgl2",{antialias:!1});if(!s)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const _=s.createProgram();if(!_)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=s,this.program=_,s.attachShader(_,this.buildShader(s.VERTEX_SHADER,J)),s.attachShader(_,this.buildShader(s.FRAGMENT_SHADER,j)),s.linkProgram(_),s.useProgram(_),this.crtProgram=s.createProgram(),s.attachShader(this.crtProgram,this.buildShader(s.VERTEX_SHADER,$)),s.attachShader(this.crtProgram,this.buildShader(s.FRAGMENT_SHADER,tt)),s.linkProgram(this.crtProgram),s.useProgram(this.crtProgram),this.crtBlurLocation=s.getUniformLocation(this.crtProgram,"u_blur"),this.crtCurvatureLocation=s.getUniformLocation(this.crtProgram,"u_curvature"),this.crtChromaLocation=s.getUniformLocation(this.crtProgram,"u_chroma"),this.crtScanlineWidthLocation=s.getUniformLocation(this.crtProgram,"u_scanlineWidth"),this.crtScanlineIntensityLocation=s.getUniformLocation(this.crtProgram,"u_scanlineIntensity"),this.crtVignetteLocation=s.getUniformLocation(this.crtProgram,"u_vignette"),this.crtPositionLocation=s.getAttribLocation(this.crtProgram,"a_position"),this.crtPositionBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.crtPositionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),s.STATIC_DRAW),s.enableVertexAttribArray(this.crtPositionLocation),s.vertexAttribPointer(this.crtPositionLocation,2,s.FLOAT,!1,0,0),this.crtTexCoordLocation=s.getAttribLocation(this.crtProgram,"a_texCoord"),this.crtTexCoordBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.crtTexCoordBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),s.STATIC_DRAW),s.enableVertexAttribArray(this.crtTexCoordLocation),s.vertexAttribPointer(this.crtTexCoordLocation,2,s.FLOAT,!1,0,0),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const l=i*r;this.positionsArray=new Float32Array(l*3*4),this.indexArray=new Uint16Array(l*6),this.textureArray=new Float32Array(l*2*4),this.foregroundUint8Array=new Uint8Array(l*4*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(l*4*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer),this.frameBufferTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.frameBufferTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.pixelWidth,this.pixelHeight,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.frameBufferTexture,0);let a=0,u=0,d=0;for(let A=0;A<r;A++)for(let c=0;c<i;c++)this.positionsArray[a++]=x(c,i),this.positionsArray[a++]=-x(A,r),this.positionsArray[a++]=x(c+1,i),this.positionsArray[a++]=-x(A,r),this.positionsArray[a++]=x(c+1,i),this.positionsArray[a++]=-x(A+1,r),this.positionsArray[a++]=x(c,i),this.positionsArray[a++]=-x(A+1,r),this.indexArray[u++]=d+0,this.indexArray[u++]=d+1,this.indexArray[u++]=d+2,this.indexArray[u++]=d+0,this.indexArray[u++]=d+2,this.indexArray[u++]=d+3,d+=4;this.positionBuffer=s.createBuffer(),this.indexBuffer=s.createBuffer(),this.textureBuffer=s.createBuffer(),this.foregroundBuffer=s.createBuffer(),this.backgroundBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),s.bufferData(s.ARRAY_BUFFER,this.positionsArray,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,this.indexArray,s.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,this.maxFps===void 0?this.requestAnimationFrame():window.setInterval(()=>this.renderLoop(performance.now()),1e3/this.maxFps)}handleResize(){const t=this.canvas.parentElement;if(!t)return;const i=t.offsetWidth/this.pixelWidth,r=t.offsetHeight/this.pixelHeight,n=Math.min(i,r),o=n*this.pixelWidth|0,s=n*this.pixelHeight|0;this.canvas.style.width=o+"px",this.canvas.style.height=s+"px"}getAttribLocation(t){const i=this.gl.getAttribLocation(this.program,t);return this.gl.enableVertexAttribArray(i),i}flush(){let t=0,i=0;for(let r=0;r<this.height;r++)for(let n=0;n<this.width;n++){const o=this.getCell(n,r);if(!o.dirty){t+=8,i+=16;continue}const s=o.charCode%16,_=o.charCode/16|0;this.textureArray[t++]=s,this.textureArray[t++]=_,this.textureArray[t++]=s+1,this.textureArray[t++]=_,this.textureArray[t++]=s+1,this.textureArray[t++]=_+1,this.textureArray[t++]=s,this.textureArray[t++]=_+1;for(let l=0;l<4;l++)this.foregroundDataView.setUint32(i,o.fg,!1),this.backgroundDataView.setUint32(i,o.bg,!1),i+=4;o.dirty=!1}}isKeyDown(t){return this.keys.getKey(t).down}isKeyPressed(t){return this.keys.getKey(t).isPressed()}getKeyDownCount(t){return this.keys.getKey(t).downCount}getMovementKey(){if(this.isKeyPressed(f.VK_NUMPAD1)||this.isKeyPressed(f.VK_B))return new D(-1,1);if(this.isKeyPressed(f.VK_NUMPAD2)||this.isKeyPressed(f.VK_J)||this.isKeyPressed(f.VK_DOWN))return new D(0,1);if(this.isKeyPressed(f.VK_NUMPAD3)||this.isKeyPressed(f.VK_N))return new D(1,1);if(this.isKeyPressed(f.VK_NUMPAD4)||this.isKeyPressed(f.VK_H)||this.isKeyPressed(f.VK_LEFT))return new D(-1,0);if(this.isKeyPressed(f.VK_NUMPAD5)||this.isKeyPressed(f.VK_PERIOD))return new D(0,0);if(this.isKeyPressed(f.VK_NUMPAD6)||this.isKeyPressed(f.VK_L)||this.isKeyPressed(f.VK_RIGHT))return new D(1,0);if(this.isKeyPressed(f.VK_NUMPAD7)||this.isKeyPressed(f.VK_Y))return new D(-1,-1);if(this.isKeyPressed(f.VK_NUMPAD8)||this.isKeyPressed(f.VK_K)||this.isKeyPressed(f.VK_UP))return new D(0,-1);if(this.isKeyPressed(f.VK_NUMPAD9)||this.isKeyPressed(f.VK_U))return new D(1,-1)}buildShader(t,i){const r=this.gl,n=r.createShader(t);if(!n)throw new Error("An error occurred compiling the shader: ");if(r.shaderSource(n,i),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+r.getShaderInfoLog(n));return n}loadTexture(t){const i=this.gl,r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);const n=0,o=i.RGBA,s=1,_=1,l=0,a=i.RGBA,u=i.UNSIGNED_BYTE,d=new Uint8Array([0,0,0,255]);i.texImage2D(i.TEXTURE_2D,n,o,s,_,l,a,u,d);const A=new Image;return A.onload=()=>{i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,n,o,a,u,A),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)},A.src=t,r}render(){const t=this.gl;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.crt?t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const r=t.FLOAT,n=!1,o=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(this.positionAttribLocation,2,r,n,o,s)}{const r=t.FLOAT,n=!1,o=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.textureAttribLocation,2,r,n,o,s)}{const r=t.UNSIGNED_BYTE,n=!0,o=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this.foregroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.foregroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.fgColorAttribLocation,4,r,n,o,s)}{const r=t.UNSIGNED_BYTE,n=!0,o=0,s=0;t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.backgroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.bgColorAttribLocation,4,r,n,o,s)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture);{const i=this.width*this.height*6,r=t.UNSIGNED_SHORT,n=0;t.drawElements(t.TRIANGLES,i,r,n)}}renderCrt(){const t=this.crt;if(!t)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,this.pixelWidth*this.pixelScale,this.pixelHeight*this.pixelScale),i.useProgram(this.crtProgram),i.uniform1f(this.crtBlurLocation,t.blur),i.uniform1f(this.crtCurvatureLocation,t.curvature),i.uniform1f(this.crtChromaLocation,t.chroma),i.uniform1f(this.crtVignetteLocation,t.vignette),i.uniform1f(this.crtScanlineWidthLocation,t.scanlineWidth),i.uniform1f(this.crtScanlineIntensityLocation,t.scanlineIntensity),i.bindBuffer(i.ARRAY_BUFFER,this.crtPositionBuffer),i.vertexAttribPointer(this.crtPositionLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.crtTexCoordBuffer),i.vertexAttribPointer(this.crtTexCoordLocation,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.frameBufferTexture),i.drawArrays(i.TRIANGLES,0,6)}requestAnimationFrame(){window.requestAnimationFrame(t=>this.renderLoop(t))}renderLoop(t){this.lastRenderTime===0?(this.lastRenderTime=t,this.fps=0):(this.renderDelta=t-this.lastRenderTime,this.lastRenderTime=t,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(t),this.mouse.update(t),this.update&&this.update(),this.flush(),this.render(),this.crt&&this.renderCrt(),this.maxFps===void 0&&this.requestAnimationFrame()}}const g=new it(document.querySelector("canvas"),80,45);g.fillRect(0,0,80,45,0,U.YELLOW,U.DARK_BLUE);let b=10,G=10;g.update=function(){const e=g.getMovementKey();e&&(b+=e.x,G+=e.y),g.clear(),g.drawString(1,1,"Hello world!"),g.drawString(1,3,"Use arrow keys to move"),g.drawString(b,G,"@")};
