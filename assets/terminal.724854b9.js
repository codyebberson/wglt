var p=(t=>(t[t.None=0]="None",t[t.Blend=1]="Blend",t[t.Add=2]="Add",t))(p||{});function h(t,e,i,r){return r===void 0&&(r=255),(t<<24)+(e<<16)+(i<<8)+r}function vt(t,e,i,r){const o=t*6|0,s=t*6-o,n=i*(1-e),_=i*(1-s*e),a=i*(1-(1-s)*e);let c,l,E;switch(o%6){case 0:c=i,l=a,E=n;break;case 1:c=_,l=i,E=n;break;case 2:c=n,l=i,E=a;break;case 3:c=n,l=_,E=i;break;case 4:c=a,l=n,E=i;break;case 5:c=i,l=n,E=_;break;default:c=0,l=0,E=0}return r===void 0&&(r=1),h(c*255|0,l*255|0,E*255|0,r*255|0)}const b={BLACK:h(0,0,0),WHITE:h(255,255,255),LIGHT_GRAY:h(170,170,170),DARK_GRAY:h(85,85,85),YELLOW:h(255,255,85),BROWN:h(170,85,0),LIGHT_RED:h(255,85,85),DARK_RED:h(170,0,0),LIGHT_GREEN:h(85,255,85),DARK_GREEN:h(0,170,0),LIGHT_CYAN:h(85,255,255),DARK_CYAN:h(0,170,170),LIGHT_BLUE:h(85,85,255),DARK_BLUE:h(0,0,170),LIGHT_MAGENTA:h(255,85,255),DARK_MAGENTA:h(170,0,170),ORANGE:h(255,136,0)},z=new Map;function m(t){z.set(t.name,t)}var Q=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,j=(t,e,i,r)=>{for(var o=r>1?void 0:r?Z(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&Q(e,i,o),o};function q(t){return typeof t=="string"&&t.length>0?t.charCodeAt(0):t}let U=class{constructor(t,e,i,r,o){this.x=t,this.y=e,i!==void 0?this.charCode=q(i):this.charCode=" ".charCodeAt(0),r!==void 0?this.fg=r:this.fg=b.WHITE,o!==void 0?this.bg=o:this.bg=b.BLACK,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(t){this.charCode!==t&&(this.charCode=t,this.dirty=!0)}setForeground(t){t!=null&&t!==this.fg&&(this.fg=t,this.dirty=!0)}setBackground(t){t!=null&&t!==this.bg&&(this.bg=t,this.dirty=!0)}setValue(t,e,i){return typeof t=="string"&&(t=t.charCodeAt(0)),typeof t=="number"?(this.setCharCode(t),e!==void 0&&this.setForeground(e),i!==void 0&&this.setBackground(i)):this.drawCell(t,p.None),this.dirty}drawCell(t,e){const i=t.bg&255;e===p.None||t.charCode>0?(this.setCharCode(t.charCode),this.setForeground(t.fg)):i>0&&i<255&&this.setForeground(this.blendColors(this.fg,t.bg,e)),e===p.None||i===255?this.setBackground(t.bg):i>0&&this.setBackground(this.blendColors(this.bg,t.bg,e))}blendColors(t,e,i){const r=e&255,o=(255-r)/255,s=1-o,n=t>>24&255,_=t>>16&255,a=t>>8&255,c=e>>24&255,l=e>>16&255,E=e>>8&255;switch(i){case p.Blend:return h(o*n+s*c|0,o*_+s*l|0,o*a+s*E|0);case p.Add:return h(this.clamp(n+s*c|0),this.clamp(_+s*l|0),this.clamp(a+s*E|0));default:return e}}clamp(t){return Math.min(255,t)}};U=j([m],U);var L=(t=>(t[t.SMILEY=1]="SMILEY",t[t.INVERSE_SMILEY=2]="INVERSE_SMILEY",t[t.HEART=3]="HEART",t[t.DIAMOND=4]="DIAMOND",t[t.CLUB=5]="CLUB",t[t.SPADE=6]="SPADE",t[t.BULLET=7]="BULLET",t[t.INVERSE_BULLET=8]="INVERSE_BULLET",t[t.LIGHT_SHADE=176]="LIGHT_SHADE",t[t.MEDIUM_SHADE=177]="MEDIUM_SHADE",t[t.DARK_SHADE=178]="DARK_SHADE",t[t.BOX_SINGLE_VERTICAL=179]="BOX_SINGLE_VERTICAL",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT=180]="BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT=185]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT",t[t.BOX_DOUBLE_VERTICAL=186]="BOX_DOUBLE_VERTICAL",t[t.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT=187]="BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT",t[t.BOX_DOUBLE_UP_AND_DOUBLE_LEFT=188]="BOX_DOUBLE_UP_AND_DOUBLE_LEFT",t[t.BOX_SINGLE_DOWN_AND_SINGLE_LEFT=191]="BOX_SINGLE_DOWN_AND_SINGLE_LEFT",t[t.BOX_SINGLE_UP_AND_SINGLE_RIGHT=192]="BOX_SINGLE_UP_AND_SINGLE_RIGHT",t[t.BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP=193]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP",t[t.BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN=194]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT=195]="BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT",t[t.BOX_SINGLE_HORIZONTAL=196]="BOX_SINGLE_HORIZONTAL",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL=197]="BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL",t[t.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT=200]="BOX_DOUBLE_UP_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT=201]="BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP=202]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP",t[t.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN=203]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT=204]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_HORIZONTAL=205]="BOX_DOUBLE_HORIZONTAL",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL=206]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL",t[t.BOX_SINGLE_UP_AND_SINGLE_LEFT=217]="BOX_SINGLE_UP_AND_SINGLE_LEFT",t[t.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT=218]="BOX_SINGLE_DOWN_AND_SINGLE_RIGHT",t[t.BLOCK_FULL=219]="BLOCK_FULL",t[t.BLOCK_BOTTOM_HALF=220]="BLOCK_BOTTOM_HALF",t[t.BLOCK_LEFT_HALF=221]="BLOCK_LEFT_HALF",t[t.BLOCK_RIGHT_HALF=222]="BLOCK_RIGHT_HALF",t[t.BLOCK_TOP_HALF=223]="BLOCK_TOP_HALF",t))(L||{});function J(t,e){const i=new RegExp("(\\S(.{0,"+e+"}\\S)?)\\s+","g");return(t+" ").replace(i,`$1
`).trim().split(`
`).map(r=>r.trim())}var $=Object.defineProperty,tt=Object.getOwnPropertyDescriptor,et=(t,e,i,r)=>{for(var o=r>1?void 0:r?tt(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&$(e,i,o),o};let N=class{constructor(t,e,i){this.width=t,this.height=e,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let r=0;r<e;r++){const o=[];for(let s=0;s<t;s++)o.push(new U(s,r));this.grid.push(o)}if(this.clear(),i)for(let r=0;r<e;r++)for(let o=0;o<t;o++)this.grid[r][o].blocked=this.grid[r][o].blockedSight=i(o,r)}clear(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.drawChar(e,t,0)}getCell(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t]}getCharCode(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t].charCode}drawChar(t,e,i,r,o){this.clip&&!this.clip.contains({x:t,y:e})||t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[e|0][t|0].setValue(i,r,o)}drawString(t,e,i,r,o){const s=i.split(`
`);for(let n=0;n<s.length;n++)this.drawStringLine(t,e+n,s[n],r,o)}drawStringLine(t,e,i,r,o){for(let s=0;s<i.length;s++)this.drawChar(t+s,e,i.charCodeAt(s),r,o)}drawCenteredString(t,e,i,r,o){this.drawString(t-Math.floor(i.length/2),e,i,r,o)}drawMessage(t,e,i,r){if(i.text){const o=J(i.text,r||this.width-t);for(const s of o)this.drawStringLine(t,e,s,i.fg,i.bg),e++}if(i.children)for(const o of i.children)e=this.drawMessage(t,e,o,r);return e}drawHLine(t,e,i,r,o,s){for(let n=t;n<t+i;n++)this.drawChar(n,e,r,o,s)}drawVLine(t,e,i,r,o,s){for(let n=e;n<e+i;n++)this.drawChar(t,n,r,o,s)}drawRect(t,e,i,r,o,s,n){this.drawHLine(t,e,i,o,s,n),this.drawHLine(t,e+r-1,i,o,s,n),this.drawVLine(t,e,r,o,s,n),this.drawVLine(t+i-1,e,r,o,s,n)}drawBox(t,e,i,r,o,s,n,_,a,c,l,E,u,f){this.drawHLine(t,e,i,o,u,f),this.drawHLine(t,e+r-1,i,n,u,f),this.drawVLine(t,e,r,_,u,f),this.drawVLine(t+i-1,e,r,s,u,f),this.drawChar(t,e,a,u,f),this.drawChar(t+i-1,e,c,u,f),this.drawChar(t,e+r-1,E,u,f),this.drawChar(t+i-1,e+r-1,l,u,f)}drawSingleBox(t,e,i,r,o,s){this.drawBox(t,e,i,r,L.BOX_SINGLE_HORIZONTAL,L.BOX_SINGLE_VERTICAL,L.BOX_SINGLE_HORIZONTAL,L.BOX_SINGLE_VERTICAL,L.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,L.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,L.BOX_SINGLE_UP_AND_SINGLE_LEFT,L.BOX_SINGLE_UP_AND_SINGLE_RIGHT,o,s)}drawDoubleBox(t,e,i,r,o,s){this.drawBox(t,e,i,r,L.BOX_DOUBLE_HORIZONTAL,L.BOX_DOUBLE_VERTICAL,L.BOX_DOUBLE_HORIZONTAL,L.BOX_DOUBLE_VERTICAL,L.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,L.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,L.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,L.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,o,s)}fillRect(t,e,i,r,o,s,n){for(let _=e;_<e+r;_++)this.drawHLine(t,_,i,o,s,n)}drawConsole(t,e,i,r,o,s,n,_){_=_||p.None;for(let a=0;a<n;a++)for(let c=0;c<s;c++){const l=i.getCell(r+c,o+a);l&&this.drawCell(t+c,e+a,l,_)}}drawCell(t,e,i,r){t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[e][t].drawCell(i,r)}setBlocked(t,e,i){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blocked=i)}setBlockedSight(t,e,i){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blockedSight=i)}isVisible(t,e){return t<this.minX||t>this.maxX||e<this.minY||e>this.maxY?!1:this.grid[e][t].visible}isBlocked(t,e){return t<0||t>this.width||e<0||e>this.height?!0:this.grid[e][t].blocked}isBlockedSight(t,e){return t<0||t>this.width||e<0||e>this.height?!0:this.grid[e][t].blockedSight}computeOctantY(t,e){const i=[],r=[];let o=1,s=0,n=0,_=0,a,c,l,E,u,f,D,R,O,g;for(c=this.originY+e;c>=this.minY&&c<=this.maxY;c+=e,n=s,++o)for(l=.5/o,g=-1,E=Math.floor(_*o+.5),a=this.originX+E*t;E<=o&&a>=this.minX&&a<=this.maxX;a+=t,++E,g=O){if(u=!0,f=!1,D=E/o,R=g,O=D+l,n>0){if(!(this.grid[c-e][a].visible&&!this.grid[c-e][a].blockedSight)&&!(this.grid[c-e][a-t].visible&&!this.grid[c-e][a-t].blockedSight))u=!1;else for(let A=0;A<n&&u;++A)if(R<=r[A]&&O>=i[A]){if(this.grid[c][a].blockedSight)if(R>=i[A]&&O<=r[A]){u=!1;break}else i[A]=Math.min(i[A],R),r[A]=Math.max(r[A],O),f=!0;else if(D>i[A]&&D<r[A]){u=!1;break}}}u&&(this.grid[c][a].visible=!0,this.grid[c][a].blockedSight&&(_>=R?_=O:f||(i[s]=R,r[s++]=O)))}}computeOctantX(t,e){const i=[],r=[];let o=1,s=0,n=0,_=0,a,c,l,E,u,f,D,R,O,g;for(a=this.originX+t;a>=this.minX&&a<=this.maxX;a+=t,n=s,++o)for(l=.5/o,g=-1,E=Math.floor(_*o+.5),c=this.originY+E*e;E<=o&&c>=this.minY&&c<=this.maxY;c+=e,++E,g=O){if(u=!0,f=!1,D=E/o,R=g,O=D+l,n>0){if(!(this.grid[c][a-t].visible&&!this.grid[c][a-t].blockedSight)&&!(this.grid[c-e][a-t].visible&&!this.grid[c-e][a-t].blockedSight))u=!1;else for(let A=0;A<n&&u;++A)if(R<=r[A]&&O>=i[A]){if(this.grid[c][a].blockedSight)if(R>=i[A]&&O<=r[A]){u=!1;break}else i[A]=Math.min(i[A],R),r[A]=Math.max(r[A],O),f=!0;else if(D>i[A]&&D<r[A]){u=!1;break}}}u&&(this.grid[c][a].visible=!0,this.grid[c][a].blockedSight&&(_>=R?_=O:f||(i[s]=R,r[s++]=O)))}}computeFov(t,e,i,r,o){if(this.originX=t,this.originY=e,this.radius=i,r)this.minX=Math.min(this.minX,Math.max(0,t-i)),this.minY=Math.min(this.minY,Math.max(0,e-i)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,t+i)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,e+i));else{this.minX=Math.max(0,t-i),this.minY=Math.max(0,e-i),this.maxX=Math.min(this.width-1,t+i),this.maxY=Math.min(this.height-1,e+i);for(let s=this.minY;s<=this.maxY;s++)for(let n=this.minX;n<=this.maxX;n++)this.grid[s][n].visible=!1}this.grid[e][t].visible=!0,o===void 0?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(o&1&&this.computeOctantY(1,1),o&2&&this.computeOctantX(1,1),o&4&&this.computeOctantX(1,-1),o&8&&this.computeOctantY(1,-1),o&16&&this.computeOctantY(-1,-1),o&32&&this.computeOctantX(-1,-1),o&64&&this.computeOctantX(-1,1),o&128&&this.computeOctantY(-1,1))}updateExplored(){for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++){const i=this.grid[t][e];i.explored=i.explored||i.visible}}};N=et([m],N);class it{constructor(e,i,r,o){this.url=e,this.charWidth=i,this.charHeight=r,this.scale=o||1}}const rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",X=new it(rt,8,8);var st=Object.defineProperty,ot=Object.getOwnPropertyDescriptor,nt=(t,e,i,r)=>{for(var o=r>1?void 0:r?ot(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&st(e,i,o),o};let T=class{constructor(t,e){this.x=t,this.y=e}};T=nt([m],T);var ht=Object.defineProperty,at=Object.getOwnPropertyDescriptor,_t=(t,e,i,r)=>{for(var o=r>1?void 0:r?at(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&ht(e,i,o),o};let v=class{constructor(t,e,i,r){this.x=this.left=t,this.y=this.top=e,this.width=i,this.height=r,this.x2=t+i,this.y2=e+r}getCenter(){return new T(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<this.x2&&t.y>=this.y&&t.y<this.y2}};v=_t([m],v);var ct=Object.defineProperty,lt=Object.getOwnPropertyDescriptor,ut=(t,e,i,r)=>{for(var o=r>1?void 0:r?lt(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&ct(e,i,o),o};let G=class{constructor(t,e,i,r){this.text=t,this.fg=e,this.bg=i,this.children=r}getWidth(){let t=0;if(this.text)for(const e of this.text.split(`
`))t=Math.max(t,e.length);if(this.children)for(const e of this.children)t=Math.max(t,e.getWidth());return t}getHeight(){let t=0;if(this.text&&(t+=this.text.split(`
`).length),this.children)for(const e of this.children)t+=e.getHeight();return t}};G=ut([m],G);const Et=200,ft=1e3/15;class At{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(e){this.down!==e&&(this.down=e,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(e){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,e-this.downTime>=Et&&e-this.repeatTime>=ft&&(this.repeat=!0,this.repeatTime=e)):(this.downCount=0,this.upCount++)}isPressed(){return this.downCount===1||this.repeat}isClicked(){return this.upCount===1}}class M{constructor(){this.inputs=new Map}clear(){this.inputs.clear()}get(e){let i=this.inputs.get(e);return i||(i=new At,this.inputs.set(e,i)),i}updateAll(e){this.inputs.forEach(i=>i.update(e))}}class dt{constructor(e){this.keys=new M,e.addEventListener("keydown",i=>this.setKey(i,!0)),e.addEventListener("keyup",i=>this.setKey(i,!1))}clear(){this.keys.clear()}getKey(e){return this.keys.get(e)}setKey(e,i){const r=e.code;r!==d.VK_F11&&(e.stopPropagation(),e.preventDefault(),this.keys.get(r).setDown(i))}updateKeys(e){this.keys.updateAll(e)}}var d=(t=>(t.VK_CANCEL="Pause",t.VK_BACKSPACE="Backspace",t.VK_TAB="Tab",t.VK_ENTER="Enter",t.VK_SHIFT_LEFT="ShiftLeft",t.VK_SHIFT_RIGHT="ShiftLeft",t.VK_CONTROL_LEFT="ControlLeft",t.VK_CONTROL_RIGHT="ControlRight",t.VK_ALT_LEFT="AltLeft",t.VK_ALT_RIGHT="AltRight",t.VK_PAUSE="Pause",t.VK_CAPS_LOCK="CapsLock",t.VK_ESCAPE="Escape",t.VK_SPACE="Space",t.VK_PAGE_UP="PageUp",t.VK_PAGE_DOWN="PageDown",t.VK_END="End",t.VK_HOME="Home",t.VK_LEFT="ArrowLeft",t.VK_UP="ArrowUp",t.VK_RIGHT="ArrowRight",t.VK_DOWN="ArrowDown",t.VK_INSERT="Insert",t.VK_DELETE="Delete",t.VK_0="Digit0",t.VK_1="Digit1",t.VK_2="Digit2",t.VK_3="Digit3",t.VK_4="Digit4",t.VK_5="Digit5",t.VK_6="Digit6",t.VK_7="Digit7",t.VK_8="Digit8",t.VK_9="Digit9",t.VK_SEMICOLON="Semicolon",t.VK_EQUALS="Equal",t.VK_A="KeyA",t.VK_B="KeyB",t.VK_C="KeyC",t.VK_D="KeyD",t.VK_E="KeyE",t.VK_F="KeyF",t.VK_G="KeyG",t.VK_H="KeyH",t.VK_I="KeyI",t.VK_J="KeyJ",t.VK_K="KeyK",t.VK_L="KeyL",t.VK_M="KeyM",t.VK_N="KeyN",t.VK_O="KeyO",t.VK_P="KeyP",t.VK_Q="KeyQ",t.VK_R="KeyR",t.VK_S="KeyS",t.VK_T="KeyT",t.VK_U="KeyU",t.VK_V="KeyV",t.VK_W="KeyW",t.VK_X="KeyX",t.VK_Y="KeyY",t.VK_Z="KeyZ",t.VK_CONTEXT_MENU="ContextMenu",t.VK_NUMPAD0="Numpad0",t.VK_NUMPAD1="Numpad1",t.VK_NUMPAD2="Numpad2",t.VK_NUMPAD3="Numpad3",t.VK_NUMPAD4="Numpad4",t.VK_NUMPAD5="Numpad5",t.VK_NUMPAD6="Numpad6",t.VK_NUMPAD7="Numpad7",t.VK_NUMPAD8="Numpad8",t.VK_NUMPAD9="Numpad9",t.VK_NUMPAD_ENTER="NumpadEnter",t.VK_MULTIPLY="NumpadMultiply",t.VK_ADD="NumpadAdd",t.VK_SEPARATOR="NumpadDecimal",t.VK_SUBTRACT="NumpadSubtract",t.VK_DECIMAL="NumpadDecimal",t.VK_DIVIDE="NumpadDivide",t.VK_F1="F1",t.VK_F2="F2",t.VK_F3="F3",t.VK_F4="F4",t.VK_F5="F5",t.VK_F6="F6",t.VK_F7="F7",t.VK_F8="F8",t.VK_F9="F9",t.VK_F10="F10",t.VK_F11="F11",t.VK_F12="F12",t.VK_F13="F13",t.VK_F14="F14",t.VK_F15="F15",t.VK_F16="F16",t.VK_F17="F17",t.VK_F18="F18",t.VK_F19="F19",t.VK_F20="F20",t.VK_F21="F21",t.VK_F22="F22",t.VK_F23="F23",t.VK_F24="F24",t.VK_NUM_LOCK="NumLock",t.VK_SCROLL_LOCK="ScrollLock",t.VK_COMMA="Comma",t.VK_PERIOD="Period",t.VK_SLASH="Slash",t.VK_BACKQUOTE="Backquote",t.VK_OPEN_BRACKET="BracketLeft",t.VK_BACK_SLASH="Backslash",t.VK_CLOSE_BRACKET="BracketRight",t.VK_QUOTE="Quote",t.VK_META="OSLeft",t))(d||{});const C=[{charCode:L.BLOCK_TOP_HALF,active:[1,1,0,0]},{charCode:L.BLOCK_RIGHT_HALF,active:[0,1,0,1]}];function xt(t,e){const i=new Image;i.onload=()=>{const r=i.width,o=i.height,s=Y(i),n=new N(r,o);let _=0;for(let a=0;a<o;a++)for(let c=0;c<r;c++)n.getCell(c,a).setBackground(h(s[_++],s[_++],s[_++],s[_++]));e(n)},i.src=t}function Ut(t,e){const i=new Image;i.onload=()=>{const r=i.width,o=i.height,s=Y(i),n=new N(r/2,o/2);for(let _=0;_<o;_+=2)for(let a=0;a<r;a+=2)Lt(n,s,a,_,r);e(n)},i.src=t}function Y(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data}function Lt(t,e,i,r,o){const s=4*(r*o+i),n=e[s],_=e[s+1],a=e[s+2],c=4*(r*o+i+1),l=e[c],E=e[c+1],u=e[c+2],f=4*((r+1)*o+i),D=e[f],R=e[f+1],O=e[f+2],g=4*((r+1)*o+i+1),A=e[g],W=e[g+1],y=e[g+2],k=[[n,_,a],[l,E,u],[D,R,O],[A,W,y]];let w=Number.MAX_VALUE,S=0,F=null,P=null;for(let x=0;x<C.length;x++){const V=C[x],I=Ot(V.active,k);I.error<w&&(w=I.error,S=V.charCode,F=I.bg,P=I.fg)}t.drawChar(i/2,r/2,S,K(P),K(F))}function Ot(t,e){const i=[[0,0,0],[0,0,0]],r=[[0,0,0],[0,0,0]],o=[0,0];for(let n=0;n<4;n++){for(let _=0;_<3;_++)i[t[n]][_]+=e[n][_];o[t[n]]++}for(let n=0;n<2;n++)for(let _=0;_<3;_++)r[n][_]=i[n][_]/o[n];let s=0;for(let n=0;n<4;n++){let _=0;for(let a=0;a<3;a++){const c=e[n][a]-r[t[n]][a];_+=c*c}s+=Math.sqrt(_)}return{bg:r[0],fg:r[1],error:s}}function K(t){return h(t[0],t[1],t[2])}class Rt{constructor(e){this.buttons=new M,this.el=e.canvas,this.width=e.width,this.height=e.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0;const i=this.el;i.addEventListener("mousedown",r=>this.handleEvent(r)),i.addEventListener("mouseup",r=>this.handleEvent(r)),i.addEventListener("mousemove",r=>this.handleEvent(r)),i.addEventListener("contextmenu",r=>this.handleEvent(r)),i.addEventListener("touchstart",r=>this.handleTouchEvent(r)),i.addEventListener("touchend",r=>this.handleTouchEvent(r)),i.addEventListener("touchcancel",r=>this.handleTouchEvent(r)),i.addEventListener("touchmove",r=>this.handleTouchEvent(r)),i.addEventListener("wheel",r=>this.handleWheelEvent(r))}handleTouchEvent(e){if(e.stopPropagation(),e.preventDefault(),e.touches.length>0){const i=e.touches[0];this.updatePosition(i.clientX,i.clientY),this.buttons.get(0).setDown(!0)}else this.buttons.get(0).setDown(!1)}handleEvent(e){e.stopPropagation(),e.preventDefault(),this.updatePosition(e.clientX,e.clientY),e.type==="mousedown"&&(this.buttons.get(e.button).setDown(!0),this.el.focus()),e.type==="mouseup"&&this.buttons.get(e.button).setDown(!1)}handleWheelEvent(e){e.stopPropagation(),e.preventDefault(),this.wheelDeltaX=e.deltaX,this.wheelDeltaY=e.deltaY}updatePosition(e,i){let r=this.el.getBoundingClientRect();const o=this.width/this.height,s=r.width/r.height;if(s-o>.01){const n=o*r.height,_=r.width-n;r=new v(Math.floor(_/2),0,n,r.height)}if(s-o<-.01){const n=r.width/o,_=r.height-n;r=new v(0,Math.floor(_/2),r.width,n)}this.x=this.width*(e-r.left)/r.width|0,this.y=this.height*(i-r.top)/r.height|0}update(e){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y,this.buttons.updateAll(e)}}h(0,0,0),h(255,255,255),h(136,0,0),h(170,255,238),h(204,68,204),h(0,204,85),h(0,0,170),h(238,238,119),h(221,136,85),h(102,68,0),h(255,119,119),h(51,51,51),h(119,119,119),h(170,255,102),h(0,136,255),h(187,187,187);const wt={BLACK:h(0,0,0),WHITE:h(255,255,255),RED:h(136,0,0),CYAN:h(170,255,238),VIOLET:h(204,68,204),GREEN:h(0,204,85),BLUE:h(0,0,170),YELLOW:h(238,238,119),ORANGE:h(221,136,85),BROWN:h(102,68,0),LIGHT_RED:h(255,119,119),DARK_GRAY:h(51,51,51),GRAY:h(119,119,119),LIGHT_GREEN:h(170,255,102),LIGHT_BLUE:h(0,136,255),LIGHT_GRAY:h(187,187,187)};h(0,0,0),h(29,43,83),h(126,37,83),h(0,135,81),h(171,82,54),h(95,87,79),h(194,195,199),h(255,241,232),h(255,0,77),h(255,163,0),h(255,236,39),h(0,228,54),h(41,173,255),h(131,118,156),h(255,119,168),h(255,204,170);var Tt=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,gt=(t,e,i,r)=>{for(var o=r>1?void 0:r?Dt(e,i):e,s=t.length-1,n;s>=0;s--)(n=t[s])&&(o=(r?n(e,i,o):n(o))||o);return r&&o&&Tt(e,i,o),o};let H=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const i=e-t,r=this.nextInt()/this.m,o=t+(r*i|0);if(isNaN(o))throw new Error("rand nan");return o}chooseIndex(t){const e=t.reduce((o,s)=>o+s),i=this.nextRange(1,e+1);let r=0;for(let o=0;o<t.length;o++)if(r+=t[o],i<=r)return o;return t.length-1}chooseKey(t){const e=Object.keys(t),i=e.map(r=>t[r]);return e[this.chooseIndex(i)]}};H=gt([m],H);const Bt=`#version 300 es
precision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}`,pt=`#version 300 es
precision highp float;in vec2 e;in vec4 f;in vec4 g;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(o.r<0.1) {o=g;} else {o=f;}}`,mt=`#version 300 es
precision highp float;
in vec2 a_position;
in vec2 a_texCoord;
out vec2 v_texCoord;
void main(void) {
  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);
  v_texCoord = a_texCoord;
}`,Nt=`#version 300 es
#define PI 3.1415926535897932384626433832795
precision highp float;
in vec2 v_texCoord;
uniform sampler2D u_texture;
uniform float u_blur;
uniform float u_curvature;
uniform float u_chroma;
uniform float u_scanlineWidth;
uniform float u_scanlineIntensity;
uniform float u_vignette;
out vec4 outputColor;

vec2 curve(vec2 uv) {
  uv = (uv - 0.5) * 2.0;
  uv *= 1.1;
  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);
  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);
  uv /= 1.1;
  uv = (uv / 2.0) + 0.5;
  return uv;
}

void main() {
  vec2 iResolution = vec2(640.0, 360.0);
  vec2 q = v_texCoord;
  vec2 fragCoord = v_texCoord;
  vec2 uv = q;
  uv = curve(uv);

  // Outside of range is black
  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    outputColor = vec4(0.0, 0.0, 0.0, 1.0);
    return;
  }

  vec4 col;

  // Chromatic aberration
  // col = texture(u_texture, uv.xy);
  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;
  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;
  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;
  
  // Blur
  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));

  // Vignette
  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);

  // Scanlines
  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);

  outputColor = vec4(col.rgb, 1.0);
}`;function B(t,e){return-1+2*(t/e)}const It={font:X};class St extends N{constructor(e,i,r,o){var E;super(i,r),o=o||It,this.canvas=e,this.font=o.font||X,this.crt=o.crt,this.pixelWidth=i*this.font.charWidth,this.pixelHeight=r*this.font.charHeight,this.pixelScale=((E=o==null?void 0:o.crt)==null?void 0:E.scale)||1,e.width=this.pixelWidth*this.pixelScale,e.height=this.pixelHeight*this.pixelScale,e.style.imageRendering="pixelated",e.style.outline="none",e.tabIndex=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.keys=new dt(e),this.mouse=new Rt(this);const s=e.getContext("webgl2",{antialias:!1});if(!s)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=s.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=s,this.program=n,s.attachShader(n,this.buildShader(s.VERTEX_SHADER,Bt)),s.attachShader(n,this.buildShader(s.FRAGMENT_SHADER,pt)),s.linkProgram(n),s.useProgram(n),this.crtProgram=s.createProgram(),s.attachShader(this.crtProgram,this.buildShader(s.VERTEX_SHADER,mt)),s.attachShader(this.crtProgram,this.buildShader(s.FRAGMENT_SHADER,Nt)),s.linkProgram(this.crtProgram),s.useProgram(this.crtProgram),this.crtBlurLocation=s.getUniformLocation(this.crtProgram,"u_blur"),this.crtCurvatureLocation=s.getUniformLocation(this.crtProgram,"u_curvature"),this.crtChromaLocation=s.getUniformLocation(this.crtProgram,"u_chroma"),this.crtScanlineWidthLocation=s.getUniformLocation(this.crtProgram,"u_scanlineWidth"),this.crtScanlineIntensityLocation=s.getUniformLocation(this.crtProgram,"u_scanlineIntensity"),this.crtVignetteLocation=s.getUniformLocation(this.crtProgram,"u_vignette"),this.crtPositionLocation=s.getAttribLocation(this.crtProgram,"a_position"),this.crtPositionBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.crtPositionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),s.STATIC_DRAW),s.enableVertexAttribArray(this.crtPositionLocation),s.vertexAttribPointer(this.crtPositionLocation,2,s.FLOAT,!1,0,0),this.crtTexCoordLocation=s.getAttribLocation(this.crtProgram,"a_texCoord"),this.crtTexCoordBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.crtTexCoordBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),s.STATIC_DRAW),s.enableVertexAttribArray(this.crtTexCoordLocation),s.vertexAttribPointer(this.crtTexCoordLocation,2,s.FLOAT,!1,0,0),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const _=i*r;this.positionsArray=new Float32Array(_*3*4),this.indexArray=new Uint16Array(_*6),this.textureArray=new Float32Array(_*2*4),this.foregroundUint8Array=new Uint8Array(_*4*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(_*4*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer),this.frameBufferTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.frameBufferTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.pixelWidth,this.pixelHeight,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.frameBufferTexture,0);let a=0,c=0,l=0;for(let u=0;u<r;u++)for(let f=0;f<i;f++)this.positionsArray[a++]=B(f,i),this.positionsArray[a++]=-B(u,r),this.positionsArray[a++]=B(f+1,i),this.positionsArray[a++]=-B(u,r),this.positionsArray[a++]=B(f+1,i),this.positionsArray[a++]=-B(u+1,r),this.positionsArray[a++]=B(f,i),this.positionsArray[a++]=-B(u+1,r),this.indexArray[c++]=l+0,this.indexArray[c++]=l+1,this.indexArray[c++]=l+2,this.indexArray[c++]=l+0,this.indexArray[c++]=l+2,this.indexArray[c++]=l+3,l+=4;this.positionBuffer=s.createBuffer(),this.indexBuffer=s.createBuffer(),this.textureBuffer=s.createBuffer(),this.foregroundBuffer=s.createBuffer(),this.backgroundBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),s.bufferData(s.ARRAY_BUFFER,this.positionsArray,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,this.indexArray,s.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,this.requestAnimationFrame()}handleResize(){const e=this.canvas.parentElement;if(!e)return;const i=e.offsetWidth/this.pixelWidth,r=e.offsetHeight/this.pixelHeight,o=Math.min(i,r),s=o*this.pixelWidth|0,n=o*this.pixelHeight|0;this.canvas.style.width=s+"px",this.canvas.style.height=n+"px"}getAttribLocation(e){const i=this.gl.getAttribLocation(this.program,e);return this.gl.enableVertexAttribArray(i),i}flush(){let e=0,i=0;for(let r=0;r<this.height;r++)for(let o=0;o<this.width;o++){const s=this.getCell(o,r);if(!s.dirty){e+=8,i+=16;continue}const n=s.charCode%16,_=s.charCode/16|0;this.textureArray[e++]=n,this.textureArray[e++]=_,this.textureArray[e++]=n+1,this.textureArray[e++]=_,this.textureArray[e++]=n+1,this.textureArray[e++]=_+1,this.textureArray[e++]=n,this.textureArray[e++]=_+1;for(let a=0;a<4;a++)this.foregroundDataView.setUint32(i,s.fg,!1),this.backgroundDataView.setUint32(i,s.bg,!1),i+=4;s.dirty=!1}}isKeyDown(e){return this.keys.getKey(e).down}isKeyPressed(e){return this.keys.getKey(e).isPressed()}getKeyDownCount(e){return this.keys.getKey(e).downCount}getMovementKey(){if(this.isKeyPressed(d.VK_NUMPAD1)||this.isKeyPressed(d.VK_B))return new T(-1,1);if(this.isKeyPressed(d.VK_NUMPAD2)||this.isKeyPressed(d.VK_J)||this.isKeyPressed(d.VK_DOWN))return new T(0,1);if(this.isKeyPressed(d.VK_NUMPAD3)||this.isKeyPressed(d.VK_N))return new T(1,1);if(this.isKeyPressed(d.VK_NUMPAD4)||this.isKeyPressed(d.VK_H)||this.isKeyPressed(d.VK_LEFT))return new T(-1,0);if(this.isKeyPressed(d.VK_NUMPAD5)||this.isKeyPressed(d.VK_PERIOD))return new T(0,0);if(this.isKeyPressed(d.VK_NUMPAD6)||this.isKeyPressed(d.VK_L)||this.isKeyPressed(d.VK_RIGHT))return new T(1,0);if(this.isKeyPressed(d.VK_NUMPAD7)||this.isKeyPressed(d.VK_Y))return new T(-1,-1);if(this.isKeyPressed(d.VK_NUMPAD8)||this.isKeyPressed(d.VK_K)||this.isKeyPressed(d.VK_UP))return new T(0,-1);if(this.isKeyPressed(d.VK_NUMPAD9)||this.isKeyPressed(d.VK_U))return new T(1,-1)}buildShader(e,i){const r=this.gl,o=r.createShader(e);if(!o)throw new Error("An error occurred compiling the shader: ");if(r.shaderSource(o,i),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+r.getShaderInfoLog(o));return o}loadTexture(e){const i=this.gl,r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);const o=0,s=i.RGBA,n=1,_=1,a=0,c=i.RGBA,l=i.UNSIGNED_BYTE,E=new Uint8Array([0,0,0,255]);i.texImage2D(i.TEXTURE_2D,o,s,n,_,a,c,l,E);const u=new Image;return u.onload=()=>{i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,o,s,c,l,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)},u.src=e,r}render(){const e=this.gl;e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.crt?e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer):e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.pixelWidth,this.pixelHeight);{const r=e.FLOAT,o=!1,s=0,n=0;e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.vertexAttribPointer(this.positionAttribLocation,2,r,o,s,n)}{const r=e.FLOAT,o=!1,s=0,n=0;e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.bufferData(e.ARRAY_BUFFER,this.textureArray,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.textureAttribLocation,2,r,o,s,n)}{const r=e.UNSIGNED_BYTE,o=!0,s=0,n=0;e.bindBuffer(e.ARRAY_BUFFER,this.foregroundBuffer),e.bufferData(e.ARRAY_BUFFER,this.foregroundUint8Array,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.fgColorAttribLocation,4,r,o,s,n)}{const r=e.UNSIGNED_BYTE,o=!0,s=0,n=0;e.bindBuffer(e.ARRAY_BUFFER,this.backgroundBuffer),e.bufferData(e.ARRAY_BUFFER,this.backgroundUint8Array,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.bgColorAttribLocation,4,r,o,s,n)}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.useProgram(this.program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture);{const i=this.width*this.height*6,r=e.UNSIGNED_SHORT,o=0;e.drawElements(e.TRIANGLES,i,r,o)}}renderCrt(){const e=this.crt;if(!e)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,this.pixelWidth*this.pixelScale,this.pixelHeight*this.pixelScale),i.useProgram(this.crtProgram),i.uniform1f(this.crtBlurLocation,e.blur),i.uniform1f(this.crtCurvatureLocation,e.curvature),i.uniform1f(this.crtChromaLocation,e.chroma),i.uniform1f(this.crtVignetteLocation,e.vignette),i.uniform1f(this.crtScanlineWidthLocation,e.scanlineWidth),i.uniform1f(this.crtScanlineIntensityLocation,e.scanlineIntensity),i.bindBuffer(i.ARRAY_BUFFER,this.crtPositionBuffer),i.vertexAttribPointer(this.crtPositionLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.crtTexCoordBuffer),i.vertexAttribPointer(this.crtTexCoordLocation,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.frameBufferTexture),i.drawArrays(i.TRIANGLES,0,6)}requestAnimationFrame(){window.requestAnimationFrame(e=>this.renderLoop(e))}renderLoop(e){this.lastRenderTime===0?(this.lastRenderTime=e,this.fps=0):(this.renderDelta=e-this.lastRenderTime,this.lastRenderTime=e,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(e),this.mouse.update(e),this.update&&this.update(),this.flush(),this.render(),this.crt&&this.renderCrt(),this.requestAnimationFrame()}}export{p as B,b as C,it as F,d as K,G as M,T as P,H as R,St as T,N as a,L as b,v as c,wt as d,h as e,vt as f,xt as g,Ut as l};
