{"version":3,"sources":["webpack://wglt/webpack/universalModuleDefinition","webpack://wglt/webpack/bootstrap","webpack://wglt/./src/rect.ts","webpack://wglt/./src/color.ts","webpack://wglt/./src/keys.ts","webpack://wglt/./src/blendmode.ts","webpack://wglt/./src/colors.ts","webpack://wglt/./src/chars.ts","webpack://wglt/./src/console.ts","webpack://wglt/./src/point.ts","webpack://wglt/./src/gui/dialog.ts","webpack://wglt/./src/cell.ts","webpack://wglt/./src/font.ts","webpack://wglt/./src/gui/dialogstate.ts","webpack://wglt/./src/index.ts","webpack://wglt/./src/boxutils.ts","webpack://wglt/./src/fov.ts","webpack://wglt/./src/gui.ts","webpack://wglt/./src/gui/defaultdialogrenderer.ts","webpack://wglt/./src/gui/messagedialog.ts","webpack://wglt/./src/gui/selectdialog.ts","webpack://wglt/./src/image.ts","webpack://wglt/./src/path.ts","webpack://wglt/./src/rng.ts","webpack://wglt/./src/terminal.ts","webpack://wglt/./src/mouse.ts","webpack://wglt/./src/shaders.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","point_1","Rect","[object Object]","x","y","width","height","this","left","top","x2","y2","Point","other","fromRgb","g","b","a","undefined","fromHsv","h","v","f","q","KEY_COUNT","Key","down","downCount","Keys","el","keys","Array","addEventListener","e","setKey","state","stopPropagation","preventDefault","keyCode","VK_CANCEL","VK_HELP","VK_BACK_SPACE","VK_TAB","VK_CLEAR","VK_ENTER","VK_SHIFT","VK_CONTROL","VK_ALT","VK_PAUSE","VK_CAPS_LOCK","VK_ESCAPE","VK_SPACE","VK_PAGE_UP","VK_PAGE_DOWN","VK_END","VK_HOME","VK_LEFT","VK_UP","VK_RIGHT","VK_DOWN","VK_PRINTSCREEN","VK_INSERT","VK_DELETE","VK_0","VK_1","VK_2","VK_3","VK_4","VK_5","VK_6","VK_7","VK_8","VK_9","VK_COLON","VK_SEMICOLON","VK_LESS_THAN","VK_EQUALS","VK_GREATER_THAN","VK_QUESTION_MARK","VK_AT","VK_A","VK_B","VK_C","VK_D","VK_E","VK_F","VK_G","VK_H","VK_I","VK_J","VK_K","VK_L","VK_M","VK_N","VK_O","VK_P","VK_Q","VK_R","VK_S","VK_T","VK_U","VK_V","VK_W","VK_X","VK_Y","VK_Z","VK_CONTEXT_MENU","VK_NUMPAD0","VK_NUMPAD1","VK_NUMPAD2","VK_NUMPAD3","VK_NUMPAD4","VK_NUMPAD5","VK_NUMPAD6","VK_NUMPAD7","VK_NUMPAD8","VK_NUMPAD9","VK_MULTIPLY","VK_ADD","VK_SEPARATOR","VK_SUBTRACT","VK_DECIMAL","VK_DIVIDE","VK_F1","VK_F2","VK_F3","VK_F4","VK_F5","VK_F6","VK_F7","VK_F8","VK_F9","VK_F10","VK_F11","VK_F12","VK_F13","VK_F14","VK_F15","VK_F16","VK_F17","VK_F18","VK_F19","VK_F20","VK_F21","VK_F22","VK_F23","VK_F24","VK_NUM_LOCK","VK_SCROLL_LOCK","VK_CIRCUMFLEX","VK_EXCLAMATION","VK_DOUBLE_QUOTE","VK_HASH","VK_DOLLAR","VK_PERCENT","VK_AMPERSAND","VK_UNDERSCORE","VK_OPEN_PAREN","VK_CLOSE_PAREN","VK_ASTERISK","VK_PLUS","VK_PIPE","VK_HYPHEN_MINUS","VK_OPEN_CURLY_BRACKET","VK_CLOSE_CURLY_BRACKET","VK_TILDE","VK_COMMA","VK_PERIOD","VK_SLASH","VK_BACK_QUOTE","VK_OPEN_BRACKET","VK_BACK_SLASH","VK_CLOSE_BRACKET","VK_QUOTE","VK_META","VK_ALTGR","VK_WIN","VK_KANA","VK_HANGUL","VK_EISU","VK_JUNJA","VK_FINAL","VK_HANJA","VK_KANJI","VK_CONVERT","VK_NONCONVERT","VK_ACCEPT","VK_MODECHANGE","VK_SELECT","VK_PRINT","VK_EXECUTE","VK_SLEEP","BlendMode","color_1","Colors","BLACK","WHITE","LIGHT_GRAY","DARK_GRAY","YELLOW","BROWN","LIGHT_RED","DARK_RED","LIGHT_GREEN","DARK_GREEN","LIGHT_CYAN","DARK_CYAN","LIGHT_BLUE","DARK_BLUE","LIGHT_MAGENTA","DARK_MAGENTA","ORANGE","Chars","SMILEY","INVERSE_SMILEY","HEART","DIAMOND","CLUB","SPADE","BULLET","INVERSE_BULLET","LIGHT_SHADE","MEDIUM_SHADE","DARK_SHADE","BOX_SINGLE_VERTICAL","BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT","BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT","BOX_DOUBLE_VERTICAL","BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_LEFT","BOX_SINGLE_DOWN_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_RIGHT","BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP","BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN","BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT","BOX_SINGLE_HORIZONTAL","BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL","BOX_DOUBLE_UP_AND_DOUBLE_RIGHT","BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT","BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP","BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN","BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT","BOX_DOUBLE_HORIZONTAL","BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL","BOX_SINGLE_UP_AND_SINGLE_LEFT","BOX_SINGLE_DOWN_AND_SINGLE_RIGHT","BLOCK_TOP_LEFT","BLOCK_TOP_RIGHT","BLOCK_TOP_HALF","BLOCK_BOTTOM_LEFT","BLOCK_BOTTOM_RIGHT","BLOCK_RIGHT_HALF","BLOCK_CHECKER","blendmode_1","cell_1","chars_1","Console","grid","row","push","Cell","clear","drawChar","charCode","fg","bg","setValue","str","length","charCodeAt","drawString","Math","floor","xi","yi","drawHLine","drawVLine","topChar","rightChar","bottomChar","leftChar","topLeftChar","topRightChar","bottomRightChar","bottomLeftChar","fillRect","drawBox","dstX","dstY","srcConsole","srcX","srcY","srcWidth","srcHeight","blendMode","None","cell","getCell","drawCell","Dialog","contentsRect","title","colors_1","meta","convertCharCode","dirty","setCharCode","setForeground","setBackground","setMeta","otherCell","alpha","blendColors","c1","c2","w1","w2","r1","g1","b1","r2","g2","b2","Blend","Add","clamp","min","Font","url","charWidth","charHeight","scale","graphical","DEFAULT_FONT","DialogState","dialog","rect","contentsOffset","open","count","__export","BOX_CHAR_DETAILS","isBoxCell","console","getBoxCell","up","right","fixBoxCells","Error","FovCell","blocked","visible","prev","FovMap","blockedFunc","originX","originY","minX","maxX","minY","maxY","radius","deltaX","deltaY","startSlopes","endSlopes","halfSlope","processedCell","extended","centreSlope","startSlope","endSlope","previousEndSlope","iteration","totalObstacles","obstaclesInLastLine","minSlope","idx","max","computeOctantY","computeOctantX","defaultdialogrenderer_1","GUI","terminal","renderer","DefaultDialogRenderer","dialogs","getState","activeIndex","activeState","handleInput","splice","draw","rect_1","dialogstate_1","term","dialogState","drawSingleBox","drawCenteredString","drawContents","keys_1","dialog_1","MessageDialog","message","lines","split","super","offset","isKeyPressed","SelectDialog","options","callback","String","fromCharCode","console_1","PATTERNS","active","getImageData","img","canvas","document","createElement","ctx","getContext","drawImage","data","draw2x2","con","w","i1","i2","i3","i4","colors","minError","Number","MAX_VALUE","bestCharCode","bestBg","bestFg","pattern","patternColors","computeColors","error","arrayToColor","sum","avg","j","cellError","delta","sqrt","rgb","loadImage","Image","onload","result","src","loadImage2x","dxs","dys","costs","getMinCell","bestCell","bestIndex","minDist","Infinity","buildPath","curr","reverse","computePath","map","source","dest","maxDist","abs","clearDijkstra","sourceCell","u","alt","RNG","seed","nextInt","start","end","rangeSize","chances","total","reduce","roll","nextRange","runningTotal","chancesMap","values","chooseIndex","font_1","mouse_1","shaders_1","interpolate","DEFAULT_OPTIONS","font","requestFullscreen","Terminal","pixelWidth","pixelHeight","style","outline","tabIndex","mouse","Mouse","gl","antialias","program","createProgram","attachShader","buildShader","VERTEX_SHADER","VERTEX_SHADER_SOURCE","FRAGMENT_SHADER","FRAGMENT_SHADER_SOURCE","linkProgram","useProgram","uniform1i","getUniformLocation","positionAttribLocation","getAttribLocation","textureAttribLocation","fgColorAttribLocation","bgColorAttribLocation","cellCount","positionsArray","Float32Array","indexArray","Uint16Array","textureArray","foregroundUint8Array","Uint8Array","foregroundDataView","DataView","buffer","backgroundUint8Array","backgroundDataView","k","positionBuffer","createBuffer","indexBuffer","textureBuffer","foregroundBuffer","backgroundBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","texture","loadTexture","renderLoop","location","enableVertexAttribArray","textureArrayIndex","colorArrayIndex","textureX","textureY","setUint32","getKey","type","sh","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createTexture","bindTexture","TEXTURE_2D","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","pixel","texImage2D","image","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","clearColor","clearDepth","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","viewport","numComponents","FLOAT","normalize","stride","vertexAttribPointer","DYNAMIC_DRAW","activeTexture","TEXTURE0","vertexCount","UNSIGNED_SHORT","drawElements","TRIANGLES","updateKeys","update","flush","render","requestAnimationFrame","prevX","prevY","dx","dy","buttons","handleEvent","touchEventHandler","handleTouchEvent","touches","touch","updatePosition","clientX","clientY","button","focus","getBoundingClientRect","terminalAspectRatio","rectAspectRatio","actualWidth","excess","actualHeight","webkitRequestFullscreen","mozRequestFullScreen"],"mappings":"CAAA,SAAAA,EAAAC,GACA,iBAAAC,SAAA,iBAAAC,OACAA,OAAAD,QAAAD,IACA,mBAAAG,eAAAC,IACAD,OAAA,UAAAH,GACA,iBAAAC,QACAA,QAAA,KAAAD,IAEAD,EAAA,KAAAC,IARA,CASCK,OAAA,WACD,mBCTA,IAAAC,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAP,QAGA,IAAAC,EAAAI,EAAAE,GAAA,CACAC,EAAAD,EACAE,GAAA,EACAT,QAAA,IAUA,OANAU,EAAAH,GAAAI,KAAAV,EAAAD,QAAAC,IAAAD,QAAAM,GAGAL,EAAAQ,GAAA,EAGAR,EAAAD,QA0DA,OArDAM,EAAAM,EAAAF,EAGAJ,EAAAO,EAAAR,EAGAC,EAAAQ,EAAA,SAAAd,EAAAe,EAAAC,GACAV,EAAAW,EAAAjB,EAAAe,IACAG,OAAAC,eAAAnB,EAAAe,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CV,EAAAgB,EAAA,SAAAtB,GACA,oBAAAuB,eAAAC,aACAN,OAAAC,eAAAnB,EAAAuB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAnB,EAAA,cAAiDyB,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAQ,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAhC,GACA,IAAAe,EAAAf,KAAA2B,WACA,WAA2B,OAAA3B,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAK,EAAAQ,EAAAE,EAAA,IAAAA,GACAA,GAIAV,EAAAW,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD7B,EAAAgC,EAAA,GAIAhC,IAAAiC,EAAA,oFClFA,MAAAC,EAAAlC,EAAA,GAEAN,EAAAyC,KAAA,MAUEC,YAAYC,EAAWC,EAAWC,EAAeC,GAC/CC,KAAKJ,EAAII,KAAKC,KAAOL,EACrBI,KAAKH,EAAIG,KAAKE,IAAML,EACpBG,KAAKF,MAAQA,EACbE,KAAKD,OAASA,EACdC,KAAKG,GAAKP,EAAIE,EACdE,KAAKI,GAAKP,EAAIE,EAGhBJ,YACE,OAAO,IAAIF,EAAAY,MACPL,KAAKJ,EAAKI,KAAKF,MAAQ,EAAK,EAAGE,KAAKH,EAAKG,KAAKD,OAAS,EAAK,GAGlEJ,WAAWW,GACT,OAAON,KAAKJ,GAAKU,EAAMH,IAAMH,KAAKG,IAAMG,EAAMV,GAAKI,KAAKH,GAAKS,EAAMF,IAC/DJ,KAAKI,IAAME,EAAMT,kCCjBzB,SAAgBU,EAAQhC,EAAWiC,EAAWC,EAAWC,GAIvD,YAHUC,IAAND,IACFA,EAAI,MAEGnC,GAAK,KAAOiC,GAAK,KAAOC,GAAK,GAAKC,mDAJ7CzD,EAAAsD,UAmBAtD,EAAA2D,QAAA,SAAwBC,EAAWrB,EAAWsB,EAAWJ,GACvD,MAAMjD,EAAS,EAAJoD,EAAS,EACdE,EAAQ,EAAJF,EAAQpD,EACZ8B,EAAIuB,GAAK,EAAItB,GACbwB,EAAIF,GAAK,EAAIC,EAAIvB,GACjBb,EAAImC,GAAK,GAAK,EAAIC,GAAKvB,GAC7B,IAAIjB,EAAGiC,EAAGC,EACV,OAAQhD,EAAI,GACV,KAAK,EACHc,EAAIuC,EAAGN,EAAI7B,EAAG8B,EAAIlB,EAClB,MACF,KAAK,EACHhB,EAAIyC,EAAGR,EAAIM,EAAGL,EAAIlB,EAClB,MACF,KAAK,EACHhB,EAAIgB,EAAGiB,EAAIM,EAAGL,EAAI9B,EAClB,MACF,KAAK,EACHJ,EAAIgB,EAAGiB,EAAIQ,EAAGP,EAAIK,EAClB,MACF,KAAK,EACHvC,EAAII,EAAG6B,EAAIjB,EAAGkB,EAAIK,EAClB,MACF,KAAK,EACHvC,EAAIuC,EAAGN,EAAIjB,EAAGkB,EAAIO,EAClB,MACF,QACEzC,EAAI,EACJiC,EAAI,EACJC,EAAI,EAKR,YAHUE,IAAND,IACFA,EAAI,GAECH,EAAa,IAAJhC,EAAW,EAAQ,IAAJiC,EAAW,EAAQ,IAAJC,EAAW,EAAQ,IAAJC,EAAW,mFC5D1E,MAAMO,EAAY,IAKlB,MAAaC,EAIXvB,cACEK,KAAKmB,MAAO,EACZnB,KAAKoB,UAAY,GANrBnE,EAAAiE,MAUA,MAAaG,EAQX1B,YAAY2B,GACVtB,KAAKuB,KAAO,IAAIC,MAAMP,GACtB,IAAK,IAAIxD,EAAI,EAAGA,EAAIwD,EAAWxD,IAC7BuC,KAAKuB,KAAK9D,GAAK,IAAIyD,EAGrBI,EAAGG,iBAAiB,UAAWC,GAAK1B,KAAK2B,OAAOD,GAAoB,IACpEJ,EAAGG,iBAAiB,QAASC,GAAK1B,KAAK2B,OAAOD,GAAoB,IAIpE/B,OAAO+B,EAAkBE,GACvBF,EAAEG,kBACFH,EAAEI,iBACF,MAAMC,EAAUL,EAAEK,QACdA,GAAW,GAAKA,EAAUd,IAC5BjB,KAAKuB,KAAKQ,GAASZ,KAAOS,GAI9BjC,aACE,IAAK,IAAIlC,EAAI,EAAGA,EAAIwD,EAAWxD,IACzBuC,KAAKuB,KAAK9D,GAAG0D,KACfnB,KAAKuB,KAAK9D,GAAG2D,YAEbpB,KAAKuB,KAAK9D,GAAG2D,UAAY,EAK/BzB,OAAOoC,GACL,OAAOA,GAAW,GAAKA,EAAUd,EAAYjB,KAAKuB,KAAKQ,GAAW,MAGpDV,EAAAW,UAAY,EACZX,EAAAY,QAAU,EACVZ,EAAAa,cAAgB,EAChBb,EAAAc,OAAS,EACTd,EAAAe,SAAW,GACXf,EAAAgB,SAAW,GACXhB,EAAAiB,SAAW,GACXjB,EAAAkB,WAAa,GACblB,EAAAmB,OAAS,GACTnB,EAAAoB,SAAW,GACXpB,EAAAqB,aAAe,GACfrB,EAAAsB,UAAY,GACZtB,EAAAuB,SAAW,GACXvB,EAAAwB,WAAa,GACbxB,EAAAyB,aAAe,GACfzB,EAAA0B,OAAS,GACT1B,EAAA2B,QAAU,GACV3B,EAAA4B,QAAU,GACV5B,EAAA6B,MAAQ,GACR7B,EAAA8B,SAAW,GACX9B,EAAA+B,QAAU,GACV/B,EAAAgC,eAAiB,GACjBhC,EAAAiC,UAAY,GACZjC,EAAAkC,UAAY,GACZlC,EAAAmC,KAAO,GACPnC,EAAAoC,KAAO,GACPpC,EAAAqC,KAAO,GACPrC,EAAAsC,KAAO,GACPtC,EAAAuC,KAAO,GACPvC,EAAAwC,KAAO,GACPxC,EAAAyC,KAAO,GACPzC,EAAA0C,KAAO,GACP1C,EAAA2C,KAAO,GACP3C,EAAA4C,KAAO,GACP5C,EAAA6C,SAAW,GACX7C,EAAA8C,aAAe,GACf9C,EAAA+C,aAAe,GACf/C,EAAAgD,UAAY,GACZhD,EAAAiD,gBAAkB,GAClBjD,EAAAkD,iBAAmB,GACnBlD,EAAAmD,MAAQ,GACRnD,EAAAoD,KAAO,GACPpD,EAAAqD,KAAO,GACPrD,EAAAsD,KAAO,GACPtD,EAAAuD,KAAO,GACPvD,EAAAwD,KAAO,GACPxD,EAAAyD,KAAO,GACPzD,EAAA0D,KAAO,GACP1D,EAAA2D,KAAO,GACP3D,EAAA4D,KAAO,GACP5D,EAAA6D,KAAO,GACP7D,EAAA8D,KAAO,GACP9D,EAAA+D,KAAO,GACP/D,EAAAgE,KAAO,GACPhE,EAAAiE,KAAO,GACPjE,EAAAkE,KAAO,GACPlE,EAAAmE,KAAO,GACPnE,EAAAoE,KAAO,GACPpE,EAAAqE,KAAO,GACPrE,EAAAsE,KAAO,GACPtE,EAAAuE,KAAO,GACPvE,EAAAwE,KAAO,GACPxE,EAAAyE,KAAO,GACPzE,EAAA0E,KAAO,GACP1E,EAAA2E,KAAO,GACP3E,EAAA4E,KAAO,GACP5E,EAAA6E,KAAO,GACP7E,EAAA8E,gBAAkB,GAClB9E,EAAA+E,WAAa,GACb/E,EAAAgF,WAAa,GACbhF,EAAAiF,WAAa,GACbjF,EAAAkF,WAAa,GACblF,EAAAmF,WAAa,IACbnF,EAAAoF,WAAa,IACbpF,EAAAqF,WAAa,IACbrF,EAAAsF,WAAa,IACbtF,EAAAuF,WAAa,IACbvF,EAAAwF,WAAa,IACbxF,EAAAyF,YAAc,IACdzF,EAAA0F,OAAS,IACT1F,EAAA2F,aAAe,IACf3F,EAAA4F,YAAc,IACd5F,EAAA6F,WAAa,IACb7F,EAAA8F,UAAY,IACZ9F,EAAA+F,MAAQ,IACR/F,EAAAgG,MAAQ,IACRhG,EAAAiG,MAAQ,IACRjG,EAAAkG,MAAQ,IACRlG,EAAAmG,MAAQ,IACRnG,EAAAoG,MAAQ,IACRpG,EAAAqG,MAAQ,IACRrG,EAAAsG,MAAQ,IACRtG,EAAAuG,MAAQ,IACRvG,EAAAwG,OAAS,IACTxG,EAAAyG,OAAS,IACTzG,EAAA0G,OAAS,IACT1G,EAAA2G,OAAS,IACT3G,EAAA4G,OAAS,IACT5G,EAAA6G,OAAS,IACT7G,EAAA8G,OAAS,IACT9G,EAAA+G,OAAS,IACT/G,EAAAgH,OAAS,IACThH,EAAAiH,OAAS,IACTjH,EAAAkH,OAAS,IACTlH,EAAAmH,OAAS,IACTnH,EAAAoH,OAAS,IACTpH,EAAAqH,OAAS,IACTrH,EAAAsH,OAAS,IACTtH,EAAAuH,YAAc,IACdvH,EAAAwH,eAAiB,IACjBxH,EAAAyH,cAAgB,IAChBzH,EAAA0H,eAAiB,IACjB1H,EAAA2H,gBAAkB,IAClB3H,EAAA4H,QAAU,IACV5H,EAAA6H,UAAY,IACZ7H,EAAA8H,WAAa,IACb9H,EAAA+H,aAAe,IACf/H,EAAAgI,cAAgB,IAChBhI,EAAAiI,cAAgB,IAChBjI,EAAAkI,eAAiB,IACjBlI,EAAAmI,YAAc,IACdnI,EAAAoI,QAAU,IACVpI,EAAAqI,QAAU,IACVrI,EAAAsI,gBAAkB,IAClBtI,EAAAuI,sBAAwB,IACxBvI,EAAAwI,uBAAyB,IACzBxI,EAAAyI,SAAW,IACXzI,EAAA0I,SAAW,IACX1I,EAAA2I,UAAY,IACZ3I,EAAA4I,SAAW,IACX5I,EAAA6I,cAAgB,IAChB7I,EAAA8I,gBAAkB,IAClB9I,EAAA+I,cAAgB,IAChB/I,EAAAgJ,iBAAmB,IACnBhJ,EAAAiJ,SAAW,IACXjJ,EAAAkJ,QAAU,IACVlJ,EAAAmJ,SAAW,IACXnJ,EAAAoJ,OAAS,GACTpJ,EAAAqJ,QAAU,GACVrJ,EAAAsJ,UAAY,GACZtJ,EAAAuJ,QAAU,GACVvJ,EAAAwJ,SAAW,GACXxJ,EAAAyJ,SAAW,GACXzJ,EAAA0J,SAAW,GACX1J,EAAA2J,SAAW,GACX3J,EAAA4J,WAAa,GACb5J,EAAA6J,cAAgB,GAChB7J,EAAA8J,UAAY,GACZ9J,EAAA+J,cAAgB,GAChB/J,EAAAgK,UAAY,GACZhK,EAAAiK,SAAW,GACXjK,EAAAkK,WAAa,GACblK,EAAAmK,SAAW,GAlM7BvO,EAAAoE,sFCfA,SAAYoK,GAKVA,IAAA,eASAA,IAAA,iBASAA,IAAA,aAvBF,CAAYxO,EAAAwO,YAAAxO,EAAAwO,UAAS,oFCHrB,MAAAC,EAAAnO,EAAA,GAEA,MAAaoO,GACKA,EAAAC,MAAQF,EAAAnL,QAAQ,EAAG,EAAG,GACtBoL,EAAAE,MAAQH,EAAAnL,QAAQ,IAAM,IAAM,KAC5BoL,EAAAG,WAAaJ,EAAAnL,QAAQ,IAAM,IAAM,KACjCoL,EAAAI,UAAYL,EAAAnL,QAAQ,GAAM,GAAM,IAChCoL,EAAAK,OAASN,EAAAnL,QAAQ,IAAM,IAAM,IAC7BoL,EAAAM,MAAQP,EAAAnL,QAAQ,IAAM,GAAM,GAC5BoL,EAAAO,UAAYR,EAAAnL,QAAQ,IAAM,GAAM,IAChCoL,EAAAQ,SAAWT,EAAAnL,QAAQ,IAAM,EAAM,GAC/BoL,EAAAS,YAAcV,EAAAnL,QAAQ,GAAM,IAAM,IAClCoL,EAAAU,WAAaX,EAAAnL,QAAQ,EAAM,IAAM,GACjCoL,EAAAW,WAAaZ,EAAAnL,QAAQ,GAAM,IAAM,KACjCoL,EAAAY,UAAYb,EAAAnL,QAAQ,EAAM,IAAM,KAChCoL,EAAAa,WAAad,EAAAnL,QAAQ,GAAM,GAAM,KACjCoL,EAAAc,UAAYf,EAAAnL,QAAQ,EAAM,EAAM,KAChCoL,EAAAe,cAAgBhB,EAAAnL,QAAQ,IAAM,GAAM,KACpCoL,EAAAgB,aAAejB,EAAAnL,QAAQ,IAAM,EAAM,KACnCoL,EAAAiB,OAASlB,EAAAnL,QAAQ,IAAM,IAAM,GAjB/CtD,EAAA0O,wFCGA,MAAakB,GACKA,EAAAC,OAAS,EACTD,EAAAE,eAAiB,EACjBF,EAAAG,MAAQ,EACRH,EAAAI,QAAU,EACVJ,EAAAK,KAAO,EACPL,EAAAM,MAAQ,EACRN,EAAAO,OAAS,EACTP,EAAAQ,eAAiB,EAEjBR,EAAAS,YAAc,IACdT,EAAAU,aAAe,IACfV,EAAAW,WAAa,IAEbX,EAAAY,oBAAsB,IACtBZ,EAAAa,oCAAsC,IACtCb,EAAAc,oCAAsC,IACtCd,EAAAe,oBAAsB,IACtBf,EAAAgB,gCAAkC,IAClChB,EAAAiB,8BAAgC,IAChCjB,EAAAkB,gCAAkC,IAClClB,EAAAmB,+BAAiC,IACjCnB,EAAAoB,oCAAsC,IACtCpB,EAAAqB,sCAAwC,IACxCrB,EAAAsB,qCAAuC,IACvCtB,EAAAuB,sBAAwB,IACxBvB,EAAAwB,0CAA4C,IAC5CxB,EAAAyB,+BAAiC,IACjCzB,EAAA0B,iCAAmC,IACnC1B,EAAA2B,oCAAsC,IACtC3B,EAAA4B,sCAAwC,IACxC5B,EAAA6B,qCAAuC,IACvC7B,EAAA8B,sBAAwB,IACxB9B,EAAA+B,0CAA4C,IAC5C/B,EAAAgC,8BAAgC,IAChChC,EAAAiC,iCAAmC,IAEnCjC,EAAAkC,eAAiB,IACjBlC,EAAAmC,gBAAkB,IAClBnC,EAAAoC,eAAiB,IACjBpC,EAAAqC,kBAAoB,IACpBrC,EAAAsC,mBAAqB,IACrBtC,EAAAuC,iBAAmB,IACnBvC,EAAAwC,cAAgB,IA3ClCpS,EAAA4P,uFCLA,MAAAyC,EAAA/R,EAAA,GACAgS,EAAAhS,EAAA,GACAiS,EAAAjS,EAAA,GAGAN,EAAAwS,QAAA,MAKE9P,YAAYG,EAAeC,GACzBC,KAAKF,MAAQA,EACbE,KAAKD,OAASA,EACdC,KAAK0P,KAAO,IAAIlO,MAEhB,IAAK,IAAI3B,EAAI,EAAGA,EAAIE,EAAQF,IAAK,CAC/B,MAAM8P,EAAM,IAAInO,MAChB,IAAK,IAAI5B,EAAI,EAAGA,EAAIE,EAAOF,IACzB+P,EAAIC,KAAK,IAAIL,EAAAM,MAEf7P,KAAK0P,KAAKE,KAAKD,GAGjB3P,KAAK8P,QAGPnQ,QACE,IAAK,IAAIE,EAAI,EAAGA,EAAIG,KAAKD,OAAQF,IAC/B,IAAK,IAAID,EAAI,EAAGA,EAAII,KAAKF,MAAOF,IAC9BI,KAAK+P,SAASnQ,EAAGC,EAAG,GAK1BF,QAAQC,EAAWC,GACjB,KAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKI,KAAKF,OAASD,GAAKG,KAAKD,QAGnD,OAAOC,KAAK0P,KAAK7P,GAAGD,GAGtBD,YAAYC,EAAWC,GACrB,KAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKI,KAAKF,OAASD,GAAKG,KAAKD,QAGnD,OAAOC,KAAK0P,KAAK7P,GAAGD,GAAGoQ,SAGzBrQ,SACIC,EAAWC,EAAW/B,EAAuBmS,EAAYC,GACvDtQ,GAAK,GAAKA,EAAII,KAAKF,OAASD,GAAK,GAAKA,EAAIG,KAAKD,QACjDC,KAAK0P,KAAK7P,GAAGD,GAAGuQ,SAASrS,EAAGmS,EAAIC,GAIpCvQ,WAAWC,EAAWC,EAAWuQ,EAAaH,EAAYC,GACxD,IAAK,IAAIzS,EAAI,EAAGA,EAAI2S,EAAIC,OAAQ5S,IAC9BuC,KAAK+P,SAASnQ,EAAInC,EAAGoC,EAAGuQ,EAAIE,WAAW7S,GAAIwS,EAAIC,GAInDvQ,mBACIC,EAAWC,EAAWuQ,EAAaH,EAAYC,GACjDlQ,KAAKuQ,WAAW3Q,EAAI4Q,KAAKC,MAAML,EAAIC,OAAS,GAAIxQ,EAAGuQ,EAAKH,EAAIC,GAG9DvQ,UACIC,EAAWC,EAAWC,EAAehC,EAAgBmS,EACrDC,GACF,IAAK,IAAIQ,EAAK9Q,EAAG8Q,EAAK9Q,EAAIE,EAAO4Q,IAC/B1Q,KAAK+P,SAASW,EAAI7Q,EAAG/B,EAAGmS,EAAIC,GAIhCvQ,UACIC,EAAWC,EAAWE,EAAgBjC,EAAgBmS,EACtDC,GACF,IAAK,IAAIS,EAAK9Q,EAAG8Q,EAAK9Q,EAAIE,EAAQ4Q,IAChC3Q,KAAK+P,SAASnQ,EAAG+Q,EAAI7S,EAAGmS,EAAIC,GAIhCvQ,SACIC,EAAWC,EAAWC,EAAeC,EAAgBjC,EACrDmS,EAAYC,GACdlQ,KAAK4Q,UAAUhR,EAAGC,EAAGC,EAAOhC,EAAGmS,EAAIC,GACnClQ,KAAK4Q,UAAUhR,EAAGC,EAAIE,EAAS,EAAGD,EAAOhC,EAAGmS,EAAIC,GAChDlQ,KAAK6Q,UAAUjR,EAAGC,EAAGE,EAAQjC,EAAGmS,EAAIC,GACpClQ,KAAK6Q,UAAUjR,EAAIE,EAAQ,EAAGD,EAAGE,EAAQjC,EAAGmS,EAAIC,GAGlDvQ,QACIC,EAAWC,EAAWC,EAAeC,EAAgB+Q,EACrDC,EAAmBC,EAAoBC,EACvCC,EAAqBC,EAAsBC,EAC3CC,EAAwBpB,EAAYC,GACtClQ,KAAKsR,SAAS1R,EAAGC,EAAGC,EAAOC,EAAQ,EAAGkQ,EAAIC,GAE1ClQ,KAAK4Q,UAAUhR,EAAGC,EAAGC,EAAOgR,GAC5B9Q,KAAK4Q,UAAUhR,EAAGC,EAAIE,EAAS,EAAGD,EAAOkR,GAEzChR,KAAK6Q,UAAUjR,EAAGC,EAAGE,EAAQkR,GAC7BjR,KAAK6Q,UAAUjR,EAAIE,EAAQ,EAAGD,EAAGE,EAAQgR,GAEzC/Q,KAAK+P,SAASnQ,EAAGC,EAAGqR,GACpBlR,KAAK+P,SAASnQ,EAAIE,EAAQ,EAAGD,EAAGsR,GAChCnR,KAAK+P,SAASnQ,EAAGC,EAAIE,EAAS,EAAGsR,GACjCrR,KAAK+P,SAASnQ,EAAIE,EAAQ,EAAGD,EAAIE,EAAS,EAAGqR,GAG/CzR,cACIC,EAAWC,EAAWC,EAAeC,EAAgBkQ,EACrDC,GACFlQ,KAAKuR,QACD3R,EAAGC,EAAGC,EAAOC,EAAQyP,EAAA3C,MAAMuB,sBAC3BoB,EAAA3C,MAAMY,oBAAqB+B,EAAA3C,MAAMuB,sBACjCoB,EAAA3C,MAAMY,oBAAqB+B,EAAA3C,MAAMiC,iCACjCU,EAAA3C,MAAMkB,gCACNyB,EAAA3C,MAAMgC,8BACNW,EAAA3C,MAAMmB,+BAAgCiC,EAAIC,GAGhDvQ,cACIC,EAAWC,EAAWC,EAAeC,EAAgBkQ,EACrDC,GACFlQ,KAAKuR,QACD3R,EAAGC,EAAGC,EAAOC,EAAQyP,EAAA3C,MAAM8B,sBAC3Ba,EAAA3C,MAAMe,oBAAqB4B,EAAA3C,MAAM8B,sBACjCa,EAAA3C,MAAMe,oBAAqB4B,EAAA3C,MAAM0B,iCACjCiB,EAAA3C,MAAMgB,gCACN2B,EAAA3C,MAAMiB,8BACN0B,EAAA3C,MAAMyB,+BAAgC2B,EAAIC,GAGhDvQ,SACIC,EAAWC,EAAWC,EAAeC,EAAgBjC,EACrDmS,EAAYC,GACd,IAAK,IAAIS,EAAK9Q,EAAG8Q,EAAK9Q,EAAIE,EAAQ4Q,IAChC3Q,KAAK4Q,UAAUhR,EAAG+Q,EAAI7Q,EAAOhC,EAAGmS,EAAIC,GAIxCvQ,YACI6R,EAAcC,EAAcC,EAAqBC,EACjDC,EAAcC,EAAkBC,EAChCC,GACFA,EAAYA,GAAazC,EAAA7D,UAAUuG,KAEnC,IAAK,IAAInS,EAAI,EAAGA,EAAIiS,EAAWjS,IAC7B,IAAK,IAAID,EAAI,EAAGA,EAAIiS,EAAUjS,IAAK,CACjC,MAAMqS,EAAOP,EAAWQ,QAAQP,EAAO/R,EAAGgS,EAAO/R,GAC7CoS,GACFjS,KAAKmS,SAASX,EAAO5R,EAAG6R,EAAO5R,EAAGoS,EAAMF,IAMxCpS,SAASC,EAAWC,EAAWoS,EAAYF,GAC7CnS,GAAK,GAAKA,EAAII,KAAKF,OAASD,GAAK,GAAKA,EAAIG,KAAKD,QACjDC,KAAK0P,KAAK7P,GAAGD,GAAGuS,SAASF,EAAMF,oFChKrC9U,EAAAoD,MAAA,MAIEV,YAAYC,EAAWC,GACrBG,KAAKJ,EAAIA,EACTI,KAAKH,EAAIA,mFCDb5C,EAAAmV,OAAA,MAIEzS,YAAY0S,EAAoBC,GAC9BtS,KAAKqS,aAAeA,EACpBrS,KAAKsS,MAAQA,mFCXjB,MAAAhD,EAAA/R,EAAA,GACAmO,EAAAnO,EAAA,GACAgV,EAAAhV,EAAA,GAUAN,EAAA4S,KAAA,MAOElQ,YAAYqQ,EAA0BC,EAAYC,EAAYsC,GAE1DxS,KAAKgQ,cADUrP,IAAbqP,EAhBR,SAAyBA,GACvB,MAAyB,iBAAbA,GAA0BA,EAASK,OAAS,EAC/CL,EAASM,WAAW,GAEpBN,EAaWyC,CAAgBzC,GAEhB,IAAIM,WAAW,GAI/BtQ,KAAKiQ,QADItP,IAAPsP,EACQA,EAEAsC,EAAA5G,OAAOE,MAIjB7L,KAAKkQ,QADIvP,IAAPuP,EACQA,EAEAqC,EAAA5G,OAAOC,WAGNjL,IAAT6R,IACFxS,KAAKwS,KAAOA,GAGdxS,KAAK0S,OAAQ,EAGf/S,YAAYqQ,GACNhQ,KAAKgQ,WAAaA,IACpBhQ,KAAKgQ,SAAWA,EAChBhQ,KAAK0S,OAAQ,GAIjB/S,cAAcsQ,GACRA,SAAmCA,IAAOjQ,KAAKiQ,KACjDjQ,KAAKiQ,GAAKA,EACVjQ,KAAK0S,OAAQ,GAIjB/S,cAAcuQ,GACRA,SAAmCA,IAAOlQ,KAAKkQ,KACjDlQ,KAAKkQ,GAAKA,EACVlQ,KAAK0S,OAAQ,GAIjB/S,QAAQ6S,QACO7R,IAAT6R,IACFxS,KAAKwS,KAAOA,EACZxS,KAAK0S,OAAQ,GAIjB/S,SACIqQ,EAA8BC,EAAYC,EAAYsC,GAYxD,MAXwB,iBAAbxC,IACTA,EAAWA,EAASM,WAAW,IAET,iBAAbN,GACThQ,KAAK2S,YAAY3C,GACjBhQ,KAAK4S,cAAc3C,GACnBjQ,KAAK6S,cAAc3C,GACnBlQ,KAAK8S,QAAQN,IAEbxS,KAAKmS,SAASnC,EAAUV,EAAA7D,UAAUuG,MAE7BhS,KAAK0S,MAGd/S,SAASoT,EAAiBhB,GACxB,MAAMiB,EAAuB,IAAfD,EAAU7C,GAEpB6B,IAAczC,EAAA7D,UAAUuG,MAAQe,EAAU/C,SAAW,GACvDhQ,KAAK2S,YAAYI,EAAU/C,UAC3BhQ,KAAK4S,cAAcG,EAAU9C,KACpB+C,EAAQ,GAAKA,EAAQ,KAC9BhT,KAAK4S,cAAc5S,KAAKiT,YAAYjT,KAAKiQ,GAAI8C,EAAU7C,GAAI6B,IAGzDA,IAAczC,EAAA7D,UAAUuG,MAAkB,MAAVgB,EAClChT,KAAK6S,cAAcE,EAAU7C,IACpB8C,EAAQ,GACjBhT,KAAK6S,cAAc7S,KAAKiT,YAAYjT,KAAKkQ,GAAI6C,EAAU7C,GAAI6B,IAG7D/R,KAAK8S,QAAQC,EAAUP,MAGjB7S,YAAYuT,EAAWC,EAAWpB,GACxC,MACMqB,GAAM,KADO,IAALD,IACa,IACrBE,EAAK,EAAMD,EACXE,EAAMJ,GAAM,GAAM,IAClBK,EAAML,GAAM,GAAM,IAClBM,EAAMN,GAAM,EAAK,IACjBO,EAAMN,GAAM,GAAM,IAClBO,EAAMP,GAAM,GAAM,IAClBQ,EAAMR,GAAM,EAAK,IAEvB,OAAQpB,GACN,KAAKzC,EAAA7D,UAAUmI,MACb,OAAOlI,EAAAnL,QACF6S,EAAKE,EAAKD,EAAKI,EAAM,EAAIL,EAAKG,EAAKF,EAAKK,EAAM,EAC9CN,EAAKI,EAAKH,EAAKM,EAAM,GAE5B,KAAKrE,EAAA7D,UAAUoI,IACb,OAAOnI,EAAAnL,QACHP,KAAK8T,MAAOR,EAAKD,EAAKI,EAAM,GAAIzT,KAAK8T,MAAOP,EAAKF,EAAKK,EAAM,GAC5D1T,KAAK8T,MAAON,EAAKH,EAAKM,EAAM,IAElC,QACE,OAAOR,GAILxT,MAAMC,GACZ,OAAO4Q,KAAKuD,IAAI,IAAKnU,oFCxIzB,MAAaoU,EAOXrU,YACIsU,EAAaC,EAAmBC,EAAoBC,EACpDC,GACFrU,KAAKiU,IAAMA,EACXjU,KAAKkU,UAAYA,EACjBlU,KAAKmU,WAAaA,EAClBnU,KAAKoU,MAAQA,GAAS,EACtBpU,KAAKqU,YAAcA,GAdvBpX,EAAA+W,OAgDa/W,EAAAqX,aAAe,IAAIN,EAzBb,qoDAyB8B,EAAG,kFC5CpD/W,EAAAsX,YAAA,MAOE5U,YAAY6U,EAAgBC,EAAYC,GACtC1U,KAAKwU,OAASA,EACdxU,KAAKyU,KAAOA,EACZzU,KAAK0U,eAAiBA,EACtB1U,KAAK2U,MAAO,EACZ3U,KAAK4U,MAAQ,iJChBjBC,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,IAEAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,IACAsX,EAAAtX,EAAA,KACAsX,EAAAtX,EAAA,oFCZA,MAAMuX,EAAmB,CACvB,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,IAGZ,SAASC,EAAUC,EAAkBpV,EAAWC,GAC9C,MAAMmQ,EAAYgF,EAAQ9C,QAAQtS,EAAGC,GAAYmQ,SACjD,OAAOA,GAAY,KAAQA,GAAY,IAGzC,SAASiF,EAAWC,EAAYC,EAAehU,EAAclB,GAC3D,IAAK,IAAIxC,EAAI,EAAGA,EAAIqX,EAAiBzE,OAAQ5S,IAAK,CAChD,MAAMkS,EAAMmF,EAAiBrX,GAC7B,GAAIkS,EAAI,KAAOuF,GAAMvF,EAAI,KAAOwF,GAASxF,EAAI,KAAOxO,GAAQwO,EAAI,KAAO1P,EACrE,OAAO,IAAOxC,EAGlB,OAAO,EAGTR,EAAAmY,YAAA,SAA4BJ,GAC1B,IAAK,IAAInV,EAAI,EAAGA,EAAImV,EAAQjV,OAAQF,IAClC,IAAK,IAAID,EAAI,EAAGA,EAAIoV,EAAQlV,MAAOF,IACjC,GAAImV,EAAUC,EAASpV,EAAGC,GAAI,CAC5B,IAAIqV,EAAKrV,EAAI,GAAKkV,EAAUC,EAASpV,EAAGC,EAAI,GACxCsV,EAAQvV,EAAIoV,EAAQlV,MAAQ,GAAKiV,EAAUC,EAASpV,EAAI,EAAGC,GAC3DsB,EAAOtB,EAAImV,EAAQjV,OAAS,GAAKgV,EAAUC,EAASpV,EAAGC,EAAI,GAC3DI,EAAOL,EAAI,GAAKmV,EAAUC,EAASpV,EAAI,EAAGC,IAE1CqV,GAAOC,GAAUhU,GAASlB,IAC5BkB,GAAO,GAEJ+T,IAAMC,GAAUhU,GAASlB,IAC5BA,GAAO,GAEJiV,GAAOC,IAAShU,GAASlB,IAC5BiV,GAAK,GAEFA,GAAOC,GAAUhU,IAAQlB,IAC5BkV,GAAQ,GAGV,MAAMnF,EAAWiF,EAAWC,EAAK,EAAI,EAAGC,EAAQ,EAAI,EAAGhU,EAAO,EAAI,EAAGlB,EAAO,EAAI,GAEhF,IAAKiV,GAAMC,GAAShU,GAAQlB,MAAW+P,GAAY,KAAQA,GAAY,KACrE,MAAM,IAAIqF,MAAM,sBAGjBL,EAAQ9C,QAAQtS,EAAGC,GAAY8S,YAAY3C,oFC3FpD,MAAasF,EASX3V,YAAYC,EAAWC,GACrBG,KAAKJ,EAAIA,EACTI,KAAKH,EAAIA,EACTG,KAAKuV,SAAU,EACfvV,KAAKwV,SAAU,EACfxV,KAAKQ,EAAI,EACTR,KAAKa,EAAI,EACTb,KAAKyV,KAAO,MAhBhBxY,EAAAqY,UAoBArY,EAAAyY,OAAA,MAmBE/V,YACIG,EAAeC,EACf4V,GACF3V,KAAKF,MAAQA,EACbE,KAAKD,OAASA,EAEdC,KAAK0P,KAAO,IAAIlO,MAAMzB,GACtB,IAAK,IAAIF,EAAI,EAAGA,EAAIE,EAAQF,IAAK,CAC/BG,KAAK0P,KAAK7P,GAAK,IAAI2B,MAAM1B,GACzB,IAAK,IAAIF,EAAI,EAAGA,EAAIE,EAAOF,IACzBI,KAAK0P,KAAK7P,GAAGD,GAAK,IAAI0V,EAAQ1V,EAAGC,GAYrC,GARAG,KAAK4V,QAAU,EACf5V,KAAK6V,QAAU,EACf7V,KAAK8V,KAAO,EACZ9V,KAAK+V,KAAO,EACZ/V,KAAKgW,KAAO,EACZhW,KAAKiW,KAAO,EACZjW,KAAKkW,OAAS,EAEVP,EACF,IAAK,IAAI9V,EAAI,EAAGA,EAAIE,EAAQF,IAC1B,IAAK,IAAID,EAAI,EAAGA,EAAIE,EAAOF,IACzBI,KAAK0P,KAAK7P,GAAGD,GAAG2V,QAAUI,EAAY/V,EAAGC,GAMjDF,QAAQC,EAAWC,GACjB,OAAOG,KAAK0P,KAAK7P,GAAGD,GAGtBD,WAAWC,EAAWC,EAAW0V,GAC3B3V,GAAK,GAAKA,EAAII,KAAKF,OAASD,GAAK,GAAKA,EAAIG,KAAKD,SACjDC,KAAK0P,KAAK7P,GAAGD,GAAG2V,QAAUA,GAI9B5V,UAAUC,EAAWC,GACnB,QAAID,EAAI,GAAKA,GAAKI,KAAKF,OAASD,EAAI,GAAKA,GAAKG,KAAKD,SAG5CC,KAAK0P,KAAK7P,GAAGD,GAAG4V,QAMjB7V,eAAewW,EAAgBC,GACrC,MAAMC,EAAwB,GACxBC,EAAsB,GAC5B,IAII1W,EACAC,EACA0W,EACAC,EACAhB,EACAiB,EACAC,EACAC,EACAC,EACAC,EAbAC,EAAY,EACZC,EAAiB,EACjBC,EAAsB,EACtBC,EAAW,EAYf,IAAKpX,EAAIG,KAAK6V,QAAUO,EAAQvW,GAAKG,KAAKgW,MAAQnW,GAAKG,KAAKiW,KACvDpW,GAAKuW,EAAQY,EAAsBD,IAAkBD,EAGxD,IAFAP,EAAY,GAAMO,EAClBD,GAAoB,EACfL,EAAgBhG,KAAKC,MAAMwG,EAAWH,EAAY,IACnDlX,EAAII,KAAK4V,QAAWY,EAAgBL,EACnCK,GAAiBM,GAAalX,GAAKI,KAAK8V,MAAQlW,GAAKI,KAAK+V,KAC1DnW,GAAKuW,IAAUK,EAAeK,EAAmBD,EAAU,CAO9D,GANApB,GAAU,EACViB,GAAW,EAEXE,EAAaE,EACbD,GAFAF,EAAcF,EAAgBM,GAELP,EAErBS,EAAsB,EACxB,GAAMhX,KAAK0P,KAAK7P,EAAIuW,GAAQxW,GAAG4V,UACxBxV,KAAK0P,KAAK7P,EAAIuW,GAAQxW,GAAG2V,SAC1BvV,KAAK0P,KAAK7P,EAAIuW,GAAQxW,EAAIuW,GAAQX,UACjCxV,KAAK0P,KAAK7P,EAAIuW,GAAQxW,EAAIuW,GAAQZ,SAGvC,IAAK,IAAI2B,EAAM,EAAGA,EAAMF,GAAuBxB,IAAW0B,EACxD,GAAIP,GAAcL,EAAUY,IACxBN,GAAYP,EAAYa,GAC1B,GAAKlX,KAAK0P,KAAK7P,GAAGD,GAAG2V,QAMd,CACL,GAAIoB,GAAcN,EAAYa,IAC1BN,GAAYN,EAAUY,GAAM,CAC9B1B,GAAU,EACV,MAEAa,EAAYa,GAAO1G,KAAKuD,IAAIsC,EAAYa,GAAMP,GAC9CL,EAAUY,GAAO1G,KAAK2G,IAAIb,EAAUY,GAAMN,GAC1CH,GAAW,OAbb,GAAIC,EAAcL,EAAYa,IAC1BR,EAAcJ,EAAUY,GAAM,CAChC1B,GAAU,EACV,YATRA,GAAU,EA0BVA,IACFxV,KAAK0P,KAAK7P,GAAGD,GAAG4V,SAAU,EACtBxV,KAAK0P,KAAK7P,GAAGD,GAAG2V,UACd0B,GAAYN,EACdM,EAAWL,EACDH,IACVJ,EAAYU,GAAkBJ,EAC9BL,EAAUS,KAAoBH,MAWlCjX,eAAewW,EAAgBC,GACrC,MAAMC,EAAwB,GACxBC,EAAsB,GAC5B,IAII1W,EACAC,EACA0W,EACAC,EACAhB,EACAiB,EACAC,EACAC,EACAC,EACAC,EAbAC,EAAY,EACZC,EAAiB,EACjBC,EAAsB,EACtBC,EAAW,EAYf,IAAKrX,EAAII,KAAK4V,QAAUO,EAAQvW,GAAKI,KAAK8V,MAAQlW,GAAKI,KAAK+V,KACvDnW,GAAKuW,EAAQa,EAAsBD,IAAkBD,EAGxD,IAFAP,EAAY,GAAMO,EAClBD,GAAoB,EACfL,EAAgBhG,KAAKC,MAAMwG,EAAWH,EAAY,IACnDjX,EAAIG,KAAK6V,QAAWW,EAAgBJ,EACnCI,GAAiBM,GAAajX,GAAKG,KAAKgW,MAAQnW,GAAKG,KAAKiW,KAC1DpW,GAAKuW,IAAUI,EAAeK,EAAmBD,EAAU,CAO9D,GANApB,GAAU,EACViB,GAAW,EAEXE,EAAaE,EACbD,GAFAF,EAAcF,EAAgBM,GAELP,EAErBS,EAAsB,EACxB,GAAMhX,KAAK0P,KAAK7P,GAAGD,EAAIuW,GAAQX,UACxBxV,KAAK0P,KAAK7P,GAAGD,EAAIuW,GAAQZ,SAC1BvV,KAAK0P,KAAK7P,EAAIuW,GAAQxW,EAAIuW,GAAQX,UACjCxV,KAAK0P,KAAK7P,EAAIuW,GAAQxW,EAAIuW,GAAQZ,SAGvC,IAAK,IAAI2B,EAAM,EAAGA,EAAMF,GAAuBxB,IAAW0B,EACxD,GAAIP,GAAcL,EAAUY,IACxBN,GAAYP,EAAYa,GAC1B,GAAKlX,KAAK0P,KAAK7P,GAAGD,GAAG2V,QAMd,CACL,GAAIoB,GAAcN,EAAYa,IAC1BN,GAAYN,EAAUY,GAAM,CAC9B1B,GAAU,EACV,MAEAa,EAAYa,GAAO1G,KAAKuD,IAAIsC,EAAYa,GAAMP,GAC9CL,EAAUY,GAAO1G,KAAK2G,IAAIb,EAAUY,GAAMN,GAC1CH,GAAW,OAbb,GAAIC,EAAcL,EAAYa,IAC1BR,EAAcJ,EAAUY,GAAM,CAChC1B,GAAU,EACV,YATRA,GAAU,EA0BVA,IACFxV,KAAK0P,KAAK7P,GAAGD,GAAG4V,SAAU,EACtBxV,KAAK0P,KAAK7P,GAAGD,GAAG2V,UACd0B,GAAYN,EACdM,EAAWL,EACDH,IACVJ,EAAYU,GAAkBJ,EAC9BL,EAAUS,KAAoBH,MAQ1CjX,WAAWiW,EAAiBC,EAAiBK,GAC3C,IAAK,IAAIrW,EAAI,EAAGA,EAAIG,KAAKD,OAAQF,IAC/B,IAAK,IAAID,EAAI,EAAGA,EAAII,KAAKF,MAAOF,IAC9BI,KAAK0P,KAAK7P,GAAGD,GAAG4V,SAAU,EAI9BxV,KAAK0P,KAAKmG,GAASD,GAASJ,SAAU,EACtCxV,KAAK4V,QAAUA,EACf5V,KAAK6V,QAAUA,EACf7V,KAAKkW,OAASA,EACdlW,KAAK8V,KAAOtF,KAAK2G,IAAI,EAAGvB,EAAUM,GAClClW,KAAKgW,KAAOxF,KAAK2G,IAAI,EAAGtB,EAAUK,GAClClW,KAAK+V,KAAOvF,KAAKuD,IAAI/T,KAAKF,MAAQ,EAAG8V,EAAUM,GAC/ClW,KAAKiW,KAAOzF,KAAKuD,IAAI/T,KAAKD,OAAS,EAAG8V,EAAUK,GAEhDlW,KAAKoX,eAAe,EAAG,GACvBpX,KAAKqX,eAAe,EAAG,GACvBrX,KAAKoX,eAAe,GAAI,GACxBpX,KAAKqX,eAAe,GAAI,GACxBrX,KAAKoX,gBAAgB,EAAG,GACxBpX,KAAKqX,gBAAgB,EAAG,GACxBrX,KAAKoX,gBAAgB,GAAI,GACzBpX,KAAKqX,gBAAgB,GAAI,oFCpR7B,MAAAC,EAAA/Z,EAAA,IAMAN,EAAAsa,IAAA,MAKE5X,YAAY6X,EAAoBC,GAC9BzX,KAAKwX,SAAWA,EAChBxX,KAAKyX,SAAWA,GAAY,IAAIH,EAAAI,sBAChC1X,KAAK2X,QAAU,GAGjBhY,IAAI6U,GACFxU,KAAK2X,QAAQ/H,KAAK5P,KAAKyX,SAASG,SAAS5X,KAAKwX,SAAUhD,IAG1D7U,cACE,GAA4B,IAAxBK,KAAK2X,QAAQtH,OACf,OAAO,EAGT,MAAMwH,EAAc7X,KAAK2X,QAAQtH,OAAS,EACpCyH,EAAc9X,KAAK2X,QAAQ3X,KAAK2X,QAAQtH,OAAS,GAMvD,OALqByH,EAAYtD,OAChBuD,YAAY/X,KAAKwX,SAAUM,EAAYpD,iBACtD1U,KAAK2X,QAAQK,OAAOH,EAAa,IAG5B,EAGTlY,OACE,IAAK,IAAIlC,EAAI,EAAGA,EAAIuC,KAAK2X,QAAQtH,OAAQ5S,IACvCuC,KAAKyX,SAASQ,KAAKjY,KAAKwX,SAAUxX,KAAK2X,QAAQla,qFCtCrD,MAAA8U,EAAAhV,EAAA,GACAkC,EAAAlC,EAAA,GACA2a,EAAA3a,EAAA,GAKA4a,EAAA5a,EAAA,IAEAN,EAAAya,sBAAA,MACE/X,SAAS6X,EAAoBhD,GAC3B,MAAM1U,EAAQ0U,EAAOnC,aAAavS,MAAQ,EACpCC,EAASyU,EAAOnC,aAAatS,OAAS,EACtCH,GAAM4X,EAAS1X,MAAQA,GAAS,EAAK,EACrCD,GAAM2X,EAASzX,OAASA,GAAU,EAAK,EAC7C,OAAO,IAAIoY,EAAA5D,YACPC,EAAQ,IAAI0D,EAAAxY,KAAKE,EAAGC,EAAGC,EAAOC,GAAS,IAAIN,EAAAY,MAAMT,EAAI,EAAGC,EAAI,IAGlEF,KAAKyY,EAAgBC,GACnB,MAAM7D,EAAS6D,EAAY7D,QACrB5U,EAACA,EAACC,EAAEA,EAACC,MAAEA,EAAKC,OAAEA,GAAUsY,EAAY5D,KAC1C2D,EAAK9G,SAAS1R,EAAGC,EAAGC,EAAOC,EAAQ,EAAGwS,EAAA5G,OAAOE,MAAO0G,EAAA5G,OAAOC,OAC3DwM,EAAKE,cAAc1Y,EAAGC,EAAGC,EAAOC,GAChCqY,EAAKG,mBAAmB3Y,EAAKE,EAAQ,EAAK,EAAGD,EAAG,IAAM2U,EAAOlC,MAAQ,KACrEkC,EAAOgE,aAAaJ,EAAMC,EAAY3D,iGCxB1C,MAAA+D,EAAAlb,EAAA,GAEA2a,EAAA3a,EAAA,GAGAmb,EAAAnb,EAAA,GAEAN,EAAA0b,cAAA,cAAmCD,EAAAtG,OAGjCzS,YAAY2S,EAAesG,GACzB,MAAMC,EAAQD,EAAQE,MAAM,MAC5B,IAAIhZ,EAAQwS,EAAMjC,OAClB,IAAK,IAAI5S,EAAI,EAAGA,EAAIob,EAAMxI,OAAQ5S,IAChCqC,EAAQ0Q,KAAK2G,IAAIrX,EAAO+Y,EAAMpb,GAAG4S,QAGnC,MAAMtQ,EAAS8Y,EAAMxI,OAErB0I,MADa,IAAIb,EAAAxY,KAAK,EAAG,EAAGI,EAAOC,GACvBuS,GACZtS,KAAK6Y,MAAQA,EAGflZ,aAAaqV,EAAkBgE,GAC7B,IAAK,IAAIvb,EAAI,EAAGA,EAAIuC,KAAK6Y,MAAMxI,OAAQ5S,IACrCuX,EAAQzE,WAAWyI,EAAOpZ,EAAGoZ,EAAOnZ,EAAIpC,EAAGuC,KAAK6Y,MAAMpb,IAI1DkC,YAAY6X,EAAoBwB,GAC9B,OAAOxB,EAASyB,aAAaR,EAAApX,KAAKsB,4FC9BtC,MAAA8V,EAAAlb,EAAA,GAEA2a,EAAA3a,EAAA,GAGAmb,EAAAnb,EAAA,GAEAN,EAAAic,aAAA,cAAkCR,EAAAtG,OAIhCzS,YACI2S,EAAe6G,EAAmBC,GACpC,IAAItZ,EAAQwS,EAAMjC,OAClB,IAAK,IAAI5S,EAAI,EAAGA,EAAI0b,EAAQ9I,OAAQ5S,IAClCqC,EAAQ0Q,KAAK2G,IAAIrX,EAAOqZ,EAAQ1b,GAAG4S,OAAS,GAG9C,MAAMtQ,EAASoZ,EAAQ9I,OAEvB0I,MADa,IAAIb,EAAAxY,KAAK,EAAG,EAAGI,EAAOC,GACvBuS,GACZtS,KAAKmZ,QAAUA,EACfnZ,KAAKoZ,SAAWA,EAGlBzZ,aAAaqV,EAAkBgE,GAC7B,IAAK,IAAIvb,EAAI,EAAGA,EAAIuC,KAAKmZ,QAAQ9I,OAAQ5S,IAAK,CAC5C,MAAM2S,EAAMiJ,OAAOC,aAAa,GAAK7b,GAAK,MAAQuC,KAAKmZ,QAAQ1b,GAC/DuX,EAAQzE,WAAWyI,EAAOpZ,EAAGoZ,EAAOnZ,EAAIpC,EAAG2S,IAI/CzQ,YAAY6X,EAAoBwB,GAC9B,IAAK,IAAIvb,EAAI,EAAGA,EAAIuC,KAAKmZ,QAAQ9I,OAAQ5S,IACvC,GAAI+Z,EAASyB,aAAaR,EAAApX,KAAKoD,KAAOhH,GAEpC,OADAuC,KAAKoZ,SAAS3b,IACP,EAGX,OAAO+Z,EAASyB,aAAaR,EAAApX,KAAKsB,4FCvCtC,MAAA6M,EAAAjS,EAAA,GACAmO,EAAAnO,EAAA,GACAgc,EAAAhc,EAAA,GAKMic,EAAW,CACf,CAACxJ,SAAUR,EAAA3C,MAAMkC,eAAgB0K,OAAQ,CAAC,EAAG,EAAG,EAAG,IACnD,CAACzJ,SAAUR,EAAA3C,MAAMmC,gBAAiByK,OAAQ,CAAC,EAAG,EAAG,EAAG,IACpD,CAACzJ,SAAUR,EAAA3C,MAAMoC,eAAgBwK,OAAQ,CAAC,EAAG,EAAG,EAAG,IACnD,CAACzJ,SAAUR,EAAA3C,MAAMqC,kBAAmBuK,OAAQ,CAAC,EAAG,EAAG,EAAG,IACtD,CAACzJ,SAAUR,EAAA3C,MAAMsC,mBAAoBsK,OAAQ,CAAC,EAAG,EAAG,EAAG,IACvD,CAACzJ,SAAUR,EAAA3C,MAAMuC,iBAAkBqK,OAAQ,CAAC,EAAG,EAAG,EAAG,IACrD,CAACzJ,SAAUR,EAAA3C,MAAMwC,cAAeoK,OAAQ,CAAC,EAAG,EAAG,EAAG,KA2CpD,SAASC,EAAaC,GACpB,MAAMC,EAASC,SAASC,cAAc,UACtCF,EAAO9Z,MAAQ6Z,EAAI7Z,MACnB8Z,EAAO7Z,OAAS4Z,EAAI5Z,OAEpB,MAAMga,EAAMH,EAAOI,WAAW,MAG9B,OAFAD,EAAIE,UAAUN,EAAK,EAAG,GAEfI,EAAIL,aAAa,EAAG,EAAGC,EAAI7Z,MAAO6Z,EAAI5Z,QAAQma,KAGvD,SAASC,EACLC,EAAcF,EAAyBta,EAAWC,EAAWwa,GAE/D,MAAMC,EAAK,GAAKza,EAAIwa,EAAIza,GAMlB2a,EAAK,GAAK1a,EAAIwa,EAAIza,EAAI,GAMtB4a,EAAK,IAAM3a,EAAI,GAAKwa,EAAIza,GAMxB6a,EAAK,IAAM5a,EAAI,GAAKwa,EAAIza,EAAI,GAK5B8a,EAAS,CAAC,CAtBLR,EAAKI,GACLJ,EAAKI,EAAK,GACVJ,EAAKI,EAAK,IAoBS,CAhBnBJ,EAAKK,GACLL,EAAKK,EAAK,GACVL,EAAKK,EAAK,IAcuB,CAVjCL,EAAKM,GACLN,EAAKM,EAAK,GACVN,EAAKM,EAAK,IAQqC,CAJ/CN,EAAKO,GACLP,EAAKO,EAAK,GACVP,EAAKO,EAAK,KAOrB,IAAIE,EAAWC,OAAOC,UAClBC,EAAe,EACfC,EAAS,KACTC,EAAS,KAEb,IAAK,IAAIvd,EAAI,EAAGA,EAAI+b,EAASnJ,OAAQ5S,IAAK,CACxC,MAAMwd,EAAUzB,EAAS/b,GACnByd,EAAgBC,EAAcF,EAAQxB,OAAQiB,GAChDQ,EAAcE,MAAQT,IACxBA,EAAWO,EAAcE,MACzBN,EAAeG,EAAQjL,SACvB+K,EAASG,EAAchL,GACvB8K,EAASE,EAAcjL,IAI3BmK,EAAIrK,SACAnQ,EAAI,EAAGC,EAAI,EAAGib,EAAcO,EAAaL,GACzCK,EAAaN,IAGnB,SAASI,EAAcF,EAAmBP,GACxC,MAAMY,EAAM,CAAC,CAAC,EAAG,EAAG,GAAI,CAAC,EAAG,EAAG,IACzBC,EAAM,CAAC,CAAC,EAAG,EAAG,GAAI,CAAC,EAAG,EAAG,IACzB3G,EAAQ,CAAC,EAAG,GAElB,IAAK,IAAInX,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAK,IAAI+d,EAAI,EAAGA,EAAI,EAAGA,IACrBF,EAAIL,EAAQxd,IAAI+d,IAAMd,EAAOjd,GAAG+d,GAElC5G,EAAMqG,EAAQxd,MAGhB,IAAK,IAAIA,EAAI,EAAGA,EAAI,EAAGA,IACrB,IAAK,IAAI+d,EAAI,EAAGA,EAAI,EAAGA,IACrBD,EAAI9d,GAAG+d,GAAKF,EAAI7d,GAAG+d,GAAK5G,EAAMnX,GAIlC,IAAI2d,EAAQ,EAEZ,IAAK,IAAI3d,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAIge,EAAY,EAChB,IAAK,IAAID,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAME,EAAQhB,EAAOjd,GAAG+d,GAAKD,EAAIN,EAAQxd,IAAI+d,GAC7CC,GAAaC,EAAQA,EAEvBN,GAAS5K,KAAKmL,KAAKF,GAGrB,MAAO,CAACvL,GAAIqL,EAAI,GAAItL,GAAIsL,EAAI,GAAIH,SAGlC,SAASC,EAAaO,GACpB,OAAOlQ,EAAAnL,QAAQqb,EAAI,GAAIA,EAAI,GAAIA,EAAI,IAxIrC3e,EAAA4e,UAAA,SAA0B5H,EAAamF,GACrC,MAAMO,EAAM,IAAImC,MAChBnC,EAAIoC,OAAS,MACX,MAAM1B,EAAIV,EAAI7Z,MACRe,EAAI8Y,EAAI5Z,OACRma,EAAOR,EAAaC,GACpBqC,EAAS,IAAIzC,EAAA9J,QAAQ4K,EAAGxZ,GAC9B,IAAIpD,EAAI,EAER,IAAK,IAAIoC,EAAI,EAAGA,EAAIgB,EAAGhB,IACrB,IAAK,IAAID,EAAI,EAAGA,EAAIya,EAAGza,IACRoc,EAAO9J,QAAQtS,EAAGC,GAC1BgT,cAAcnH,EAAAnL,QAAQ2Z,EAAKzc,KAAMyc,EAAKzc,KAAMyc,EAAKzc,KAAMyc,EAAKzc,OAIrE2b,EAAS4C,KAEXrC,EAAIsC,IAAMhI,GAGZhX,EAAAif,YAAA,SAA4BjI,EAAamF,GACvC,MAAMO,EAAM,IAAImC,MAChBnC,EAAIoC,OAAS,MACX,MAAM1B,EAAIV,EAAI7Z,MACRe,EAAI8Y,EAAI5Z,OACRma,EAAOR,EAAaC,GACpBqC,EAAS,IAAIzC,EAAA9J,QAAQ4K,EAAI,EAAGxZ,EAAI,GAEtC,IAAK,IAAIhB,EAAI,EAAGA,EAAIgB,EAAGhB,GAAK,EAC1B,IAAK,IAAID,EAAI,EAAGA,EAAIya,EAAGza,GAAK,EAC1Bua,EAAQ6B,EAAQ9B,EAAMta,EAAGC,EAAGwa,GAIhCjB,EAAS4C,KAEXrC,EAAIsC,IAAMhI,kFCpDZ,MAAMkI,EAAM,EAAE,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,GAC/BC,EAAM,EAAE,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAC/BC,EAAQ,CAAC,IAAK,EAAG,IAAK,EAAG,EAAG,IAAK,EAAG,KAsD1C,SAASC,EAAWtb,GAClB,IAAIub,EAAW,KACXC,GAAa,EACbC,EAAUC,IAEd,IAAK,IAAIjf,EAAI,EAAGA,EAAIuD,EAAEqP,OAAQ5S,IAAK,CACjC,MAAMwU,EAAOjR,EAAEvD,GACXwU,EAAKzR,IAAMkc,KAAYzK,EAAKzR,EAAIyR,EAAKpR,EAAI4b,IAC3CF,EAAWtK,EACXuK,EAAY/e,EACZgf,EAAUxK,EAAKzR,EAAIyR,EAAKpR,GAK5B,OADAG,EAAEgX,OAAOwE,EAAW,GACbD,EAGT,SAASI,EAAU1K,GACjB,MAAM+J,EAAS,GACf,IAAIY,EAAqB3K,EACzB,KAAO2K,GACLZ,EAAOpM,KAAKgN,GACZA,EAAOA,EAAKnH,KAGd,OADAuG,EAAOa,UACAb,EAtET/e,EAAA6f,YAAA,SACIC,EAAaC,EAAeC,EAAaC,IAgC7C,SAAuBH,EAAaE,GAClC,IAAK,IAAIpd,EAAI,EAAGA,EAAIkd,EAAIhd,OAAQF,IAC9B,IAAK,IAAID,EAAI,EAAGA,EAAImd,EAAIjd,MAAOF,IAAK,CAClC,MAAMqS,EAAO8K,EAAIrN,KAAK7P,GAAGD,GACzBqS,EAAKzR,EAAIkc,IACTzK,EAAKpR,EAAI2P,KAAKuD,IAAIvD,KAAK2M,IAAIvd,EAAIqd,EAAKrd,GAAI4Q,KAAK2M,IAAItd,EAAIod,EAAKpd,IAC1DoS,EAAKwD,KAAO,MArChB2H,CAAcL,EAAKE,GAEnB,MAAMI,EAAaN,EAAIrN,KAAKsN,EAAOnd,GAAGmd,EAAOpd,GAC7Cyd,EAAW7c,EAAI,EAEf,MAAMQ,EAAe,CAACqc,GAEtB,KAAOrc,EAAEqP,OAAS,GAAG,CACnB,MAAMiN,EAAIhB,EAAWtb,GAErB,GAAIsc,EAAE1d,IAAMqd,EAAKrd,GAAK0d,EAAEzd,IAAMod,EAAKpd,EACjC,OAAO8c,EAAUW,GAGnB,IAAK,IAAI7f,EAAI,EAAGA,EAAI0e,EAAI9L,OAAQ5S,IAAK,CACnC,MAAMmC,EAAI0d,EAAE1d,EAAIuc,EAAI1e,GACdoC,EAAIyd,EAAEzd,EAAIuc,EAAI3e,GACpB,GAAImC,GAAK,GAAKA,EAAImd,EAAIjd,OAASD,GAAK,GAAKA,EAAIkd,EAAIhd,OAAQ,CACvD,MAAMe,EAAIic,EAAIrN,KAAK7P,GAAGD,GAChB2d,EAAMD,EAAE9c,EAAI6b,EAAM5e,GACpB8f,EAAMzc,EAAEN,GAAK+c,GAAOL,IAAYH,EAAIrN,KAAK7P,GAAGD,GAAG2V,UACjDzU,EAAEN,EAAI+c,EACNzc,EAAE2U,KAAO6H,EACTtc,EAAE4O,KAAK9O,MAKf,OAAO,qFCvCT7D,EAAAugB,IAAA,MAWE7d,YAAY8d,GAEVzd,KAAKnC,EAAI,WACTmC,KAAKU,EAAI,WACTV,KAAKlC,EAAI,MACTkC,KAAK4B,MAAQ6b,GAAQ,EAGf9d,UAEN,OADAK,KAAK4B,OAAS5B,KAAKU,EAAIV,KAAK4B,MAAQ5B,KAAKlC,GAAKkC,KAAKnC,EAC5CmC,KAAK4B,MAMdjC,YAEE,OAAOK,KAAK0d,WAAa1d,KAAKnC,EAAI,GAQpC8B,UAAUge,EAAeC,GAGvB,MAAMC,EAAYD,EAAMD,EAExB,OAAOA,GADc3d,KAAK0d,UAAY1d,KAAKnC,EACXggB,EAAa,GAG/Cle,YAAYme,GACV,MAAMC,EAAQD,EAAQE,OAAO,CAACtd,EAAGD,IAAMC,EAAID,GACrCwd,EAAOje,KAAKke,UAAU,EAAGH,EAAQ,GACvC,IAAII,EAAe,EAEnB,IAAK,IAAI1gB,EAAI,EAAGA,EAAIqgB,EAAQzN,OAAQ5S,IAElC,GAAIwgB,IADJE,GAAgBL,EAAQrgB,IAEtB,OAAOA,EAIX,OAAOqgB,EAAQzN,OAAS,EAG1B1Q,UAAUye,GACR,MAAMC,EAAmB,GACnBP,EAAoB,GAE1B,IAAK,MAAM1e,KAAYgf,EACjBA,EAAW9e,eAAeF,KAC5Bif,EAAOzO,KAAKxQ,GACZ0e,EAAQlO,KAAKwO,EAAWhf,KAI5B,OAAOif,EAAOre,KAAKse,YAAYR,qFC5EnC,MAAAvE,EAAAhc,EAAA,GACAghB,EAAAhhB,EAAA,IACAkb,EAAAlb,EAAA,GACAihB,EAAAjhB,EAAA,IACAkhB,EAAAlhB,EAAA,IAUA,SAASmhB,EAAYjhB,EAAW0Z,GAC9B,OAAqB1Z,EAAI0Z,EAAX,EAAN,EAGV,MAAMwH,EAAmC,CACvCC,KAAML,EAAAjK,aACNuK,mBAAmB,GAGrB5hB,EAAA6hB,SAAA,cAA8BvF,EAAA9J,QA4B5B9P,YACIia,EAA2B9Z,EAAeC,EAC1CoZ,GACFJ,MAAMjZ,EAAOC,GAEboZ,EAAUA,GAAWwF,EAErB3e,KAAK4Z,OAASA,EACd5Z,KAAK4e,KAAOzF,EAAQyF,MAAQL,EAAAjK,aAC5BtU,KAAK+e,WAAajf,EAAQE,KAAK4e,KAAK1K,UACpClU,KAAKgf,YAAcjf,EAASC,KAAK4e,KAAKzK,WAEtCyF,EAAO9Z,MAAQE,KAAK+e,WACpBnF,EAAO7Z,OAASC,KAAKgf,YACrBpF,EAAOqF,MAAMnf,MAASE,KAAK4e,KAAKxK,MAAQpU,KAAK+e,WAAc,KAC3DnF,EAAOqF,MAAMlf,OAAUC,KAAK4e,KAAKxK,MAAQpU,KAAKgf,YAAe,KAE7DpF,EAAOqF,MAAMC,QAAU,OACvBtF,EAAOuF,SAAW,EAElBnf,KAAKuB,KAAO,IAAIkX,EAAApX,KAAKuY,GACrB5Z,KAAKof,MAAQ,IAAIZ,EAAAa,MAAMrf,KAAMmZ,GAG7B,MAAMmG,EAAK1F,EAAOI,WAAW,QAAS,CAACuF,WAAW,IAClD,IAAKD,EACH,MAAM,IAAIjK,MACN,gEAGN,MAAMmK,EAAUF,EAAGG,gBACnB,IAAKD,EACH,MAAM,IAAInK,MACN,gEAGNrV,KAAKsf,GAAKA,EACVtf,KAAKwf,QAAUA,EAEfF,EAAGI,aACCF,EAASxf,KAAK2f,YAAYL,EAAGM,cAAenB,EAAAoB,uBAChDP,EAAGI,aACCF,EAASxf,KAAK2f,YAAYL,EAAGQ,gBAAiBrB,EAAAsB,yBAClDT,EAAGU,YAAYR,GACfF,EAAGW,WAAWT,GAEVxf,KAAK4e,KAAKvK,WAGZiL,EAAGY,UAAUZ,EAAGa,mBAAmBX,EAAS,KAAM,GAGpDxf,KAAKogB,uBAAyBpgB,KAAKqgB,kBAAkB,KACrDrgB,KAAKsgB,sBAAwBtgB,KAAKqgB,kBAAkB,KACpDrgB,KAAKugB,sBAAwBvgB,KAAKqgB,kBAAkB,KACpDrgB,KAAKwgB,sBAAwBxgB,KAAKqgB,kBAAkB,KAEpD,MAAMI,EAAY3gB,EAAQC,EAC1BC,KAAK0gB,eAAiB,IAAIC,aAAyB,EAAZF,EAAgB,GACvDzgB,KAAK4gB,WAAa,IAAIC,YAAwB,EAAZJ,GAClCzgB,KAAK8gB,aAAe,IAAIH,aAAyB,EAAZF,EAAgB,GACrDzgB,KAAK+gB,qBAAuB,IAAIC,WAAuB,EAAZP,EAAgB,GAC3DzgB,KAAKihB,mBAAqB,IAAIC,SAASlhB,KAAK+gB,qBAAqBI,QACjEnhB,KAAKohB,qBAAuB,IAAIJ,WAAuB,EAAZP,EAAgB,GAC3DzgB,KAAKqhB,mBAAqB,IAAIH,SAASlhB,KAAKohB,qBAAqBD,QAGjE,IAAI1jB,EAAI,EACJ+d,EAAI,EACJ8F,EAAI,EACR,IAAK,IAAIzhB,EAAI,EAAGA,EAAIE,EAAQF,IAC1B,IAAK,IAAID,EAAI,EAAGA,EAAIE,EAAOF,IAEzBI,KAAK0gB,eAAejjB,KAAOihB,EAAY9e,EAAGE,GAC1CE,KAAK0gB,eAAejjB,MAAQihB,EAAY7e,EAAGE,GAG3CC,KAAK0gB,eAAejjB,KAAOihB,EAAY9e,EAAI,EAAGE,GAC9CE,KAAK0gB,eAAejjB,MAAQihB,EAAY7e,EAAGE,GAG3CC,KAAK0gB,eAAejjB,KAAOihB,EAAY9e,EAAI,EAAGE,GAC9CE,KAAK0gB,eAAejjB,MAAQihB,EAAY7e,EAAI,EAAGE,GAG/CC,KAAK0gB,eAAejjB,KAAOihB,EAAY9e,EAAGE,GAC1CE,KAAK0gB,eAAejjB,MAAQihB,EAAY7e,EAAI,EAAGE,GAE/CC,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAC3BthB,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAC3BthB,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAC3BthB,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAC3BthB,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAC3BthB,KAAK4gB,WAAWpF,KAAO8F,EAAI,EAE3BA,GAAK,EAITthB,KAAKuhB,eAAiBjC,EAAGkC,eACzBxhB,KAAKyhB,YAAcnC,EAAGkC,eACtBxhB,KAAK0hB,cAAgBpC,EAAGkC,eACxBxhB,KAAK2hB,iBAAmBrC,EAAGkC,eAC3BxhB,KAAK4hB,iBAAmBtC,EAAGkC,eAE3BlC,EAAGuC,WAAWvC,EAAGwC,aAAc9hB,KAAKuhB,gBACpCjC,EAAGyC,WAAWzC,EAAGwC,aAAc9hB,KAAK0gB,eAAgBpB,EAAG0C,aAEvD1C,EAAGuC,WAAWvC,EAAG2C,qBAAsBjiB,KAAKyhB,aAC5CnC,EAAGyC,WAAWzC,EAAG2C,qBAAsBjiB,KAAK4gB,WAAYtB,EAAG0C,aAE3DhiB,KAAKkiB,QAAUliB,KAAKmiB,YAAYniB,KAAK4e,KAAK3K,KAE1CjU,KAAKoiB,aAGCziB,kBAAkB3B,GACxB,MAAMqkB,EAAWriB,KAAKsf,GAAGe,kBAAkBrgB,KAAKwf,QAASxhB,GAEzD,OADAgC,KAAKsf,GAAGgD,wBAAwBD,GACzBA,EAGT1iB,QACE,IAAI4iB,EAAoB,EACpBC,EAAkB,EAEtB,IAAK,IAAI3iB,EAAI,EAAGA,EAAIG,KAAKD,OAAQF,IAC/B,IAAK,IAAID,EAAI,EAAGA,EAAII,KAAKF,MAAOF,IAAK,CACnC,MAAMqS,EAAOjS,KAAKkS,QAAQtS,EAAGC,GAE7B,IAAKoS,EAAKS,MAAO,CACf6P,GAAqB,EACrBC,GAAmB,GACnB,SAGF,MAAMC,EAAYxQ,EAAKjC,SAAW,GAC5B0S,EAAazQ,EAAKjC,SAAW,GAAM,EAEzChQ,KAAK8gB,aAAayB,KAAuBE,EACzCziB,KAAK8gB,aAAayB,KAAuBG,EAEzC1iB,KAAK8gB,aAAayB,KAAuBE,EAAW,EACpDziB,KAAK8gB,aAAayB,KAAuBG,EAEzC1iB,KAAK8gB,aAAayB,KAAuBE,EAAW,EACpDziB,KAAK8gB,aAAayB,KAAuBG,EAAW,EAEpD1iB,KAAK8gB,aAAayB,KAAuBE,EACzCziB,KAAK8gB,aAAayB,KAAuBG,EAAW,EAEpD,IAAK,IAAIjlB,EAAI,EAAGA,EAAI,EAAGA,IACrBuC,KAAKihB,mBAAmB0B,UAAUH,EAAiBvQ,EAAKhC,IAAI,GAC5DjQ,KAAKqhB,mBAAmBsB,UAAUH,EAAiBvQ,EAAK/B,IAAI,GAC5DsS,GAAmB,EAGrBvQ,EAAKS,OAAQ,GAKnB/S,UAAUoC,GACR,MAAM/C,EAAMgB,KAAKuB,KAAKqhB,OAAO7gB,GAC7B,OAAO/C,GAAOA,EAAImC,KAGpBxB,aAAaoC,GACX,MAAM/C,EAAMgB,KAAKuB,KAAKqhB,OAAO7gB,GACvB6S,EAAQ5V,EAAMA,EAAIoC,UAAY,EACpC,OAAiB,IAAVwT,GAAgBA,EAAQ,IAAMA,EAAQ,GAAM,EAGrDjV,gBAAgBoC,GACd,MAAM/C,EAAMgB,KAAKuB,KAAKqhB,OAAO7gB,GAC7B,OAAO/C,EAAMA,EAAIoC,UAAY,EAGvBzB,YAAYkjB,EAAa7F,GAC/B,MAAMsC,EAAKtf,KAAKsf,GACVwD,EAAKxD,EAAGyD,aAAaF,GAC3B,IAAKC,EACH,MAAM,IAAIzN,MAAM,4CAIlB,GAFAiK,EAAG0D,aAAaF,EAAI9F,GACpBsC,EAAG2D,cAAcH,IACZxD,EAAG4D,mBAAmBJ,EAAIxD,EAAG6D,gBAChC,MAAM,IAAI9N,MACN,2CAA6CiK,EAAG8D,iBAAiBN,IAEvE,OAAOA,EAQDnjB,YAAYsU,GAClB,MAAMqL,EAAKtf,KAAKsf,GACV4C,EAAU5C,EAAG+D,gBACnB/D,EAAGgE,YAAYhE,EAAGiE,WAAYrB,GAO9B,MACMsB,EAAiBlE,EAAGmE,KAIpBC,EAAYpE,EAAGmE,KACfE,EAAUrE,EAAGsE,cACbC,EAAQ,IAAI7C,WAAW,CAAC,EAAG,EAAG,EAAG,MACvC1B,EAAGwE,WACCxE,EAAGiE,WATO,EASYC,EAPZ,EACC,EACA,EAKkDE,EAC7DC,EAASE,GAEb,MAAME,EAAQ,IAAIjI,MAYlB,OAXAiI,EAAMhI,OAAS,MACbuD,EAAGgE,YAAYhE,EAAGiE,WAAYrB,GAC9B5C,EAAGwE,WACCxE,EAAGiE,WAhBK,EAgBcC,EAAgBE,EAAWC,EAASI,GAC9DzE,EAAG0E,cAAc1E,EAAGiE,WAAYjE,EAAG2E,eAAgB3E,EAAG4E,eACtD5E,EAAG0E,cAAc1E,EAAGiE,WAAYjE,EAAG6E,eAAgB7E,EAAG4E,eACtD5E,EAAG0E,cAAc1E,EAAGiE,WAAYjE,EAAG8E,mBAAoB9E,EAAG+E,QAC1D/E,EAAG0E,cAAc1E,EAAGiE,WAAYjE,EAAGgF,mBAAoBhF,EAAG+E,UAE5DN,EAAM9H,IAAMhI,EAELiO,EAMDviB,SACN,MAAM2f,EAAKtf,KAAKsf,GAChBA,EAAGiF,WAAW,EAAK,EAAK,EAAK,GAC7BjF,EAAGkF,WAAW,GACdlF,EAAGxP,MAAMwP,EAAGmF,iBAAmBnF,EAAGoF,kBAClCpF,EAAGqF,SAAS,EAAG,EAAG3kB,KAAK+e,WAAY/e,KAAKgf,aAIxC,CACE,MAAM4F,EAAgB,EAChB/B,EAAOvD,EAAGuF,MACVC,GAAY,EACZC,EAAS,EACT/L,EAAS,EACfsG,EAAGuC,WAAWvC,EAAGwC,aAAc9hB,KAAKuhB,gBACpCjC,EAAG0F,oBACChlB,KAAKogB,uBAAwBwE,EAAe/B,EAAMiC,EAAWC,EAC7D/L,GAKN,CACE,MAAM4L,EAAgB,EAChB/B,EAAOvD,EAAGuF,MACVC,GAAY,EACZC,EAAS,EACT/L,EAAS,EACfsG,EAAGuC,WAAWvC,EAAGwC,aAAc9hB,KAAK0hB,eACpCpC,EAAGyC,WAAWzC,EAAGwC,aAAc9hB,KAAK8gB,aAAcxB,EAAG2F,cACrD3F,EAAG0F,oBACChlB,KAAKsgB,sBAAuBsE,EAAe/B,EAAMiC,EAAWC,EAC5D/L,GAIN,CACE,MAAM4L,EAAgB,EAChB/B,EAAOvD,EAAGsE,cACVkB,GAAY,EACZC,EAAS,EACT/L,EAAS,EACfsG,EAAGuC,WAAWvC,EAAGwC,aAAc9hB,KAAK2hB,kBACpCrC,EAAGyC,WACCzC,EAAGwC,aAAc9hB,KAAK+gB,qBAAsBzB,EAAG2F,cACnD3F,EAAG0F,oBACChlB,KAAKugB,sBAAuBqE,EAAe/B,EAAMiC,EAAWC,EAC5D/L,GAIN,CACE,MAAM4L,EAAgB,EAChB/B,EAAOvD,EAAGsE,cACVkB,GAAY,EACZC,EAAS,EACT/L,EAAS,EACfsG,EAAGuC,WAAWvC,EAAGwC,aAAc9hB,KAAK4hB,kBACpCtC,EAAGyC,WACCzC,EAAGwC,aAAc9hB,KAAKohB,qBAAsB9B,EAAG2F,cACnD3F,EAAG0F,oBACChlB,KAAKwgB,sBAAuBoE,EAAe/B,EAAMiC,EAAWC,EAC5D/L,GAINsG,EAAGuC,WAAWvC,EAAG2C,qBAAsBjiB,KAAKyhB,aAG5CnC,EAAGW,WAAWjgB,KAAKwf,SAGnBF,EAAG4F,cAAc5F,EAAG6F,UAGpB7F,EAAGgE,YAAYhE,EAAGiE,WAAYvjB,KAAKkiB,SAGnC,CACE,MAAMkD,EAAcplB,KAAKF,MAAQE,KAAKD,OAAS,EACzC8iB,EAAOvD,EAAG+F,eACVrM,EAAS,EACfsG,EAAGgG,aAAahG,EAAGiG,UAAWH,EAAavC,EAAM7J,IAI7CrZ,aACNK,KAAKuB,KAAKikB,aACVxlB,KAAKof,MAAMqG,SACPzlB,KAAKylB,QACPzlB,KAAKylB,SAEPzlB,KAAK0lB,QACL1lB,KAAK2lB,SACLC,sBAAsB5lB,KAAKoiB,WAAWnjB,KAAKe,wFCjY/C,MAAAkY,EAAA3a,EAAA,GAIAN,EAAAoiB,MAAA,MAaE1f,YAAY6X,EAAoB2B,GAC9BnZ,KAAKsB,GAAKkW,EAASoC,OACnB5Z,KAAKF,MAAQ0X,EAAS1X,MACtBE,KAAKD,OAASyX,EAASzX,OACvBC,KAAKmZ,QAAUA,EACfnZ,KAAK6lB,MAAQ,EACb7lB,KAAK8lB,MAAQ,EACb9lB,KAAKJ,EAAI,EACTI,KAAKH,EAAI,EACTG,KAAK+lB,GAAK,EACV/lB,KAAKgmB,GAAK,EACVhmB,KAAKimB,QAAU,EAAC,GAAO,GAAO,GAE9B,MAAM3kB,EAAKtB,KAAKsB,GAChBA,EAAGG,iBAAiB,YAAaC,GAAK1B,KAAKkmB,YAAYxkB,IACvDJ,EAAGG,iBAAiB,UAAWC,GAAK1B,KAAKkmB,YAAYxkB,IACrDJ,EAAGG,iBAAiB,YAAaC,GAAK1B,KAAKkmB,YAAYxkB,IACvDJ,EAAGG,iBAAiB,cAAeC,GAAK1B,KAAKkmB,YAAYxkB,IAEzD,MAAMykB,EAAoBnmB,KAAKomB,iBAAiBnnB,KAAKe,MACrDsB,EAAGG,iBAAiB,aAAc0kB,GAClC7kB,EAAGG,iBAAiB,WAAY0kB,GAChC7kB,EAAGG,iBAAiB,cAAe0kB,GACnC7kB,EAAGG,iBAAiB,YAAa0kB,GAG3BxmB,iBAAiB+B,GAQvB,GAPAA,EAAEG,kBACFH,EAAEI,iBAEa,aAAXJ,EAAEmhB,MAAuB7iB,KAAKmZ,QAAQ0F,mBACxC7e,KAAK6e,oBAGHnd,EAAE2kB,QAAQhW,OAAS,EAAG,CACxB,MAAMiW,EAAQ5kB,EAAE2kB,QAAQ,GACxBrmB,KAAKumB,eAAeD,EAAME,QAASF,EAAMG,SACzCzmB,KAAKimB,QAAQ,IAAK,OAElBjmB,KAAKimB,QAAQ,IAAK,EAIdtmB,YAAY+B,GAClBA,EAAEG,kBACFH,EAAEI,iBAEF9B,KAAKumB,eAAe7kB,EAAE8kB,QAAS9kB,EAAE+kB,SAElB,cAAX/kB,EAAEmhB,OACJ7iB,KAAKimB,QAAQvkB,EAAEglB,SAAU,EAEzB1mB,KAAKsB,GAAGqlB,QAEJ3mB,KAAKmZ,QAAQ0F,mBACf7e,KAAK6e,qBAIM,YAAXnd,EAAEmhB,OACJ7iB,KAAKimB,QAAQvkB,EAAEglB,SAAU,GAIrB/mB,eAAe6mB,EAAiBC,GACtC,IAAIhS,EAAgCzU,KAAKsB,GAAGslB,wBAM5C,MAAMC,EAAsB7mB,KAAKF,MAAQE,KAAKD,OACxC+mB,EAAkBrS,EAAK3U,MAAQ2U,EAAK1U,OAE1C,GAAI+mB,EAAkBD,EAAsB,IAAM,CAChD,MAAME,EAAcF,EAAsBpS,EAAK1U,OACzCinB,EAASvS,EAAK3U,MAAQinB,EAC5BtS,EAAO,IAAIyD,EAAAxY,KAAK8Q,KAAKC,MAAMuW,EAAS,GAAI,EAAGD,EAAatS,EAAK1U,QAG/D,GAAI+mB,EAAkBD,GAAuB,IAAM,CACjD,MAAMI,EAAexS,EAAK3U,MAAQ+mB,EAC5BG,EAASvS,EAAK1U,OAASknB,EAC7BxS,EAAO,IAAIyD,EAAAxY,KAAK,EAAG8Q,KAAKC,MAAMuW,EAAS,GAAIvS,EAAK3U,MAAOmnB,GAGzDjnB,KAAKJ,EAAKI,KAAKF,OAAS0mB,EAAU/R,EAAKxU,MAAQwU,EAAK3U,MAAS,EAC7DE,KAAKH,EAAKG,KAAKD,QAAU0mB,EAAUhS,EAAKvU,KAAOuU,EAAK1U,OAAU,EAGxDJ,oBACN,MAAMia,EAAS5Z,KAAKsB,GAChBsY,EAAOiF,kBACTjF,EAAOiF,oBACEjF,EAAOsN,wBAChBtN,EAAOsN,0BACEtN,EAAOuN,sBAChBvN,EAAOuN,uBAIXxnB,SACEK,KAAK+lB,GAAK/lB,KAAKJ,EAAII,KAAK6lB,MACxB7lB,KAAKgmB,GAAKhmB,KAAKH,EAAIG,KAAK8lB,MACxB9lB,KAAK6lB,MAAQ7lB,KAAKJ,EAClBI,KAAK8lB,MAAQ9lB,KAAKH,mFC/GT5C,EAAA4iB,qBAAuB,0OAuBvB5iB,EAAA8iB,uBAAyB","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"wglt\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"wglt\"] = factory();\n\telse\n\t\troot[\"wglt\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","import {Point} from './point';\n\nexport class Rect {\n  readonly x: number;\n  readonly y: number;\n  readonly left: number;\n  readonly top: number;\n  readonly width: number;\n  readonly height: number;\n  readonly x2: number;\n  readonly y2: number;\n\n  constructor(x: number, y: number, width: number, height: number) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n    this.x2 = x + width;\n    this.y2 = y + height;\n  }\n\n  getCenter() {\n    return new Point(\n        this.x + (this.width / 2) | 0, this.y + (this.height / 2) | 0);\n  }\n\n  intersects(other: Rect) {\n    return this.x <= other.x2 && this.x2 >= other.x && this.y <= other.y2 &&\n        this.y2 >= other.y;\n  }\n}\n","\nexport type Color = number;\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromRgb(r: number, g: number, b: number, a?: number): Color {\n  if (a === undefined) {\n    a = 255;\n  }\n  return ((r << 24) + (g << 16) + (b << 8) + a) as Color;\n}\n\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromHsv(h: number, s: number, v: number, a?: number): Color {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      r = v, g = t, b = p;\n      break;\n    case 1:\n      r = q, g = v, b = p;\n      break;\n    case 2:\n      r = p, g = v, b = t;\n      break;\n    case 3:\n      r = p, g = q, b = v;\n      break;\n    case 4:\n      r = t, g = p, b = v;\n      break;\n    case 5:\n      r = v, g = p, b = q;\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n","\n/**\n * Number of keys to track.\n */\nconst KEY_COUNT = 256;\n\n/**\n * Creates a new key instance.\n */\nexport class Key {\n  down: boolean;\n  downCount: number;\n\n  constructor() {\n    this.down = false;\n    this.downCount = 0;\n  }\n}\n\nexport class Keys {\n  private readonly keys: Key[];\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el: Element) {\n    this.keys = new Array(KEY_COUNT);\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i] = new Key();\n    }\n\n    el.addEventListener('keydown', e => this.setKey(e as KeyboardEvent, true));\n    el.addEventListener('keyup', e => this.setKey(e as KeyboardEvent, false));\n  }\n\n\n  setKey(e: KeyboardEvent, state: boolean) {\n    e.stopPropagation();\n    e.preventDefault();\n    const keyCode = e.keyCode;\n    if (keyCode >= 0 && keyCode < KEY_COUNT) {\n      this.keys[keyCode].down = state;\n    }\n  }\n\n  updateKeys() {\n    for (let i = 0; i < KEY_COUNT; i++) {\n      if (this.keys[i].down) {\n        this.keys[i].downCount++;\n      } else {\n        this.keys[i].downCount = 0;\n      }\n    }\n  }\n\n  getKey(keyCode: number) {\n    return keyCode >= 0 && keyCode < KEY_COUNT ? this.keys[keyCode] : null;\n  }\n\n  static readonly VK_CANCEL = 3;\n  static readonly VK_HELP = 6;\n  static readonly VK_BACK_SPACE = 8;\n  static readonly VK_TAB = 9;\n  static readonly VK_CLEAR = 12;\n  static readonly VK_ENTER = 13;\n  static readonly VK_SHIFT = 16;\n  static readonly VK_CONTROL = 17;\n  static readonly VK_ALT = 18;\n  static readonly VK_PAUSE = 19;\n  static readonly VK_CAPS_LOCK = 20;\n  static readonly VK_ESCAPE = 27;\n  static readonly VK_SPACE = 32;\n  static readonly VK_PAGE_UP = 33;\n  static readonly VK_PAGE_DOWN = 34;\n  static readonly VK_END = 35;\n  static readonly VK_HOME = 36;\n  static readonly VK_LEFT = 37;\n  static readonly VK_UP = 38;\n  static readonly VK_RIGHT = 39;\n  static readonly VK_DOWN = 40;\n  static readonly VK_PRINTSCREEN = 44;\n  static readonly VK_INSERT = 45;\n  static readonly VK_DELETE = 46;\n  static readonly VK_0 = 48;\n  static readonly VK_1 = 49;\n  static readonly VK_2 = 50;\n  static readonly VK_3 = 51;\n  static readonly VK_4 = 52;\n  static readonly VK_5 = 53;\n  static readonly VK_6 = 54;\n  static readonly VK_7 = 55;\n  static readonly VK_8 = 56;\n  static readonly VK_9 = 57;\n  static readonly VK_COLON = 58;\n  static readonly VK_SEMICOLON = 59;\n  static readonly VK_LESS_THAN = 60;\n  static readonly VK_EQUALS = 61;\n  static readonly VK_GREATER_THAN = 62;\n  static readonly VK_QUESTION_MARK = 63;\n  static readonly VK_AT = 64;\n  static readonly VK_A = 65;\n  static readonly VK_B = 66;\n  static readonly VK_C = 67;\n  static readonly VK_D = 68;\n  static readonly VK_E = 69;\n  static readonly VK_F = 70;\n  static readonly VK_G = 71;\n  static readonly VK_H = 72;\n  static readonly VK_I = 73;\n  static readonly VK_J = 74;\n  static readonly VK_K = 75;\n  static readonly VK_L = 76;\n  static readonly VK_M = 77;\n  static readonly VK_N = 78;\n  static readonly VK_O = 79;\n  static readonly VK_P = 80;\n  static readonly VK_Q = 81;\n  static readonly VK_R = 82;\n  static readonly VK_S = 83;\n  static readonly VK_T = 84;\n  static readonly VK_U = 85;\n  static readonly VK_V = 86;\n  static readonly VK_W = 87;\n  static readonly VK_X = 88;\n  static readonly VK_Y = 89;\n  static readonly VK_Z = 90;\n  static readonly VK_CONTEXT_MENU = 93;\n  static readonly VK_NUMPAD0 = 96;\n  static readonly VK_NUMPAD1 = 97;\n  static readonly VK_NUMPAD2 = 98;\n  static readonly VK_NUMPAD3 = 99;\n  static readonly VK_NUMPAD4 = 100;\n  static readonly VK_NUMPAD5 = 101;\n  static readonly VK_NUMPAD6 = 102;\n  static readonly VK_NUMPAD7 = 103;\n  static readonly VK_NUMPAD8 = 104;\n  static readonly VK_NUMPAD9 = 105;\n  static readonly VK_MULTIPLY = 106;\n  static readonly VK_ADD = 107;\n  static readonly VK_SEPARATOR = 108;\n  static readonly VK_SUBTRACT = 109;\n  static readonly VK_DECIMAL = 110;\n  static readonly VK_DIVIDE = 111;\n  static readonly VK_F1 = 112;\n  static readonly VK_F2 = 113;\n  static readonly VK_F3 = 114;\n  static readonly VK_F4 = 115;\n  static readonly VK_F5 = 116;\n  static readonly VK_F6 = 117;\n  static readonly VK_F7 = 118;\n  static readonly VK_F8 = 119;\n  static readonly VK_F9 = 120;\n  static readonly VK_F10 = 121;\n  static readonly VK_F11 = 122;\n  static readonly VK_F12 = 123;\n  static readonly VK_F13 = 124;\n  static readonly VK_F14 = 125;\n  static readonly VK_F15 = 126;\n  static readonly VK_F16 = 127;\n  static readonly VK_F17 = 128;\n  static readonly VK_F18 = 129;\n  static readonly VK_F19 = 130;\n  static readonly VK_F20 = 131;\n  static readonly VK_F21 = 132;\n  static readonly VK_F22 = 133;\n  static readonly VK_F23 = 134;\n  static readonly VK_F24 = 135;\n  static readonly VK_NUM_LOCK = 144;\n  static readonly VK_SCROLL_LOCK = 145;\n  static readonly VK_CIRCUMFLEX = 160;\n  static readonly VK_EXCLAMATION = 161;\n  static readonly VK_DOUBLE_QUOTE = 162;\n  static readonly VK_HASH = 163;\n  static readonly VK_DOLLAR = 164;\n  static readonly VK_PERCENT = 165;\n  static readonly VK_AMPERSAND = 166;\n  static readonly VK_UNDERSCORE = 167;\n  static readonly VK_OPEN_PAREN = 168;\n  static readonly VK_CLOSE_PAREN = 169;\n  static readonly VK_ASTERISK = 170;\n  static readonly VK_PLUS = 171;\n  static readonly VK_PIPE = 172;\n  static readonly VK_HYPHEN_MINUS = 173;\n  static readonly VK_OPEN_CURLY_BRACKET = 174;\n  static readonly VK_CLOSE_CURLY_BRACKET = 175;\n  static readonly VK_TILDE = 176;\n  static readonly VK_COMMA = 188;\n  static readonly VK_PERIOD = 190;\n  static readonly VK_SLASH = 191;\n  static readonly VK_BACK_QUOTE = 192;\n  static readonly VK_OPEN_BRACKET = 219;\n  static readonly VK_BACK_SLASH = 220;\n  static readonly VK_CLOSE_BRACKET = 221;\n  static readonly VK_QUOTE = 222;\n  static readonly VK_META = 224;\n  static readonly VK_ALTGR = 225;\n  static readonly VK_WIN = 91;\n  static readonly VK_KANA = 21;\n  static readonly VK_HANGUL = 21;\n  static readonly VK_EISU = 22;\n  static readonly VK_JUNJA = 23;\n  static readonly VK_FINAL = 24;\n  static readonly VK_HANJA = 25;\n  static readonly VK_KANJI = 25;\n  static readonly VK_CONVERT = 28;\n  static readonly VK_NONCONVERT = 29;\n  static readonly VK_ACCEPT = 30;\n  static readonly VK_MODECHANGE = 31;\n  static readonly VK_SELECT = 41;\n  static readonly VK_PRINT = 42;\n  static readonly VK_EXECUTE = 43;\n  static readonly VK_SLEEP = 95;\n}\n","\n/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nexport enum BlendMode {\n\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None = 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend = 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add = 2\n}\n","\nimport {fromRgb} from './color';\n\nexport class Colors {\n  static readonly BLACK = fromRgb(0, 0, 0);\n  static readonly WHITE = fromRgb(0xff, 0xff, 0xff);\n  static readonly LIGHT_GRAY = fromRgb(0xaa, 0xaa, 0xaa);\n  static readonly DARK_GRAY = fromRgb(0x55, 0x55, 0x55);\n  static readonly YELLOW = fromRgb(0xff, 0xff, 0x55);\n  static readonly BROWN = fromRgb(0xaa, 0x55, 0x00);\n  static readonly LIGHT_RED = fromRgb(0xff, 0x55, 0x55);\n  static readonly DARK_RED = fromRgb(0xaa, 0x00, 0x00);\n  static readonly LIGHT_GREEN = fromRgb(0x55, 0xff, 0x55);\n  static readonly DARK_GREEN = fromRgb(0x00, 0xaa, 0x00);\n  static readonly LIGHT_CYAN = fromRgb(0x55, 0xff, 0xff);\n  static readonly DARK_CYAN = fromRgb(0x00, 0xaa, 0xaa);\n  static readonly LIGHT_BLUE = fromRgb(0x55, 0x55, 0xff);\n  static readonly DARK_BLUE = fromRgb(0x00, 0x00, 0xaa);\n  static readonly LIGHT_MAGENTA = fromRgb(0xff, 0x55, 0xff);\n  static readonly DARK_MAGENTA = fromRgb(0xaa, 0x00, 0xaa);\n  static readonly ORANGE = fromRgb(0xff, 0x88, 0x00);\n}\n","\n\n// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nexport class Chars {\n  static readonly SMILEY = 1;\n  static readonly INVERSE_SMILEY = 2;\n  static readonly HEART = 3;\n  static readonly DIAMOND = 4;\n  static readonly CLUB = 5;\n  static readonly SPADE = 6;\n  static readonly BULLET = 7;\n  static readonly INVERSE_BULLET = 8;\n\n  static readonly LIGHT_SHADE = 176;\n  static readonly MEDIUM_SHADE = 177;\n  static readonly DARK_SHADE = 178;\n\n  static readonly BOX_SINGLE_VERTICAL = 179;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT = 180;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT = 185;\n  static readonly BOX_DOUBLE_VERTICAL = 186;\n  static readonly BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT = 187;\n  static readonly BOX_DOUBLE_UP_AND_DOUBLE_LEFT = 188;\n  static readonly BOX_SINGLE_DOWN_AND_SINGLE_LEFT = 191;\n  static readonly BOX_SINGLE_UP_AND_SINGLE_RIGHT = 192;\n  static readonly BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP = 193;\n  static readonly BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN = 194;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT = 195;\n  static readonly BOX_SINGLE_HORIZONTAL = 196;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL = 197;\n  static readonly BOX_DOUBLE_UP_AND_DOUBLE_RIGHT = 200;\n  static readonly BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT = 201;\n  static readonly BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP = 202;\n  static readonly BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN = 203;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT = 204;\n  static readonly BOX_DOUBLE_HORIZONTAL = 205;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL = 206;\n  static readonly BOX_SINGLE_UP_AND_SINGLE_LEFT = 13 * 16 + 9;\n  static readonly BOX_SINGLE_DOWN_AND_SINGLE_RIGHT = 13 * 16 + 10;\n\n  static readonly BLOCK_TOP_LEFT = 14 * 16 + 2;\n  static readonly BLOCK_TOP_RIGHT = 14 * 16 + 3;\n  static readonly BLOCK_TOP_HALF = 14 * 16 + 4;\n  static readonly BLOCK_BOTTOM_LEFT = 14 * 16 + 8;\n  static readonly BLOCK_BOTTOM_RIGHT = 14 * 16 + 5;\n  static readonly BLOCK_RIGHT_HALF = 14 * 16 + 7;\n  static readonly BLOCK_CHECKER = 14 * 16 + 6;\n}\n","\nimport {BlendMode} from './blendmode';\nimport {Cell} from './cell';\nimport {Chars} from './chars';\nimport {Color} from './color';\n\nexport class Console {\n  readonly width: number;\n  readonly height: number;\n  private readonly grid: Cell[][];\n\n  constructor(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n    this.grid = new Array();\n\n    for (let y = 0; y < height; y++) {\n      const row = new Array();\n      for (let x = 0; x < width; x++) {\n        row.push(new Cell());\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n  }\n\n  clear() {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x: number, y: number) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  getCharCode(x: number, y: number) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x].charCode;\n  }\n\n  drawChar(\n      x: number, y: number, c: number|string|Cell, fg?: Color, bg?: Color) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x: number, y: number, str: string, fg?: Color, bg?: Color) {\n    for (let i = 0; i < str.length; i++) {\n      this.drawChar(x + i, y, str.charCodeAt(i), fg, bg);\n    }\n  }\n\n  drawCenteredString(\n      x: number, y: number, str: string, fg?: Color, bg?: Color) {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawHLine(\n      x: number, y: number, width: number, c: number|Cell, fg?: Color,\n      bg?: Color) {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(\n      x: number, y: number, height: number, c: number|Cell, fg?: Color,\n      bg?: Color) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(\n      x: number, y: number, width: number, height: number, c: number|Cell,\n      fg?: Color, bg?: Color) {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n      x: number, y: number, width: number, height: number, topChar: number,\n      rightChar: number, bottomChar: number, leftChar: number,\n      topLeftChar: number, topRightChar: number, bottomRightChar: number,\n      bottomLeftChar: number, fg?: Color, bg?: Color) {\n    this.fillRect(x, y, width, height, 0, fg, bg);\n\n    this.drawHLine(x, y, width, topChar);\n    this.drawHLine(x, y + height - 1, width, bottomChar);\n\n    this.drawVLine(x, y, height, leftChar);\n    this.drawVLine(x + width - 1, y, height, rightChar);\n\n    this.drawChar(x, y, topLeftChar);\n    this.drawChar(x + width - 1, y, topRightChar);\n    this.drawChar(x, y + height - 1, bottomLeftChar);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar);\n  }\n\n  drawSingleBox(\n      x: number, y: number, width: number, height: number, fg?: Color,\n      bg?: Color) {\n    this.drawBox(\n        x, y, width, height, Chars.BOX_SINGLE_HORIZONTAL,\n        Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_HORIZONTAL,\n        Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n        Chars.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n        Chars.BOX_SINGLE_UP_AND_SINGLE_LEFT,\n        Chars.BOX_SINGLE_UP_AND_SINGLE_RIGHT, fg, bg);\n  }\n\n  drawDoubleBox(\n      x: number, y: number, width: number, height: number, fg?: Color,\n      bg?: Color) {\n    this.drawBox(\n        x, y, width, height, Chars.BOX_DOUBLE_HORIZONTAL,\n        Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_HORIZONTAL,\n        Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n        Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n        Chars.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n        Chars.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT, fg, bg);\n  }\n\n  fillRect(\n      x: number, y: number, width: number, height: number, c: number|Cell,\n      fg?: Color, bg?: Color) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n      dstX: number, dstY: number, srcConsole: Console, srcX: number,\n      srcY: number, srcWidth: number, srcHeight: number,\n      blendMode?: BlendMode) {\n    blendMode = blendMode || BlendMode.None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  private drawCell(x: number, y: number, cell: Cell, blendMode: BlendMode) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n}\n","\r\nexport class Point {\r\n  readonly x: number;\r\n  readonly y: number;\r\n\r\n  constructor(x: number, y: number) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n}\r\n","\nimport {Console} from '../console';\nimport {Point} from '../point';\nimport {Rect} from '../rect';\nimport {Terminal} from '../terminal';\n\nexport abstract class Dialog {\n  readonly contentsRect: Rect;\n  readonly title: string;\n\n  constructor(contentsRect: Rect, title: string) {\n    this.contentsRect = contentsRect;\n    this.title = title;\n  }\n\n  abstract drawContents(console: Console, offset: Point): void;\n\n  abstract handleInput(terminal: Terminal, offset: Point): object|boolean;\n}\n","\nimport {BlendMode} from './blendmode';\nimport {Color, fromRgb} from './color';\nimport {Colors} from './colors';\n\nfunction convertCharCode(charCode: number|string): number {\n  if ((typeof charCode === 'string') && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode as number;\n  }\n}\n\nexport class Cell {\n  charCode: number;\n  fg: Color;\n  bg: Color;\n  meta?: object;\n  dirty: boolean;\n\n  constructor(charCode?: number|string, fg?: Color, bg?: Color, meta?: object) {\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode) as number;\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = Colors.WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = Colors.BLACK;\n    }\n\n    if (meta !== undefined) {\n      this.meta = meta;\n    }\n\n    this.dirty = true;\n  }\n\n  setCharCode(charCode: number) {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg?: Color) {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg?: Color) {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setMeta(meta?: object) {\n    if (meta !== undefined) {\n      this.meta = meta;\n      this.dirty = true;\n    }\n  }\n\n  setValue(\n      charCode: number|string|Cell, fg?: Color, bg?: Color, meta?: object) {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n      this.setForeground(fg);\n      this.setBackground(bg);\n      this.setMeta(meta);\n    } else {\n      this.drawCell(charCode, BlendMode.None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell: Cell, blendMode: BlendMode) {\n    const alpha = otherCell.bg & 0xFF;\n\n    if (blendMode === BlendMode.None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === BlendMode.None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n\n    this.setMeta(otherCell.meta);\n  }\n\n  private blendColors(c1: Color, c2: Color, blendMode: BlendMode): Color {\n    const alpha = c2 & 0xFF;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xFF;\n    const g1 = (c1 >> 16) & 0xFF;\n    const b1 = (c1 >> 8) & 0xFF;\n    const r2 = (c2 >> 24) & 0xFF;\n    const g2 = (c2 >> 16) & 0xFF;\n    const b2 = (c2 >> 8) & 0xFF;\n\n    switch (blendMode) {\n      case BlendMode.Blend:\n        return fromRgb(\n            (w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0,\n            (w1 * b1 + w2 * b2) | 0);\n\n      case BlendMode.Add:\n        return fromRgb(\n            this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0),\n            this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  private clamp(x: number): number {\n    return Math.min(255, x);\n  }\n}\n","\nexport class Font {\n  readonly url: string;\n  readonly charWidth: number;\n  readonly charHeight: number;\n  readonly scale: number;\n  readonly graphical: boolean;\n\n  constructor(\n      url: string, charWidth: number, charHeight: number, scale?: number,\n      graphical?: boolean) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n    this.graphical = !!graphical;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQ' +\n    'MAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8' +\n    'QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY' +\n    '09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1' +\n    'zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eIC' +\n    'JsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBq' +\n    'ucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqh' +\n    'JRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvh' +\n    'A1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL' +\n    '0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu' +\n    '2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIz' +\n    'CAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsW' +\n    'IE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBW' +\n    'l5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h' +\n    '5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtL' +\n    'ji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb' +\n    '2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O' +\n    '3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2f' +\n    'otTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZ' +\n    'UghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2G' +\n    'AzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc' +\n    '4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJ' +\n    'G199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJI' +\n    'lipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC';\n\nexport const DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n","import {Point} from '../point';\r\nimport {Rect} from '../rect';\r\n\r\nimport {Dialog} from './dialog';\r\n\r\nexport class DialogState {\r\n  readonly dialog: Dialog;\r\n  readonly rect: Rect;\r\n  readonly contentsOffset: Point;\r\n  open: boolean;\r\n  count: number;\r\n\r\n  constructor(dialog: Dialog, rect: Rect, contentsOffset: Point) {\r\n    this.dialog = dialog;\r\n    this.rect = rect;\r\n    this.contentsOffset = contentsOffset;\r\n    this.open = false;\r\n    this.count = 0;\r\n  }\r\n}\r\n","\nexport * from './blendmode';\nexport * from './boxutils';\nexport * from './cell';\nexport * from './chars';\nexport * from './color';\nexport * from './colors';\nexport * from './console';\nexport * from './font';\nexport * from './fov';\nexport * from './gui';\nexport * from './gui/dialog';\nexport * from './gui/dialogrenderer';\nexport * from './gui/dialogstate';\nexport * from './gui/messagedialog';\nexport * from './gui/selectdialog';\nexport * from './image';\nexport * from './keys';\nexport * from './path';\nexport * from './point';\nexport * from './rect';\nexport * from './rng';\nexport * from './terminal';\n","\r\nimport {Cell} from './cell';\r\nimport {Chars} from './chars';\r\nimport {Console} from './console';\r\n\r\n/**\r\n * Details about box characters.\r\n * The first element is the array of details for the first box char (0xB3).\r\n * Each sub array is the count of stems for top, right, bottom, and left.\r\n */\r\nconst BOX_CHAR_DETAILS = [\r\n  [1, 0, 1, 0], // 0xB3\r\n  [1, 0, 1, 1], // 0xB4\r\n  [1, 0, 1, 2], // 0xB5\r\n  [2, 0, 2, 1], // 0xB6\r\n  [0, 0, 2, 1], // 0xB7\r\n  [0, 0, 1, 2], // 0xB8\r\n  [2, 0, 2, 2], // 0xB9\r\n  [2, 0, 2, 0], // 0xBA\r\n  [0, 0, 2, 2], // 0xBB\r\n  [2, 0, 0, 2], // 0xBC\r\n  [2, 0, 0, 1], // 0xBD\r\n  [1, 0, 0, 2], // 0xBE\r\n  [0, 0, 1, 1], // 0xBF\r\n  [1, 1, 0, 0], // 0xC0\r\n  [1, 1, 0, 1], // 0xC1\r\n  [0, 1, 1, 1], // 0xC2\r\n  [1, 1, 1, 0], // 0xC3\r\n  [0, 1, 0, 1], // 0xC4\r\n  [1, 1, 1, 1], // 0xC5\r\n  [1, 2, 1, 0], // 0xC6\r\n  [2, 1, 2, 0], // 0xC7\r\n  [2, 2, 0, 0], // 0xC8\r\n  [0, 2, 2, 0], // 0xC9\r\n  [2, 2, 0, 2], // 0xCA\r\n  [0, 2, 2, 2], // 0xCB\r\n  [2, 2, 2, 0], // 0xCC\r\n  [0, 2, 0, 2], // 0xCD\r\n  [2, 2, 2, 2], // 0xCE\r\n  [1, 2, 0, 2], // 0xCF\r\n  [2, 1, 0, 1], // 0xD0\r\n  [0, 2, 1, 2], // 0xD1\r\n  [0, 1, 2, 1], // 0xD2\r\n  [2, 1, 0, 0], // 0xD3\r\n  [1, 2, 0, 0], // 0xD4\r\n  [0, 2, 1, 0], // 0xD5\r\n  [0, 1, 2, 0], // 0xD6\r\n  [2, 1, 2, 1], // 0xD7\r\n  [1, 2, 1, 2], // 0xD8\r\n  [1, 0, 0, 1], // 0xD9\r\n  [0, 1, 1, 0], // 0xDA\r\n];\r\n\r\nfunction isBoxCell(console: Console, x: number, y: number) {\r\n  const charCode = (console.getCell(x, y) as Cell).charCode;\r\n  return charCode >= 0xB3 && charCode <= 0xDA;\r\n}\r\n\r\nfunction getBoxCell(up: number, right: number, down: number, left: number) {\r\n  for (let i = 0; i < BOX_CHAR_DETAILS.length; i++) {\r\n    const row = BOX_CHAR_DETAILS[i];\r\n    if (row[0] === up && row[1] === right && row[2] === down && row[3] === left) {\r\n      return 0xB3 + i;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport function fixBoxCells(console: Console) {\r\n  for (let y = 0; y < console.height; y++) {\r\n    for (let x = 0; x < console.width; x++) {\r\n      if (isBoxCell(console, x, y)) {\r\n        let up = y > 0 && isBoxCell(console, x, y - 1);\r\n        let right = x < console.width - 1 && isBoxCell(console, x + 1, y);\r\n        let down = y < console.height - 1 && isBoxCell(console, x, y + 1);\r\n        let left = x > 0 && isBoxCell(console, x - 1, y);\r\n\r\n        if (up && !right && !down && !left) {\r\n          down = true;\r\n        }\r\n        if (!up && right && !down && !left) {\r\n          left = true;\r\n        }\r\n        if (!up && !right && down && !left) {\r\n          up = true;\r\n        }\r\n        if (!up && !right && !down && left) {\r\n          right = true;\r\n        }\r\n\r\n        const charCode = getBoxCell(up ? 1 : 0, right ? 1 : 0, down ? 1 : 0, left ? 1 : 0);\r\n\r\n        if ((up || right || down || left) && !(charCode >= 0xB3 && charCode <= 0xDA)) {\r\n          throw new Error('invalid char code!');\r\n        }\r\n\r\n        (console.getCell(x, y) as Cell).setCharCode(charCode);\r\n      }\r\n    }\r\n  }\r\n}\r\n","\n// MRPAS\n// Mingos' Restrictive Precise Angle Shadowcasting\n// https://bitbucket.org/mingos/mrpas/overview\n\nexport class FovCell {\n  readonly x: number;\n  readonly y: number;\n  blocked: boolean;\n  visible: boolean;\n  g: number;\n  h: number;\n  prev: FovCell|null;\n\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n    this.blocked = false;\n    this.visible = false;\n    this.g = 0.0;\n    this.h = 0.0;\n    this.prev = null;\n  }\n}\n\nexport class FovMap {\n  readonly width: number;\n  readonly height: number;\n  readonly grid: FovCell[][];\n  private originX: number;\n  private originY: number;\n  private minX: number;\n  private maxX: number;\n  private minY: number;\n  private maxY: number;\n  private radius: number;\n\n  /**\n   * Creates a new FOV map.\n   * @constructor\n   * @param width\n   * @param height\n   * @param blockedFunc\n   */\n  constructor(\n      width: number, height: number,\n      blockedFunc?: (x: number, y: number) => boolean) {\n    this.width = width;\n    this.height = height;\n\n    this.grid = new Array(height);\n    for (let y = 0; y < height; y++) {\n      this.grid[y] = new Array(width);\n      for (let x = 0; x < width; x++) {\n        this.grid[y][x] = new FovCell(x, y);\n      }\n    }\n\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  getCell(x: number, y: number): FovCell {\n    return this.grid[y][x];\n  }\n\n  setBlocked(x: number, y: number, blocked: boolean) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  isVisible(x: number, y: number) {\n    if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  private computeOctantY(deltaX: number, deltaY: number) {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (y = this.originY + deltaY; y >= this.minY && y <= this.maxY;\n         y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          x = this.originX + (processedCell * deltaX);\n           processedCell <= iteration && x >= this.minX && x <= this.maxX;\n           x += deltaX, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y - deltaY][x].visible &&\n                !this.grid[y - deltaY][x].blocked) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blocked)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blocked) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blocked) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  private computeOctantX(deltaX: number, deltaY: number) {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (x = this.originX + deltaX; x >= this.minX && x <= this.maxX;\n         x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          y = this.originY + (processedCell * deltaY);\n           processedCell <= iteration && y >= this.minY && y <= this.maxY;\n           y += deltaY, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y][x - deltaX].visible &&\n                !this.grid[y][x - deltaX].blocked) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blocked)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blocked) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blocked) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX: number, originY: number, radius: number) {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.grid[y][x].visible = false;\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n    this.minX = Math.max(0, originX - radius);\n    this.minY = Math.max(0, originY - radius);\n    this.maxX = Math.min(this.width - 1, originX + radius);\n    this.maxY = Math.min(this.height - 1, originY + radius);\n\n    this.computeOctantY(1, 1);\n    this.computeOctantX(1, 1);\n    this.computeOctantY(1, -1);\n    this.computeOctantX(1, -1);\n    this.computeOctantY(-1, 1);\n    this.computeOctantX(-1, 1);\n    this.computeOctantY(-1, -1);\n    this.computeOctantX(-1, -1);\n  }\n}\n","\nimport {DefaultDialogRenderer} from './gui/defaultdialogrenderer';\nimport {Dialog} from './gui/dialog';\nimport {DialogRenderer} from './gui/dialogrenderer';\nimport {DialogState} from './gui/dialogstate';\nimport {Terminal} from './terminal';\n\nexport class GUI {\n  private readonly terminal: Terminal;\n  private readonly renderer: DialogRenderer;\n  dialogs: DialogState[];\n\n  constructor(terminal: Terminal, renderer?: DialogRenderer) {\n    this.terminal = terminal;\n    this.renderer = renderer || new DefaultDialogRenderer();\n    this.dialogs = [];\n  }\n\n  add(dialog: Dialog) {\n    this.dialogs.push(this.renderer.getState(this.terminal, dialog));\n  }\n\n  handleInput(): boolean {\n    if (this.dialogs.length === 0) {\n      return false;\n    }\n\n    const activeIndex = this.dialogs.length - 1;\n    const activeState = this.dialogs[this.dialogs.length - 1];\n    const activeDialog = activeState.dialog;\n    if (activeDialog.handleInput(this.terminal, activeState.contentsOffset)) {\n      this.dialogs.splice(activeIndex, 1);\n    }\n\n    return true;\n  }\n\n  draw() {\n    for (let i = 0; i < this.dialogs.length; i++) {\n      this.renderer.draw(this.terminal, this.dialogs[i]);\n    }\n  }\n}\n","\r\nimport {Colors} from '../colors';\r\nimport {Point} from '../point';\r\nimport {Rect} from '../rect';\r\nimport {Terminal} from '../terminal';\r\n\r\nimport {Dialog} from './dialog';\r\nimport {DialogRenderer} from './dialogrenderer';\r\nimport {DialogState} from './dialogstate';\r\n\r\nexport class DefaultDialogRenderer implements DialogRenderer {\r\n  getState(terminal: Terminal, dialog: Dialog) {\r\n    const width = dialog.contentsRect.width + 4;\r\n    const height = dialog.contentsRect.height + 4;\r\n    const x = ((terminal.width - width) / 2) | 0;\r\n    const y = ((terminal.height - height) / 2) | 0;\r\n    return new DialogState(\r\n        dialog, new Rect(x, y, width, height), new Point(x + 2, y + 2));\r\n  }\r\n\r\n  draw(term: Terminal, dialogState: DialogState) {\r\n    const dialog = dialogState.dialog;\r\n    const {x, y, width, height} = dialogState.rect;\r\n    term.fillRect(x, y, width, height, 0, Colors.WHITE, Colors.BLACK);\r\n    term.drawSingleBox(x, y, width, height);\r\n    term.drawCenteredString(x + (width / 2) | 0, y, ' ' + dialog.title + ' ');\r\n    dialog.drawContents(term, dialogState.contentsOffset);\r\n  }\r\n}","\nimport {Console} from '../console';\nimport {Keys} from '../keys';\nimport {Point} from '../point';\nimport {Rect} from '../rect';\nimport {Terminal} from '../terminal';\n\nimport {Dialog} from './dialog';\n\nexport class MessageDialog extends Dialog {\n  readonly lines: string[];\n\n  constructor(title: string, message: string) {\n    const lines = message.split('\\n');\n    let width = title.length;\n    for (let i = 0; i < lines.length; i++) {\n      width = Math.max(width, lines[i].length);\n    }\n\n    const height = lines.length;\n    const rect = new Rect(0, 0, width, height);\n    super(rect, title);\n    this.lines = lines;\n  }\n\n  drawContents(console: Console, offset: Point) {\n    for (let i = 0; i < this.lines.length; i++) {\n      console.drawString(offset.x, offset.y + i, this.lines[i]);\n    }\n  }\n\n  handleInput(terminal: Terminal, offset: Point) {\n    return terminal.isKeyPressed(Keys.VK_ESCAPE);\n  }\n}\n","\nimport {Console} from '../console';\nimport {Keys} from '../keys';\nimport {Point} from '../point';\nimport {Rect} from '../rect';\nimport {Terminal} from '../terminal';\n\nimport {Dialog} from './dialog';\n\nexport class SelectDialog extends Dialog {\n  options: string[];\n  callback: Function;\n\n  constructor(\n      title: string, options: string[], callback: (choice: number) => void) {\n    let width = title.length;\n    for (let i = 0; i < options.length; i++) {\n      width = Math.max(width, options[i].length + 4);\n    }\n\n    const height = options.length;\n    const rect = new Rect(0, 0, width, height);\n    super(rect, title);\n    this.options = options;\n    this.callback = callback;\n  }\n\n  drawContents(console: Console, offset: Point) {\n    for (let i = 0; i < this.options.length; i++) {\n      const str = String.fromCharCode(65 + i) + ' - ' + this.options[i];\n      console.drawString(offset.x, offset.y + i, str);\n    }\n  }\n\n  handleInput(terminal: Terminal, offset: Point) {\n    for (let i = 0; i < this.options.length; i++) {\n      if (terminal.isKeyPressed(Keys.VK_A + i)) {\n        this.callback(i);\n        return true;\n      }\n    }\n    return terminal.isKeyPressed(Keys.VK_ESCAPE);\n  }\n}\n","\nimport {Cell} from './cell';\nimport {Chars} from './chars';\nimport {Color, fromRgb} from './color';\nimport {Console} from './console';\n\n/**\n * All available 2x2 patterns for 2x image loading.\n */\nconst PATTERNS = [\n  {charCode: Chars.BLOCK_TOP_LEFT, active: [1, 0, 0, 0]},\n  {charCode: Chars.BLOCK_TOP_RIGHT, active: [0, 1, 0, 0]},\n  {charCode: Chars.BLOCK_TOP_HALF, active: [1, 1, 0, 0]},\n  {charCode: Chars.BLOCK_BOTTOM_LEFT, active: [0, 0, 1, 0]},\n  {charCode: Chars.BLOCK_BOTTOM_RIGHT, active: [0, 0, 0, 1]},\n  {charCode: Chars.BLOCK_RIGHT_HALF, active: [0, 1, 0, 1]},\n  {charCode: Chars.BLOCK_CHECKER, active: [1, 0, 0, 1]},\n];\n\nexport function loadImage(url: string, callback: (result: Console) => void) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w, h);\n    let i = 0;\n\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        const cell = result.getCell(x, y) as Cell;\n        cell.setBackground(fromRgb(data[i++], data[i++], data[i++], data[i++]));\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nexport function loadImage2x(url: string, callback: (result: Console) => void) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w / 2, h / 2);\n\n    for (let y = 0; y < h; y += 2) {\n      for (let x = 0; x < w; x += 2) {\n        draw2x2(result, data, x, y, w);\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nfunction getImageData(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n  ctx.drawImage(img, 0, 0);\n\n  return ctx.getImageData(0, 0, img.width, img.height).data;\n}\n\nfunction draw2x2(\n    con: Console, data: Uint8ClampedArray, x: number, y: number, w: number) {\n  // Top left\n  const i1 = 4 * (y * w + x);\n  const r1 = data[i1];\n  const g1 = data[i1 + 1];\n  const b1 = data[i1 + 2];\n\n  // Top right\n  const i2 = 4 * (y * w + x + 1);\n  const r2 = data[i2];\n  const g2 = data[i2 + 1];\n  const b2 = data[i2 + 2];\n\n  // Bottom left\n  const i3 = 4 * ((y + 1) * w + x);\n  const r3 = data[i3];\n  const g3 = data[i3 + 1];\n  const b3 = data[i3 + 2];\n\n  // Bottom right\n  const i4 = 4 * ((y + 1) * w + x + 1);\n  const r4 = data[i4];\n  const g4 = data[i4 + 1];\n  const b4 = data[i4 + 2];\n\n  const colors = [[r1, g1, b1], [r2, g2, b2], [r3, g3, b3], [r4, g4, b4]];\n\n  // For each possible pattern, calculate the total error\n  // Find the pattern with minum error\n\n  let minError = Number.MAX_VALUE;\n  let bestCharCode = 0;\n  let bestBg = null;\n  let bestFg = null;\n\n  for (let i = 0; i < PATTERNS.length; i++) {\n    const pattern = PATTERNS[i];\n    const patternColors = computeColors(pattern.active, colors);\n    if (patternColors.error < minError) {\n      minError = patternColors.error;\n      bestCharCode = pattern.charCode;\n      bestBg = patternColors.bg;\n      bestFg = patternColors.fg;\n    }\n  }\n\n  con.drawChar(\n      x / 2, y / 2, bestCharCode, arrayToColor(bestFg as number[]),\n      arrayToColor(bestBg as number[]));\n}\n\nfunction computeColors(pattern: number[], colors: number[][]) {\n  const sum = [[0, 0, 0], [0, 0, 0]];\n  const avg = [[0, 0, 0], [0, 0, 0]];\n  const count = [0, 0];\n\n  for (let i = 0; i < 4; i++) {\n    for (let j = 0; j < 3; j++) {\n      sum[pattern[i]][j] += colors[i][j];\n    }\n    count[pattern[i]]++;\n  }\n\n  for (let i = 0; i < 2; i++) {\n    for (let j = 0; j < 3; j++) {\n      avg[i][j] = sum[i][j] / count[i];\n    }\n  }\n\n  let error = 0.0;\n\n  for (let i = 0; i < 4; i++) {\n    let cellError = 0.0;\n    for (let j = 0; j < 3; j++) {\n      const delta = colors[i][j] - avg[pattern[i]][j];\n      cellError += delta * delta;\n    }\n    error += Math.sqrt(cellError);\n  }\n\n  return {bg: avg[0], fg: avg[1], error};\n}\n\nfunction arrayToColor(rgb: number[]): Color {\n  return fromRgb(rgb[0], rgb[1], rgb[2]);\n}\n","\nimport {FovCell, FovMap} from './fov';\nimport {Point} from './point';\n\nconst dxs = [-1, 0, 1, -1, 1, -1, 0, 1];\nconst dys = [-1, -1, -1, 0, 0, 1, 1, 1];\nconst costs = [1.5, 1, 1.5, 1, 1, 1.5, 1, 1.5];\n\n/**\n * Calculates Dijkstra's algorithm.\n *\n * @param {!Object} source Starting point, must have x and y properties.\n * @param {!Object=} opt_dest Optional destination point, must have x and y properties.\n * @param {!number=} opt_maxDist Optional maximum distance to examine.\n * @return {?Array} Array of steps if destination found; null otherwise.\n */\nexport function computePath(\n    map: FovMap, source: Point, dest: Point, maxDist: number) {\n  clearDijkstra(map, dest);\n\n  const sourceCell = map.grid[source.y][source.x];\n  sourceCell.g = 0.0;\n\n  const q: FovCell[] = [sourceCell];\n\n  while (q.length > 0) {\n    const u = getMinCell(q);\n\n    if (u.x === dest.x && u.y === dest.y) {\n      return buildPath(u);\n    }\n\n    for (let i = 0; i < dxs.length; i++) {\n      const x = u.x + dxs[i];\n      const y = u.y + dys[i];\n      if (x >= 0 && x < map.width && y >= 0 && y < map.height) {\n        const v = map.grid[y][x];\n        const alt = u.g + costs[i];\n        if (alt < v.g && alt <= maxDist && !map.grid[y][x].blocked) {\n          v.g = alt;\n          v.prev = u;\n          q.push(v);\n        }\n      }\n    }\n  }\n  return null;\n}\n\nfunction clearDijkstra(map: FovMap, dest: Point) {\n  for (let y = 0; y < map.height; y++) {\n    for (let x = 0; x < map.width; x++) {\n      const cell = map.grid[y][x];\n      cell.g = Infinity;\n      cell.h = Math.min(Math.abs(x - dest.x), Math.abs(y - dest.y));\n      cell.prev = null;\n    }\n  }\n}\n\nfunction getMinCell(q: FovCell[]): FovCell {\n  let bestCell = null;\n  let bestIndex = -1;\n  let minDist = Infinity;\n\n  for (let i = 0; i < q.length; i++) {\n    const cell = q[i];\n    if (cell.g !== Infinity && cell.g + cell.h < minDist) {\n      bestCell = cell;\n      bestIndex = i;\n      minDist = cell.g + cell.h;\n    }\n  }\n\n  q.splice(bestIndex, 1);\n  return bestCell as FovCell;\n}\n\nfunction buildPath(cell: FovCell) {\n  const result = [];\n  let curr: FovCell|null = cell;\n  while (curr) {\n    result.push(curr);\n    curr = curr.prev;\n  }\n  result.reverse();\n  return result;\n}\n","\n/**\n * Random number generator.\n *\n * LCG\n * https://stackoverflow.com/a/424445/2051724\n */\nexport class RNG {\n  private readonly m: number;\n  private readonly a: number;\n  private readonly c: number;\n  private state: number;\n\n  /**\n   * Creates a new random number generator.\n   *\n   * @param seed The integer seed.\n   */\n  constructor(seed?: number) {\n    // LCG using GCC's constants\n    this.m = 0x80000000;  // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n    this.state = seed || 1;\n  }\n\n  private nextInt() {\n    this.state = (this.a * this.state + this.c) % this.m;\n    return this.state;\n  }\n\n  /**\n   * Returns a floating point number between 0.0 and 1.0.\n   */\n  nextFloat() {\n    // returns in range [0,1]\n    return this.nextInt() / (this.m - 1);\n  }\n\n  /**\n   * Returns an integer in the range start (inclusive) to end (exclusive).\n   * @param start Lower bound, inclusive.\n   * @param end Upper bound, exclusive.\n   */\n  nextRange(start: number, end: number) {\n    // returns in range [start, end): including start, excluding end\n    // can't modulu nextInt because of weak randomness in lower bits\n    const rangeSize = end - start;\n    const randomUnder1 = this.nextInt() / this.m;\n    return start + ((randomUnder1 * rangeSize) | 0);\n  }\n\n  chooseIndex(chances: number[]) {\n    const total = chances.reduce((a, b) => a + b);\n    const roll = this.nextRange(1, total + 1);\n    let runningTotal = 0;\n\n    for (let i = 0; i < chances.length; i++) {\n      runningTotal += chances[i];\n      if (roll <= runningTotal) {\n        return i;\n      }\n    }\n\n    return chances.length - 1;\n  }\n\n  chooseKey(chancesMap: {[key: string]: number}) {\n    const values: string[] = [];\n    const chances: number[] = [];\n\n    for (const property in chancesMap) {\n      if (chancesMap.hasOwnProperty(property)) {\n        values.push(property);\n        chances.push(chancesMap[property]);\n      }\n    }\n\n    return values[this.chooseIndex(chances)];\n  }\n}\n","\nimport {Cell} from './cell';\nimport {Console} from './console';\nimport {DEFAULT_FONT, Font} from './font';\nimport {Keys} from './keys';\nimport {Mouse} from './mouse';\nimport {FRAGMENT_SHADER_SOURCE, VERTEX_SHADER_SOURCE} from './shaders';\nimport {TerminalOptions} from './terminaloptions';\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i: number, max: number) {\n  return -1.0 + 2.0 * (i / max);\n}\n\nconst DEFAULT_OPTIONS: TerminalOptions = {\n  font: DEFAULT_FONT,\n  requestFullscreen: false\n};\n\nexport class Terminal extends Console {\n  readonly canvas: HTMLCanvasElement;\n  private readonly font: Font;\n  private readonly pixelWidth: number;\n  private readonly pixelHeight: number;\n  private readonly gl: WebGLRenderingContext;\n  private readonly program: WebGLProgram;\n  private readonly positionAttribLocation: GLint;\n  private readonly textureAttribLocation: GLint;\n  private readonly fgColorAttribLocation: GLint;\n  private readonly bgColorAttribLocation: GLint;\n  private readonly positionsArray: Float32Array;\n  private readonly indexArray: Uint16Array;\n  private readonly textureArray: Float32Array;\n  private readonly foregroundUint8Array: Uint8Array;\n  private readonly foregroundDataView: DataView;\n  private readonly backgroundUint8Array: Uint8Array;\n  private readonly backgroundDataView: DataView;\n  private readonly positionBuffer: WebGLBuffer;\n  private readonly indexBuffer: WebGLBuffer;\n  private readonly textureBuffer: WebGLBuffer;\n  private readonly foregroundBuffer: WebGLBuffer;\n  private readonly backgroundBuffer: WebGLBuffer;\n  private readonly texture: WebGLTexture;\n  readonly keys: Keys;\n  readonly mouse: Mouse;\n  update?: Function;\n\n  constructor(\n      canvas: HTMLCanvasElement, width: number, height: number,\n      options?: TerminalOptions) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || DEFAULT_FONT;\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n\n    canvas.width = this.pixelWidth;\n    canvas.height = this.pixelHeight;\n    canvas.style.width = (this.font.scale * this.pixelWidth) + 'px';\n    canvas.style.height = (this.font.scale * this.pixelHeight) + 'px';\n    // canvas.style.imageRendering = 'pixelated';\n    canvas.style.outline = 'none';\n    canvas.tabIndex = 0;\n\n    this.keys = new Keys(canvas);\n    this.mouse = new Mouse(this, options);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext('webgl', {antialias: false});\n    if (!gl) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(\n        program, this.buildShader(gl.VERTEX_SHADER, VERTEX_SHADER_SOURCE));\n    gl.attachShader(\n        program, this.buildShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER_SOURCE));\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (this.font.graphical) {\n      // Set the flag to ignore foreground/background colors, and use texture\n      // directly\n      gl.uniform1i(gl.getUniformLocation(program, 'h'), 1);\n    }\n\n    this.positionAttribLocation = this.getAttribLocation('a');\n    this.textureAttribLocation = this.getAttribLocation('b');\n    this.fgColorAttribLocation = this.getAttribLocation('c');\n    this.bgColorAttribLocation = this.getAttribLocation('d');\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer() as WebGLBuffer;\n    this.indexBuffer = gl.createBuffer() as WebGLBuffer;\n    this.textureBuffer = gl.createBuffer() as WebGLBuffer;\n    this.foregroundBuffer = gl.createBuffer() as WebGLBuffer;\n    this.backgroundBuffer = gl.createBuffer() as WebGLBuffer;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url) as WebGLTexture;\n\n    this.renderLoop();\n  }\n\n  private getAttribLocation(name: string) {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  flush() {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y) as Cell;\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = (cell.charCode % 16);\n        const textureY = ((cell.charCode / 16) | 0);\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.down;\n  }\n\n  isKeyPressed(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    const count = key ? key.downCount : 0;\n    return count === 1 || (count > 30 && count % 3 === 0);\n  }\n\n  getKeyDownCount(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    return key ? key.downCount : 0;\n  }\n\n  private buildShader(type: GLint, source: string) {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error('An error occurred compiling the shader: ');\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error(\n          'An error occurred compiling the shader: ' + gl.getShaderInfoLog(sh));\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  private loadTexture(url: string) {\n    const gl = this.gl;\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]);  // opaque black\n    gl.texImage2D(\n        gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat,\n        srcType, pixel);\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(\n          gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  private render() {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(\n          this.positionAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.textureAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.foregroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.fgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.backgroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.bgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  private renderLoop() {\n    this.keys.updateKeys();\n    this.mouse.update();\n    if (this.update) {\n      this.update();\n    }\n    this.flush();\n    this.render();\n    requestAnimationFrame(this.renderLoop.bind(this));\n  }\n}\n","import {Fullscreenable} from './fullscreenable';\nimport {Rect} from './rect';\nimport {Terminal} from './terminal';\nimport {TerminalOptions} from './terminaloptions';\n\nexport class Mouse {\n  private readonly el: HTMLElement;\n  private readonly width: number;\n  private readonly height: number;\n  private readonly options: TerminalOptions;\n  readonly buttons: boolean[];\n  private prevX: number;\n  private prevY: number;\n  x: number;\n  y: number;\n  dx: number;\n  dy: number;\n\n  constructor(terminal: Terminal, options: TerminalOptions) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.options = options;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.buttons = [false, false, false];\n\n    const el = this.el;\n    el.addEventListener('mousedown', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('mouseup', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('mousemove', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('contextmenu', e => this.handleEvent(e as MouseEvent));\n\n    const touchEventHandler = this.handleTouchEvent.bind(this);\n    el.addEventListener('touchstart', touchEventHandler);\n    el.addEventListener('touchend', touchEventHandler);\n    el.addEventListener('touchcancel', touchEventHandler);\n    el.addEventListener('touchmove', touchEventHandler);\n  }\n\n  private handleTouchEvent(e: TouchEvent) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.type === 'touchend' && this.options.requestFullscreen) {\n      this.requestFullscreen();\n    }\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons[0] = true;\n    } else {\n      this.buttons[0] = false;\n    }\n  }\n\n  private handleEvent(e: MouseEvent) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons[e.button] = true;\n\n      this.el.focus();\n\n      if (this.options.requestFullscreen) {\n        this.requestFullscreen();\n      }\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons[e.button] = false;\n    }\n  }\n\n  private updatePosition(clientX: number, clientY: number) {\n    let rect: ClientRect|DOMRect|Rect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new Rect(Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new Rect(0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = (this.width * (clientX - rect.left) / rect.width) | 0;\n    this.y = (this.height * (clientY - rect.top) / rect.height) | 0;\n  }\n\n  private requestFullscreen() {\n    const canvas = this.el as Fullscreenable;\n    if (canvas.requestFullscreen) {\n      canvas.requestFullscreen();\n    } else if (canvas.webkitRequestFullscreen) {\n      canvas.webkitRequestFullscreen();\n    } else if (canvas.mozRequestFullScreen) {\n      canvas.mozRequestFullScreen();\n    }\n  }\n\n  update() {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n  }\n}","\n/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nexport const VERTEX_SHADER_SOURCE = 'attribute vec2 a;' +\n    'attribute vec2 b;' +\n    'attribute vec3 c;' +\n    'attribute vec3 d;' +\n    'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'void main(void){' +\n    'gl_Position=vec4(a.x,a.y,0,1);' +\n    'e=b/16.0;' +\n    'f=vec4(c.r,c.g,c.b,1);' +\n    'g=vec4(d.r,d.g,d.b,1);' +\n    '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * h = uniform bool uGraphicalTiles;\n * s = uniform sampler2D uSampler;\n */\nexport const FRAGMENT_SHADER_SOURCE = 'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'uniform bool h;' +\n    'uniform sampler2D s;' +\n    'void main(void){' +\n    'gl_FragColor=texture2D(s,e);' +\n    'if(h){' +\n    // Using graphical tiles\n    'if(gl_FragColor.a<0.1){' +\n    // The current pixel of the foreground sprite is transparent.\n    // Draw the background tile instead.\n    // Use the background red channel for the tile X coordinate.\n    // Use the background green channel for the tile Y coordinate.\n    // Use the fractional component of the texture coord for the pixel offset.\n    'gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);' +\n    '}' +\n    '}else{' +\n    // Using ASCII characters\n    'if(gl_FragColor.r<0.1) {' +\n    // Black background, so use bgColor\n    'gl_FragColor=g;' +\n    '} else {' +\n    // White background, so use fgColor\n    'gl_FragColor=f;' +\n    '}' +\n    '}' +\n    '}';\n"],"sourceRoot":""}