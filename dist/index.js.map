{"version":3,"file":"index.js","sources":["../src/blendmode.ts","../src/color.ts","../src/colors.ts","../src/cell.ts","../src/chars.ts","../src/console.ts","../src/font.ts","../src/fov.ts","../src/image.ts","../src/keys.ts","../src/dialog.ts","../src/rect.ts","../src/path.ts","../src/mouse.ts","../src/shaders.ts","../src/terminal.ts","../src/gui.ts","../src/messagedialog.ts","../src/point.ts","../src/rng.ts","../src/selectdialog.ts"],"sourcesContent":["\n/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nexport enum BlendMode {\n\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None = 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend = 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add = 2\n}\n","\nexport type Color = number;\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromRgb(r: number, g: number, b: number, a?: number): Color {\n  if (a === undefined) {\n    a = 255;\n  }\n  return ((r << 24) + (g << 16) + (b << 8) + a) as Color;\n}\n\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromHsv(h: number, s: number, v: number, a?: number): Color {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      r = v, g = t, b = p;\n      break;\n    case 1:\n      r = q, g = v, b = p;\n      break;\n    case 2:\n      r = p, g = v, b = t;\n      break;\n    case 3:\n      r = p, g = q, b = v;\n      break;\n    case 4:\n      r = t, g = p, b = v;\n      break;\n    case 5:\n      r = v, g = p, b = q;\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n","\nimport {fromRgb} from './color';\n\nexport class Colors {\n  static readonly BLACK = fromRgb(0, 0, 0);\n  static readonly WHITE = fromRgb(0xff, 0xff, 0xff);\n  static readonly LIGHT_GRAY = fromRgb(0xaa, 0xaa, 0xaa);\n  static readonly DARK_GRAY = fromRgb(0x55, 0x55, 0x55);\n  static readonly YELLOW = fromRgb(0xff, 0xff, 0x55);\n  static readonly BROWN = fromRgb(0xaa, 0x55, 0x00);\n  static readonly LIGHT_RED = fromRgb(0xff, 0x55, 0x55);\n  static readonly DARK_RED = fromRgb(0xaa, 0x00, 0x00);\n  static readonly LIGHT_GREEN = fromRgb(0x55, 0xff, 0x55);\n  static readonly DARK_GREEN = fromRgb(0x00, 0xaa, 0x00);\n  static readonly LIGHT_CYAN = fromRgb(0x55, 0xff, 0xff);\n  static readonly DARK_CYAN = fromRgb(0x00, 0xaa, 0xaa);\n  static readonly LIGHT_BLUE = fromRgb(0x55, 0x55, 0xff);\n  static readonly DARK_BLUE = fromRgb(0x00, 0x00, 0xaa);\n  static readonly LIGHT_MAGENTA = fromRgb(0xff, 0x55, 0xff);\n  static readonly DARK_MAGENTA = fromRgb(0xaa, 0x00, 0xaa);\n  static readonly ORANGE = fromRgb(0xff, 0x88, 0x00);\n}\n","\nimport {BlendMode} from './blendmode';\nimport {Color, fromRgb} from './color';\nimport {Colors} from './colors';\n\nfunction convertCharCode(charCode: number|string): number {\n  if ((typeof charCode === 'string') && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode as number;\n  }\n}\n\nexport class Cell {\n  charCode: number;\n  fg: Color;\n  bg: Color;\n  meta?: object;\n  dirty: boolean;\n\n  constructor(charCode?: number|string, fg?: Color, bg?: Color, meta?: object) {\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode) as number;\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = Colors.WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = Colors.BLACK;\n    }\n\n    if (meta !== undefined) {\n      this.meta = meta;\n    }\n\n    this.dirty = true;\n  }\n\n  setCharCode(charCode: number) {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg?: Color) {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg?: Color) {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setMeta(meta?: object) {\n    if (meta !== undefined) {\n      this.meta = meta;\n      this.dirty = true;\n    }\n  }\n\n  setValue(\n      charCode: number|string|Cell, fg?: Color, bg?: Color, meta?: object) {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n      this.setForeground(fg);\n      this.setBackground(bg);\n      this.setMeta(meta);\n    } else {\n      this.drawCell(charCode, BlendMode.None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell: Cell, blendMode: BlendMode) {\n    const alpha = otherCell.bg & 0xFF;\n\n    if (blendMode === BlendMode.None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === BlendMode.None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n\n    this.setMeta(otherCell.meta);\n  }\n\n  private blendColors(c1: Color, c2: Color, blendMode: BlendMode): Color {\n    const alpha = c2 & 0xFF;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xFF;\n    const g1 = (c1 >> 16) & 0xFF;\n    const b1 = (c1 >> 8) & 0xFF;\n    const r2 = (c2 >> 24) & 0xFF;\n    const g2 = (c2 >> 16) & 0xFF;\n    const b2 = (c2 >> 8) & 0xFF;\n\n    switch (blendMode) {\n      case BlendMode.Blend:\n        return fromRgb(\n            (w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0,\n            (w1 * b1 + w2 * b2) | 0);\n\n      case BlendMode.Add:\n        return fromRgb(\n            this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0),\n            this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  private clamp(x: number): number {\n    return Math.min(255, x);\n  }\n}\n","\n\n// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nexport class Chars {\n  static readonly SMILEY = 1;\n  static readonly INVERSE_SMILEY = 2;\n  static readonly HEART = 3;\n  static readonly DIAMOND = 4;\n  static readonly CLUB = 5;\n  static readonly SPADE = 6;\n  static readonly BULLET = 7;\n  static readonly INVERSE_BULLET = 8;\n\n  static readonly LIGHT_SHADE = 176;\n  static readonly MEDIUM_SHADE = 177;\n  static readonly DARK_SHADE = 178;\n\n  static readonly BOX_SINGLE_VERTICAL = 179;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT = 180;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT = 185;\n  static readonly BOX_DOUBLE_VERTICAL = 186;\n  static readonly BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT = 187;\n  static readonly BOX_DOUBLE_UP_AND_DOUBLE_LEFT = 188;\n  static readonly BOX_SINGLE_DOWN_AND_SINGLE_LEFT = 191;\n  static readonly BOX_SINGLE_UP_AND_SINGLE_RIGHT = 192;\n  static readonly BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP = 193;\n  static readonly BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN = 194;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT = 195;\n  static readonly BOX_SINGLE_HORIZONTAL = 196;\n  static readonly BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL = 197;\n  static readonly BOX_DOUBLE_UP_AND_DOUBLE_RIGHT = 200;\n  static readonly BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT = 201;\n  static readonly BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP = 202;\n  static readonly BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN = 203;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT = 204;\n  static readonly BOX_DOUBLE_HORIZONTAL = 205;\n  static readonly BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL = 206;\n  static readonly BOX_SINGLE_UP_AND_SINGLE_LEFT = 13 * 16 + 9;\n  static readonly BOX_SINGLE_DOWN_AND_SINGLE_RIGHT = 13 * 16 + 10;\n\n  static readonly BLOCK_TOP_LEFT = 14 * 16 + 2;\n  static readonly BLOCK_TOP_RIGHT = 14 * 16 + 3;\n  static readonly BLOCK_TOP_HALF = 14 * 16 + 4;\n  static readonly BLOCK_BOTTOM_LEFT = 14 * 16 + 8;\n  static readonly BLOCK_BOTTOM_RIGHT = 14 * 16 + 5;\n  static readonly BLOCK_RIGHT_HALF = 14 * 16 + 7;\n  static readonly BLOCK_CHECKER = 14 * 16 + 6;\n}\n","\nimport {BlendMode} from './blendmode';\nimport {Cell} from './cell';\nimport {Chars} from './chars';\nimport {Color} from './color';\n\nexport class Console {\n  readonly width: number;\n  readonly height: number;\n  private readonly grid: Cell[][];\n\n  constructor(width: number, height: number) {\n    this.width = width;\n    this.height = height;\n    this.grid = new Array();\n\n    for (let y = 0; y < height; y++) {\n      const row = new Array();\n      for (let x = 0; x < width; x++) {\n        row.push(new Cell());\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n  }\n\n  clear() {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x: number, y: number) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  drawChar(\n      x: number, y: number, c: number|string|Cell, fg?: Color, bg?: Color) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x: number, y: number, str: string, fg?: Color, bg?: Color) {\n    for (let i = 0; i < str.length; i++) {\n      this.drawChar(x + i, y, str.charCodeAt(i), fg, bg);\n    }\n  }\n\n  drawCenteredString(\n      x: number, y: number, str: string, fg?: Color, bg?: Color) {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawHLine(\n      x: number, y: number, width: number, c: number|Cell, fg?: Color,\n      bg?: Color) {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(\n      x: number, y: number, height: number, c: number|Cell, fg?: Color,\n      bg?: Color) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(\n      x: number, y: number, width: number, height: number, c: number|Cell,\n      fg?: Color, bg?: Color) {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n      x: number, y: number, width: number, height: number, topChar: number,\n      rightChar: number, bottomChar: number, leftChar: number,\n      topLeftChar: number, topRightChar: number, bottomRightChar: number,\n      bottomLeftChar: number, fg?: Color, bg?: Color) {\n    this.fillRect(x, y, width, height, 0, fg, bg);\n\n    this.drawHLine(x, y, width, topChar);\n    this.drawHLine(x, y + height - 1, width, bottomChar);\n\n    this.drawVLine(x, y, height, leftChar);\n    this.drawVLine(x + width - 1, y, height, rightChar);\n\n    this.drawChar(x, y, topLeftChar);\n    this.drawChar(x + width - 1, y, topRightChar);\n    this.drawChar(x, y + height - 1, bottomLeftChar);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar);\n  }\n\n  drawSingleBox(\n      x: number, y: number, width: number, height: number, fg?: Color,\n      bg?: Color) {\n    this.drawBox(\n        x, y, width, height, Chars.BOX_SINGLE_HORIZONTAL,\n        Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_HORIZONTAL,\n        Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n        Chars.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n        Chars.BOX_SINGLE_UP_AND_SINGLE_LEFT,\n        Chars.BOX_SINGLE_UP_AND_SINGLE_RIGHT, fg, bg);\n  }\n\n  drawDoubleBox(\n      x: number, y: number, width: number, height: number, fg?: Color,\n      bg?: Color) {\n    this.drawBox(\n        x, y, width, height, Chars.BOX_DOUBLE_HORIZONTAL,\n        Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_HORIZONTAL,\n        Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n        Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n        Chars.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n        Chars.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT, fg, bg);\n  }\n\n  fillRect(\n      x: number, y: number, width: number, height: number, c: number|Cell,\n      fg?: Color, bg?: Color) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n      dstX: number, dstY: number, srcConsole: Console, srcX: number,\n      srcY: number, srcWidth: number, srcHeight: number,\n      blendMode?: BlendMode) {\n    blendMode = blendMode || BlendMode.None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  private drawCell(x: number, y: number, cell: Cell, blendMode: BlendMode) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n}\n","\nexport class Font {\n  readonly url: string;\n  readonly charWidth: number;\n  readonly charHeight: number;\n  readonly scale: number;\n  readonly graphical: boolean;\n\n  constructor(\n      url: string, charWidth: number, charHeight: number, scale?: number,\n      graphical?: boolean) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n    this.graphical = !!graphical;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAA' +\n    'ACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEtElEQVRIx2WTsYsUMRTGPxT' +\n    'OJniWgRMFsbR4oJyDBE+s/AdsrIJKtEixIKwPHOc8tbCwsdNKLCy0tlBQGBCnel55C' +\n    'K5y1dqIbKVbhBlfZkYP8UsI2d98ed+bMAtUVTxUHELn3Krb2HwCbHVtUSo4f/5AOHn' +\n    'lEvD8c1sWhf229WQ1bGy63tG2pXu/9e52oCvfgHfvy7JtMxDXgyffimKnzEfETq71R' +\n    'w6pclGpFvNLORYoihzLdrd+gjv7bNisYK3FoN2DLnx+D+esJRy3HZZnq/CZ9aA1vg6' +\n    'uQ9vacEvykbatu6pShw1rooYqOzqnNSqsceWss9Qe76ymuLD2sNpLAXS3RIe/4hgJh' +\n    'bceWSs9SE30RIEUmAzaWoraW0fDeUZMdgpvu4QEhYTW0AyjI1dSRxDkGhNQnR2Rmil' +\n    'yCoHuYE+jn4n5cCoSc47wDFmIuNqLSH9EMCNj4rI2IkQ+WYNERSFmabkkjTAW38mb1' +\n    'giJAdRB0K2o34ulCYEATokNs+cJkabQf22gpORS2zrhI/NF0xRoOIR4+XIQMsH/mEd' +\n    '8lVCH69drBdG3PxsFZR2Y60SG/c5XBal3bGt8vNxsN6gl1/BaQzdNE8GSUxZnhXne5' +\n    'pT/lFiHSNNIyzUfAoIEedUD8d4WPdglBVEee7IRKKUsFOwUTN7aBvAzPqygjXTZGws' +\n    'FHIWEfzTU+JUMFofnzImahlvex/hPHQi7OIwCu2R3JxkRPAyiruP96f2zYT+NEw70f' +\n    'cmACVLKQqbaFbUiQBlqSV4CWaadDCSI1L4M2dFkMH3LU16YOX+acyOMUUtggr86hF6' +\n    'H7e502NIAyNKswGz6qSz7C0oKEBEk1uMF5XdoMuD+goTUoaAsvTkl3Mby6gC8WSztl' +\n    'GJjkqagxeLIXie9GLYS76CLlF4IIvQeFFgXNEQXUIMdsxNdJsWECbXIijErdRDRFGG' +\n    'IpLNleVaqlDIQsOSHgX1dK0gJVPFGVW2Q1tBi6vB73+ggi7MMzx6NoDiDgyBEEdIBI' +\n    'EasIW3KYC2lvLotFt60zCwijWwvdrgCb4qqBzt+TuoYf6dG5vPIVmtsM3NVmZLL9Fo' +\n    '+Af9exwTWGjOdOkcO83lGRNbOZjHgkrZhTwp4knEM9BzMCAGGWJbfzzr/JlU3rJxES' +\n    'TkTqF+YK9esOiSDWVVJMNsfndaotAkRgB0eP3X4R0f3WwDHLn7RVrh26+tYtwI8eHn' +\n    'TWnvfnx/A6CCiNz/X258Vjw5mfrayvrJSp8Gx1GR1/GxrWg6OlJLWWEeV7FBDHS4DS' +\n    '3ZwQPUH6C8d0+k6hjGC2WwEd0fAdHrjV3e6+9WOwDARoDPiaNfpLGVDH+uMGKpIygV' +\n    '0tiOoZAR3RwCMAPiUWLzGiEUH6ztM4n1QTffRA+rwKeibnWPmHnAH89N7v0tEGUAdL' +\n    'jAzFCy1HZtbi+rIAHYARVJBXT1g7CkDqLpusdphsaoJvm9xa2sEdJ+IEmHr3gikH8D' +\n    'Whz9A1YMXAFZXVxei4gwe7YFEGWyNgJkN97Ej+PutEuabFaEAipIHcOLze0IU8EGTQ' +\n    'QJ/ZiAC1hUuO9LJW5JQKDjoFWjUtzWBylZlqUDRxzUmDMog4enaQ1Kyp/1Y7v1vfwP' +\n    'x3em+Z+50IgAAAABJRU5ErkJggg==';\n\nexport const DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n","\n// MRPAS\n// Mingos' Restrictive Precise Angle Shadowcasting\n// https://bitbucket.org/mingos/mrpas/overview\n\nexport class FovCell {\n  readonly x: number;\n  readonly y: number;\n  blocked: boolean;\n  visible: boolean;\n  g: number;\n  h: number;\n  prev: FovCell|null;\n\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n    this.blocked = false;\n    this.visible = false;\n    this.g = 0.0;\n    this.h = 0.0;\n    this.prev = null;\n  }\n}\n\nexport class FovMap {\n  readonly width: number;\n  readonly height: number;\n  readonly grid: FovCell[][];\n  private originX: number;\n  private originY: number;\n  private minX: number;\n  private maxX: number;\n  private minY: number;\n  private maxY: number;\n  private radius: number;\n\n  /**\n   * Creates a new FOV map.\n   * @constructor\n   * @param width\n   * @param height\n   * @param blockedFunc\n   */\n  constructor(width: number, height: number, blockedFunc?: Function) {\n    this.width = width;\n    this.height = height;\n\n    this.grid = new Array(height);\n    for (let y = 0; y < height; y++) {\n      this.grid[y] = new Array(width);\n      for (let x = 0; x < width; x++) {\n        this.grid[y][x] = new FovCell(x, y);\n      }\n    }\n\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  getCell(x: number, y: number): FovCell {\n    return this.grid[y][x];\n  }\n\n  setBlocked(x: number, y: number, blocked: boolean) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  isVisible(x: number, y: number) {\n    if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  private computeOctantY(deltaX: number, deltaY: number) {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (y = this.originY + deltaY; y >= this.minY && y <= this.maxY;\n         y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          x = this.originX + (processedCell * deltaX);\n           processedCell <= iteration && x >= this.minX && x <= this.maxX;\n           x += deltaX, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y - deltaY][x].visible &&\n                !this.grid[y - deltaY][x].blocked) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blocked)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blocked) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blocked) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  private computeOctantX(deltaX: number, deltaY: number) {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (x = this.originX + deltaX; x >= this.minX && x <= this.maxX;\n         x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          y = this.originY + (processedCell * deltaY);\n           processedCell <= iteration && y >= this.minY && y <= this.maxY;\n           y += deltaY, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y][x - deltaX].visible &&\n                !this.grid[y][x - deltaX].blocked) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blocked)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blocked) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blocked) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX: number, originY: number, radius: number) {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.grid[y][x].visible = false;\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n    this.minX = Math.max(0, originX - radius);\n    this.minY = Math.max(0, originY - radius);\n    this.maxX = Math.min(this.width - 1, originX + radius);\n    this.maxY = Math.min(this.height - 1, originY + radius);\n\n    this.computeOctantY(1, 1);\n    this.computeOctantX(1, 1);\n    this.computeOctantY(1, -1);\n    this.computeOctantX(1, -1);\n    this.computeOctantY(-1, 1);\n    this.computeOctantX(-1, 1);\n    this.computeOctantY(-1, -1);\n    this.computeOctantX(-1, -1);\n  }\n}\n","\nimport {Cell} from './cell';\nimport {Chars} from './chars';\nimport {Color, fromRgb} from './color';\nimport {Console} from './console';\n\n/**\n * All available 2x2 patterns for 2x image loading.\n */\nconst PATTERNS = [\n  {charCode: Chars.BLOCK_TOP_LEFT, active: [1, 0, 0, 0]},\n  {charCode: Chars.BLOCK_TOP_RIGHT, active: [0, 1, 0, 0]},\n  {charCode: Chars.BLOCK_TOP_HALF, active: [1, 1, 0, 0]},\n  {charCode: Chars.BLOCK_BOTTOM_LEFT, active: [0, 0, 1, 0]},\n  {charCode: Chars.BLOCK_BOTTOM_RIGHT, active: [0, 0, 0, 1]},\n  {charCode: Chars.BLOCK_RIGHT_HALF, active: [0, 1, 0, 1]},\n  {charCode: Chars.BLOCK_CHECKER, active: [1, 0, 0, 1]},\n];\n\nexport function loadImage(url: string, callback: Function) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w, h);\n    let i = 0;\n\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        const cell = result.getCell(x, y) as Cell;\n        cell.setBackground(fromRgb(data[i++], data[i++], data[i++], data[i++]));\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nexport function loadImage2x(url: string, callback: Function) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new Console(w / 2, h / 2);\n\n    for (let y = 0; y < h; y += 2) {\n      for (let x = 0; x < w; x += 2) {\n        draw2x2(result, data, x, y, w);\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nfunction getImageData(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n  ctx.drawImage(img, 0, 0);\n\n  return ctx.getImageData(0, 0, img.width, img.height).data;\n}\n\nfunction draw2x2(\n    con: Console, data: Uint8ClampedArray, x: number, y: number, w: number) {\n  // Top left\n  const i1 = 4 * (y * w + x);\n  const r1 = data[i1];\n  const g1 = data[i1 + 1];\n  const b1 = data[i1 + 2];\n\n  // Top right\n  const i2 = 4 * (y * w + x + 1);\n  const r2 = data[i2];\n  const g2 = data[i2 + 1];\n  const b2 = data[i2 + 2];\n\n  // Bottom left\n  const i3 = 4 * ((y + 1) * w + x);\n  const r3 = data[i3];\n  const g3 = data[i3 + 1];\n  const b3 = data[i3 + 2];\n\n  // Bottom right\n  const i4 = 4 * ((y + 1) * w + x + 1);\n  const r4 = data[i4];\n  const g4 = data[i4 + 1];\n  const b4 = data[i4 + 2];\n\n  const colors = [[r1, g1, b1], [r2, g2, b2], [r3, g3, b3], [r4, g4, b4]];\n\n  // For each possible pattern, calculate the total error\n  // Find the pattern with minum error\n\n  let minError = Number.MAX_VALUE;\n  let bestCharCode = 0;\n  let bestBg = null;\n  let bestFg = null;\n\n  for (let i = 0; i < PATTERNS.length; i++) {\n    const pattern = PATTERNS[i];\n    const patternColors = computeColors(pattern.active, colors);\n    if (patternColors.error < minError) {\n      minError = patternColors.error;\n      bestCharCode = pattern.charCode;\n      bestBg = patternColors.bg;\n      bestFg = patternColors.fg;\n    }\n  }\n\n  con.drawChar(\n      x / 2, y / 2, bestCharCode, arrayToColor(bestFg as number[]),\n      arrayToColor(bestBg as number[]));\n}\n\nfunction computeColors(pattern: number[], colors: number[][]) {\n  const sum = [[0, 0, 0], [0, 0, 0]];\n  const avg = [[0, 0, 0], [0, 0, 0]];\n  const count = [0, 0];\n\n  for (let i = 0; i < 4; i++) {\n    for (let j = 0; j < 3; j++) {\n      sum[pattern[i]][j] += colors[i][j];\n    }\n    count[pattern[i]]++;\n  }\n\n  for (let i = 0; i < 2; i++) {\n    for (let j = 0; j < 3; j++) {\n      avg[i][j] = sum[i][j] / count[i];\n    }\n  }\n\n  let error = 0.0;\n\n  for (let i = 0; i < 4; i++) {\n    let cellError = 0.0;\n    for (let j = 0; j < 3; j++) {\n      const delta = colors[i][j] - avg[pattern[i]][j];\n      cellError += delta * delta;\n    }\n    error += Math.sqrt(cellError);\n  }\n\n  return {bg: avg[0], fg: avg[1], error};\n}\n\nfunction arrayToColor(rgb: number[]): Color {\n  return fromRgb(rgb[0], rgb[1], rgb[2]);\n}\n","\n/**\n * Number of keys to track.\n */\nconst KEY_COUNT = 256;\n\n/**\n * Creates a new key instance.\n */\nexport class Key {\n  down: boolean;\n  downCount: number;\n\n  constructor() {\n    this.down = false;\n    this.downCount = 0;\n  }\n}\n\nexport class Keys {\n  private readonly keys: Key[];\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el: Element) {\n    this.keys = new Array(KEY_COUNT);\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i] = new Key();\n    }\n\n    el.addEventListener('keydown', e => this.setKey(e as KeyboardEvent, true));\n    el.addEventListener('keyup', e => this.setKey(e as KeyboardEvent, false));\n  }\n\n\n  setKey(e: KeyboardEvent, state: boolean) {\n    e.stopPropagation();\n    e.preventDefault();\n    const keyCode = e.keyCode;\n    if (keyCode >= 0 && keyCode < KEY_COUNT) {\n      this.keys[keyCode].down = state;\n    }\n  }\n\n  updateKeys() {\n    for (let i = 0; i < KEY_COUNT; i++) {\n      if (this.keys[i].down) {\n        this.keys[i].downCount++;\n      } else {\n        this.keys[i].downCount = 0;\n      }\n    }\n  }\n\n  getKey(keyCode: number) {\n    return keyCode >= 0 && keyCode < KEY_COUNT ? this.keys[keyCode] : null;\n  }\n\n  static readonly VK_CANCEL = 3;\n  static readonly VK_HELP = 6;\n  static readonly VK_BACK_SPACE = 8;\n  static readonly VK_TAB = 9;\n  static readonly VK_CLEAR = 12;\n  static readonly VK_ENTER = 13;\n  static readonly VK_SHIFT = 16;\n  static readonly VK_CONTROL = 17;\n  static readonly VK_ALT = 18;\n  static readonly VK_PAUSE = 19;\n  static readonly VK_CAPS_LOCK = 20;\n  static readonly VK_ESCAPE = 27;\n  static readonly VK_SPACE = 32;\n  static readonly VK_PAGE_UP = 33;\n  static readonly VK_PAGE_DOWN = 34;\n  static readonly VK_END = 35;\n  static readonly VK_HOME = 36;\n  static readonly VK_LEFT = 37;\n  static readonly VK_UP = 38;\n  static readonly VK_RIGHT = 39;\n  static readonly VK_DOWN = 40;\n  static readonly VK_PRINTSCREEN = 44;\n  static readonly VK_INSERT = 45;\n  static readonly VK_DELETE = 46;\n  static readonly VK_0 = 48;\n  static readonly VK_1 = 49;\n  static readonly VK_2 = 50;\n  static readonly VK_3 = 51;\n  static readonly VK_4 = 52;\n  static readonly VK_5 = 53;\n  static readonly VK_6 = 54;\n  static readonly VK_7 = 55;\n  static readonly VK_8 = 56;\n  static readonly VK_9 = 57;\n  static readonly VK_COLON = 58;\n  static readonly VK_SEMICOLON = 59;\n  static readonly VK_LESS_THAN = 60;\n  static readonly VK_EQUALS = 61;\n  static readonly VK_GREATER_THAN = 62;\n  static readonly VK_QUESTION_MARK = 63;\n  static readonly VK_AT = 64;\n  static readonly VK_A = 65;\n  static readonly VK_B = 66;\n  static readonly VK_C = 67;\n  static readonly VK_D = 68;\n  static readonly VK_E = 69;\n  static readonly VK_F = 70;\n  static readonly VK_G = 71;\n  static readonly VK_H = 72;\n  static readonly VK_I = 73;\n  static readonly VK_J = 74;\n  static readonly VK_K = 75;\n  static readonly VK_L = 76;\n  static readonly VK_M = 77;\n  static readonly VK_N = 78;\n  static readonly VK_O = 79;\n  static readonly VK_P = 80;\n  static readonly VK_Q = 81;\n  static readonly VK_R = 82;\n  static readonly VK_S = 83;\n  static readonly VK_T = 84;\n  static readonly VK_U = 85;\n  static readonly VK_V = 86;\n  static readonly VK_W = 87;\n  static readonly VK_X = 88;\n  static readonly VK_Y = 89;\n  static readonly VK_Z = 90;\n  static readonly VK_CONTEXT_MENU = 93;\n  static readonly VK_NUMPAD0 = 96;\n  static readonly VK_NUMPAD1 = 97;\n  static readonly VK_NUMPAD2 = 98;\n  static readonly VK_NUMPAD3 = 99;\n  static readonly VK_NUMPAD4 = 100;\n  static readonly VK_NUMPAD5 = 101;\n  static readonly VK_NUMPAD6 = 102;\n  static readonly VK_NUMPAD7 = 103;\n  static readonly VK_NUMPAD8 = 104;\n  static readonly VK_NUMPAD9 = 105;\n  static readonly VK_MULTIPLY = 106;\n  static readonly VK_ADD = 107;\n  static readonly VK_SEPARATOR = 108;\n  static readonly VK_SUBTRACT = 109;\n  static readonly VK_DECIMAL = 110;\n  static readonly VK_DIVIDE = 111;\n  static readonly VK_F1 = 112;\n  static readonly VK_F2 = 113;\n  static readonly VK_F3 = 114;\n  static readonly VK_F4 = 115;\n  static readonly VK_F5 = 116;\n  static readonly VK_F6 = 117;\n  static readonly VK_F7 = 118;\n  static readonly VK_F8 = 119;\n  static readonly VK_F9 = 120;\n  static readonly VK_F10 = 121;\n  static readonly VK_F11 = 122;\n  static readonly VK_F12 = 123;\n  static readonly VK_F13 = 124;\n  static readonly VK_F14 = 125;\n  static readonly VK_F15 = 126;\n  static readonly VK_F16 = 127;\n  static readonly VK_F17 = 128;\n  static readonly VK_F18 = 129;\n  static readonly VK_F19 = 130;\n  static readonly VK_F20 = 131;\n  static readonly VK_F21 = 132;\n  static readonly VK_F22 = 133;\n  static readonly VK_F23 = 134;\n  static readonly VK_F24 = 135;\n  static readonly VK_NUM_LOCK = 144;\n  static readonly VK_SCROLL_LOCK = 145;\n  static readonly VK_CIRCUMFLEX = 160;\n  static readonly VK_EXCLAMATION = 161;\n  static readonly VK_DOUBLE_QUOTE = 162;\n  static readonly VK_HASH = 163;\n  static readonly VK_DOLLAR = 164;\n  static readonly VK_PERCENT = 165;\n  static readonly VK_AMPERSAND = 166;\n  static readonly VK_UNDERSCORE = 167;\n  static readonly VK_OPEN_PAREN = 168;\n  static readonly VK_CLOSE_PAREN = 169;\n  static readonly VK_ASTERISK = 170;\n  static readonly VK_PLUS = 171;\n  static readonly VK_PIPE = 172;\n  static readonly VK_HYPHEN_MINUS = 173;\n  static readonly VK_OPEN_CURLY_BRACKET = 174;\n  static readonly VK_CLOSE_CURLY_BRACKET = 175;\n  static readonly VK_TILDE = 176;\n  static readonly VK_COMMA = 188;\n  static readonly VK_PERIOD = 190;\n  static readonly VK_SLASH = 191;\n  static readonly VK_BACK_QUOTE = 192;\n  static readonly VK_OPEN_BRACKET = 219;\n  static readonly VK_BACK_SLASH = 220;\n  static readonly VK_CLOSE_BRACKET = 221;\n  static readonly VK_QUOTE = 222;\n  static readonly VK_META = 224;\n  static readonly VK_ALTGR = 225;\n  static readonly VK_WIN = 91;\n  static readonly VK_KANA = 21;\n  static readonly VK_HANGUL = 21;\n  static readonly VK_EISU = 22;\n  static readonly VK_JUNJA = 23;\n  static readonly VK_FINAL = 24;\n  static readonly VK_HANJA = 25;\n  static readonly VK_KANJI = 25;\n  static readonly VK_CONVERT = 28;\n  static readonly VK_NONCONVERT = 29;\n  static readonly VK_ACCEPT = 30;\n  static readonly VK_MODECHANGE = 31;\n  static readonly VK_SELECT = 41;\n  static readonly VK_PRINT = 42;\n  static readonly VK_EXECUTE = 43;\n  static readonly VK_SLEEP = 95;\n}\n","\nimport {Colors} from './colors';\nimport {Rect} from './rect';\nimport {Terminal} from './terminal';\n\nexport abstract class Dialog {\n  readonly terminal: Terminal;\n  readonly rect: Rect;\n  readonly title: string;\n\n  constructor(terminal: Terminal, rect: Rect, title: string) {\n    this.terminal = terminal;\n    this.rect = rect;\n    this.title = title;\n  }\n\n  draw(term: Terminal) {\n    const {x, y, width, height} = this.rect;\n    term.fillRect(x, y, width, height, 0, Colors.WHITE, Colors.BLACK);\n    term.drawSingleBox(x, y, width, height);\n    term.drawCenteredString(x + (width / 2) | 0, y, ' ' + this.title + ' ');\n    this.drawContents();\n  }\n\n  abstract drawContents(): void;\n\n  abstract handleInput(): object|boolean;\n}\n","\nexport class Rect {\n  readonly x: number;\n  readonly y: number;\n  readonly left: number;\n  readonly top: number;\n  readonly width: number;\n  readonly height: number;\n\n  constructor(x: number, y: number, width: number, height: number) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n  }\n}\n","\nimport {FovCell, FovMap} from './fov';\nimport {Point} from './point';\n\nconst dxs = [-1, 0, 1, -1, 1, -1, 0, 1];\nconst dys = [-1, -1, -1, 0, 0, 1, 1, 1];\nconst costs = [1.5, 1, 1.5, 1, 1, 1.5, 1, 1.5];\n\n/**\n * Calculates Dijkstra's algorithm.\n *\n * @param {!Object} source Starting point, must have x and y properties.\n * @param {!Object=} opt_dest Optional destination point, must have x and y properties.\n * @param {!number=} opt_maxDist Optional maximum distance to examine.\n * @return {?Array} Array of steps if destination found; null otherwise.\n */\nexport function computePath(\n    map: FovMap, source: Point, dest: Point, maxDist: number) {\n  clearDijkstra(map, dest);\n\n  const sourceCell = map.grid[source.y][source.x];\n  sourceCell.g = 0.0;\n\n  const q: FovCell[] = [sourceCell];\n\n  while (q.length > 0) {\n    const u = getMinCell(q);\n\n    if (u.x === dest.x && u.y === dest.y) {\n      return buildPath(u);\n    }\n\n    for (let i = 0; i < dxs.length; i++) {\n      const x = u.x + dxs[i];\n      const y = u.y + dys[i];\n      if (x >= 0 && x < map.width && y >= 0 && y < map.height) {\n        const v = map.grid[y][x];\n        const alt = u.g + costs[i];\n        if (alt < v.g && alt <= maxDist && !map.grid[y][x].blocked) {\n          v.g = alt;\n          v.prev = u;\n          q.push(v);\n        }\n      }\n    }\n  }\n  return null;\n}\n\nfunction clearDijkstra(map: FovMap, dest: Point) {\n  for (let y = 0; y < map.height; y++) {\n    for (let x = 0; x < map.width; x++) {\n      const cell = map.grid[y][x];\n      cell.g = Infinity;\n      cell.h = Math.min(Math.abs(x - dest.x), Math.abs(y - dest.y));\n      cell.prev = null;\n    }\n  }\n}\n\nfunction getMinCell(q: FovCell[]): FovCell {\n  let bestCell = null;\n  let bestIndex = -1;\n  let minDist = Infinity;\n\n  for (let i = 0; i < q.length; i++) {\n    const cell = q[i];\n    if (cell.g !== Infinity && cell.g + cell.h < minDist) {\n      bestCell = cell;\n      bestIndex = i;\n      minDist = cell.g + cell.h;\n    }\n  }\n\n  q.splice(bestIndex, 1);\n  return bestCell as FovCell;\n}\n\nfunction buildPath(cell: FovCell) {\n  const result = [];\n  let curr: FovCell|null = cell;\n  while (curr) {\n    result.push(curr);\n    curr = curr.prev;\n  }\n  result.reverse();\n  return result;\n}\n","import {Fullscreenable} from './fullscreenable';\nimport {Rect} from './rect';\nimport {Terminal} from './terminal';\nimport {TerminalOptions} from './terminaloptions';\n\nexport class Mouse {\n  private readonly el: HTMLElement;\n  private readonly width: number;\n  private readonly height: number;\n  private readonly options: TerminalOptions;\n  readonly buttons: boolean[];\n  private prevX: number;\n  private prevY: number;\n  x: number;\n  y: number;\n  dx: number;\n  dy: number;\n\n  constructor(terminal: Terminal, options: TerminalOptions) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.options = options;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.buttons = [false, false, false];\n\n    const el = this.el;\n    el.addEventListener('mousedown', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('mouseup', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('mousemove', e => this.handleEvent(e as MouseEvent));\n    el.addEventListener('contextmenu', e => this.handleEvent(e as MouseEvent));\n\n    const touchEventHandler = this.handleTouchEvent.bind(this);\n    el.addEventListener('touchstart', touchEventHandler);\n    el.addEventListener('touchend', touchEventHandler);\n    el.addEventListener('touchcancel', touchEventHandler);\n    el.addEventListener('touchmove', touchEventHandler);\n  }\n\n  private handleTouchEvent(e: TouchEvent) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.type === 'touchend' && this.options.requestFullscreen) {\n      this.requestFullscreen();\n    }\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons[0] = true;\n    } else {\n      this.buttons[0] = false;\n    }\n  }\n\n  private handleEvent(e: MouseEvent) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons[e.button] = true;\n\n      this.el.focus();\n\n      if (this.options.requestFullscreen) {\n        this.requestFullscreen();\n      }\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons[e.button] = false;\n    }\n  }\n\n  private updatePosition(clientX: number, clientY: number) {\n    let rect: ClientRect|DOMRect|Rect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new Rect(Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new Rect(0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = (this.width * (clientX - rect.left) / rect.width) | 0;\n    this.y = (this.height * (clientY - rect.top) / rect.height) | 0;\n  }\n\n  private requestFullscreen() {\n    const canvas = this.el as Fullscreenable;\n    if (canvas.requestFullscreen) {\n      canvas.requestFullscreen();\n    } else if (canvas.webkitRequestFullscreen) {\n      canvas.webkitRequestFullscreen();\n    } else if (canvas.mozRequestFullScreen) {\n      canvas.mozRequestFullScreen();\n    }\n  }\n\n  update() {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n  }\n}","\n/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nexport const VERTEX_SHADER_SOURCE = 'attribute vec2 a;' +\n    'attribute vec2 b;' +\n    'attribute vec3 c;' +\n    'attribute vec3 d;' +\n    'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'void main(void){' +\n    'gl_Position=vec4(a.x,a.y,0,1);' +\n    'e=b/16.0;' +\n    'f=vec4(c.r,c.g,c.b,1);' +\n    'g=vec4(d.r,d.g,d.b,1);' +\n    '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * h = uniform bool uGraphicalTiles;\n * s = uniform sampler2D uSampler;\n */\nexport const FRAGMENT_SHADER_SOURCE = 'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'uniform bool h;' +\n    'uniform sampler2D s;' +\n    'void main(void){' +\n    'gl_FragColor=texture2D(s,e);' +\n    'if(!h){' +\n    'if(gl_FragColor.r<0.1) {' +\n    'gl_FragColor=g;' +\n    '} else {' +\n    'gl_FragColor=f;' +\n    '}' +\n    '}' +\n    '}';\n","\nimport {Cell} from './cell';\nimport {Console} from './console';\nimport {DEFAULT_FONT, Font} from './font';\nimport {Keys} from './keys';\nimport {Mouse} from './mouse';\nimport {FRAGMENT_SHADER_SOURCE, VERTEX_SHADER_SOURCE} from './shaders';\nimport {TerminalOptions} from './terminaloptions';\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i: number, max: number) {\n  return -1.0 + 2.0 * (i / max);\n}\n\nconst DEFAULT_OPTIONS: TerminalOptions = {\n  font: DEFAULT_FONT,\n  requestFullscreen: false\n};\n\nexport class Terminal extends Console {\n  readonly canvas: HTMLCanvasElement;\n  private readonly font: Font;\n  private readonly pixelWidth: number;\n  private readonly pixelHeight: number;\n  private readonly gl: WebGLRenderingContext;\n  private readonly program: WebGLProgram;\n  private readonly positionAttribLocation: GLint;\n  private readonly textureAttribLocation: GLint;\n  private readonly fgColorAttribLocation: GLint;\n  private readonly bgColorAttribLocation: GLint;\n  private readonly positionsArray: Float32Array;\n  private readonly indexArray: Uint16Array;\n  private readonly textureArray: Float32Array;\n  private readonly foregroundUint8Array: Uint8Array;\n  private readonly foregroundDataView: DataView;\n  private readonly backgroundUint8Array: Uint8Array;\n  private readonly backgroundDataView: DataView;\n  private readonly positionBuffer: WebGLBuffer;\n  private readonly indexBuffer: WebGLBuffer;\n  private readonly textureBuffer: WebGLBuffer;\n  private readonly foregroundBuffer: WebGLBuffer;\n  private readonly backgroundBuffer: WebGLBuffer;\n  private readonly texture: WebGLTexture;\n  readonly keys: Keys;\n  readonly mouse: Mouse;\n  update?: Function;\n\n  constructor(\n      canvas: HTMLCanvasElement, width: number, height: number,\n      options?: TerminalOptions) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || DEFAULT_FONT;\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n\n    canvas.width = this.pixelWidth;\n    canvas.height = this.pixelHeight;\n    canvas.style.width = (this.font.scale * this.pixelWidth) + 'px';\n    canvas.style.height = (this.font.scale * this.pixelHeight) + 'px';\n    // canvas.style.imageRendering = 'pixelated';\n    canvas.style.outline = 'none';\n    canvas.tabIndex = 0;\n\n    this.keys = new Keys(canvas);\n    this.mouse = new Mouse(this, options);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext('webgl', {antialias: false});\n    if (!gl) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(\n        program, this.buildShader(gl.VERTEX_SHADER, VERTEX_SHADER_SOURCE));\n    gl.attachShader(\n        program, this.buildShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER_SOURCE));\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (this.font.graphical) {\n      // Set the flag to ignore foreground/background colors, and use texture\n      // directly\n      gl.uniform1i(gl.getUniformLocation(program, 'h'), 1);\n    }\n\n    this.positionAttribLocation = this.getAttribLocation('a');\n    this.textureAttribLocation = this.getAttribLocation('b');\n    this.fgColorAttribLocation = this.getAttribLocation('c');\n    this.bgColorAttribLocation = this.getAttribLocation('d');\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer() as WebGLBuffer;\n    this.indexBuffer = gl.createBuffer() as WebGLBuffer;\n    this.textureBuffer = gl.createBuffer() as WebGLBuffer;\n    this.foregroundBuffer = gl.createBuffer() as WebGLBuffer;\n    this.backgroundBuffer = gl.createBuffer() as WebGLBuffer;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url) as WebGLTexture;\n\n    this.renderLoop();\n  }\n\n  private getAttribLocation(name: string) {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  flush() {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y) as Cell;\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = (cell.charCode % 16) + (0.5 / 256.0);\n        const textureY = ((cell.charCode / 16) | 0) + (0.5 / 256.0);\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.down;\n  }\n\n  isKeyPressed(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    const count = key ? key.downCount : 0;\n    return count === 1 || (count > 30 && count % 3 === 0);\n  }\n\n  getKeyDownCount(keyCode: number) {\n    const key = this.keys.getKey(keyCode);\n    return key ? key.downCount : 0;\n  }\n\n  private buildShader(type: GLint, source: string) {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error('An error occurred compiling the shader: ');\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error(\n          'An error occurred compiling the shader: ' + gl.getShaderInfoLog(sh));\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  private loadTexture(url: string) {\n    const gl = this.gl;\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]);  // opaque black\n    gl.texImage2D(\n        gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat,\n        srcType, pixel);\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(\n          gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  private render() {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(\n          this.positionAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.textureAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.foregroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.fgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.backgroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.bgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  private renderLoop() {\n    this.keys.updateKeys();\n    this.mouse.update();\n    if (this.update) {\n      this.update();\n    }\n    this.flush();\n    this.render();\n    requestAnimationFrame(this.renderLoop.bind(this));\n  }\n}\n","\nimport {Dialog} from './dialog';\nimport {Terminal} from './terminal';\n\nexport class GUI {\n  private readonly terminal: Terminal;\n  dialogs: Dialog[];\n\n  constructor(terminal: Terminal) {\n    this.terminal = terminal;\n    this.dialogs = [];\n  }\n\n  add(dialog: Dialog) {\n    this.dialogs.push(dialog);\n  }\n\n  handleInput(): boolean {\n    if (this.dialogs.length === 0) {\n      return false;\n    }\n\n    const active = this.dialogs[this.dialogs.length - 1];\n    if (active.handleInput()) {\n      this.dialogs.splice(this.dialogs.indexOf(active), 1);\n    }\n\n    return true;\n  }\n\n  draw() {\n    for (let i = 0; i < this.dialogs.length; i++) {\n      this.dialogs[i].draw(this.terminal);\n    }\n  }\n}\n","\nimport {Dialog} from './dialog';\nimport {Keys} from './keys';\nimport {Rect} from './rect';\nimport {Terminal} from './terminal';\n\nexport class MessageDialog extends Dialog {\n  readonly lines: string[];\n\n  constructor(terminal: Terminal, title: string, message: string) {\n    const lines = message.split('\\n');\n    let width = title.length + 6;\n    for (let i = 0; i < lines.length; i++) {\n      width = Math.max(width, lines[i].length + 6);\n    }\n\n    const height = 4 + lines.length;\n    const x = ((terminal.width - width) / 2) | 0;\n    const y = ((terminal.height - height) / 2) | 0;\n    const rect = new Rect(x, y, width, height);\n    super(terminal, rect, title);\n    this.lines = lines;\n  }\n\n  drawContents() {\n    const centerX = this.rect.x + (this.rect.width / 2) | 0;\n    const startY = this.rect.y + 2;\n\n    for (let i = 0; i < this.lines.length; i++) {\n      this.terminal.drawCenteredString(centerX, startY + i, this.lines[i]);\n    }\n  }\n\n  handleInput() {\n    return this.terminal.isKeyPressed(Keys.VK_ESCAPE);\n  }\n}\n","\r\nexport class Point {\r\n  readonly x: number;\r\n  readonly y: number;\r\n\r\n  constructor(x: number, y: number) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n}\r\n","\n/**\n * Random number generator.\n *\n * LCG\n * https://stackoverflow.com/a/424445/2051724\n */\nexport class RNG {\n  private readonly m: number;\n  private readonly a: number;\n  private readonly c: number;\n  private state: number;\n\n  /**\n   * Creates a new random number generator.\n   *\n   * @param seed The integer seed.\n   */\n  constructor(seed: number) {\n    // LCG using GCC's constants\n    this.m = 0x80000000;  // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n    this.state = seed || 1;\n  }\n\n  private nextInt() {\n    this.state = (this.a * this.state + this.c) % this.m;\n    return this.state;\n  }\n\n  nextFloat() {\n    // returns in range [0,1]\n    return this.nextInt() / (this.m - 1);\n  }\n\n  nextRange(start: number, end: number) {\n    // returns in range [start, end): including start, excluding end\n    // can't modulu nextInt because of weak randomness in lower bits\n    const rangeSize = end - start;\n    const randomUnder1 = this.nextInt() / this.m;\n    return start + ((randomUnder1 * rangeSize) | 0);\n  }\n\n  chooseIndex(chances: number[]) {\n    const total = chances.reduce((a, b) => a + b);\n    const roll = this.nextRange(1, total);\n    let runningTotal = 0;\n\n    for (let i = 0; i < chances.length; i++) {\n      runningTotal += chances[i];\n      if (roll <= runningTotal) {\n        return i;\n      }\n    }\n\n    return chances.length - 1;\n  }\n\n  chooseKey(chancesMap: Map<string, number>) {\n    const values: string[] = [];\n    const chances: number[] = [];\n\n    for (var property in chancesMap) {\n      if (chancesMap.hasOwnProperty(property)) {\n        values.push(property);\n        chances.push((chancesMap as any)[property] as number);\n      }\n    }\n\n    return values[this.chooseIndex(chances)];\n  }\n}\n","\nimport {Dialog} from './dialog';\nimport {Keys} from './keys';\nimport {Rect} from './rect';\nimport {Terminal} from './terminal';\n\nexport class SelectDialog extends Dialog {\n  options: string[];\n  callback: Function;\n\n  constructor(\n      terminal: Terminal, title: string, options: string[],\n      callback: Function) {\n    let width = title.length + 6;\n    for (let i = 0; i < options.length; i++) {\n      width = Math.max(width, options[i].length + 9);\n    }\n\n    const height = 4 + options.length;\n    const x = ((terminal.width - width) / 2) | 0;\n    const y = ((terminal.height - height) / 2) | 0;\n    const rect = new Rect(x, y, width, height);\n    super(terminal, rect, title);\n    this.options = options;\n    this.callback = callback;\n  }\n\n  drawContents() {\n    for (let i = 0; i < this.options.length; i++) {\n      const str = String.fromCharCode(65 + i) + ' - ' + this.options[i];\n      this.terminal.drawString(this.rect.x + 2, this.rect.y + 2 + i, str);\n    }\n  }\n\n  handleInput() {\n    for (let i = 0; i < this.options.length; i++) {\n      if (this.terminal.isKeyPressed(Keys.VK_A + i)) {\n        this.callback(i);\n        return true;\n      }\n    }\n    return this.terminal.isKeyPressed(Keys.VK_ESCAPE);\n  }\n}\n"],"names":["BlendMode","fromRgb","r","g","b","a","undefined","Colors","Cell","[object Object]","charCode","fg","bg","meta","this","length","charCodeAt","convertCharCode","WHITE","BLACK","dirty","setCharCode","setForeground","setBackground","setMeta","drawCell","None","otherCell","blendMode","alpha","blendColors","c1","c2","w1","w2","r1","g1","b1","r2","g2","b2","Blend","Add","clamp","x","Math","min","Chars","Console","width","height","grid","Array","y","row","push","clear","drawChar","c","setValue","str","i","drawString","floor","xi","yi","drawHLine","drawVLine","topChar","rightChar","bottomChar","leftChar","topLeftChar","topRightChar","bottomRightChar","bottomLeftChar","fillRect","drawBox","BOX_SINGLE_HORIZONTAL","BOX_SINGLE_VERTICAL","BOX_SINGLE_DOWN_AND_SINGLE_RIGHT","BOX_SINGLE_DOWN_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_RIGHT","BOX_DOUBLE_HORIZONTAL","BOX_DOUBLE_VERTICAL","BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT","BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_RIGHT","dstX","dstY","srcConsole","srcX","srcY","srcWidth","srcHeight","cell","getCell","Font","url","charWidth","charHeight","scale","graphical","DEFAULT_FONT","FovCell","blocked","visible","h","prev","PATTERNS","BLOCK_TOP_LEFT","active","BLOCK_TOP_RIGHT","BLOCK_TOP_HALF","BLOCK_BOTTOM_LEFT","BLOCK_BOTTOM_RIGHT","BLOCK_RIGHT_HALF","BLOCK_CHECKER","getImageData","img","canvas","document","createElement","ctx","getContext","drawImage","data","draw2x2","con","w","i1","i2","i3","i4","colors","minError","Number","MAX_VALUE","bestCharCode","bestBg","bestFg","pattern","patternColors","computeColors","error","arrayToColor","sum","avg","count","j","cellError","delta","sqrt","rgb","KEY_COUNT","Key","down","downCount","Keys","el","keys","addEventListener","e","setKey","state","stopPropagation","preventDefault","keyCode","Dialog","terminal","rect","title","term","drawSingleBox","drawCenteredString","drawContents","Rect","left","top","dxs","dys","costs","getMinCell","q","bestCell","bestIndex","minDist","Infinity","splice","buildPath","result","curr","reverse","Mouse","options","prevX","prevY","dx","dy","buttons","handleEvent","touchEventHandler","handleTouchEvent","bind","type","requestFullscreen","touches","touch","updatePosition","clientX","clientY","button","focus","getBoundingClientRect","terminalAspectRatio","rectAspectRatio","actualWidth","actualHeight","webkitRequestFullscreen","mozRequestFullScreen","VERTEX_SHADER_SOURCE","FRAGMENT_SHADER_SOURCE","interpolate","max","DEFAULT_OPTIONS","font","s","v","f","p","t","blockedFunc","originX","originY","minX","maxX","minY","maxY","radius","deltaX","deltaY","startSlopes","endSlopes","halfSlope","processedCell","extended","centreSlope","startSlope","endSlope","previousEndSlope","iteration","totalObstacles","obstaclesInLastLine","minSlope","idx","computeOctantY","computeOctantX","dialogs","dialog","handleInput","indexOf","draw","callback","Image","onload","src","message","lines","split","super","centerX","startY","isKeyPressed","VK_ESCAPE","map","source","dest","maxDist","abs","clearDijkstra","sourceCell","u","alt","seed","m","nextInt","start","end","rangeSize","chances","total","reduce","roll","nextRange","runningTotal","chancesMap","values","property","hasOwnProperty","chooseIndex","String","fromCharCode","VK_A","pixelWidth","pixelHeight","style","outline","tabIndex","mouse","gl","antialias","Error","program","createProgram","attachShader","buildShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","useProgram","uniform1i","getUniformLocation","positionAttribLocation","getAttribLocation","textureAttribLocation","fgColorAttribLocation","bgColorAttribLocation","cellCount","positionsArray","Float32Array","indexArray","Uint16Array","textureArray","foregroundUint8Array","Uint8Array","foregroundDataView","DataView","buffer","backgroundUint8Array","backgroundDataView","k","positionBuffer","createBuffer","indexBuffer","textureBuffer","foregroundBuffer","backgroundBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","texture","loadTexture","renderLoop","name","location","enableVertexAttribArray","textureArrayIndex","colorArrayIndex","textureX","textureY","setUint32","key","getKey","sh","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createTexture","bindTexture","TEXTURE_2D","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","pixel","texImage2D","image","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","clearColor","clearDepth","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","viewport","numComponents","FLOAT","normalize","stride","offset","vertexAttribPointer","DYNAMIC_DRAW","activeTexture","TEXTURE0","drawElements","TRIANGLES","UNSIGNED_SHORT","updateKeys","update","flush","render","requestAnimationFrame"],"mappings":"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"}