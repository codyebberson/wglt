!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.wglt={})}(this,function(t){function e(t,e,i){return(t<<24)+(e<<16)+(i<<8)}function i(t,e){const i=new Array(e);for(let r=0;r<e;r++)i[r]=new Array(t);return i}const r=256;class s{constructor(){this.down=!1,this.downCount=0}}class o{constructor(t){this.keys=new Array(r);for(let t=0;t<r;t++)this.keys[t]=new s;t.addEventListener("keydown",t=>this.setKey(t,!0)),t.addEventListener("keyup",t=>this.setKey(t,!1))}setKey(t,e){t.stopPropagation(),t.preventDefault();const i=t.keyCode;i>=0&&i<r&&(this.keys[i].down=e)}updateKeys(){for(let t=0;t<r;t++)this.keys[t].down?this.keys[t].downCount++:this.keys[t].downCount=0}getKey(t){return t>=0&&t<r?this.keys[t]:null}}const h=8,n=8,a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEtElEQVRIx2WTsYsUMRTGPxTOJniWgRMFsbR4oJyDBE+s/AdsrIJKtEixIKwPHOc8tbCwsdNKLCy0tlBQGBCnel55CK5y1dqIbKVbhBlfZkYP8UsI2d98ed+bMAtUVTxUHELn3Krb2HwCbHVtUSo4f/5AOHnlEvD8c1sWhf229WQ1bGy63tG2pXu/9e52oCvfgHfvy7JtMxDXgyffimKnzEfETq71Rw6pclGpFvNLORYoihzLdrd+gjv7bNisYK3FoN2DLnx+D+esJRy3HZZnq/CZ9aA1vg6uQ9vacEvykbatu6pShw1rooYqOzqnNSqsceWss9Qe76ymuLD2sNpLAXS3RIe/4hgJhbceWSs9SE30RIEUmAzaWoraW0fDeUZMdgpvu4QEhYTW0AyjI1dSRxDkGhNQnR2RmilyCoHuYE+jn4n5cCoSc47wDFmIuNqLSH9EMCNj4rI2IkQ+WYNERSFmabkkjTAW38mb1giJAdRB0K2o34ulCYEATokNs+cJkabQf22gpORS2zrhI/NF0xRoOIR4+XIQMsH/mEd8lVCH69drBdG3PxsFZR2Y60SG/c5XBal3bGt8vNxsN6gl1/BaQzdNE8GSUxZnhXne5pT/lFiHSNNIyzUfAoIEedUD8d4WPdglBVEee7IRKKUsFOwUTN7aBvAzPqygjXTZGwsFHIWEfzTU+JUMFofnzImahlvex/hPHQi7OIwCu2R3JxkRPAyiruP96f2zYT+NEw70fcmACVLKQqbaFbUiQBlqSV4CWaadDCSI1L4M2dFkMH3LU16YOX+acyOMUUtggr86hF6H7e502NIAyNKswGz6qSz7C0oKEBEk1uMF5XdoMuD+goTUoaAsvTkl3Mby6gC8WSztlGJjkqagxeLIXie9GLYS76CLlF4IIvQeFFgXNEQXUIMdsxNdJsWECbXIijErdRDRFGGIpLNleVaqlDIQsOSHgX1dK0gJVPFGVW2Q1tBi6vB73+ggi7MMzx6NoDiDgyBEEdIBIEasIW3KYC2lvLotFt60zCwijWwvdrgCb4qqBzt+TuoYf6dG5vPIVmtsM3NVmZLL9Fo+Af9exwTWGjOdOkcO83lGRNbOZjHgkrZhTwp4knEM9BzMCAGGWJbfzzr/JlU3rJxESTkTqF+YK9esOiSDWVVJMNsfndaotAkRgB0eP3X4R0f3WwDHLn7RVrh26+tYtwI8eHnTWnvfnx/A6CCiNz/X258Vjw5mfrayvrJSp8Gx1GR1/GxrWg6OlJLWWEeV7FBDHS4DS3ZwQPUH6C8d0+k6hjGC2WwEd0fAdHrjV3e6+9WOwDARoDPiaNfpLGVDH+uMGKpIygV0tiOoZAR3RwCMAPiUWLzGiEUH6ztM4n1QTffRA+rwKeibnWPmHnAH89N7v0tEGUAdLjAzFCy1HZtbi+rIAHYARVJBXT1g7CkDqLpusdphsaoJvm9xa2sEdJ+IEmHr3gikH8DWhz9A1YMXAFZXVxei4gwe7YFEGWyNgJkN97Ej+PutEuabFaEAipIHcOLze0IU8EGTQQJ/ZiAC1hUuO9LJW5JQKDjoFWjUtzWBylZlqUDRxzUmDMog4enaQ1Kyp/1Y7v1vfwPx3em+Z+50IgAAAABJRU5ErkJggg==",u="attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}",d="varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}";class A{constructor(t){this.x=0,this.y=0,this.buttons=[!1,!1,!1],t.addEventListener("mousedown",t=>this.update(t)),t.addEventListener("mouseup",t=>this.update(t)),t.addEventListener("mousemove",t=>this.update(t))}update(t){this.x=t.offsetX/h|0,this.y=t.offsetY/n|0,"mousedown"===t.type&&(this.buttons[t.button]=!0),"mouseup"===t.type&&(this.buttons[t.button]=!1)}}function c(t,e){return t/e*2-1}t.COLOR_BLACK=0,t.COLOR_WHITE=4294967040,t.COLOR_LIGHT_GRAY=2863311360,t.COLOR_DARK_GRAY=1431655680,t.COLOR_YELLOW=4294923520,t.COLOR_BROWN=2857697280,t.COLOR_LIGHT_RED=4283782400,t.COLOR_DARK_RED=2852126720,t.COLOR_LIGHT_GREEN=1442796800,t.COLOR_DARK_GREEN=11141120,t.COLOR_LIGHT_CYAN=1442840320,t.COLOR_DARK_CYAN=11184640,t.COLOR_LIGHT_BLUE=1431699200,t.COLOR_DARK_BLUE=43520,t.COLOR_LIGHT_MAGENTA=4283825920,t.COLOR_DARK_MAGENTA=2852170240,t.COLOR_ORANGE=4287102976,t.createColor=e,t.createHsvColor=function(t,i,r){let s,o,h,n,a,u,d,A;switch(u=r*(1-i),d=r*(1-(a=6*t-(n=6*t|0))*i),A=r*(1-(1-a)*i),n%6){case 0:s=r,o=A,h=u;break;case 1:s=d,o=r,h=u;break;case 2:s=u,o=r,h=A;break;case 3:s=u,o=d,h=r;break;case 4:s=A,o=u,h=r;break;case 5:s=r,o=u,h=d;break;default:s=0,o=0,h=0}return e(255*s|0,255*o|0,255*h|0)},t.FovMap=class{constructor(t,e,r){if(this.width=t,this.height=e,this.blocked=i(t,e),this.visible=i(t,e),this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0,r)for(let i=0;i<e;i++)for(let e=0;e<t;e++)this.blocked[i][e]=r(e,i)}setBlocked(t,e,i){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.blocked[e][t]=i)}isVisible(t,e){return!(t<0||t>=this.width||e<0||e>=this.height)&&this.visible[e][t]}computeOctantY(t,e){const i=[],r=[];let s,o,h,n,a,u,d,A,c,f,l=1,g=0,R=0,E=0;for(o=this.originY+e;o>=this.minY&&o<=this.maxY;o+=e,R=g,++l)for(h=.5/l,f=-1,n=Math.floor(E*l+.5),s=this.originX+n*t;n<=l&&s>=this.minX&&s<=this.maxX;s+=t,++n,f=c){if(a=!0,u=!1,A=f,c=(d=n/l)+h,R>0)if(this.visible[o-e][s]&&!this.blocked[o-e][s]||this.visible[o-e][s-t]&&!this.blocked[o-e][s-t]){for(let t=0;t<R&&a;++t)if(A<=r[t]&&c>=i[t])if(this.blocked[o][s]){if(A>=i[t]&&c<=r[t]){a=!1;break}i[t]=Math.min(i[t],A),r[t]=Math.max(r[t],c),u=!0}else if(d>i[t]&&d<r[t]){a=!1;break}}else a=!1;a&&(this.visible[o][s]=!0,this.blocked[o][s]&&(E>=A?E=c:u||(i[g]=A,r[g++]=c)))}}computeOctantX(t,e){const i=[],r=[];let s,o,h,n,a,u,d,A,c,f,l=1,g=0,R=0,E=0;for(s=this.originX+t;s>=this.minX&&s<=this.maxX;s+=t,R=g,++l)for(h=.5/l,f=-1,n=Math.floor(E*l+.5),o=this.originY+n*e;n<=l&&o>=this.minY&&o<=this.maxY;o+=e,++n,f=c){if(a=!0,u=!1,A=f,c=(d=n/l)+h,R>0)if(this.visible[o][s-t]&&!this.blocked[o][s-t]||this.visible[o-e][s-t]&&!this.blocked[o-e][s-t]){for(let t=0;t<R&&a;++t)if(A<=r[t]&&c>=i[t])if(this.blocked[o][s]){if(A>=i[t]&&c<=r[t]){a=!1;break}i[t]=Math.min(i[t],A),r[t]=Math.max(r[t],c),u=!0}else if(d>i[t]&&d<r[t]){a=!1;break}}else a=!1;a&&(this.visible[o][s]=!0,this.blocked[o][s]&&(E>=A?E=c:u||(i[g]=A,r[g++]=c)))}}computeFov(t,e,i){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.visible[t][e]=!1;this.visible[e][t]=!0,this.originX=t,this.originY=e,this.radius=i,this.minX=Math.max(0,t-i),this.minY=Math.max(0,e-i),this.maxX=Math.min(this.width-1,t+i),this.maxY=Math.min(this.height-1,e+i),this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantY(1,-1),this.computeOctantX(1,-1),this.computeOctantY(-1,1),this.computeOctantX(-1,1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1)}},t.Key=s,t.Keys=o,t.VK_ESCAPE=27,t.VK_SPACE=32,t.VK_LEFT=37,t.VK_UP=38,t.VK_RIGHT=39,t.VK_DOWN=40,t.VK_A=65,t.VK_D=68,t.VK_M=77,t.VK_Q=81,t.VK_S=83,t.VK_W=87,t.VK_Z=90,t.RNG=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const i=e-t;return t+(this.nextInt()/this.m*i|0)}},t.Terminal=class{constructor(t,e,i){this.canvas=t,this.width=e,this.height=i,this.pixelWidth=e*h,this.pixelHeight=i*n,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.pixelWidth+"px",t.style.height=this.pixelHeight+"px",t.style.outline="none",t.tabIndex=0,this.keys=new o(t),this.mouse=new A(t);const r=t.getContext("webgl",{antialias:!1});if(!r)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const s=r.createProgram();if(!s)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=r,this.program=s,r.attachShader(s,this.buildShader(r.VERTEX_SHADER,u)),r.attachShader(s,this.buildShader(r.FRAGMENT_SHADER,d)),r.linkProgram(s),r.useProgram(s),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const f=e*i;this.positionsArray=new Float32Array(3*f*4),this.indexArray=new Uint16Array(6*f),this.textureArray=new Float32Array(2*f*4),this.foregroundUint8Array=new Uint8Array(4*f*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(4*f*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer);let l=0,g=0,R=0;for(let t=0;t<i;t++)for(let r=0;r<e;r++)this.positionsArray[l++]=c(r,e),this.positionsArray[l++]=-c(t,i),this.positionsArray[l++]=c(r+1,e),this.positionsArray[l++]=-c(t,i),this.positionsArray[l++]=c(r+1,e),this.positionsArray[l++]=-c(t+1,i),this.positionsArray[l++]=c(r,e),this.positionsArray[l++]=-c(t+1,i),this.indexArray[g++]=R+0,this.indexArray[g++]=R+1,this.indexArray[g++]=R+2,this.indexArray[g++]=R+0,this.indexArray[g++]=R+2,this.indexArray[g++]=R+3,R+=4;this.positionBuffer=r.createBuffer(),this.indexBuffer=r.createBuffer(),this.textureBuffer=r.createBuffer(),this.foregroundBuffer=r.createBuffer(),this.backgroundBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferData(r.ARRAY_BUFFER,this.positionsArray,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,this.indexArray,r.STATIC_DRAW),this.texture=this.loadTexture(a),this.renderLoop()}getAttribLocation(t){const e=this.gl.getAttribLocation(this.program,t);return this.gl.enableVertexAttribArray(e),e}isOutOfRange(t,e){return t<0||t>=this.width||e<0||e>=this.height}setCharCode(t,e,i){if(this.isOutOfRange(t,e))return;const r=i%16+.5/256,s=(i/16|0)+.5/256,o=8*(e*this.width+t);this.textureArray[o+0]=r,this.textureArray[o+1]=s,this.textureArray[o+2]=r+1,this.textureArray[o+3]=s,this.textureArray[o+4]=r+1,this.textureArray[o+5]=s+1,this.textureArray[o+6]=r,this.textureArray[o+7]=s+1}clear(){this.clearRect(0,0,this.width,this.height)}clearRect(t,e,i,r){const s=t+i,o=e+r;for(let i=e;i<o;i++)for(let e=t;e<s;e++)this.setCharCode(e,i,0)}setForegroundColor(t,e,i){if(this.isOutOfRange(t,e))return;let r=16*(e*this.width+t);for(let t=0;t<4;t++)this.foregroundDataView.setUint32(r,i,!1),r+=4}setBackgroundColor(t,e,i){if(this.isOutOfRange(t,e))return;let r=16*(e*this.width+t);for(let t=0;t<4;t++)this.backgroundDataView.setUint32(r,i,!1),r+=4}drawString(t,e,i,r,s){for(let r=0;r<i.length;r++)this.setCharCode(t+r,e,i.charCodeAt(r));r&&this.fillForegroundRect(t,e,i.length,1,r),s&&this.fillBackgroundRect(t,e,i.length,1,s)}drawCenteredString(t,e,i,r,s){this.drawString(t-i.length/2|0,e,i,r,s)}fillForegroundRect(t,e,i,r,s){for(let o=e;o<e+r;o++)for(let e=t;e<t+i;e++)this.setForegroundColor(e,o,s)}fillBackgroundRect(t,e,i,r,s){for(let o=e;o<e+r;o++)for(let e=t;e<t+i;e++)this.setBackgroundColor(e,o,s)}isKeyDown(t){const e=this.keys.getKey(t);return e&&e.down}isKeyPressed(t){const e=this.keys.getKey(t),i=e?e.downCount:0;return 1===i||i>30&&i%3==0}getKeyDownCount(t){const e=this.keys.getKey(t);return e?e.downCount:0}getMouse(){return this.mouse}buildShader(t,e){const i=this.gl,r=i.createShader(t);if(!r)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(r));return r}loadTexture(t){const e=this.gl,i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const r=e.RGBA,s=e.RGBA,o=e.UNSIGNED_BYTE,h=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,0,r,1,1,0,s,o,h);const n=new Image;return n.onload=(()=>{e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,r,s,o,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D)}),n.src=t,i}render(){const t=this.gl;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const e=2,i=t.FLOAT,r=!1,s=0,o=0;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(this.positionAttribLocation,e,i,r,s,o)}{const e=2,i=t.FLOAT,r=!1,s=0,o=0;t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.textureAttribLocation,e,i,r,s,o)}{const e=4,i=t.UNSIGNED_BYTE,r=!0,s=0,o=0;t.bindBuffer(t.ARRAY_BUFFER,this.foregroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.foregroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.fgColorAttribLocation,e,i,r,s,o)}{const e=4,i=t.UNSIGNED_BYTE,r=!0,s=0,o=0;t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.backgroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.bgColorAttribLocation,e,i,r,s,o)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.drawElements(t.TRIANGLES,this.width*this.height*6,t.UNSIGNED_SHORT,0)}renderLoop(){this.keys.updateKeys(),this.update&&this.update(),this.render(),requestAnimationFrame(this.renderLoop.bind(this))}}});
//# sourceMappingURL=index.umd.js.map
