!function(t,s){if("object"===typeof exports&&"object"===typeof module)module.t=s();else if("function"===typeof define&&define.amd)define([],s);else{var i=s();for(var h in i)("object"===typeof exports?exports:t)[h]=i[h]}}(window,(function(){return function(t){var s={};function i(h){if(s[h])return s[h].t;var e=s[h]={s:h,i:!1,t:{}};return t[h].call(e.t,e,e.t,i),e.i=!0,e.t}return i.h=t,i.c=s,i.d=function(t,s,h){i.o(t,s)||Object.defineProperty(t,s,{_:!0,get:h})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},i.l=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t.u)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{_:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,function(s){return t[s]}.bind(null,e));return h},i.n=function(t){var s=t&&t.u?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.A="",i(i.K=0)}([function(t,s,i){"use strict";i.r(s),i.d(s,"BlendMode",(function(){return h})),i.d(s,"fixBoxCells",(function(){return _})),i.d(s,"Cell",(function(){return l})),i.d(s,"Chars",(function(){return A})),i.d(s,"fromRgb",(function(){return c})),i.d(s,"fromHsv",(function(){return u})),i.d(s,"Colors",(function(){return a})),i.d(s,"Console",(function(){return K})),i.d(s,"Font",(function(){return E})),i.d(s,"DEFAULT_FONT",(function(){return f})),i.d(s,"GUI",(function(){return L})),i.d(s,"DefaultDialogRenderer",(function(){return N})),i.d(s,"Dialog",(function(){return d})),i.d(s,"DialogState",(function(){return T})),i.d(s,"MessageDialog",(function(){return S})),i.d(s,"SelectDialog",(function(){return I})),i.d(s,"loadImage",(function(){return w})),i.d(s,"loadImage2x",(function(){return B})),i.d(s,"Keyboard",(function(){return C})),i.d(s,"Keys",(function(){return R})),i.d(s,"Mouse",(function(){return F})),i.d(s,"computePath",(function(){return y})),i.d(s,"Point",(function(){return V})),i.d(s,"Rect",(function(){return O})),i.d(s,"RNG",(function(){return Q})),i.d(s,"Terminal",(function(){return Y})),i.d(s,"FovOctants",(function(){return z})),i.d(s,"FovQuadrants",(function(){return k})),i.d(s,"getFovQuadrant",(function(){return J})),i.d(s,"Tile",(function(){return j})),i.d(s,"TileMap",(function(){return Z}));const h={V:0,O:1,T:2},e=[[1,0,1,0],[1,0,1,1],[1,0,1,2],[2,0,2,1],[0,0,2,1],[0,0,1,2],[2,0,2,2],[2,0,2,0],[0,0,2,2],[2,0,0,2],[2,0,0,1],[1,0,0,2],[0,0,1,1],[1,1,0,0],[1,1,0,1],[0,1,1,1],[1,1,1,0],[0,1,0,1],[1,1,1,1],[1,2,1,0],[2,1,2,0],[2,2,0,0],[0,2,2,0],[2,2,0,2],[0,2,2,2],[2,2,2,0],[0,2,0,2],[2,2,2,2],[1,2,0,2],[2,1,0,1],[0,2,1,2],[0,1,2,1],[2,1,0,0],[1,2,0,0],[0,2,1,0],[0,1,2,0],[2,1,2,1],[1,2,1,2],[1,0,0,1],[0,1,1,0]];function n(t,s,i){const h=t.N(s,i).charCode;return h>=179&&h<=218}function r(t,s,i,h){if(s<0||i<0||s>=t.width||i>=t.height)return 0;const n=t.N(s,i).charCode;return n<179||n>218?0:e[n-179][h]}function o(t,s,i,h){for(let n=0;n<e.length;n++){const r=e[n];if(r[0]===t&&r[1]===s&&r[2]===i&&r[3]===h)return 179+n}return 0}function _(t){for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++)if(n(t,i,s)){let h=r(t,i,s-1,2),e=r(t,i+1,s,3),n=r(t,i,s+1,0),_=r(t,i-1,s,1);h>0&&0===e&&0===n&&0===_?n=h:0===h&&e>0&&0===n&&0===_?_=e:0===h&&0===e&&n>0&&0===_?h=n:0===h&&0===e&&0===n&&_>0&&(e=_),_>0&&e>0&&(_=e=Math.max(_,e)),h>0&&n>0&&(h=n=Math.max(h,n));const c=o(h,e,n,_);if((h||e||n||_)&&!(c>=179&&c<=218))throw new Error("invalid char code! (up="+h+", right="+e+", down="+n+", left="+_+")");t.N(i,s).L(c)}}function c(t,s,i,h){return void 0===h&&(h=255),(t<<24)+(s<<16)+(i<<8)+h}function u(t,s,i,h){const e=6*t|0,n=6*t-e,r=i*(1-s),o=i*(1-n*s),_=i*(1-(1-n)*s);let u,a,l;switch(e%6){case 0:u=i,a=_,l=r;break;case 1:u=o,a=i,l=r;break;case 2:u=r,a=i,l=_;break;case 3:u=r,a=o,l=i;break;case 4:u=_,a=r,l=i;break;case 5:u=i,a=r,l=o;break;default:u=0,a=0,l=0}return void 0===h&&(h=1),c(255*u|0,255*a|0,255*l|0,255*h|0)}const a={D:c(0,0,0),C:c(255,255,255),R:c(170,170,170),S:c(85,85,85),I:c(255,255,85),U:c(170,85,0),B:c(255,85,85),M:c(170,0,0),g:c(85,255,85),H:c(0,170,0),G:c(85,255,255),F:c(0,170,170),p:c(85,85,255),v:c(0,0,170),P:c(255,85,255),m:c(170,0,170),W:c(255,136,0)};class l{constructor(t,s,i,h){this.charCode=void 0!==t?function(t){return"string"===typeof t&&t.length>0?t.charCodeAt(0):t}(t):" ".charCodeAt(0),this.X=void 0!==s?s:a.C,this.Y=void 0!==i?i:a.D,void 0!==h&&(this.k=h),this.J=!0}L(t){this.charCode!==t&&(this.charCode=t,this.J=!0)}j(t){void 0!==t&&null!==t&&t!==this.X&&(this.X=t,this.J=!0)}Z(t){void 0!==t&&null!==t&&t!==this.Y&&(this.Y=t,this.J=!0)}q(t){void 0!==t&&(this.k=t,this.J=!0)}$(t,s,i,e){return"string"===typeof t&&(t=t.charCodeAt(0)),"number"===typeof t?(this.L(t),this.j(s),this.Z(i),this.q(e)):this.tt(t,h.V),this.J}tt(t,s){const i=255&t.Y;s===h.V||t.charCode>0?(this.L(t.charCode),this.j(t.X)):i>0&&i<255&&this.j(this.st(this.X,t.Y,s)),s===h.V||255===i?this.Z(t.Y):i>0&&this.Z(this.st(this.Y,t.Y,s)),this.q(t.k)}st(t,s,i){const e=(255-(255&s))/255,n=1-e,r=t>>24&255,o=t>>16&255,_=t>>8&255,u=s>>24&255,a=s>>16&255,l=s>>8&255;switch(i){case h.O:return c(e*r+n*u|0,e*o+n*a|0,e*_+n*l|0);case h.T:return c(this.it(r+n*u|0),this.it(o+n*a|0),this.it(_+n*l|0));default:return s}}it(t){return Math.min(255,t)}}const A={ht:1,et:2,nt:3,rt:4,ot:5,_t:6,ct:7,ut:8,at:176,lt:177,At:178,Kt:179,Et:180,ft:185,Vt:186,Ot:187,Tt:188,Nt:191,Lt:192,dt:193,Dt:194,Ct:195,Rt:196,St:197,It:200,Ut:201,wt:202,Bt:203,Mt:204,gt:205,Ht:206,Gt:217,Ft:218,pt:219,vt:220,bt:221,Pt:222,yt:223};class K{constructor(t,s,i){this.width=t,this.height=s,this.xt=new Array;const h=i||l;for(let i=0;i<s;i++){const s=new Array;for(let e=0;e<t;e++)s.push(new h(e,i));this.xt.push(s)}this.clear()}clear(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)this.Qt(s,t,0)}N(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.xt[s][t]}Wt(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.xt[s][t].charCode}Qt(t,s,i,h,e){t>=0&&t<this.width&&s>=0&&s<this.height&&this.xt[s][t].$(i,h,e)}Xt(t,s,i,h,e){const n=i.split("\n");for(let i=0;i<n.length;i++){const r=n[i];for(let n=0;n<r.length;n++)this.Qt(t+n,s+i,r.charCodeAt(n),h,e)}}Yt(t,s,i,h,e){this.Xt(t-Math.floor(i.length/2),s,i,h,e)}zt(t,s,i,h,e,n){for(let r=t;r<t+i;r++)this.Qt(r,s,h,e,n)}kt(t,s,i,h,e,n){for(let r=s;r<s+i;r++)this.Qt(t,r,h,e,n)}Jt(t,s,i,h,e,n,r){this.zt(t,s,i,e,n,r),this.zt(t,s+h-1,i,e,n,r),this.kt(t,s,h,e,n,r),this.kt(t+i-1,s,h,e,n,r)}jt(t,s,i,h,e,n,r,o,_,c,u,a,l,A){this.fillRect(t,s,i,h,0,l,A),this.zt(t,s,i,e),this.zt(t,s+h-1,i,r),this.kt(t,s,h,o),this.kt(t+i-1,s,h,n),this.Qt(t,s,_),this.Qt(t+i-1,s,c),this.Qt(t,s+h-1,a),this.Qt(t+i-1,s+h-1,u)}Zt(t,s,i,h,e,n){this.jt(t,s,i,h,A.Rt,A.Kt,A.Rt,A.Kt,A.Ft,A.Nt,A.Gt,A.Lt,e,n)}qt(t,s,i,h,e,n){this.jt(t,s,i,h,A.gt,A.Vt,A.gt,A.Vt,A.Ut,A.Ot,A.Tt,A.It,e,n)}fillRect(t,s,i,h,e,n,r){for(let o=s;o<s+h;o++)this.zt(t,o,i,e,n,r)}$t(t,s,i,e,n,r,o,_){_=_||h.V;for(let h=0;h<o;h++)for(let o=0;o<r;o++){const r=i.N(e+o,n+h);r&&this.tt(t+o,s+h,r,_)}}tt(t,s,i,h){t>=0&&t<this.width&&s>=0&&s<this.height&&this.xt[s][t].tt(i,h)}}class E{constructor(t,s,i,h,e){this.url=t,this.ts=s,this.ss=i,this.scale=h||1,this.hs=!!e}}const f=new E("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);class V{constructor(t,s){this.x=t,this.y=s}}class O{constructor(t,s,i,h){this.x=this.left=t,this.y=this.top=s,this.width=i,this.height=h,this.x2=t+i,this.y2=s+h}es(){return new V(this.x+this.width/2|0,this.y+this.height/2|0)}ns(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.y<this.x2&&t.y>=this.y&&t.y<this.y2}}class T{constructor(t,s,i){this.rs=t,this.rect=s,this.os=i,this.open=!1,this.count=0}}class N{_s(t,s){const i=s.cs.width+4,h=s.cs.height+4,e=(t.width-i)/2|0,n=(t.height-h)/2|0;return new T(s,new O(e,n,i,h),new V(e+2,n+2))}us(t,s){const i=s.rs,{x:h,y:e,width:n,height:r}=s.rect;t.fillRect(h,e,n,r,0,a.C,a.D),t.Zt(h,e,n,r),t.Yt(h+n/2|0,e," "+i.title+" "),i.as(t,s.os)}}class L{constructor(t,s){this.ls=t,this.As=s||new N,this.Ks=[]}add(t){this.Ks.push(this.As._s(this.ls,t))}Es(){if(0===this.Ks.length)return!1;const t=this.Ks.length-1,s=this.Ks[this.Ks.length-1];return s.rs.Es(this.ls,s.os)&&this.Ks.splice(t,1),!0}us(){for(let t=0;t<this.Ks.length;t++)this.As.us(this.ls,this.Ks[t])}}class d{constructor(t,s){this.cs=t,this.title=s}as(t,s){}Es(t,s){}}class D{constructor(){this.fs=!1,this.Vs=0,this.Os=0}update(){this.fs?(this.Vs++,this.Os=0):(this.Vs=0,this.Os++)}Ts(){const t=this.Vs;return 1===t||t>6&&t%1===0}Ns(){return 1===this.Os}}class C{constructor(t){this.keys=new Array(256);for(let t=0;t<256;t++)this.keys[t]=new D;t.addEventListener("keydown",t=>this.Ls(t,!0)),t.addEventListener("keyup",t=>this.Ls(t,!1))}Ls(t,s){const i=t.keyCode;i!==R.ds&&(t.stopPropagation(),t.preventDefault(),i>=0&&i<256&&(this.keys[i].fs=s))}Ds(){for(let t=0;t<256;t++)this.keys[t].update()}getKey(t){return t>=0&&t<256?this.keys[t]:null}}const R={Cs:3,Rs:6,Ss:8,Is:9,Us:12,ws:13,Bs:16,Ms:17,gs:18,Hs:19,Gs:20,Fs:27,ps:32,vs:33,bs:34,Ps:35,ys:36,ms:37,xs:38,Qs:39,Ws:40,Xs:44,Ys:45,zs:46,ks:48,Js:49,js:50,Zs:51,qs:52,$s:53,ti:54,si:55,ii:56,hi:57,ei:58,ni:59,ri:60,oi:61,_i:62,ci:63,ui:64,ai:65,li:66,Ai:67,Ki:68,Ei:69,fi:70,Vi:71,Oi:72,Ti:73,Ni:74,Li:75,di:76,Di:77,Ci:78,Ri:79,Si:80,Ii:81,Ui:82,wi:83,Bi:84,Mi:85,gi:86,Hi:87,Gi:88,Fi:89,pi:90,vi:93,bi:96,Pi:97,yi:98,mi:99,xi:100,Qi:101,Wi:102,Xi:103,Yi:104,zi:105,ki:106,Ji:107,ji:108,Zi:109,qi:110,$i:111,th:112,sh:113,ih:114,hh:115,eh:116,nh:117,rh:118,oh:119,_h:120,uh:121,ds:122,ah:123,lh:124,Ah:125,Kh:126,Eh:127,fh:128,Vh:129,Oh:130,Th:131,Nh:132,Lh:133,dh:134,Dh:135,Ch:144,Rh:145,Sh:160,Ih:161,Uh:162,wh:163,Bh:164,Mh:165,gh:166,Hh:167,Gh:168,Fh:169,ph:170,vh:171,bh:172,Ph:173,yh:174,mh:175,xh:176,Qh:188,Wh:190,Xh:191,Yh:192,zh:219,kh:220,Jh:221,jh:222,Zh:224,qh:225,$h:91,te:21,se:21,ie:22,he:23,ee:24,ne:25,re:25,oe:28,_e:29,ce:30,ue:31,ae:41,le:42,Ae:43,Ke:95};class S extends d{constructor(t,s){const i=s.split("\n");let h=t.length;for(let t=0;t<i.length;t++)h=Math.max(h,i[t].length);const e=i.length;super(new O(0,0,h,e),t),this.Ee=i}as(t,s){for(let i=0;i<this.Ee.length;i++)t.Xt(s.x,s.y+i,this.Ee[i])}Es(t,s){return t.fe(R.Fs)}}class I extends d{constructor(t,s,i){let h=t.length;for(let t=0;t<s.length;t++)h=Math.max(h,s[t].length+4);const e=s.length;super(new O(0,0,h,e),t),this.options=s,this.Ve=i}as(t,s){for(let i=0;i<this.options.length;i++){const h=String.fromCharCode(65+i)+" - "+this.options[i];t.Xt(s.x,s.y+i,h)}}Es(t,s){for(let s=0;s<this.options.length;s++)if(t.fe(R.ai+s))return this.Ve(s),!0;return t.fe(R.Fs)}}const U=[{charCode:A.yt,active:[1,1,0,0]},{charCode:A.Pt,active:[0,1,0,1]}];function w(t,s){const i=new Image;i.onload=()=>{const t=i.width,h=i.height,e=M(i),n=new K(t,h);let r=0;for(let s=0;s<h;s++)for(let i=0;i<t;i++){n.N(i,s).Z(c(e[r++],e[r++],e[r++],e[r++]))}s(n)},i.src=t}function B(t,s){const i=new Image;i.onload=()=>{const t=i.width,h=i.height,e=M(i),n=new K(t/2,h/2);for(let s=0;s<h;s+=2)for(let i=0;i<t;i+=2)g(n,e,i,s,t);s(n)},i.src=t}function M(t){const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const i=s.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data}function g(t,s,i,h,e){const n=4*(h*e+i),r=4*(h*e+i+1),o=4*((h+1)*e+i),_=4*((h+1)*e+i+1),c=[[s[n],s[n+1],s[n+2]],[s[r],s[r+1],s[r+2]],[s[o],s[o+1],s[o+2]],[s[_],s[_+1],s[_+2]]];let u=Number.MAX_VALUE,a=0,l=null,A=null;for(let t=0;t<U.length;t++){const s=U[t],i=H(s.active,c);i.error<u&&(u=i.error,a=s.charCode,l=i.Y,A=i.X)}t.Qt(i/2,h/2,a,G(A),G(l))}function H(t,s){const i=[[0,0,0],[0,0,0]],h=[[0,0,0],[0,0,0]],e=[0,0];for(let h=0;h<4;h++){for(let e=0;e<3;e++)i[t[h]][e]+=s[h][e];e[t[h]]++}for(let t=0;t<2;t++)for(let s=0;s<3;s++)h[t][s]=i[t][s]/e[t];let n=0;for(let i=0;i<4;i++){let e=0;for(let n=0;n<3;n++){const r=s[i][n]-h[t[i]][n];e+=r*r}n+=Math.sqrt(e)}return{Y:h[0],X:h[1],error:n}}function G(t){return c(t[0],t[1],t[2])}class F{constructor(t,s){this.Oe=t.canvas,this.width=t.width,this.height=t.height,this.options=s,this.Te=0,this.Ne=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.buttons=[new D,new D,new D];const i=this.Oe;i.addEventListener("mousedown",t=>this.Le(t)),i.addEventListener("mouseup",t=>this.Le(t)),i.addEventListener("mousemove",t=>this.Le(t)),i.addEventListener("contextmenu",t=>this.Le(t));const h=this.de.bind(this);i.addEventListener("touchstart",h),i.addEventListener("touchend",h),i.addEventListener("touchcancel",h),i.addEventListener("touchmove",h)}de(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type&&this.options.requestFullscreen&&this.requestFullscreen(),t.touches.length>0){const s=t.touches[0];this.De(s.clientX,s.clientY),this.buttons[0].fs=!0}else this.buttons[0].fs=!1}Le(t){t.stopPropagation(),t.preventDefault(),this.De(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons[t.button].fs=!0,this.Oe.focus(),this.options.requestFullscreen&&this.requestFullscreen()),"mouseup"===t.type&&(this.buttons[t.button].fs=!1)}De(t,s){let i=this.Oe.getBoundingClientRect();const h=this.width/this.height,e=i.width/i.height;if(e-h>.01){const t=h*i.height,s=i.width-t;i=new O(Math.floor(s/2),0,t,i.height)}if(e-h<-.01){const t=i.width/h,s=i.height-t;i=new O(0,Math.floor(s/2),i.width,t)}this.x=this.width*(t-i.left)/i.width|0,this.y=this.height*(s-i.top)/i.height|0}requestFullscreen(){const t=this.Oe;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()}update(){this.dx=this.x-this.Te,this.dy=this.y-this.Ne,this.Te=this.x,this.Ne=this.y;for(let t=0;t<this.buttons.length;t++)this.buttons[t].update()}}const p=[-1,0,1,-1,1,-1,0,1],v=[-1,-1,-1,0,0,1,1,1],b=[1.5,1,1.5,1,1,1.5,1,1.5];let P=0;function y(t,s,i,h){P++;const e=t.xt[s.y][s.x];e.Ce=P,e.Re=0,e.Se=Math.min(Math.abs(s.x-i.x),Math.abs(s.y-i.y)),e.Ie=null;const n=new x([e]);for(;n.size()>0;){const s=n.pop();if(s.x===i.x&&s.y===i.y)return m(s);for(let e=0;e<p.length;e++){const r=s.x+p[e],o=s.y+v[e];if(r>=0&&r<t.width&&o>=0&&o<t.height){const _=t.xt[o][r];_.Ce!==P&&(_.Ce=P,_.Re=1/0,_.Se=Math.min(Math.abs(r-i.x),Math.abs(o-i.y)),_.Ie=null);const c=s.Re+b[e];c<_.Re&&c<=h&&(!t.xt[o][r].Ue||r===i.x&&o===i.y)&&(_.Re=c,_.Ie=s,n.we(_))}}}return null}function m(t){const s=[];let i=t;for(;i;)s.push(i),i=i.Ie;return s.reverse(),s}class x{constructor(t){this.values=t}we(t){const s=this.values;let i=0,h=s.length;for(;i<h;){const e=i+h>>>1,n=s[e];n.Re+n.Se>t.Re+t.Se?i=e+1:h=e}s.splice(i+1,0,t)}pop(){return this.values.pop()}size(){return this.values.length}}class Q{constructor(t){this.h=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}Be(){return this.state=(this.a*this.state+this.c)%this.h,this.state}Me(){return this.Be()/(this.h-1)}ge(t,s){const i=s-t,h=t+(this.Be()/this.h*i|0);if(isNaN(h))throw new Error("rand nan");return h}He(t){const s=t.reduce((t,s)=>t+s),i=this.ge(1,s+1);let h=0;for(let s=0;s<t.length;s++)if(h+=t[s],i<=h)return s;return t.length-1}Ge(t){const s=[],i=[];for(const h in t)t.hasOwnProperty(h)&&(s.push(h),i.push(t[h]));return s[this.He(i)]}}function W(t,s){return t/s*2-1}const X={font:f,requestFullscreen:!1};class Y extends K{constructor(t,s,i,h){super(s,i),h=h||X,this.canvas=t,this.font=h.font||f,this.pixelWidth=s*this.font.ts,this.pixelHeight=i*this.font.ss,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.font.scale*this.pixelWidth+"px",t.style.height=this.font.scale*this.pixelHeight+"px",t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.Fe(),window.addEventListener("resize",()=>this.Fe()),this.keys=new C(t),this.pe=new F(this,h);const e=t.getContext("webgl",{ve:!1});if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=e.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.be=e,this.Pe=n,e.attachShader(n,this.ye(e.VERTEX_SHADER,"attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),e.attachShader(n,this.ye(e.FRAGMENT_SHADER,"varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform bool h;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(h){if(gl_FragColor.a<0.1){gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}}")),e.linkProgram(n),e.useProgram(n),this.font.hs&&e.uniform1i(e.getUniformLocation(n,"h"),1),this.me=this.getAttribLocation("a"),this.xe=this.getAttribLocation("b"),this.Qe=this.getAttribLocation("c"),this.We=this.getAttribLocation("d");const r=s*i;this.Xe=new Float32Array(3*r*4),this.Ye=new Uint16Array(6*r),this.ze=new Float32Array(2*r*4),this.ke=new Uint8Array(4*r*4),this.Je=new DataView(this.ke.buffer),this.je=new Uint8Array(4*r*4),this.Ze=new DataView(this.je.buffer);let o=0,_=0,c=0;for(let t=0;t<i;t++)for(let h=0;h<s;h++)this.Xe[o++]=W(h,s),this.Xe[o++]=-W(t,i),this.Xe[o++]=W(h+1,s),this.Xe[o++]=-W(t,i),this.Xe[o++]=W(h+1,s),this.Xe[o++]=-W(t+1,i),this.Xe[o++]=W(h,s),this.Xe[o++]=-W(t+1,i),this.Ye[_++]=c+0,this.Ye[_++]=c+1,this.Ye[_++]=c+2,this.Ye[_++]=c+0,this.Ye[_++]=c+2,this.Ye[_++]=c+3,c+=4;this.qe=e.createBuffer(),this.$e=e.createBuffer(),this.tn=e.createBuffer(),this.sn=e.createBuffer(),this.in=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.qe),e.bufferData(e.ARRAY_BUFFER,this.Xe,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.$e),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.Ye,e.STATIC_DRAW),this.hn=this.en(this.font.url),window.setInterval(()=>this.nn(),1e3/30)}Fe(){const t=this.canvas.parentElement.offsetWidth/this.pixelWidth,s=this.canvas.parentElement.offsetHeight/this.pixelHeight,i=Math.min(t,s),h=i*this.pixelWidth|0,e=i*this.pixelHeight|0;this.canvas.style.width=h+"px",this.canvas.style.height=e+"px"}getAttribLocation(t){const s=this.be.getAttribLocation(this.Pe,t);return this.be.enableVertexAttribArray(s),s}flush(){let t=0,s=0;for(let i=0;i<this.height;i++)for(let h=0;h<this.width;h++){const e=this.N(h,i);if(!e.J){t+=8,s+=16;continue}const n=e.charCode%16,r=e.charCode/16|0;this.ze[t++]=n,this.ze[t++]=r,this.ze[t++]=n+1,this.ze[t++]=r,this.ze[t++]=n+1,this.ze[t++]=r+1,this.ze[t++]=n,this.ze[t++]=r+1;for(let t=0;t<4;t++)this.Je.setUint32(s,e.X,!1),this.Ze.setUint32(s,e.Y,!1),s+=4;e.J=!1}}rn(t){const s=this.keys.getKey(t);return s&&s.fs}fe(t){const s=this.keys.getKey(t);return s&&s.Ts()}on(t){const s=this.keys.getKey(t);return s?s.Vs:0}ye(t,s){const i=this.be,h=i.createShader(t);if(!h)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(h,s),i.compileShader(h),!i.getShaderParameter(h,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(h));return h}en(t){const s=this.be,i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const h=s.RGBA,e=s.RGBA,n=s.UNSIGNED_BYTE,r=new Uint8Array([0,0,0,255]);s.texImage2D(s.TEXTURE_2D,0,h,1,1,0,e,n,r);const o=new Image;return o.onload=()=>{s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,h,e,n,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)},o.src=t,i}_n(){const t=this.be;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.qe),t.vertexAttribPointer(this.me,s,i,h,e,n)}{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.tn),t.bufferData(t.ARRAY_BUFFER,this.ze,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.xe,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.sn),t.bufferData(t.ARRAY_BUFFER,this.ke,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Qe,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.in),t.bufferData(t.ARRAY_BUFFER,this.je,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.We,s,i,h,e,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.$e),t.useProgram(this.Pe),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.hn);{const s=this.width*this.height*6,i=t.UNSIGNED_SHORT,h=0;t.drawElements(t.TRIANGLES,s,i,h)}}nn(){this.keys.Ds(),this.pe.update(),this.update&&this.update(),this.state&&this.state.update(),this.flush(),this._n()}}const z={cn:1,un:2,an:4,ln:8,An:16,Kn:32,En:64,fn:128},k={Vn:3,On:6,Tn:12,Nn:24,Ln:48,dn:96,Dn:192,Cn:129};function J(t,s){return t>0?s>0?k.Vn:0===s?k.On:k.Tn:t<0?s>0?k.Dn:0===s?k.dn:k.Ln:s>0?k.Cn:k.Nn}class j extends l{constructor(t,s){super(),this.x=t,this.y=s,this.Ue=!1,this.Rn=!1,this.Sn=!1,this.visible=!1,this.Ce=-1,this.Re=0,this.Se=0,this.Ie=null}}class Z extends K{constructor(t,s,i){if(super(t,s,j),this.In=0,this.Un=0,this.wn=0,this.Bn=0,this.Mn=0,this.gn=0,this.Hn=0,i)for(let h=0;h<s;h++)for(let s=0;s<t;s++)this.xt[h][s].Ue=this.xt[h][s].Rn=i(s,h)}Gn(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.xt[s][t].Ue=i)}Fn(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.xt[s][t].Rn=i)}pn(t,s){return!(t<this.wn||t>this.Bn||s<this.Mn||s>this.gn)&&this.xt[s][t].visible}vn(t,s){const i=[],h=[];let e,n,r,o,_,c,u,a,l,A,K=1,E=0,f=0,V=0;for(n=this.Un+s;n>=this.Mn&&n<=this.gn;n+=s,f=E,++K)for(r=.5/K,A=-1,o=Math.floor(V*K+.5),e=this.In+o*t;o<=K&&e>=this.wn&&e<=this.Bn;e+=t,++o,A=l){if(_=!0,c=!1,u=o/K,a=A,l=u+r,f>0)if(this.xt[n-s][e].visible&&!this.xt[n-s][e].Rn||this.xt[n-s][e-t].visible&&!this.xt[n-s][e-t].Rn){for(let t=0;t<f&&_;++t)if(a<=h[t]&&l>=i[t])if(this.xt[n][e].Rn){if(a>=i[t]&&l<=h[t]){_=!1;break}i[t]=Math.min(i[t],a),h[t]=Math.max(h[t],l),c=!0}else if(u>i[t]&&u<h[t]){_=!1;break}}else _=!1;_&&(this.xt[n][e].visible=!0,this.xt[n][e].Rn&&(V>=a?V=l:c||(i[E]=a,h[E++]=l)))}}bn(t,s){const i=[],h=[];let e,n,r,o,_,c,u,a,l,A,K=1,E=0,f=0,V=0;for(e=this.In+t;e>=this.wn&&e<=this.Bn;e+=t,f=E,++K)for(r=.5/K,A=-1,o=Math.floor(V*K+.5),n=this.Un+o*s;o<=K&&n>=this.Mn&&n<=this.gn;n+=s,++o,A=l){if(_=!0,c=!1,u=o/K,a=A,l=u+r,f>0)if(this.xt[n][e-t].visible&&!this.xt[n][e-t].Rn||this.xt[n-s][e-t].visible&&!this.xt[n-s][e-t].Rn){for(let t=0;t<f&&_;++t)if(a<=h[t]&&l>=i[t])if(this.xt[n][e].Rn){if(a>=i[t]&&l<=h[t]){_=!1;break}i[t]=Math.min(i[t],a),h[t]=Math.max(h[t],l),c=!0}else if(u>i[t]&&u<h[t]){_=!1;break}}else _=!1;_&&(this.xt[n][e].visible=!0,this.xt[n][e].Rn&&(V>=a?V=l:c||(i[E]=a,h[E++]=l)))}}Pn(t,s,i,h,e){if(this.In=t,this.Un=s,this.Hn=i,h)this.wn=Math.min(this.wn,Math.max(0,t-i)),this.Mn=Math.min(this.Mn,Math.max(0,s-i)),this.Bn=Math.max(this.Bn,Math.min(this.width-1,t+i)),this.gn=Math.max(this.gn,Math.min(this.height-1,s+i));else{this.wn=Math.max(0,t-i),this.Mn=Math.max(0,s-i),this.Bn=Math.min(this.width-1,t+i),this.gn=Math.min(this.height-1,s+i);for(let t=this.Mn;t<=this.gn;t++)for(let s=this.wn;s<=this.Bn;s++)this.xt[t][s].visible=!1}this.xt[s][t].visible=!0,void 0===e?(this.vn(1,1),this.bn(1,1),this.bn(1,-1),this.vn(1,-1),this.vn(-1,-1),this.bn(-1,-1),this.bn(-1,1),this.vn(-1,1)):(1&e&&this.vn(1,1),2&e&&this.bn(1,1),4&e&&this.bn(1,-1),8&e&&this.vn(1,-1),16&e&&this.vn(-1,-1),32&e&&this.bn(-1,-1),64&e&&this.bn(-1,1),128&e&&this.vn(-1,1))}yn(){for(let t=this.Mn;t<=this.gn;t++)for(let s=this.wn;s<=this.Bn;s++){const i=this.xt[t][s];i.Sn|=i.visible}}}}])}));