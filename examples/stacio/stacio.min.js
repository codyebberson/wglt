(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./examples/stacio/stacio.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./examples/stacio/blocktypes.js":
/*!***************************************!*\
  !*** ./examples/stacio/blocktypes.js ***!
  \***************************************/
/*! exports provided: BlockTypes */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BlockTypes\", function() { return BlockTypes; });\n\r\n\r\nconst BlockTypes = {\r\n    BLOCK_TYPE_MEGA_BUILDING: 1,\r\n    BLOCK_TYPE_NORMAL_BLOCK: 2,\r\n    BLOCK_TYPE_PARK: 3,\r\n    BLOCK_TYPE_PRISON: 4,\r\n    BLOCK_TYPE_TRASH: 5,\r\n};\n\n//# sourceURL=webpack:///./examples/stacio/blocktypes.js?");

/***/ }),

/***/ "./examples/stacio/constants.js":
/*!**************************************!*\
  !*** ./examples/stacio/constants.js ***!
  \**************************************/
/*! exports provided: Constants */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Constants\", function() { return Constants; });\n/* harmony import */ var _src_rect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/rect */ \"./src/rect.js\");\n\r\n\r\nconst SCREEN_WIDTH_PIXELS = 640;\r\nconst SCREEN_HEIGHT_PIXELS = 360;\r\nconst SCREEN_WIDTH = SCREEN_WIDTH_PIXELS / 8;\r\nconst SCREEN_HEIGHT = SCREEN_HEIGHT_PIXELS / 8;\r\nconst LEFT_CONSOLE_WIDTH = 20;\r\nconst TOP_CONSOLE_HEIGHT = 3;\r\nconst BOTTOM_CONSOLE_HEIGHT = 2;\r\n\r\n// const GAME_AREA_X = LEFT_CONSOLE_WIDTH;\r\n// const GAME_AREA_Y = TOP_CONSOLE_HEIGHT;\r\n// const GAME_AREA_WIDTH = SCREEN_WIDTH - LEFT_CONSOLE_WIDTH;\r\n// const GAME_AREA_HEIGHT = SCREEN_HEIGHT - TOP_CONSOLE_HEIGHT - BOTTOM_CONSOLE_HEIGHT;\r\nconst GAME_AREA_X = 0;\r\nconst GAME_AREA_Y = 0;\r\nconst GAME_AREA_WIDTH = SCREEN_WIDTH;\r\nconst GAME_AREA_HEIGHT = SCREEN_HEIGHT;\r\n\r\nconst DEFAULT_VIEW_DISTANCE = 14.5;\r\nconst PLAYER_VIEW_DISTANCE = 19.5;\r\n\r\nconst BLOCK_SIZE = 100;\r\nconst MAP_WIDTH_BLOCKS = 10;\r\nconst MAP_HEIGHT_BLOCKS = 5;\r\nconst MAP_BUFFER = 12;\r\nconst MAP_WIDTH = MAP_WIDTH_BLOCKS * BLOCK_SIZE + 2 * MAP_BUFFER;\r\nconst MAP_HEIGHT = MAP_HEIGHT_BLOCKS * BLOCK_SIZE + 2 * MAP_BUFFER;\r\n\r\nconst Constants = {\r\n    SCREEN_WIDTH_PIXELS: SCREEN_WIDTH_PIXELS,\r\n    SCREEN_HEIGHT_PIXELS: SCREEN_HEIGHT_PIXELS,\r\n    SCREEN_WIDTH: SCREEN_WIDTH,\r\n    SCREEN_HEIGHT: SCREEN_HEIGHT,\r\n    LEFT_CONSOLE_WIDTH: LEFT_CONSOLE_WIDTH,\r\n    TOP_CONSOLE_HEIGHT: TOP_CONSOLE_HEIGHT,\r\n    BOTTOM_CONSOLE_HEIGHT: BOTTOM_CONSOLE_HEIGHT,\r\n\r\n    GAME_AREA_X: GAME_AREA_X,\r\n    GAME_AREA_Y: GAME_AREA_Y,\r\n    GAME_AREA_WIDTH: GAME_AREA_WIDTH,\r\n    GAME_AREA_HEIGHT: GAME_AREA_HEIGHT,\r\n    GAME_AREA: new _src_rect__WEBPACK_IMPORTED_MODULE_0__[\"Rect\"](GAME_AREA_X, GAME_AREA_Y, GAME_AREA_WIDTH, GAME_AREA_HEIGHT),\r\n\r\n    DEFAULT_VIEW_DISTANCE: DEFAULT_VIEW_DISTANCE,\r\n    PLAYER_VIEW_DISTANCE: PLAYER_VIEW_DISTANCE,\r\n\r\n    BLOCK_SIZE: BLOCK_SIZE,\r\n    MAP_WIDTH_BLOCKS: MAP_WIDTH_BLOCKS,\r\n    MAP_HEIGHT_BLOCKS: MAP_HEIGHT_BLOCKS,\r\n    MAP_BUFFER: MAP_BUFFER,\r\n    MAP_WIDTH: MAP_WIDTH,\r\n    MAP_HEIGHT: MAP_HEIGHT,\r\n};\r\n\n\n//# sourceURL=webpack:///./examples/stacio/constants.js?");

/***/ }),

/***/ "./examples/stacio/entitystates.js":
/*!*****************************************!*\
  !*** ./examples/stacio/entitystates.js ***!
  \*****************************************/
/*! exports provided: EntityStates */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"EntityStates\", function() { return EntityStates; });\n\r\nconst EntityStates = {\r\n    STATE_WALKING: 1,\r\n    STATE_WAITING: 2,\r\n    STATE_ATTACKING: 3,\r\n};\r\n\n\n//# sourceURL=webpack:///./examples/stacio/entitystates.js?");

/***/ }),

/***/ "./examples/stacio/entitytypes.js":
/*!****************************************!*\
  !*** ./examples/stacio/entitytypes.js ***!
  \****************************************/
/*! exports provided: EntityTypes */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"EntityTypes\", function() { return EntityTypes; });\n\r\nconst EntityTypes = {\r\n    ENTITY_TYPE_PLAYER: 1,\r\n    ENTITY_TYPE_GUARD: 2,\r\n    ENTITY_TYPE_CAMERA: 3,\r\n    ENTITY_TYPE_STAFF: 4,\r\n    ENTITY_TYPE_HEALTHKIT: 5,\r\n};\r\n\n\n//# sourceURL=webpack:///./examples/stacio/entitytypes.js?");

/***/ }),

/***/ "./examples/stacio/gamemodes.js":
/*!**************************************!*\
  !*** ./examples/stacio/gamemodes.js ***!
  \**************************************/
/*! exports provided: GameModes */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GameModes\", function() { return GameModes; });\n\r\nconst GameModes = {\r\n    MODE_CURSOR: 1,\r\n    MODE_PLAYER: 2,\r\n    MODE_CHARACTER: 3,\r\n    MODE_MAP: 4,\r\n    MODE_FACTIONS: 5,\r\n    MODE_DIALOG: 7,\r\n    MODE_TRADE: 8,\r\n    MODE_DEBUG: 100,\r\n};\r\n\n\n//# sourceURL=webpack:///./examples/stacio/gamemodes.js?");

/***/ }),

/***/ "./examples/stacio/gamestate.js":
/*!**************************************!*\
  !*** ./examples/stacio/gamestate.js ***!
  \**************************************/
/*! exports provided: GameState */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GameState\", function() { return GameState; });\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _gamemodes_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./gamemodes.js */ \"./examples/stacio/gamemodes.js\");\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants.js */ \"./examples/stacio/constants.js\");\n\r\n\r\n\r\n\r\n\r\nclass GameState {\r\n    constructor() {\r\n        this.worldMap = null;\r\n        this.map = null;\r\n        this.gameClock = 0;\r\n        this.gameMode = _gamemodes_js__WEBPACK_IMPORTED_MODULE_1__[\"GameModes\"].MODE_PLAYER;\r\n        this.player = { x: 40, y: 90, ap: 1, hp: 100, dest: { x: 40, y: 90 }, c: '@', color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE, gender: 'male', name: 'Player', level: 1, viewDistance: _constants_js__WEBPACK_IMPORTED_MODULE_2__[\"Constants\"].PLAYER_VIEW_DISTANCE };\r\n        this.cursor = { x: -1, y: -1 };\r\n        this.vehicle = { x: 40, y: 100, dx: 4, dy: 0 };\r\n        this.viewport = { x: 0, y: 0 };\r\n\r\n        this.factions = [];\r\n        this.entities = [this.player];\r\n        this.pwned = [];\r\n        this.followed = null;\r\n        this.messages = [{ color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE, text: 'Welcome to Stacio' }];\r\n        this.selectedEntity = null;\r\n        this.hackPuzzle = null;\r\n    }\r\n\r\n    setGameMode(newGameMode) {\r\n        this.gameMode = newGameMode;\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack:///./examples/stacio/gamestate.js?");

/***/ }),

/***/ "./examples/stacio/procgen.js":
/*!************************************!*\
  !*** ./examples/stacio/procgen.js ***!
  \************************************/
/*! exports provided: initWorld */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"initWorld\", function() { return initWorld; });\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _src_chars_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/chars.js */ \"./src/chars.js\");\n/* harmony import */ var _src_prim_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/prim.js */ \"./src/prim.js\");\n/* harmony import */ var _gamestate_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./gamestate.js */ \"./examples/stacio/gamestate.js\");\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./constants.js */ \"./examples/stacio/constants.js\");\n/* harmony import */ var _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./blocktypes.js */ \"./examples/stacio/blocktypes.js\");\n/* harmony import */ var _tiles_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./tiles.js */ \"./examples/stacio/tiles.js\");\n/* harmony import */ var _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./entitytypes.js */ \"./examples/stacio/entitytypes.js\");\n/* harmony import */ var _entitystates_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./entitystates.js */ \"./examples/stacio/entitystates.js\");\n/* harmony import */ var _src_boxutils_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../src/boxutils.js */ \"./src/boxutils.js\");\n/* harmony import */ var _src_tilemap_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../src/tilemap.js */ \"./src/tilemap.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst state = new _gamestate_js__WEBPACK_IMPORTED_MODULE_3__[\"GameState\"]();\r\n\r\nfunction initWorld() {\r\n    // Create factions\r\n    const FACTION_COLORS = [\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_BLUE,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_CYAN,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_BLUE,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_CYAN,\r\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED,\r\n    ];\r\n    for (var i = 0; i < 10; i++) {\r\n        var name = null;\r\n        var rep = 0;\r\n        if (i === 0) {\r\n            name = 'Unaffiliated';\r\n            rep = 1;\r\n        } else if (i === 1) {\r\n            name = 'Justice';\r\n            rep = 1;\r\n        } else if (i >= 2 && i <= 4) {\r\n            name = generateFactionName();\r\n            rep = 0;\r\n        } else {\r\n            name = generateGangName();\r\n            rep = -1;\r\n        }\r\n        state.factions.push({\r\n            id: i,\r\n            justice: i === 1,\r\n            name: name,\r\n            color: FACTION_COLORS[i],\r\n            playerReputation: rep\r\n        });\r\n    }\r\n\r\n    state.worldMap = new Array(_constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_HEIGHT_BLOCKS);\r\n    for (var y = 0; y < _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_HEIGHT_BLOCKS; y++) {\r\n        state.worldMap[y] = new Array(_constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_WIDTH_BLOCKS);\r\n        for (var x = 0; x < _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_WIDTH_BLOCKS; x++) {\r\n            state.worldMap[y][x] = {\r\n                blockType: _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_NORMAL_BLOCK,\r\n                faction: chooseItem(state.factions)\r\n            };\r\n        }\r\n    }\r\n\r\n    createBlocks(_blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_MEGA_BUILDING, 4);\r\n    createBlocks(_blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_PARK, 8);\r\n    createBlocks(_blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_PRISON, 4);\r\n    createBlocks(_blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_TRASH, 3);\r\n\r\n    state.map = new _src_tilemap_js__WEBPACK_IMPORTED_MODULE_10__[\"TileMap\"](_constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_WIDTH, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_HEIGHT);\r\n    state.map.fillRect(0, 0, state.map.width, state.map.height, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_GRASS);\r\n\r\n    for (var i = 0; i < 3; i++) {\r\n        state.map.drawHLine(0, i, state.map.width, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TREE);\r\n        state.map.drawHLine(0, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_HEIGHT - 1 - i, state.map.width, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TREE);\r\n        state.map.drawVLine(i, 0, state.map.height, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TREE);\r\n        state.map.drawVLine(_constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_WIDTH - 1 - i, 0, state.map.height, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TREE);\r\n    }\r\n\r\n    state.map.fillRect(_constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER, state.map.width - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER, state.map.height - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET);\r\n\r\n    for (var y = _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; y < state.map.height - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; y++) {\r\n        for (var x = _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; x < state.map.width - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; x++) {\r\n            var r = Math.random();\r\n            if (r < 0.0005) {\r\n                state.map.drawCell(x, y, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_MANHOLE);\r\n            } else if (r < 0.05) {\r\n                state.map.drawCell(x, y, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_POTHOLE);\r\n            }\r\n        }\r\n    }\r\n\r\n    for (var y = _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; y < state.map.height - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; y += 100) {\r\n        for (var x = _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; x < state.map.width - 2 * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_BUFFER; x += 100) {\r\n            initBlock(x, y);\r\n        }\r\n    }\r\n\r\n    // convertWallTiles(state.map);\r\n    Object(_src_boxutils_js__WEBPACK_IMPORTED_MODULE_9__[\"fixBoxCells\"])(state.map);\r\n\r\n    // TODO\r\n    for (let y = 0; y < state.map.height; y++) {\r\n        for (let x = 0; x < state.map.width; x++) {\r\n            const tile = state.map.grid[y][x];\r\n            if (tile.meta.door) {\r\n                tile.blocked = false;\r\n                tile.blockSight = true;\r\n            } else if (tile.meta.impassable) {\r\n                tile.blocked = true;\r\n                tile.blockSight = true;\r\n            } else {\r\n                tile.blocked = false;\r\n                tile.blockSight = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    return state;\r\n}\r\n\r\nfunction createBlocks(blockType, count) {\r\n    var i = 0;\r\n    while (i < count) {\r\n        let x = Math.floor(Math.random() * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_WIDTH_BLOCKS);\r\n        let y = Math.floor(Math.random() * _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].MAP_HEIGHT_BLOCKS);\r\n        if (state.worldMap[y][x].blockType === _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_NORMAL_BLOCK) {\r\n            state.worldMap[y][x].blockType = blockType;\r\n            i++;\r\n        }\r\n    }\r\n}\r\n\r\nfunction initBlock(x, y) {\r\n    initBaseBlock(x, y);\r\n\r\n    let worldMapBlock = state.worldMap[Math.floor(y / _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE)][Math.floor(x / _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE)];\r\n\r\n    switch (worldMapBlock.blockType) {\r\n        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_NORMAL_BLOCK:\r\n            init4BuildingBlock(worldMapBlock.faction, x, y);\r\n            break;\r\n        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_MEGA_BUILDING:\r\n            initMegaBuildingBlock(worldMapBlock.faction, x, y);\r\n            break;\r\n        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_PARK:\r\n            initParkBlock(worldMapBlock.faction, x, y);\r\n            break;\r\n        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_PRISON:\r\n            initPrisonBlock(worldMapBlock.faction, x, y);\r\n            break;\r\n        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_5__[\"BlockTypes\"].BLOCK_TYPE_TRASH:\r\n            initTrashBlock(worldMapBlock.faction, x, y);\r\n            break;\r\n    }\r\n}\r\n\r\nfunction initBaseBlock(x, y) {\r\n    // Streets:  0-12, 88-100\r\n    // Potholes\r\n    // Sidwalks:  12-15, 85-88\r\n    state.map.fillRect(x + 12, y + 12, 76, 76, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_SIDEWALK);\r\n\r\n    // 4 Yellow lines:  outer border\r\n    state.map.drawHLine(x + 17, y, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_YELLOW_HLINE);\r\n    state.map.drawHLine(x + 17, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 1, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_YELLOW_HLINE);\r\n\r\n    state.map.drawVLine(x, y + 17, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_YELLOW_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 1, y + 17, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_YELLOW_VLINE);\r\n\r\n    // 4 White lines\r\n    state.map.drawHLine(x + 17, y + 6, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x + 17, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 7, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n\r\n    state.map.drawVLine(x + 6, y + 17, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 7, y + 17, _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 34, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n\r\n    // 4 Cross walks, 8 crosswalk lines\r\n    state.map.drawHLine(x, y + 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x, y + 16, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, y + 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, y + 16, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 13, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 17, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 13, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n    state.map.drawHLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 17, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_HLINE);\r\n\r\n    state.map.drawVLine(x + 12, y, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + 16, y, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + 12, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + 16, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 13, y, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 17, y, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 13, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n    state.map.drawVLine(x + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 17, y + _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].BLOCK_SIZE - 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_STREET_WHITE_VLINE);\r\n\r\n    // Law enforcement patrolling on top of white lines (cars?)\r\n    for (var i = 0; i < 4; i++) {\r\n        createGuard(state.factions[1], x + 6, y + 5, 88, 88, i);\r\n        createGuard(state.factions[1], x + 5, y + 6, 88, 88, i);\r\n        createGuard(state.factions[1], x + 7, y + 6, 88, 88, i);\r\n        createGuard(state.factions[1], x + 6, y + 7, 88, 88, i);\r\n    }\r\n}\r\n\r\nfunction init4BuildingBlock(faction, x, y) {\r\n    let r = Math.random();\r\n    if (r < 0.2) {\r\n        initHotel(x + 15, y + 15);\r\n    } else if (r < 0.3) {\r\n        initArena(x + 15, y + 15);\r\n    } else {\r\n        initBuilding(faction, x + 15, y + 15, 32, 32);\r\n    }\r\n\r\n    initBuilding(faction, x + 53, y + 15, 32, 32);\r\n    initBuilding(faction, x + 15, y + 53, 32, 32);\r\n    initBuilding(faction, x + 53, y + 53, 32, 32);\r\n}\r\n\r\nfunction initHotel(x, y) {\r\n    initBuilding(state.factions[0], x, y, 32, 32);\r\n\r\n    // Top center\r\n    state.map.drawRect(x + 9, y, 13, 10, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL);\r\n    state.map.drawCell(x + 15, y + 9, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n\r\n    // Top left\r\n    state.map.drawRect(x, y, 10, 14, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL);\r\n    state.map.drawCell(x + 9, y + 11, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n\r\n    // Top right\r\n    state.map.drawRect(x + 21, y, 11, 14, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL);\r\n    state.map.drawCell(x + 21, y + 11, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n\r\n    // Middle left\r\n    state.map.drawRect(x, y + 13, 10, 14, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL);\r\n    state.map.drawCell(x + 9, y + 20, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n\r\n    // Middle right\r\n    state.map.drawRect(x + 21, y + 13, 11, 14, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL);\r\n    state.map.drawCell(x + 21, y + 20, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n\r\n    state.player.x = x + 16;\r\n    state.player.y = y + 16;\r\n    state.player.dest.x = state.player.x;\r\n    state.player.dest.y = state.player.y;\r\n\r\n    createStaff(state.factions[0], x + 12, y + 18, 8, 8);\r\n}\r\n\r\nfunction initArena(x, y) {\r\n    initBuilding(state.factions[0], x, y, 32, 32);\r\n\r\n    // Centerbox\r\n    state.map.drawRect(x + 10, y + 10, 12, 12, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n}\r\n\r\nfunction initMegaBuildingBlock(faction, x, y) {\r\n    initBuilding(faction, x + 15, y + 15, 70, 70);\r\n\r\n    for (var i = 0; i < 20; i++) {\r\n        createStaff(faction, x + 20, y + 20, 60, 60);\r\n    }\r\n}\r\n\r\nfunction initParkBlock(faction, x, y) {\r\n    state.map.fillRect(x + 15, y + 15, 70, 70, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_GRASS);\r\n\r\n    for (var i = 0; i < 500; i++) {\r\n        let wx = x + 15 + Math.floor(Math.random() * 70);\r\n        let wy = y + 15 + Math.floor(Math.random() * 70);\r\n        state.map.drawCell(wx, wy, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WEEDS);\r\n    }\r\n}\r\n\r\nfunction initPrisonBlock(faction, x, y) {\r\n    // Outer wall\r\n    initBuildingHWall(x + 15, y + 15, 70, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingHWall(x + 15, y + 84, 70, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingVWall(x + 15, y + 15, 70, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingVWall(x + 84, y + 15, 70, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n\r\n    // Inner wall\r\n    initBuildingHWall(x + 18, y + 18, 64, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingHWall(x + 18, y + 81, 64, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingVWall(x + 18, y + 18, 64, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n    initBuildingVWall(x + 81, y + 18, 64, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_FENCE);\r\n\r\n    // Main building\r\n    // (100 - 32) / 2 = 34\r\n    initBuilding(faction, x + 34, y + 34, 33, 33);\r\n    for (var y2 = 34; y2 < 34 + 32; y2 += 4) {\r\n        initBuildingWalls(x + 34, y + y2, 13, 5);\r\n        initBuildingWalls(x + 54, y + y2, 13, 5);\r\n    }\r\n}\r\n\r\nfunction initTrashBlock(faction, x, y) {\r\n    let prim = Object(_src_prim_js__WEBPACK_IMPORTED_MODULE_2__[\"createPrimLevel\"])(37, 37, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TRASH_WALL, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TRASH_FLOOR);\r\n\r\n    for (var i = 0; i < 35; i++) {\r\n        for (var j = 0; j < 35; j++) {\r\n            let tx = x + 15 + j * 2;\r\n            let ty = y + 15 + i * 2;\r\n            let brush = undefined;\r\n\r\n            if (prim.getCell(j + 1, i + 1).meta.impassable) {\r\n                brush = _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TRASH_WALL;\r\n            } else {\r\n                brush = _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TRASH_FLOOR;\r\n                let r = Math.random();\r\n                if (r < 0.02) {\r\n                    createGuard(faction, tx, ty, 2, 2, 0);\r\n                } else if (r < 0.04) {\r\n                    createEntity({\r\n                        entityType: _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_HEALTHKIT,\r\n                        name: 'HealthKit',\r\n                        hp: 100,\r\n                        x: tx,\r\n                        y: ty,\r\n                        c: '+',\r\n                        desc: 'HealthKit',\r\n                        level: 1 + Math.floor(Math.random() * 3),\r\n                        faction: state.factions[0],\r\n                        color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED\r\n                    });\r\n                }\r\n            }\r\n            state.map.fillRect(x + 15 + j * 2, y + 15 + i * 2, 2, 2, brush);\r\n        }\r\n    }\r\n\r\n    // Rather than using '#' for walls, use extended chars for more random look\r\n    // Char codes 128-160 are accented characters\r\n    for (var i = y + 15; i < y + 85; i++) {\r\n        for (var j = x + 15; j < x + 85; j++) {\r\n            let cell = state.map.getCell(j, i);\r\n            if (cell.meta.impassable) {\r\n                cell.charCode = Math.floor(128 + Math.random() * 32);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction createEntity(entity) {\r\n    entity.dest = { x: entity.x, y: entity.y };\r\n    entity.lastSeen = { x: -1, y: -1 };\r\n    if (entity.theta === undefined) {\r\n        entity.theta = 0.0;\r\n    }\r\n    state.entities.push(entity);\r\n    state.map.grid[entity.y][entity.x].entity = entity;\r\n}\r\n\r\nfunction createGuard(faction, x, y, width, height, corner) {\r\n    // var gender = null;\r\n    // var name = null;\r\n    // if (Math.random() > 0.5) {\r\n    //     gender = 'female';\r\n    //     name = generatePersonName(femaleFirstNames, surnames, 16);\r\n    // } else {\r\n    //     gender = 'male';\r\n    //     name = generatePersonName(maleFirstNames, surnames, 16);\r\n    // }\r\n    // const name = 'GUARD';\r\n\r\n    var c = null;\r\n    var desc = null;\r\n    if (faction.id === 0) {\r\n        c = 'C';\r\n        desc = 'Citizen';\r\n    } else if (faction.id === 1) {\r\n        c = 'J';\r\n        desc = 'Judge';\r\n    } else if (faction.id >= 2 && faction.id <= 4) {\r\n        c = 'G';\r\n        desc = 'Guard';\r\n    } else {\r\n        c = 'p';\r\n        desc = 'Punk';\r\n    }\r\n\r\n    let waypoints = [\r\n        { x: x, y: y },\r\n        { x: x + width - 1, y: y },\r\n        { x: x + width - 1, y: y + height - 1 },\r\n        { x: x, y: y + height - 1 }\r\n    ];\r\n\r\n    let waitCount = faction.justice ? 0 : Math.floor(Math.random() * 10);\r\n\r\n    createEntity({\r\n        entityType: _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_GUARD,\r\n        // gender: gender,\r\n        name: desc,\r\n        hp: 100,\r\n        x: waypoints[corner].x,\r\n        y: waypoints[corner].y,\r\n        c: c,\r\n        desc: desc,\r\n        level: 1 + Math.floor(Math.random() * 3),\r\n        viewDistance: _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].DEFAULT_VIEW_DISTANCE,\r\n        faction: faction,\r\n        color: faction.color,\r\n        state: _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WAITING,\r\n        waitCount: waitCount,\r\n        waypointIndex: ((corner + 1) % 4),\r\n        waypoints: waypoints\r\n    });\r\n}\r\n\r\nfunction createStaff(faction, x, y, width, height) {\r\n    // var gender = null;\r\n    // var name = null;\r\n    // if (Math.random() > 0.5) {\r\n    //     gender = 'female';\r\n    //     name = generatePersonName(femaleFirstNames, surnames, 16);\r\n    // } else {\r\n    //     gender = 'male';\r\n    //     name = generatePersonName(maleFirstNames, surnames, 16);\r\n    // }\r\n\r\n    createEntity({\r\n        entityType: _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_STAFF,\r\n        // gender: gender,\r\n        name: 'Staff',\r\n        hp: 100,\r\n        x: (x + Math.floor(Math.random() * width)),\r\n        y: (y + Math.floor(Math.random() * height)),\r\n        c: 'S',\r\n        desc: 'Staff',\r\n        level: 1 + Math.floor(Math.random() * 3),\r\n        viewDistance: _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].DEFAULT_VIEW_DISTANCE,\r\n        faction: faction,\r\n        color: faction.color,\r\n        state: _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WAITING,\r\n        waitCount: Math.floor(Math.random() * 10),\r\n        waypointIndex: 0,\r\n        waypoints: [\r\n            { x: (x + Math.floor(Math.random() * width)), y: (y + Math.floor(Math.random() * height)) },\r\n            { x: (x + Math.floor(Math.random() * width)), y: (y + Math.floor(Math.random() * height)) },\r\n            { x: (x + Math.floor(Math.random() * width)), y: (y + Math.floor(Math.random() * height)) },\r\n        ]\r\n    });\r\n}\r\n\r\nfunction initBuildingHWall(x, y, width, opt_tile) {\r\n    const brush = opt_tile !== undefined ? opt_tile : _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL;\r\n    state.map.drawHLine(x, y, width, brush);\r\n    state.map.drawCell(x + Math.floor(width / 2), y, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n}\r\n\r\nfunction initBuildingVWall(x, y, height, opt_tile) {\r\n    const brush = opt_tile !== undefined ? opt_tile : _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_WALL;\r\n    state.map.drawVLine(x, y, height, brush);\r\n    state.map.drawCell(x, y + Math.floor(height / 2), _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_DOOR);\r\n}\r\n\r\nfunction initBuildingWalls(x, y, width, height) {\r\n    initBuildingHWall(x, y, width);\r\n    initBuildingHWall(x, y + height - 1, width);\r\n    initBuildingVWall(x, y, height);\r\n    initBuildingVWall(x + width - 1, y, height);\r\n}\r\n\r\n// function chooseAndRemove(options) {\r\n//     return options.splice(Math.floor(Math.random() * options.length), 1)[0];\r\n// }\r\n\r\nfunction chooseItem(options) {\r\n    return options[Math.floor(Math.random() * options.length)];\r\n}\r\n\r\nfunction generateFactionName() {\r\n    // while (true) {\r\n    //     let name = chooseAndRemove(corpPrefix) + ' ' + chooseAndRemove(corpSuffix);\r\n    //     if (name.length < 16) {\r\n    //         return name;\r\n    //     }\r\n    // }\r\n    return 'CORP';\r\n}\r\n\r\nfunction generateGangName() {\r\n    // while (true) {\r\n    //     let name = chooseAndRemove(gangPrefix) + ' ' + chooseAndRemove(gangSuffix);\r\n    //     if (name.length < 16) {\r\n    //         return name;\r\n    //     }\r\n    // }\r\n    return 'GANG';\r\n}\r\n\r\n// function generatePersonName(firstNames, surnames, maxLength) {\r\n//     // while (true) {\r\n//     //     let name = chooseItem(firstNames) + ' ' + chooseItem(surnames);\r\n//     //     if (name.length < maxLength) {\r\n//     //         return name;\r\n//     //     }\r\n//     // }\r\n// }\r\n\r\nfunction initBuilding(faction, x, y, width, height) {\r\n    state.map.fillRect(x, y, width, height, _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_INTERIOR);\r\n\r\n    initBuildingWalls(x, y, width, height);\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n        var tile = null;\r\n        var tile = _tiles_js__WEBPACK_IMPORTED_MODULE_6__[\"Tiles\"].TILE_TRASH_BIN;\r\n        var trashX = 0;\r\n        var trashY = 0;\r\n        var r = Math.random();\r\n        if (r < 0.25) {\r\n            trashX = x + Math.floor(Math.random() * width);\r\n            trashY = y - 1;\r\n        } else if (r < 0.5) {\r\n            trashX = x + Math.floor(Math.random() * width);\r\n            trashY = y + height;\r\n        } else if (r < 0.75) {\r\n            trashX = x - 1;\r\n            trashY = y + Math.floor(Math.random() * height);\r\n        } else {\r\n            trashX = x + width;\r\n            trashY = y + Math.floor(Math.random() * height);\r\n        }\r\n        state.map.drawCell(trashX, trashY, tile);\r\n    }\r\n\r\n    for (var corner = 0; corner < 4; corner++) {\r\n        createGuard(faction, x - 2, y - 2, width + 4, height + 4, corner);\r\n    }\r\n\r\n    createEntity({\r\n        entityType: _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_CAMERA,\r\n        name: 'Camera',\r\n        hp: 100,\r\n        x: x - 1,\r\n        y: y + 4,\r\n        c: _src_chars_js__WEBPACK_IMPORTED_MODULE_1__[\"Chars\"].INVERSE_BULLET,\r\n        desc: 'Surveillance',\r\n        viewDistance: _constants_js__WEBPACK_IMPORTED_MODULE_4__[\"Constants\"].DEFAULT_VIEW_DISTANCE,\r\n        theta: Math.PI,\r\n        minTheta: Math.PI - 0.25 * Math.PI,\r\n        maxTheta: Math.PI + 0.25 * Math.PI,\r\n        deltaTheta: Math.PI / 20.0,\r\n        level: 1 + Math.floor(Math.random() * 3),\r\n        faction: faction,\r\n        color: faction.color,\r\n        state: _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WAITING\r\n    });\r\n}\r\n\n\n//# sourceURL=webpack:///./examples/stacio/procgen.js?");

/***/ }),

/***/ "./examples/stacio/stacio.js":
/*!***********************************!*\
  !*** ./examples/stacio/stacio.js ***!
  \***********************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _src_path_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/path.js */ \"./src/path.js\");\n/* harmony import */ var _src_console_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/console.js */ \"./src/console.js\");\n/* harmony import */ var _src_terminal_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../src/terminal.js */ \"./src/terminal.js\");\n/* harmony import */ var _src_keys_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../src/keys.js */ \"./src/keys.js\");\n/* harmony import */ var _procgen_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./procgen.js */ \"./examples/stacio/procgen.js\");\n/* harmony import */ var _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./gamemodes.js */ \"./examples/stacio/gamemodes.js\");\n/* harmony import */ var _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./entitytypes.js */ \"./examples/stacio/entitytypes.js\");\n/* harmony import */ var _entitystates_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./entitystates.js */ \"./examples/stacio/entitystates.js\");\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./constants.js */ \"./examples/stacio/constants.js\");\n/* harmony import */ var _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./blocktypes.js */ \"./examples/stacio/blocktypes.js\");\n/* harmony import */ var _tiles_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./tiles.js */ \"./examples/stacio/tiles.js\");\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./utils.js */ \"./examples/stacio/utils.js\");\n/* harmony import */ var _src_point_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../src/point.js */ \"./src/point.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst term = new _src_terminal_js__WEBPACK_IMPORTED_MODULE_3__[\"Terminal\"](document.querySelector('canvas'), 80, 45, {frameDelay: 5});\nconst state = Object(_procgen_js__WEBPACK_IMPORTED_MODULE_5__[\"initWorld\"])();\nconst gameArea = new _src_console_js__WEBPACK_IMPORTED_MODULE_2__[\"Console\"](_constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH, _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT);\n\nfunction getEntityAt(x, y) {\n    let cell = state.map.getCell(x, y);\n    return cell ? cell.entity : null;\n}\n\nfunction setGameMode(newGameMode) {\n    state.gameMode = newGameMode;\n    term.fillRect(0, 0, _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].SCREEN_WIDTH, _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].SCREEN_HEIGHT, _utils_js__WEBPACK_IMPORTED_MODULE_12__[\"BRUSH_CLEAR\"]);\n}\n\nfunction handleInput() {\n    switch (state.gameMode) {\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER:\n            handlePlayerModeInput();\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CURSOR:\n            handleCursorModeInput();\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CHARACTER:\n            if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_C)) {\n                setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n            }\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_MAP:\n            if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_M)) {\n                setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n            }\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_DIALOG:\n            if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_ESCAPE)) {\n                setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n            }\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_TRADE:\n            if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_ESCAPE)) {\n                setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n            }\n            break;\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_DEBUG:\n            if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_D)) {\n                setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n            }\n            break;\n    }\n}\n\nfunction handlePlayerModeInput() {\n    if ((term.mouse.dx !== 0 || term.mouse.dy !== 0) && _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.contains(term.mouse)) {\n        state.cursor.x = term.mouse.x - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.x + state.viewport.x;\n        state.cursor.y = term.mouse.y - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.y + state.viewport.y;\n    }\n\n    if (_constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.contains(term.mouse) && term.mouse.buttons[0].isClicked()) {\n        const entity = getEntityAt(state.cursor.x, state.cursor.y);\n        if (entity) {\n            // Select the entity under the cursor\n            state.selectedEntity = entity;\n        } else {\n            // Update player destination\n            state.player.dest = new _src_point_js__WEBPACK_IMPORTED_MODULE_13__[\"Point\"](state.cursor.x, state.cursor.y);\n        }\n\n        // Hide the cursor\n        state.cursor.x = -1;\n        state.cursor.y = -1;\n        return;\n    }\n\n    const dir = Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"getDirectionsKey\"])(term);\n    if (dir) {\n        // Update player destination\n        // state.player.dest.x = state.player.x + dir.dx;\n        // state.player.dest.y = state.player.y + dir.dy;\n        state.player.dest = new _src_point_js__WEBPACK_IMPORTED_MODULE_13__[\"Point\"](state.player.x + dir.dx, state.player.y + dir.dy);\n\n        // Hide the cursor\n        state.cursor.x = -1;\n        state.cursor.y = -1;\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_NUMPAD5) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_SPACE)) {\n        state.player.ap--;\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_ENTER)) {\n        state.cursor.x = state.player.x;\n        state.cursor.y = state.player.y;\n        state.selectedEntity = null;\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CURSOR);\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_1)) {\n        if (state.selectedEntity) {\n            tryAttack(state.player, state.selectedEntity);\n        }\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_5)) {\n        if (state.selectedEntity && state.selectedEntity.pwned) {\n            state.followed = state.selectedEntity;\n        }\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_C)) {\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CHARACTER);\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_D)) {\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_DEBUG);\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_M)) {\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_MAP);\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_TAB)) {\n        handleTab();\n        return;\n    }\n}\n\nfunction handleCursorModeInput() {\n    const dir = Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"getDirectionsKey\"])(term);\n    if (dir) {\n        state.cursor.x += dir.dx;\n        state.cursor.y += dir.dy;\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_NUMPAD5) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_SPACE)) {\n        state.player.ap--;\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_ENTER)) {\n        state.selectedEntity = getEntityAt(state.cursor.x, state.cursor.y);\n        state.cursor.x = -1;\n        state.cursor.y = -1;\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_4__[\"Keys\"].VK_ESCAPE)) {\n        state.cursor.x = -1;\n        state.cursor.y = -1;\n        setGameMode(_gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER);\n        return;\n    }\n}\n\nfunction getEntitiesOnScreen() {\n    // Build list of all state.entities on the screen\n    let entitiesOnScreen = [];\n    for (var i = 1; i < state.entities.length; i++) {\n        let x2 = state.entities[i].x - state.viewport.x;\n        let y2 = state.entities[i].y - state.viewport.y;\n        if (x2 >= 0 && x2 < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH && y2 >= 0 && y2 < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT) {\n            let cell = state.map.getCell(state.entities[i].x, state.entities[i].y);\n            if (cell && cell.visible) {\n                entitiesOnScreen.push(state.entities[i]);\n            }\n        }\n    }\n\n    // Sort the list by distance from the state.player\n    entitiesOnScreen.sort(function (e1, e2) {\n        let d1 = Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(state.player.x, state.player.y, e1.x, e1.y);\n        let d2 = Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(state.player.x, state.player.y, e2.x, e2.y);\n        return d1 - d2;\n    });\n\n    return entitiesOnScreen;\n}\n\nfunction handleTab() {\n    const entitiesOnScreen = getEntitiesOnScreen();\n    let currentIndex = entitiesOnScreen.indexOf(state.selectedEntity);\n    if (currentIndex >= 0) {\n        // If have selected entity, move to next\n        let nextIndex = (currentIndex + 1) % entitiesOnScreen.length;\n        state.selectedEntity = entitiesOnScreen[nextIndex];\n    } else {\n        // Otherwise, select first\n        state.selectedEntity = entitiesOnScreen[0];\n    }\n}\n\nfunction tryAttack(src, dest) {\n    if (!canSee(src, dest.x, dest.y)) {\n        return false;\n    }\n\n    let damage = Math.floor(Math.random() * 20.0);\n    dest.hp = Math.max(0, dest.hp - damage);\n    dest.state = _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_ATTACKING;\n    src.ap--;\n\n    if (src === state.player) {\n        dest.faction.playerReputation = -1;\n    }\n\n    if (dest.hp <= 0) {\n        destroyEntity(dest);\n        state.messages.push({ color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA, text: getAttackMessageName(src) + ' killed ' + getAttackMessageName(dest) });\n        if (dest === state.player) {\n            state.messages.push({ color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_MAGENTA, text: 'GAME OVER' });\n        }\n    } else {\n        state.messages.push({ color: _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY, text: getAttackMessageName(src) + ' attacked ' + getAttackMessageName(dest) + ' ' + damage + ' dmg' })\n    }\n\n    return true;\n}\n\nfunction getAttackMessageName(entity) {\n    return entity === state.player ? 'You' : entity.name;\n}\n\nfunction updateEntity(entity) {\n    if (entity.hp <= 0 || entity.ap <= 0) {\n        return;\n    }\n\n    if (Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(state.player.x, state.player.y, entity.x, entity.y) > 80) {\n        return;\n    }\n\n    entity.seen = true;\n\n    if (entity.entityType === _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_GUARD || entity.entityType === _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_STAFF) {\n        let canSeePlayer = canSee(entity, state.player.x, state.player.y);\n\n        if (entity.entityType === _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_GUARD && canSeePlayer && entity.faction.playerReputation < 0) {\n            entity.state = _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_ATTACKING;\n        }\n\n        if (entity.state === _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_ATTACKING) {\n            if (canSeePlayer) {\n                entity.lastSeen.x = state.player.x;\n                entity.lastSeen.y = state.player.y;\n\n                if (Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(entity.x, entity.y, state.player.x, state.player.y) <= 5) {\n                    entity.dest.x = -1;\n                    entity.dest.y = -1;\n                    tryAttack(entity, state.player);\n                } else {\n                    entity.dest.x = state.player.x;\n                    entity.dest.y = state.player.y;\n                }\n            } else {\n                entity.dest.x = entity.lastSeen.x;\n                entity.dest.y = entity.lastSeen.y;\n            }\n\n        } else if (entity.state === _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WAITING) {\n            entity.waitCount--;\n            if (entity.waitCount <= 0) {\n                entity.state = _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WALKING;\n                entity.dest = entity.waypoints[entity.waypointIndex];\n            }\n\n        } else if (entity.state == _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WALKING) {\n            if (entity.x === entity.dest.x && entity.y === entity.dest.y) {\n                entity.waypointIndex = (entity.waypointIndex + 1) % entity.waypoints.length;\n                entity.state = _entitystates_js__WEBPACK_IMPORTED_MODULE_8__[\"EntityStates\"].STATE_WAITING;\n                if (entity.faction.justice) {\n                    entity.waitCount = 5;\n                } else {\n                    entity.waitCount = 3 + Math.floor(Math.random() * 20);\n                }\n            }\n        }\n    }\n\n    if (entity.entityType === _entitytypes_js__WEBPACK_IMPORTED_MODULE_7__[\"EntityTypes\"].ENTITY_TYPE_CAMERA) {\n        entity.theta += entity.deltaTheta;\n        if (entity.theta < entity.minTheta) {\n            entity.theta = entity.minTheta;\n            entity.deltaTheta = -entity.deltaTheta;\n        }\n        if (entity.theta > entity.maxTheta) {\n            entity.theta = entity.maxTheta;\n            entity.deltaTheta = -entity.deltaTheta;\n        }\n    }\n\n    if (entity.dest.x !== -1 && entity.dest.y !== -1 && (entity.dest.x !== entity.x || entity.dest.y !== entity.y)) {\n        // Entity has a destination and entity is not there yet.\n\n        if (!entity.path ||\n                entity.path.length === 0 ||\n                entity.path[entity.path.length - 1].x !== entity.dest.x ||\n                entity.path[entity.path.length - 1].y !== entity.dest.y) {\n            // Entity has a destination, but no path\n            // Compute the path.\n            // Use max distance because path can be obstructed.\n            // This is especially common when multiple entities are chasing the state.player.\n            entity.path = Object(_src_path_js__WEBPACK_IMPORTED_MODULE_1__[\"computePath\"])(state.map, entity, entity.dest, 200);\n\n            // 0 is current position, 1 is next position.\n            entity.pathIndex = 0;\n        }\n\n        if (entity.path && entity.pathIndex < entity.path.length) {\n            if (entity.pathIndex < 0 || entity.pathIndex >= entity.path.length) {\n                throw new Error('Entity path index out of range');\n            }\n            const currStep = entity.path[entity.pathIndex];\n            if (!currStep) {\n                throw new Error('Missing step in path');\n            }\n            if (entity.x !== currStep.x || entity.y !== currStep.y) {\n                throw new Error('Entity not at current step in path');\n            }\n\n            const nextStep = entity.path[entity.pathIndex + 1];\n            if (nextStep && isEmpty(nextStep.x, nextStep.y)) {\n                const dx = nextStep.x - entity.x;\n                const dy = nextStep.y - entity.y;\n\n                state.map.grid[entity.y][entity.x].entity = null;\n                entity.x = nextStep.x;\n                entity.y = nextStep.y;\n                state.map.grid[entity.y][entity.x].entity = entity;\n                entity.theta = Math.atan2(dy, dx);\n                entity.ap--;\n                entity.pathIndex++;\n\n                if (state.map.grid[entity.y][entity.x].meta.door) {\n                    state.map.grid[entity.y][entity.x].open = true;\n                    state.map.grid[entity.y][entity.x].blocked = false;\n                    state.map.grid[entity.y][entity.x].blockSight = false;\n                }\n            }\n        }\n    }\n}\n\nfunction updateEntities() {\n    updateEntity(state.player);\n\n    if (state.player.ap > 0) {\n        // Waiting on state.player input\n        return;\n    }\n\n    state.gameClock++;\n\n    state.vehicle.x += state.vehicle.dx;\n    if (state.vehicle.x > 500) {\n        state.vehicle.x = 500;\n        state.vehicle.dx = -4;\n    }\n    if (state.vehicle.x < 0) {\n        state.vehicle.x = 0;\n        state.vehicle.dx = 4;\n    }\n\n    state.player.ap = 1;\n\n    for (var i = 1; i < state.entities.length; i++) {\n        updateEntity(state.entities[i]);\n        state.entities[i].ap = 1;\n    }\n}\n\nfunction destroyEntity(entity) {\n    state.entities.splice(state.entities.indexOf(entity), 1);\n    if (entity === state.selectedEntity) {\n        state.selectedEntity = null;\n    }\n    state.map.grid[entity.y][entity.x].entity = null;\n}\n\nfunction isEmpty(x, y) {\n    var cell = state.map.grid[y][x];\n    return !cell.meta.impassable && !cell.entity;\n}\n\nterm.update = function () {\n    term.clear();\n    handleInput();\n    updateEntities();\n    draw();\n};\n\nfunction draw() {\n    switch (state.gameMode) {\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_PLAYER:\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CURSOR:\n            drawNormalMode();\n            break;\n\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CHARACTER:\n            drawCharacterScreen();\n            break;\n\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_MAP:\n            drawMapScreen();\n            break;\n\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_DIALOG:\n            drawDialog();\n            break;\n\n        case _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_TRADE:\n            drawTrade();\n            break;\n    }\n}\n\nfunction updateViewport() {\n    var targetX = state.player.x;\n    var targetY = state.player.y;\n\n    if (state.followed) {\n        targetX = state.followed.x;\n        targetY = state.followed.y;\n    }\n\n    state.viewport.x = targetX - Math.floor(_constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH / 2);\n    state.viewport.y = targetY - Math.floor(_constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT / 2);\n\n    if (state.gameMode === _gamemodes_js__WEBPACK_IMPORTED_MODULE_6__[\"GameModes\"].MODE_CURSOR) {\n        let leftMargin = state.cursor.x - state.viewport.x;\n        if (leftMargin < 10) {\n            state.viewport.x = state.cursor.x - 10;\n        }\n\n        let topMargin = state.cursor.y - state.viewport.y;\n        if (topMargin < 8) {\n            state.viewport.y = state.cursor.y - 8;\n        }\n\n        let rightMargin = (state.viewport.x + _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH) - state.cursor.x;\n        if (rightMargin < 10) {\n            state.viewport.x = state.cursor.x + 10 - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH;\n        }\n\n        let bottomMargin = (state.viewport.y + _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT) - state.cursor.y;\n        if (bottomMargin < 8) {\n            state.viewport.y = state.cursor.y + 8 - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT;\n        }\n    }\n\n    if (state.viewport.x < 0) {\n        state.viewport.x = 0;\n    }\n    if (state.viewport.y < 0) {\n        state.viewport.y = 0;\n    }\n    if (state.viewport.x > _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_WIDTH - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH) {\n        state.viewport.x = _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_WIDTH - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH;\n    }\n    if (state.viewport.y > _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_HEIGHT - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT) {\n        state.viewport.y = _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_HEIGHT - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT;\n    }\n\n    if (_constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.contains(term.mouse)) {\n        state.cursor.x = term.mouse.x - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.x + state.viewport.x;\n        state.cursor.y = term.mouse.y - _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA.y + state.viewport.y;\n    }\n}\n\nfunction calculateVisible() {\n    state.map.computeFov(state.player.x, state.player.y, state.player.viewDistance | 0);\n\n    // for (var i = 0; i < state.pwned.length; i++) {\n    //     calculateVisibleForEntity(state.pwned[i]);\n    // }\n}\n\nfunction updateFogOfWar() {\n    // Move all previously visible to \"seen\"\n    state.map.updateExplored();\n\n    // Calculate state.player line of sight\n    calculateVisible();\n}\n\nfunction drawMap() {\n    for (var y = 0; y < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT; y++) {\n        let y2 = state.viewport.y + y;\n        for (var x = 0; x < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH; x++) {\n            let x2 = state.viewport.x + x;\n            let cell = state.map.getCell(x2, y2);\n            if (!cell) {\n                gameArea.drawCell(x, y, _utils_js__WEBPACK_IMPORTED_MODULE_12__[\"BRUSH_CLEAR\"]);\n            } else if (cell.visible) {\n                gameArea.drawCell(x, y, cell);\n            } else if (cell.explored) {\n                gameArea.drawChar(x, y, cell.charCode, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BLACK);\n            } else {\n                gameArea.drawCell(x, y, _utils_js__WEBPACK_IMPORTED_MODULE_12__[\"BRUSH_CLEAR\"]);\n            }\n        }\n    }\n}\n\nfunction drawNormalMode() {\n    updateViewport();\n    updateFogOfWar();\n    drawMap();\n\n    const entitiesOnScreen = getEntitiesOnScreen();\n\n    // Draw player\n    // TODO: Should getEntitiesOnScreen include the player?\n    gameArea.drawChar(state.player.x - state.viewport.x, state.player.y - state.viewport.y, '@', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n\n    // Draw state.entities\n    for (let i = 0; i < entitiesOnScreen.length; i++) {\n        const e = entitiesOnScreen[i];\n        const cell = state.map.getCell(e.x, e.y);\n        if (cell.visible) {\n            const color = e.pwned ? _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_CYAN : _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE;\n            gameArea.drawChar(e.x - state.viewport.x, e.y - state.viewport.y, e.c, color);\n        }\n\n        const buffer = Math.ceil(e.viewDistance);\n        const minX = Math.max(e.x - buffer, state.viewport.x);\n        const minY = Math.max(e.y - buffer, state.viewport.y);\n        const maxX = Math.min(e.x + buffer, state.viewport.x + _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH - 1);\n        const maxY = Math.min(e.y + buffer, state.viewport.y + _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT - 1);\n        let newBg = _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY;\n        if (e.pwned) {\n            newBg = _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_CYAN;\n        } else if (e.faction.playerReputation < 0) {\n            newBg = _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA;\n        }\n\n        for (let y = minY; y <= maxY; y++) {\n            for (let x = minX; x <= maxX; x++) {\n                const cell = state.map.getCell(x, y);\n                if (!cell || !cell.visible) {\n                    continue;\n                }\n                if (canSee(e, x, y)) {\n                    const x2 = x - state.viewport.x;\n                    const y2 = y - state.viewport.y;\n                    const gameAreaCell = gameArea.getCell(x2, y2);\n                    const currBg = gameAreaCell.bg;\n\n                    if (newBg === _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA) {\n                        if (currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA) {\n                            gameAreaCell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA);\n                        }\n\n                    } else if (newBg === _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_CYAN) {\n                        if (currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA && currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_CYAN) {\n                            gameAreaCell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_CYAN);\n                        }\n\n                    } else if (newBg === _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY) {\n                        if (currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA && currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_CYAN && currBg !== _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY) {\n                            gameAreaCell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GRAY);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Highlight the selected unit\n    if (state.selectedEntity &&\n            state.selectedEntity !== state.player &&\n            state.map.getCell(state.selectedEntity.x, state.selectedEntity.y).visible) {\n\n        const x2 = state.selectedEntity.x - state.viewport.x;\n        const y2 = state.selectedEntity.y - state.viewport.y;\n        const cell = gameArea.getCell(x2, y2);\n        if (cell) {\n            cell.setForeground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BLACK);\n            cell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n        }\n    }\n\n    // Draw the state.cursor highlight\n    let cx2 = state.cursor.x - state.viewport.x;\n    let cy2 = state.cursor.y - state.viewport.y;\n    let cursorVisible = cx2 >= 0 && cx2 < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH && cy2 >= 0 && cy2 < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT;\n    if (cursorVisible) {\n        let cursorCell = gameArea.getCell(state.cursor.x - state.viewport.x, state.cursor.y - state.viewport.y);\n        if (cursorCell) {\n            cursorCell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n        }\n\n        const entity = getEntityAt(state.cursor.x, state.cursor.y);\n        if (!entity) {\n            const path = Object(_src_path_js__WEBPACK_IMPORTED_MODULE_1__[\"computePath\"])(state.map, state.player, state.cursor, 100);\n            if (path) {\n                for (let i = 1; i < path.length; i++) {\n                    const step = path[i];\n                    const cell = gameArea.getCell(step.x - state.viewport.x, step.y - state.viewport.y);\n                    if (cell) {\n                        cell.setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n                    }\n                }\n            }\n        }\n    }\n\n    // Draw the game area on the term\n    term.drawConsole(\n        _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_X,\n        _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_Y,\n        gameArea,\n        0,\n        0,\n        _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_WIDTH,\n        _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].GAME_AREA_HEIGHT);\n\n    // // Draw top/bottom UI\n    // term.fillRect(0, 0, Constants.LEFT_CONSOLE_WIDTH, Constants.SCREEN_HEIGHT, BRUSH_CLEAR);\n\n    // // Draw player stats summary\n    // term.drawString(0, 0, '@: You, Level 12', Colors.WHITE, Colors.BLACK);\n    // term.drawHLine(0, 1, 20, ' ', Colors.LIGHT_CYAN, Colors.BLACK);\n    // term.drawHLine(0, 1, Math.round(state.player.hp / 100.0 * 18.0), ' ', Colors.LIGHT_CYAN, Colors.DARK_CYAN);\n    // term.drawString(1, 1, 'Health (' + state.player.hp + ')', Colors.LIGHT_CYAN, null);\n\n    // {\n    //     let y = 4;\n    //     for (let i = 0; i < entitiesOnScreen.length; i++) {\n    //         const entity = entitiesOnScreen[i];\n    //         let color = Colors.WHITE;\n    //         if (entity.pwned) {\n    //             color = entity === state.selectedEntity ? Colors.LIGHT_CYAN : Colors.DARK_CYAN;\n    //         } else {\n    //             color = entity === state.selectedEntity ? Colors.WHITE : Colors.LIGHT_GRAY;\n    //         }\n    //         term.drawHLine(0, y, 20, ' ', color);\n    //         term.drawChar(0, y, entity.c, color);\n    //         term.drawString(1, y, ': ' + entity.name, color);\n    //         term.drawHLine(0, y + 1, 20, ' ', Colors.LIGHT_CYAN, Colors.BLACK);\n    //         term.drawHLine(0, y + 1, Math.round(entity.hp / 100.0 * 18.0), ' ', Colors.LIGHT_CYAN, Colors.DARK_CYAN);\n    //         term.drawString(3, y + 1, 'Health (' + entity.hp + ')', Colors.LIGHT_CYAN, null);\n    //         switch (entity.state) {\n    //             case EntityStates.STATE_WALKING:\n    //                 term.drawString(3, y + 2, 'Walking', Colors.DARK_GRAY, null);\n    //                 break;\n    //             case EntityStates.STATE_WAITING:\n    //                 term.drawString(3, y + 2, 'Waiting', Colors.DARK_GRAY, null);\n    //                 break;\n    //             case EntityStates.STATE_ATTACKING:\n    //                 term.drawString(3, y + 2, 'Attacking', Colors.DARK_MAGENTA, null);\n    //                 break;\n    //         }\n    //         y += 5;\n    //     }\n    // }\n\n    // // Draw top message history\n    // {\n    //     for (let i = Math.max(0, state.messages.length - 3), y = 0; i < state.messages.length; i++ , y++) {\n    //         term.drawString(Constants.LEFT_CONSOLE_WIDTH, y, state.messages[i].text, state.messages[i].color);\n    //     }\n    // }\n\n    // // Draw current tile summary\n    // if (cursorVisible) {\n    //     let hoverEntity = getEntityAt(state.cursor.x, state.cursor.y);\n    //     let hoverCell = state.map.getCell(state.cursor.x, state.cursor.y);\n    //     var hoverMessage = null;\n    //     if (hoverEntity === state.player) {\n    //         hoverMessage = 'This is you';\n    //     } else if (hoverEntity) {\n    //         hoverMessage = 'You see ' + hoverEntity.name + ' (' + hoverEntity.desc + ')';\n    //     } else if (hoverCell && hoverCell.meta && hoverCell.meta.desc) {\n    //         hoverMessage = 'You see ' + hoverCell.meta.desc;\n    //     }\n    //     term.drawString(Constants.LEFT_CONSOLE_WIDTH, Constants.SCREEN_HEIGHT - 2, hoverMessage, Colors.MAGENTA);\n    // }\n\n    // // Draw bottom menu\n    // term.drawString(\n    //     Constants.LEFT_CONSOLE_WIDTH,\n    //     Constants.SCREEN_HEIGHT - 1,\n    //     //'Explore    Rest    Search    Menu',\n    //     //  0123456789012345678901234567890123456789\n    //     'Character     Inventory     Map     Menu',\n    //     Colors.LIGHT_GRAY,\n    //     null);\n}\n\nfunction drawCharacterScreen() {\n    term.drawString(2, 1, 'Player', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN);\n\n    term.drawString(2, 4, 'ATTRIBUTES', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GRAY);\n    term.drawString(3, 6, 'Strength     4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(3, 7, 'Speed        4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(3, 8, 'Intelligence 4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(3, 9, 'Charisma     4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n\n    term.drawString(21, 4, 'SKILLS', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GRAY);\n    term.drawString(22, 6, 'Strength     4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(22, 7, 'Speed        4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(22, 8, 'Intelligence 4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    term.drawString(22, 9, 'Charisma     4', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n\n    term.drawString(40, 4, 'REPUTATION', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GRAY);\n    for (var i = 1; i < state.factions.length; i++) {\n        term.drawString(41, 5 + i, state.factions[i].name, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n        term.drawString(56, 5 + i, state.factions[i].playerReputation.toString().padStart(2), _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].GREEN);\n    }\n}\n\nfunction drawMapScreen() {\n    term.drawString(2, 1, 'Map', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN);\n\n    let offsetX = 5;\n    let offsetY = 3;\n\n    for (var y = 0; y < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_HEIGHT_BLOCKS; y++) {\n        for (var x = 0; x < _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_WIDTH_BLOCKS; x++) {\n            for (var y2 = 0; y2 < 5; y2++) {\n                for (var x2 = 0; x2 < 5; x2++) {\n                    var tile = null;\n                    switch (state.worldMap[y][x].blockType) {\n                        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__[\"BlockTypes\"].BLOCK_TYPE_NORMAL_BLOCK:\n                            if ((x2 === 1 || x2 === 3) && (y2 === 1 || y2 === 3)) {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_INTERIOR;\n                            } else {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_STREET;\n                            }\n                            break;\n                        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__[\"BlockTypes\"].BLOCK_TYPE_MEGA_BUILDING:\n                            if (x2 >= 1 && x2 <= 3 && y2 >= 1 && y2 <= 3) {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_INTERIOR;\n                            } else {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_STREET;\n                            }\n                            break;\n                        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__[\"BlockTypes\"].BLOCK_TYPE_PARK:\n                            tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_GRASS;\n                            break;\n                        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__[\"BlockTypes\"].BLOCK_TYPE_PRISON:\n                            if (x2 === 0 || x2 === 4 || y2 === 0 || y2 === 4) {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_SIDEWALK;\n                            } else {\n                                tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_STREET;\n                            }\n                            break;\n                        case _blocktypes_js__WEBPACK_IMPORTED_MODULE_10__[\"BlockTypes\"].BLOCK_TYPE_TRASH:\n                            tile = _tiles_js__WEBPACK_IMPORTED_MODULE_11__[\"Tiles\"].TILE_TRASH_FLOOR;\n                            break;\n                    }\n                    term.drawCell(offsetX + x * 5 + x2, offsetY + y * 5 + y2, tile);\n                }\n            }\n        }\n    }\n\n    // 100->5 => divide by 20\n    let playerMiniX = Math.floor(state.player.x / 20);\n    let playerMiniY = Math.floor(state.player.y / 20);\n    term.drawChar(offsetX + playerMiniX, offsetY + playerMiniY, state.player.c, state.player.color);\n}\n\n/**\n * Calculates a line using Bresenham's algorithm.\n *\n * See: https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm\n *\n * @param {!number} x0 The starting x-coord.\n * @param {!number} y0 The starting y-coord.\n * @param {!number} x1 The goal x-coord.\n * @param {!number} y1 The goal y-coord.\n * @param {!number=} opt_maxDist Optional maximum distance.\n * @param {!Function=} opt_callback Optional callback function at each step.\n * @return {!boolean} True on successfully reaching the goal position.\n */\nfunction drawLine(x0, y0, x1, y1, opt_maxDist, opt_callback) {\n    var x = x0;\n    var y = y0;\n    var dx = Math.abs(x1 - x0);\n    var dy = Math.abs(y1 - y0);\n    var sx = (x0 < x1) ? 1 : -1;\n    var sy = (y0 < y1) ? 1 : -1;\n    var err = dx - dy;\n\n    while (true) {\n        if (opt_maxDist !== undefined && Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(x0, y0, x, y) > opt_maxDist) {\n            return false;\n        }\n\n        if (opt_callback) {\n            opt_callback.call(null, x, y);\n        }\n\n        if (x === x1 && y === y1) {\n            // Found destination\n            return true;\n        }\n\n        if (x !== x0 || y !== y0) {\n            // You can *see* the wall\n            // You cannot see *past* the wall\n            if (state.map.grid[y][x].blockSight) {\n                return false;\n            }\n        }\n\n        var e2 = 2 * err;\n        if (e2 > -dy) {\n            err -= dy;\n            x += sx;\n        }\n        if (e2 < dx) {\n            err += dx;\n            y += sy;\n        }\n    }\n}\n\nfunction canSee(unit, x, y) {\n    if (unit.hp <= 0) {\n        return false;\n    }\n\n    if (x < 0 || y < 0 || x >= _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_WIDTH || y >= _constants_js__WEBPACK_IMPORTED_MODULE_9__[\"Constants\"].MAP_HEIGHT) {\n        return false;\n    }\n\n    if (Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"dist\"])(unit.x, unit.y, x, y) > unit.viewDistance) {\n        return false;\n    }\n\n    if (unit.x === x && unit.y === y) {\n        return true;\n    }\n\n    //        -PI/2\n    //          -y\n    //           |\n    // PI  -x  --+--  +x  0\n    //           |\n    //          +y\n    //        +PI/2\n    if (unit !== state.player && unit.theta !== undefined) {\n        var theta = Math.atan2(y - unit.y, x - unit.x);\n        var thetaDist = Math.abs(Object(_utils_js__WEBPACK_IMPORTED_MODULE_12__[\"angleDist\"])(theta, unit.theta));\n        if (thetaDist > 0.25 * Math.PI) {\n            return false;\n        }\n    }\n\n    return drawLine(unit.x, unit.y, x, y, unit.viewDistance) || drawLine(x, y, unit.x, unit.y, unit.viewDistance);\n}\n\n\n//# sourceURL=webpack:///./examples/stacio/stacio.js?");

/***/ }),

/***/ "./examples/stacio/tiles.js":
/*!**********************************!*\
  !*** ./examples/stacio/tiles.js ***!
  \**********************************/
/*! exports provided: Tiles */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Tiles\", function() { return Tiles; });\n/* harmony import */ var _src_cell_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/cell.js */ \"./src/cell.js\");\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _src_chars_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/chars.js */ \"./src/chars.js\");\n\r\n\r\n\r\n\r\nconst Tiles = {\r\n    TILE_WALL: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a wall', boxChar: true, impassable: true, opaque: true }),\r\n    TILE_FENCE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a fence', boxChar: true, impassable: true, opaque: false }),\r\n    TILE_SIDEWALK: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].DARK_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'the sidewalk' }),\r\n    TILE_STREET: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].LIGHT_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a dirty street' }),\r\n    TILE_POTHOLE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].MEDIUM_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'an ugly pothole' }),\r\n    TILE_MANHOLE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('O', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a manhole to the sewer' }),\r\n    TILE_INTERIOR: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].LIGHT_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'the building interior' }),\r\n    TILE_YELLOW_CHECKER: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].CHECKER, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'hazard warnings' }),\r\n    TILE_DOOR: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('+', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a door', door: true }),\r\n    TILE_ATM: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('$', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'an ATM' }),\r\n    TILE_STREET_WHITE_HLINE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('-', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a painted white line' }),\r\n    TILE_STREET_WHITE_VLINE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('|', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a painted white line' }),\r\n    TILE_STREET_YELLOW_HLINE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('-', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a painted yellow line' }),\r\n    TILE_STREET_YELLOW_VLINE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('|', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a painted yellow line' }),\r\n    TILE_TRASH_BIN: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('O', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a trash bin', impassable: true }),\r\n    TILE_TREE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('#', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a tree', impassable: true, opaque: true }),\r\n    TILE_GRASS: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].LIGHT_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'open grass' }),\r\n    TILE_WEEDS: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].MEDIUM_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'weedy grass' }),\r\n    TILE_TRASH_WALL: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('#', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a trash heap', impassable: true, opaque: true }),\r\n    TILE_TRASH_FLOOR: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].LIGHT_SHADE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'trash littered ground' }),\r\n\r\n    TILE_HACK_VOID: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](' ', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'void space', impassable: true, opaque: true }),\r\n    TILE_HACK_PATH: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](_src_chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_CYAN, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'conduit', boxChar: true }),\r\n    TILE_HACK_ENTRANCE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('*', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_CYAN, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'the hack access point' }),\r\n    TILE_HACK_EXIT: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('*', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GREEN, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'the hack exit', hackExit: true }),\r\n    TILE_HACK_NODE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('*', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_RED, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a hack node', hackNode: true }),\r\n    TILE_HACK_STORE: new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"]('?', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].LIGHT_GRAY, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK, { desc: 'a data store' }),\r\n};\r\n\n\n//# sourceURL=webpack:///./examples/stacio/tiles.js?");

/***/ }),

/***/ "./examples/stacio/utils.js":
/*!**********************************!*\
  !*** ./examples/stacio/utils.js ***!
  \**********************************/
/*! exports provided: BRUSH_CLEAR, dist, angleDist, normalizeAngle, getDirectionsKey */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BRUSH_CLEAR\", function() { return BRUSH_CLEAR; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"dist\", function() { return dist; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"angleDist\", function() { return angleDist; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"normalizeAngle\", function() { return normalizeAngle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDirectionsKey\", function() { return getDirectionsKey; });\n/* harmony import */ var _src_cell_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/cell.js */ \"./src/cell.js\");\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _src_keys_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/keys.js */ \"./src/keys.js\");\n\r\n\r\n\r\n\r\n\r\nconst BRUSH_CLEAR = new _src_cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"](' ', _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].WHITE, _src_colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK);\r\n\r\nconst DIRECTION_NORTHWEST = {dx: -1, dy: -1};\r\nconst DIRECTION_NORTH = {dx: 0, dy: -1};\r\nconst DIRECTION_NORTHEAST = {dx: 1, dy: -1};\r\nconst DIRECTION_WEST = {dx: -1, dy: 0};\r\nconst DIRECTION_EAST = {dx: 1, dy: 0};\r\nconst DIRECTION_SOUTHWEST = {dx: -1, dy: 1};\r\nconst DIRECTION_SOUTH = {dx: 0, dy: 1};\r\nconst DIRECTION_SOUTHEAST = {dx: 1, dy: 1};\r\n\r\nfunction dist(x1, y1, x2, y2) {\r\n    return Math.hypot(x1 - x2, y1 - y2);\r\n}\r\n\r\nfunction angleDist(theta1, theta2) {\r\n    return normalizeAngle(theta1 - theta2);\r\n}\r\n\r\nfunction normalizeAngle(theta) {\r\n    while (theta > Math.PI) {\r\n        theta -= Math.PI * 2.0;\r\n    }\r\n    while (theta < -Math.PI) {\r\n        theta += Math.PI * 2.0;\r\n    }\r\n    return theta;\r\n}\r\n\r\nfunction getDirectionsKey(term) {\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD1)) {\r\n        return DIRECTION_SOUTHWEST;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD2) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_DOWN)) {\r\n        return DIRECTION_SOUTH;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD3)) {\r\n        return DIRECTION_SOUTHEAST;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD4) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_LEFT)) {\r\n        return DIRECTION_WEST;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD6) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_RIGHT)) {\r\n        return DIRECTION_EAST;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD7)) {\r\n        return DIRECTION_NORTHWEST;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD8) || term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_UP)) {\r\n        return DIRECTION_NORTH;\r\n    }\r\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keys\"].VK_NUMPAD9)) {\r\n        return DIRECTION_NORTHEAST;\r\n    }\r\n    return null;\r\n}\r\n\n\n//# sourceURL=webpack:///./examples/stacio/utils.js?");

/***/ }),

/***/ "./src/blendmode.js":
/*!**************************!*\
  !*** ./src/blendmode.js ***!
  \**************************/
/*! exports provided: BlendMode */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BlendMode\", function() { return BlendMode; });\n\n/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nconst BlendMode = {\n\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None: 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend: 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add: 2\n};\n\n\n//# sourceURL=webpack:///./src/blendmode.js?");

/***/ }),

/***/ "./src/boxutils.js":
/*!*************************!*\
  !*** ./src/boxutils.js ***!
  \*************************/
/*! exports provided: fixBoxCells */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fixBoxCells\", function() { return fixBoxCells; });\n\n/**\n * Details about box characters.\n * The first element is the array of details for the first box char (0xB3).\n * Each sub array is the count of stems for top, right, bottom, and left.\n */\nconst BOX_CHAR_DETAILS = [\n  [1, 0, 1, 0], // 0xB3\n  [1, 0, 1, 1], // 0xB4\n  [1, 0, 1, 2], // 0xB5\n  [2, 0, 2, 1], // 0xB6\n  [0, 0, 2, 1], // 0xB7\n  [0, 0, 1, 2], // 0xB8\n  [2, 0, 2, 2], // 0xB9\n  [2, 0, 2, 0], // 0xBA\n  [0, 0, 2, 2], // 0xBB\n  [2, 0, 0, 2], // 0xBC\n  [2, 0, 0, 1], // 0xBD\n  [1, 0, 0, 2], // 0xBE\n  [0, 0, 1, 1], // 0xBF\n  [1, 1, 0, 0], // 0xC0\n  [1, 1, 0, 1], // 0xC1\n  [0, 1, 1, 1], // 0xC2\n  [1, 1, 1, 0], // 0xC3\n  [0, 1, 0, 1], // 0xC4\n  [1, 1, 1, 1], // 0xC5\n  [1, 2, 1, 0], // 0xC6\n  [2, 1, 2, 0], // 0xC7\n  [2, 2, 0, 0], // 0xC8\n  [0, 2, 2, 0], // 0xC9\n  [2, 2, 0, 2], // 0xCA\n  [0, 2, 2, 2], // 0xCB\n  [2, 2, 2, 0], // 0xCC\n  [0, 2, 0, 2], // 0xCD\n  [2, 2, 2, 2], // 0xCE\n  [1, 2, 0, 2], // 0xCF\n  [2, 1, 0, 1], // 0xD0\n  [0, 2, 1, 2], // 0xD1\n  [0, 1, 2, 1], // 0xD2\n  [2, 1, 0, 0], // 0xD3\n  [1, 2, 0, 0], // 0xD4\n  [0, 2, 1, 0], // 0xD5\n  [0, 1, 2, 0], // 0xD6\n  [2, 1, 2, 1], // 0xD7\n  [1, 2, 1, 2], // 0xD8\n  [1, 0, 0, 1], // 0xD9\n  [0, 1, 1, 0], // 0xDA\n];\n\nfunction isBoxCell(con, x, y) {\n  const charCode = con.getCell(x, y).charCode;\n  return charCode >= 0xB3 && charCode <= 0xDA;\n}\n\nfunction getBoxCount(con, x, y, index) {\n  if (x < 0 || y < 0 || x >= con.width || y >= con.height) {\n    return 0;\n  }\n  const charCode = con.getCell(x, y).charCode;\n  if (charCode < 0xB3 || charCode > 0xDA) {\n    return 0;\n  }\n  return BOX_CHAR_DETAILS[charCode - 0xB3][index];\n}\n\nfunction getBoxCell(up, right, down, left) {\n  for (let i = 0; i < BOX_CHAR_DETAILS.length; i++) {\n    const row = BOX_CHAR_DETAILS[i];\n    if (row[0] === up && row[1] === right && row[2] === down && row[3] === left) {\n      return 0xB3 + i;\n    }\n  }\n  return 0;\n}\n\nfunction fixBoxCells(con) {\n  for (let y = 0; y < con.height; y++) {\n    for (let x = 0; x < con.width; x++) {\n      if (isBoxCell(con, x, y)) {\n        let up = getBoxCount(con, x, y - 1, 2);\n        let right = getBoxCount(con, x + 1, y, 3);\n        let down = getBoxCount(con, x, y + 1, 0);\n        let left = getBoxCount(con, x - 1, y, 1);\n\n        // There are no single-direction stubs.\n        // If we need one, then we create a full vertical or horizontal pipe.\n        if (up > 0 && right === 0 && down === 0 && left === 0) {\n          down = up;\n        } else if (up === 0 && right > 0 && down === 0 && left === 0) {\n          left = right;\n        } else if (up === 0 && right === 0 && down > 0 && left === 0) {\n          up = down;\n        } else if (up === 0 && right === 0 && down === 0 && left > 0) {\n          right = left;\n        }\n\n        // Vertical and horizontal axis must have same width.\n        if (left > 0 && right > 0) {\n          left = right = Math.max(left, right);\n        }\n        if (up > 0 && down > 0) {\n          up = down = Math.max(up, down);\n        }\n\n        const charCode = getBoxCell(up, right, down, left);\n\n        if ((up || right || down || left) && !(charCode >= 0xB3 && charCode <= 0xDA)) {\n          throw new Error('invalid char code! (up=' + up + ', right=' + right + ', down=' + down + ', left=' + left + ')');\n        }\n\n        con.getCell(x, y).setCharCode(charCode);\n      }\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/boxutils.js?");

/***/ }),

/***/ "./src/cell.js":
/*!*********************!*\
  !*** ./src/cell.js ***!
  \*********************/
/*! exports provided: Cell */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Cell\", function() { return Cell; });\n/* harmony import */ var _blendmode_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./blendmode.js */ \"./src/blendmode.js\");\n/* harmony import */ var _colors_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./colors.js */ \"./src/colors.js\");\n/* harmony import */ var _color_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./color.js */ \"./src/color.js\");\n\n\n\n\n\nfunction convertCharCode(charCode) {\n  if ((typeof charCode === 'string') && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode;\n  }\n}\n\nclass Cell {\n\n  constructor(charCode, fg, bg, meta) {\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode);\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = _colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = _colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK;\n    }\n\n    if (meta !== undefined) {\n      this.meta = meta;\n    }\n\n    this.dirty = true;\n  }\n\n  setCharCode(charCode) {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg) {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg) {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setMeta(meta) {\n    if (meta !== undefined) {\n      this.meta = meta;\n      this.dirty = true;\n    }\n  }\n\n  setValue(\n      charCode, fg, bg, meta) {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n      this.setForeground(fg);\n      this.setBackground(bg);\n      this.setMeta(meta);\n    } else {\n      this.drawCell(charCode, _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell, blendMode) {\n    const alpha = otherCell.bg & 0xFF;\n\n    if (blendMode === _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n\n    this.setMeta(otherCell.meta);\n  }\n\n  blendColors(c1, c2, blendMode) {\n    const alpha = c2 & 0xFF;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xFF;\n    const g1 = (c1 >> 16) & 0xFF;\n    const b1 = (c1 >> 8) & 0xFF;\n    const r2 = (c2 >> 24) & 0xFF;\n    const g2 = (c2 >> 16) & 0xFF;\n    const b2 = (c2 >> 8) & 0xFF;\n\n    switch (blendMode) {\n      case _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].Blend:\n        return Object(_color_js__WEBPACK_IMPORTED_MODULE_2__[\"fromRgb\"])(\n            (w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0,\n            (w1 * b1 + w2 * b2) | 0);\n\n      case _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].Add:\n        return Object(_color_js__WEBPACK_IMPORTED_MODULE_2__[\"fromRgb\"])(\n            this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0),\n            this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  clamp(x) {\n    return Math.min(255, x);\n  }\n}\n\n\n//# sourceURL=webpack:///./src/cell.js?");

/***/ }),

/***/ "./src/chars.js":
/*!**********************!*\
  !*** ./src/chars.js ***!
  \**********************/
/*! exports provided: Chars */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Chars\", function() { return Chars; });\n\n\n// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nconst Chars = {\n  SMILEY: 1,\n  INVERSE_SMILEY: 2,\n  HEART: 3,\n  DIAMOND: 4,\n  CLUB: 5,\n  SPADE: 6,\n  BULLET: 7,\n  INVERSE_BULLET: 8,\n\n  LIGHT_SHADE: 176,\n  MEDIUM_SHADE: 177,\n  DARK_SHADE: 178,\n\n  BOX_SINGLE_VERTICAL: 179,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT: 180,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT: 185,\n  BOX_DOUBLE_VERTICAL: 186,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT: 187,\n  BOX_DOUBLE_UP_AND_DOUBLE_LEFT: 188,\n  BOX_SINGLE_DOWN_AND_SINGLE_LEFT: 191,\n  BOX_SINGLE_UP_AND_SINGLE_RIGHT: 192,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP: 193,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN: 194,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT: 195,\n  BOX_SINGLE_HORIZONTAL: 196,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL: 197,\n  BOX_DOUBLE_UP_AND_DOUBLE_RIGHT: 200,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT: 201,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP: 202,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN: 203,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT: 204,\n  BOX_DOUBLE_HORIZONTAL: 205,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL: 206,\n  BOX_SINGLE_UP_AND_SINGLE_LEFT: 13 * 16 + 9,\n  BOX_SINGLE_DOWN_AND_SINGLE_RIGHT: 13 * 16 + 10,\n\n  BLOCK_BOTTOM_HALF: 13 * 16 + 12,\n  BLOCK_LEFT_HALF: 13 * 16 + 13,\n  BLOCK_RIGHT_HALF: 13 * 16 + 14,\n  BLOCK_TOP_HALF: 13 * 16 + 15,\n}\n\n\n//# sourceURL=webpack:///./src/chars.js?");

/***/ }),

/***/ "./src/color.js":
/*!**********************!*\
  !*** ./src/color.js ***!
  \**********************/
/*! exports provided: fromRgb, fromHsv */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fromRgb\", function() { return fromRgb; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fromHsv\", function() { return fromHsv; });\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nfunction fromRgb(r, g, b, a) {\n  if (a === undefined) {\n    a = 255;\n  }\n  return ((r << 24) + (g << 16) + (b << 8) + a);\n}\n\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nfunction fromHsv(h, s, v, a) {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      r = v, g = t, b = p;\n      break;\n    case 1:\n      r = q, g = v, b = p;\n      break;\n    case 2:\n      r = p, g = v, b = t;\n      break;\n    case 3:\n      r = p, g = q, b = v;\n      break;\n    case 4:\n      r = t, g = p, b = v;\n      break;\n    case 5:\n      r = v, g = p, b = q;\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n\n\n//# sourceURL=webpack:///./src/color.js?");

/***/ }),

/***/ "./src/colors.js":
/*!***********************!*\
  !*** ./src/colors.js ***!
  \***********************/
/*! exports provided: Colors */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Colors\", function() { return Colors; });\n/* harmony import */ var _color_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./color.js */ \"./src/color.js\");\n\n\n\nconst Colors = {\n  BLACK: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0, 0, 0),\n  WHITE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0xff, 0xff),\n  LIGHT_GRAY: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0xaa, 0xaa),\n  DARK_GRAY: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0x55, 0x55),\n  YELLOW: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0xff, 0x55),\n  BROWN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x55, 0x00),\n  LIGHT_RED: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x55, 0x55),\n  DARK_RED: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x00, 0x00),\n  LIGHT_GREEN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0xff, 0x55),\n  DARK_GREEN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0xaa, 0x00),\n  LIGHT_CYAN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0xff, 0xff),\n  DARK_CYAN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0xaa, 0xaa),\n  LIGHT_BLUE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0x55, 0xff),\n  DARK_BLUE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0x00, 0xaa),\n  LIGHT_MAGENTA: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x55, 0xff),\n  DARK_MAGENTA: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x00, 0xaa),\n  ORANGE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x88, 0x00),\n};\n\n\n//# sourceURL=webpack:///./src/colors.js?");

/***/ }),

/***/ "./src/console.js":
/*!************************!*\
  !*** ./src/console.js ***!
  \************************/
/*! exports provided: Console */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Console\", function() { return Console; });\n/* harmony import */ var _blendmode_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./blendmode.js */ \"./src/blendmode.js\");\n/* harmony import */ var _cell_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cell.js */ \"./src/cell.js\");\n/* harmony import */ var _chars_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chars.js */ \"./src/chars.js\");\n\n\n\n\n\nclass Console {\n\n  constructor(width, height, opt_cellClass) {\n    this.width = width;\n    this.height = height;\n    this.grid = new Array();\n\n    const cellClass = opt_cellClass || _cell_js__WEBPACK_IMPORTED_MODULE_1__[\"Cell\"];\n\n    for (let y = 0; y < height; y++) {\n      const row = new Array();\n      for (let x = 0; x < width; x++) {\n        row.push(new cellClass(x, y));\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n  }\n\n  clear() {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x, y) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  getCharCode(x, y) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x].charCode;\n  }\n\n  drawChar(x, y, c, fg, bg) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x, y, str, fg, bg) {\n    const lines = str.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      for (let j = 0; j < line.length; j++) {\n        this.drawChar(x + j, y + i, line.charCodeAt(j), fg, bg);\n      }\n    }\n  }\n\n  drawCenteredString(x, y, str, fg, bg) {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawHLine(x, y, width, c, fg, bg) {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(x, y, height, c, fg, bg) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(x, y, width, height, c, fg, bg) {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n      x, y, width, height, topChar,\n      rightChar, bottomChar, leftChar,\n      topLeftChar, topRightChar, bottomRightChar,\n      bottomLeftChar, fg, bg) {\n    this.fillRect(x, y, width, height, 0, fg, bg);\n\n    this.drawHLine(x, y, width, topChar);\n    this.drawHLine(x, y + height - 1, width, bottomChar);\n\n    this.drawVLine(x, y, height, leftChar);\n    this.drawVLine(x + width - 1, y, height, rightChar);\n\n    this.drawChar(x, y, topLeftChar);\n    this.drawChar(x + width - 1, y, topRightChar);\n    this.drawChar(x, y + height - 1, bottomLeftChar);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar);\n  }\n\n  drawSingleBox(x, y, width, height, fg, bg) {\n    this.drawBox(\n        x, y, width, height, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_UP_AND_SINGLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_UP_AND_SINGLE_RIGHT, fg, bg);\n  }\n\n  drawDoubleBox(x, y, width, height, fg, bg) {\n    this.drawBox(\n        x, y, width, height, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_UP_AND_DOUBLE_RIGHT, fg, bg);\n  }\n\n  fillRect(x, y, width, height, c, fg, bg) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n      dstX, dstY, srcConsole, srcX,\n      srcY, srcWidth, srcHeight,\n      blendMode) {\n    blendMode = blendMode || _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  drawCell(x, y, cell, blendMode) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/console.js?");

/***/ }),

/***/ "./src/font.js":
/*!*********************!*\
  !*** ./src/font.js ***!
  \*********************/
/*! exports provided: Font, DEFAULT_FONT */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Font\", function() { return Font; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DEFAULT_FONT\", function() { return DEFAULT_FONT; });\n\nclass Font {\n\n  constructor(\n      url, charWidth, charHeight, scale,\n      graphical) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n    this.graphical = !!graphical;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQ' +\n    'MAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8' +\n    'QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY' +\n    '09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1' +\n    'zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eIC' +\n    'JsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBq' +\n    'ucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqh' +\n    'JRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvh' +\n    'A1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL' +\n    '0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu' +\n    '2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIz' +\n    'CAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsW' +\n    'IE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBW' +\n    'l5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h' +\n    '5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtL' +\n    'ji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb' +\n    '2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O' +\n    '3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2f' +\n    'otTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZ' +\n    'UghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2G' +\n    'AzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc' +\n    '4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJ' +\n    'G199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJI' +\n    'lipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC';\n\nconst DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n\n\n//# sourceURL=webpack:///./src/font.js?");

/***/ }),

/***/ "./src/input.js":
/*!**********************!*\
  !*** ./src/input.js ***!
  \**********************/
/*! exports provided: Input */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Input\", function() { return Input; });\n\n/**\n * The delay in frames before input repeating.\n * Assume 60 FPS.\n */\nconst INPUT_REPEAT_DELAY = 6;\n\n/**\n * The delay between subsequent repeat firing.\n * Assume 60 FPS.\n */\nconst INPUT_REPEAT_RATE = 1;\n\n/**\n * The Input class represents a pysical input.\n * Example: keyboard key or mouse button.\n */\nclass Input {\n    constructor() {\n        this.down = false;\n        this.downCount = 0;\n        this.upCount = 0;\n    }\n\n    update() {\n        if (this.down) {\n            this.downCount++;\n            this.upCount = 0;\n        } else {\n            this.downCount = 0;\n            this.upCount++;\n        }\n    }\n\n    /**\n     * Returns true if the input is \"pressed\".\n     * Pressed is a one time event when the input first goes down.\n     * It then repeats on repeat delay.\n     */\n    isPressed() {\n        const count = this.downCount;\n        return count === 1 || (count > INPUT_REPEAT_DELAY && count % INPUT_REPEAT_RATE === 0);\n    }\n\n    /**\n     * Returns true if the input is \"clicked\".\n     * Clicked is a one time event when the input first goes up.\n     */\n    isClicked() {\n        return this.upCount === 1;\n    }\n}\n\n\n//# sourceURL=webpack:///./src/input.js?");

/***/ }),

/***/ "./src/keys.js":
/*!*********************!*\
  !*** ./src/keys.js ***!
  \*********************/
/*! exports provided: Keyboard, Keys */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Keyboard\", function() { return Keyboard; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Keys\", function() { return Keys; });\n/* harmony import */ var _input_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./input.js */ \"./src/input.js\");\n\n\n/**\n * Number of keys to track.\n */\nconst KEY_COUNT = 256;\n\nclass Keyboard {\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el) {\n    this.keys = new Array(KEY_COUNT);\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i] = new _input_js__WEBPACK_IMPORTED_MODULE_0__[\"Input\"]();\n    }\n\n    el.addEventListener('keydown', e => this.setKey(e, true));\n    el.addEventListener('keyup', e => this.setKey(e, false));\n  }\n\n\n  setKey(e, state) {\n    const keyCode = e.keyCode;\n    if (keyCode === Keys.VK_F11) {\n      // Allow fullscreen requests to go through\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    if (keyCode >= 0 && keyCode < KEY_COUNT) {\n      this.keys[keyCode].down = state;\n    }\n  }\n\n  updateKeys() {\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i].update();\n    }\n  }\n\n  getKey(keyCode) {\n    return keyCode >= 0 && keyCode < KEY_COUNT ? this.keys[keyCode] : null;\n  }\n}\n\nconst Keys = {\n  VK_CANCEL: 3,\n  VK_HELP: 6,\n  VK_BACK_SPACE: 8,\n  VK_TAB: 9,\n  VK_CLEAR: 12,\n  VK_ENTER: 13,\n  VK_SHIFT: 16,\n  VK_CONTROL: 17,\n  VK_ALT: 18,\n  VK_PAUSE: 19,\n  VK_CAPS_LOCK: 20,\n  VK_ESCAPE: 27,\n  VK_SPACE: 32,\n  VK_PAGE_UP: 33,\n  VK_PAGE_DOWN: 34,\n  VK_END: 35,\n  VK_HOME: 36,\n  VK_LEFT: 37,\n  VK_UP: 38,\n  VK_RIGHT: 39,\n  VK_DOWN: 40,\n  VK_PRINTSCREEN: 44,\n  VK_INSERT: 45,\n  VK_DELETE: 46,\n  VK_0: 48,\n  VK_1: 49,\n  VK_2: 50,\n  VK_3: 51,\n  VK_4: 52,\n  VK_5: 53,\n  VK_6: 54,\n  VK_7: 55,\n  VK_8: 56,\n  VK_9: 57,\n  VK_COLON: 58,\n  VK_SEMICOLON: 59,\n  VK_LESS_THAN: 60,\n  VK_EQUALS: 61,\n  VK_GREATER_THAN: 62,\n  VK_QUESTION_MARK: 63,\n  VK_AT: 64,\n  VK_A: 65,\n  VK_B: 66,\n  VK_C: 67,\n  VK_D: 68,\n  VK_E: 69,\n  VK_F: 70,\n  VK_G: 71,\n  VK_H: 72,\n  VK_I: 73,\n  VK_J: 74,\n  VK_K: 75,\n  VK_L: 76,\n  VK_M: 77,\n  VK_N: 78,\n  VK_O: 79,\n  VK_P: 80,\n  VK_Q: 81,\n  VK_R: 82,\n  VK_S: 83,\n  VK_T: 84,\n  VK_U: 85,\n  VK_V: 86,\n  VK_W: 87,\n  VK_X: 88,\n  VK_Y: 89,\n  VK_Z: 90,\n  VK_CONTEXT_MENU: 93,\n  VK_NUMPAD0: 96,\n  VK_NUMPAD1: 97,\n  VK_NUMPAD2: 98,\n  VK_NUMPAD3: 99,\n  VK_NUMPAD4: 100,\n  VK_NUMPAD5: 101,\n  VK_NUMPAD6: 102,\n  VK_NUMPAD7: 103,\n  VK_NUMPAD8: 104,\n  VK_NUMPAD9: 105,\n  VK_MULTIPLY: 106,\n  VK_ADD: 107,\n  VK_SEPARATOR: 108,\n  VK_SUBTRACT: 109,\n  VK_DECIMAL: 110,\n  VK_DIVIDE: 111,\n  VK_F1: 112,\n  VK_F2: 113,\n  VK_F3: 114,\n  VK_F4: 115,\n  VK_F5: 116,\n  VK_F6: 117,\n  VK_F7: 118,\n  VK_F8: 119,\n  VK_F9: 120,\n  VK_F10: 121,\n  VK_F11: 122,\n  VK_F12: 123,\n  VK_F13: 124,\n  VK_F14: 125,\n  VK_F15: 126,\n  VK_F16: 127,\n  VK_F17: 128,\n  VK_F18: 129,\n  VK_F19: 130,\n  VK_F20: 131,\n  VK_F21: 132,\n  VK_F22: 133,\n  VK_F23: 134,\n  VK_F24: 135,\n  VK_NUM_LOCK: 144,\n  VK_SCROLL_LOCK: 145,\n  VK_CIRCUMFLEX: 160,\n  VK_EXCLAMATION: 161,\n  VK_DOUBLE_QUOTE: 162,\n  VK_HASH: 163,\n  VK_DOLLAR: 164,\n  VK_PERCENT: 165,\n  VK_AMPERSAND: 166,\n  VK_UNDERSCORE: 167,\n  VK_OPEN_PAREN: 168,\n  VK_CLOSE_PAREN: 169,\n  VK_ASTERISK: 170,\n  VK_PLUS: 171,\n  VK_PIPE: 172,\n  VK_HYPHEN_MINUS: 173,\n  VK_OPEN_CURLY_BRACKET: 174,\n  VK_CLOSE_CURLY_BRACKET: 175,\n  VK_TILDE: 176,\n  VK_COMMA: 188,\n  VK_PERIOD: 190,\n  VK_SLASH: 191,\n  VK_BACK_QUOTE: 192,\n  VK_OPEN_BRACKET: 219,\n  VK_BACK_SLASH: 220,\n  VK_CLOSE_BRACKET: 221,\n  VK_QUOTE: 222,\n  VK_META: 224,\n  VK_ALTGR: 225,\n  VK_WIN: 91,\n  VK_KANA: 21,\n  VK_HANGUL: 21,\n  VK_EISU: 22,\n  VK_JUNJA: 23,\n  VK_FINAL: 24,\n  VK_HANJA: 25,\n  VK_KANJI: 25,\n  VK_CONVERT: 28,\n  VK_NONCONVERT: 29,\n  VK_ACCEPT: 30,\n  VK_MODECHANGE: 31,\n  VK_SELECT: 41,\n  VK_PRINT: 42,\n  VK_EXECUTE: 43,\n  VK_SLEEP: 95,\n};\n\n\n//# sourceURL=webpack:///./src/keys.js?");

/***/ }),

/***/ "./src/mouse.js":
/*!**********************!*\
  !*** ./src/mouse.js ***!
  \**********************/
/*! exports provided: Mouse */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Mouse\", function() { return Mouse; });\n/* harmony import */ var _rect_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rect.js */ \"./src/rect.js\");\n/* harmony import */ var _input_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./input.js */ \"./src/input.js\");\n\n\n\n\nclass Mouse {\n\n  constructor(terminal, options) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.options = options;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.buttons = [new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"](), new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"](), new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"]()];\n\n    const el = this.el;\n    el.addEventListener('mousedown', e => this.handleEvent(e));\n    el.addEventListener('mouseup', e => this.handleEvent(e));\n    el.addEventListener('mousemove', e => this.handleEvent(e));\n    el.addEventListener('contextmenu', e => this.handleEvent(e));\n\n    const touchEventHandler = this.handleTouchEvent.bind(this);\n    el.addEventListener('touchstart', touchEventHandler);\n    el.addEventListener('touchend', touchEventHandler);\n    el.addEventListener('touchcancel', touchEventHandler);\n    el.addEventListener('touchmove', touchEventHandler);\n  }\n\n  handleTouchEvent(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.type === 'touchend' && this.options.requestFullscreen) {\n      this.requestFullscreen();\n    }\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons[0].down = true;\n    } else {\n      this.buttons[0].down = false;\n    }\n  }\n\n  handleEvent(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons[e.button].down = true;\n\n      this.el.focus();\n\n      if (this.options.requestFullscreen) {\n        this.requestFullscreen();\n      }\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons[e.button].down = false;\n    }\n  }\n\n  updatePosition(clientX, clientY) {\n    let rect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new _rect_js__WEBPACK_IMPORTED_MODULE_0__[\"Rect\"](Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new _rect_js__WEBPACK_IMPORTED_MODULE_0__[\"Rect\"](0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = (this.width * (clientX - rect.left) / rect.width) | 0;\n    this.y = (this.height * (clientY - rect.top) / rect.height) | 0;\n  }\n\n  requestFullscreen() {\n    const canvas = this.el;\n    if (canvas.requestFullscreen) {\n      canvas.requestFullscreen();\n    } else if (canvas.webkitRequestFullscreen) {\n      canvas.webkitRequestFullscreen();\n    } else if (canvas.mozRequestFullScreen) {\n      canvas.mozRequestFullScreen();\n    }\n  }\n\n  update() {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n\n    for (let i = 0; i < this.buttons.length; i++) {\n      this.buttons[i].update();\n    }\n  }\n}\n\n//# sourceURL=webpack:///./src/mouse.js?");

/***/ }),

/***/ "./src/path.js":
/*!*********************!*\
  !*** ./src/path.js ***!
  \*********************/
/*! exports provided: computePath */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"computePath\", function() { return computePath; });\n\nconst dxs = [-1, 0, 1, -1, 1, -1, 0, 1];\nconst dys = [-1, -1, -1, 0, 0, 1, 1, 1];\nconst costs = [1.5, 1, 1.5, 1, 1, 1.5, 1, 1.5];\nlet pathId = 0;\n\n/**\n * Calculates Dijkstra's algorithm.\n *\n * @param {!Object} source Starting point, must have x and y properties.\n * @param {!Object=} opt_dest Optional destination point, must have x and y properties.\n * @param {!number=} opt_maxDist Optional maximum distance to examine.\n * @return {?Array} Array of steps if destination found; null otherwise.\n */\nfunction computePath(map, source, dest, maxDist) {\n  pathId++;\n\n  const sourceCell = map.grid[source.y][source.x];\n  sourceCell.pathId = pathId;\n  sourceCell.g = 0.0;\n  sourceCell.h = Math.min(Math.abs(source.x - dest.x), Math.abs(source.y - dest.y));\n  sourceCell.prev = null;\n\n  const q = new SortedSet([sourceCell]);\n\n  while (q.size() > 0) {\n    const u = q.pop();\n\n    if (u.x === dest.x && u.y === dest.y) {\n      return buildPath(u);\n    }\n\n    for (let i = 0; i < dxs.length; i++) {\n      const x = u.x + dxs[i];\n      const y = u.y + dys[i];\n      if (x >= 0 && x < map.width && y >= 0 && y < map.height) {\n        const v = map.grid[y][x];\n        if (v.pathId !== pathId) {\n          v.pathId = pathId;\n          v.g = Infinity;\n          v.h = Math.min(Math.abs(x - dest.x), Math.abs(y - dest.y));\n          v.prev = null;\n        }\n        const alt = u.g + costs[i];\n        if (alt < v.g && alt <= maxDist && (!map.grid[y][x].blocked || (x === dest.x && y === dest.y))) {\n          v.g = alt;\n          v.prev = u;\n          q.insert(v);\n        }\n      }\n    }\n  }\n  return null;\n}\n\nfunction buildPath(cell) {\n  const result = [];\n  let curr = cell;\n  while (curr) {\n    result.push(curr);\n    curr = curr.prev;\n  }\n  result.reverse();\n  return result;\n}\n\nclass SortedSet {\n  constructor(initialValues) {\n    this.values = initialValues\n  }\n\n  insert(cell) {\n    const array = this.values;\n    let low = 0;\n    let high = array.length;\n\n    while (low < high) {\n      const mid = (low + high) >>> 1;\n      const midCell = array[mid];\n      if (midCell.g + midCell.h > cell.g + cell.h) {\n        low = mid + 1;\n      } else {\n        high = mid;\n      }\n    }\n    array.splice(low + 1, 0, cell);\n  }\n\n  pop() {\n    return this.values.pop();\n  }\n\n  size() {\n    return this.values.length;\n  }\n}\n\n//# sourceURL=webpack:///./src/path.js?");

/***/ }),

/***/ "./src/point.js":
/*!**********************!*\
  !*** ./src/point.js ***!
  \**********************/
/*! exports provided: Point */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Point\", function() { return Point; });\n\nclass Point {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n}\n\n\n//# sourceURL=webpack:///./src/point.js?");

/***/ }),

/***/ "./src/prim.js":
/*!*********************!*\
  !*** ./src/prim.js ***!
  \*********************/
/*! exports provided: createPrimLevel */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createPrimLevel\", function() { return createPrimLevel; });\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n\n\n\n/**\n * Creates a \"prim\" level.\n *\n * The map is a randomly generated maze using the Prim algorithm:\n * http://stackoverflow.com/a/29810293\n *\n * There are a fixed number of health potions and bombs randomly scattered.\n */\nfunction createPrimLevel(width, height, wallTile, emptyTile) {\n    var frontiers = [[1, 1, 1, 1]];\n    var lastX = 0;\n    var lastY = 0;\n\n    let result = new _console_js__WEBPACK_IMPORTED_MODULE_0__[\"Console\"](width, height);\n    result.fillRect(0, 0, width, height, wallTile);\n\n    while (frontiers.length > 0) {\n        var r = Math.floor(Math.random() * frontiers.length);\n        var f = frontiers.splice(r, 1)[0];\n        var x = f[2];\n        var y = f[3];\n        if (result.getCell(x, y).charCode === wallTile.charCode) {\n            result.drawCell(x, y, emptyTile);\n            result.drawCell(f[0], f[1], emptyTile);\n            lastX = x;\n            lastY = y;\n\n            if (x >= 3 && result.getCell(x - 2, y).charCode === wallTile.charCode) {\n                frontiers.push([x - 1, y, x - 2, y]);\n            }\n\n            if (y >= 3 && result.getCell(x, y - 2).charCode === wallTile.charCode) {\n                frontiers.push([x, y - 1, x, y - 2]);\n            }\n\n            if (x < width - 3 && result.getCell(x + 2, y).charCode === wallTile.charCode) {\n                frontiers.push([x + 1, y, x + 2, y]);\n            }\n\n            if (y < height - 3 && result.getCell(x, y + 2).charCode === wallTile.charCode) {\n                frontiers.push([x, y + 1, x, y + 2]);\n            }\n        }\n    }\n\n    return result;\n}\n\n\n//# sourceURL=webpack:///./src/prim.js?");

/***/ }),

/***/ "./src/rect.js":
/*!*********************!*\
  !*** ./src/rect.js ***!
  \*********************/
/*! exports provided: Rect */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Rect\", function() { return Rect; });\n/* harmony import */ var _point_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./point.js */ \"./src/point.js\");\n\n\nclass Rect {\n  constructor(x, y, width, height) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n    this.x2 = x + width;\n    this.y2 = y + height;\n  }\n\n  getCenter() {\n    return new _point_js__WEBPACK_IMPORTED_MODULE_0__[\"Point\"](this.x + (this.width / 2) | 0, this.y + (this.height / 2) | 0);\n  }\n\n  intersects(other) {\n    return this.x <= other.x2 && this.x2 >= other.x && this.y <= other.y2 && this.y2 >= other.y;\n  }\n\n  contains(point) {\n    return point.x >= this.x && point.y < this.x2 && point.y >= this.y && point.y < this.y2;\n  }\n}\n\n\n//# sourceURL=webpack:///./src/rect.js?");

/***/ }),

/***/ "./src/shaders.js":
/*!************************!*\
  !*** ./src/shaders.js ***!
  \************************/
/*! exports provided: VERTEX_SHADER_SOURCE, FRAGMENT_SHADER_SOURCE */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"VERTEX_SHADER_SOURCE\", function() { return VERTEX_SHADER_SOURCE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FRAGMENT_SHADER_SOURCE\", function() { return FRAGMENT_SHADER_SOURCE; });\n\n/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nconst VERTEX_SHADER_SOURCE = 'attribute vec2 a;' +\n    'attribute vec2 b;' +\n    'attribute vec3 c;' +\n    'attribute vec3 d;' +\n    'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'void main(void){' +\n    'gl_Position=vec4(a.x,a.y,0,1);' +\n    'e=b/16.0;' +\n    'f=vec4(c.r,c.g,c.b,1);' +\n    'g=vec4(d.r,d.g,d.b,1);' +\n    '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * h = uniform bool uGraphicalTiles;\n * s = uniform sampler2D uSampler;\n */\nconst FRAGMENT_SHADER_SOURCE = 'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'uniform bool h;' +\n    'uniform sampler2D s;' +\n    'void main(void){' +\n    'gl_FragColor=texture2D(s,e);' +\n    'if(h){' +\n    // Using graphical tiles\n    'if(gl_FragColor.a<0.1){' +\n    // The current pixel of the foreground sprite is transparent.\n    // Draw the background tile instead.\n    // Use the background red channel for the tile X coordinate.\n    // Use the background green channel for the tile Y coordinate.\n    // Use the fractional component of the texture coord for the pixel offset.\n    'gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);' +\n    '}' +\n    '}else{' +\n    // Using ASCII characters\n    'if(gl_FragColor.r<0.1) {' +\n    // Black background, so use bgColor\n    'gl_FragColor=g;' +\n    '} else {' +\n    // White background, so use fgColor\n    'gl_FragColor=f;' +\n    '}' +\n    '}' +\n    '}';\n\n\n//# sourceURL=webpack:///./src/shaders.js?");

/***/ }),

/***/ "./src/terminal.js":
/*!*************************!*\
  !*** ./src/terminal.js ***!
  \*************************/
/*! exports provided: Terminal */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Terminal\", function() { return Terminal; });\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n/* harmony import */ var _font_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./font.js */ \"./src/font.js\");\n/* harmony import */ var _keys_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./keys.js */ \"./src/keys.js\");\n/* harmony import */ var _mouse_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./mouse.js */ \"./src/mouse.js\");\n/* harmony import */ var _shaders_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shaders.js */ \"./src/shaders.js\");\n\n\n\n\n\n\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i, max) {\n  return -1.0 + 2.0 * (i / max);\n}\n\nconst DEFAULT_OPTIONS = {\n  font: _font_js__WEBPACK_IMPORTED_MODULE_1__[\"DEFAULT_FONT\"],\n  requestFullscreen: false\n};\n\nclass Terminal extends _console_js__WEBPACK_IMPORTED_MODULE_0__[\"Console\"] {\n  constructor(canvas, width, height, options) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || _font_js__WEBPACK_IMPORTED_MODULE_1__[\"DEFAULT_FONT\"];\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n\n    canvas.width = this.pixelWidth;\n    canvas.height = this.pixelHeight;\n    canvas.style.width = (this.font.scale * this.pixelWidth) + 'px';\n    canvas.style.height = (this.font.scale * this.pixelHeight) + 'px';\n    canvas.style.imageRendering = 'pixelated';\n    canvas.style.outline = 'none';\n    canvas.tabIndex = 0;\n    this.handleResize();\n    window.addEventListener('resize', () => this.handleResize());\n\n    this.keys = new _keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keyboard\"](canvas);\n    this.mouse = new _mouse_js__WEBPACK_IMPORTED_MODULE_3__[\"Mouse\"](this, options);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext('webgl', {antialias: false});\n    if (!gl) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(program, this.buildShader(gl.VERTEX_SHADER, _shaders_js__WEBPACK_IMPORTED_MODULE_4__[\"VERTEX_SHADER_SOURCE\"]));\n    gl.attachShader(program, this.buildShader(gl.FRAGMENT_SHADER, _shaders_js__WEBPACK_IMPORTED_MODULE_4__[\"FRAGMENT_SHADER_SOURCE\"]));\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (this.font.graphical) {\n      // Set the flag to ignore foreground/background colors, and use texture\n      // directly\n      gl.uniform1i(gl.getUniformLocation(program, 'h'), 1);\n    }\n\n    this.positionAttribLocation = this.getAttribLocation('a');\n    this.textureAttribLocation = this.getAttribLocation('b');\n    this.fgColorAttribLocation = this.getAttribLocation('c');\n    this.bgColorAttribLocation = this.getAttribLocation('d');\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer();\n    this.indexBuffer = gl.createBuffer();\n    this.textureBuffer = gl.createBuffer();\n    this.foregroundBuffer = gl.createBuffer();\n    this.backgroundBuffer = gl.createBuffer();\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url);\n\n    this.frameDelay = options.frameDelay || 0;\n    this.frameIndex = 0;\n\n    this.renderLoop();\n  }\n\n  handleResize() {\n    const width = this.canvas.parentElement.offsetWidth;\n    const height = width * this.pixelHeight / this.pixelWidth;\n    this.canvas.style.width = width + 'px';\n    this.canvas.style.height = height + 'px';\n  }\n\n  getAttribLocation(name) {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  flush() {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y);\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = (cell.charCode % 16);\n        const textureY = ((cell.charCode / 16) | 0);\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.down;\n  }\n\n  isKeyPressed(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.isPressed();\n  }\n\n  getKeyDownCount(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key ? key.downCount : 0;\n  }\n\n  buildShader(type, source) {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error('An error occurred compiling the shader: ');\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error(\n          'An error occurred compiling the shader: ' + gl.getShaderInfoLog(sh));\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  loadTexture(url) {\n    const gl = this.gl;\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]);  // opaque black\n    gl.texImage2D(\n        gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat,\n        srcType, pixel);\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(\n          gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  render() {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(\n          this.positionAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.textureAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.foregroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.fgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.backgroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.bgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  renderLoop() {\n    this.frameIndex++;\n    if (this.frameIndex >= this.frameDelay) {\n      this.keys.updateKeys();\n      this.mouse.update();\n      if (this.update) {\n        this.update();\n      }\n      this.flush();\n      this.render();\n      this.frameIndex = 0;\n    }\n    requestAnimationFrame(this.renderLoop.bind(this));\n  }\n}\n\n\n//# sourceURL=webpack:///./src/terminal.js?");

/***/ }),

/***/ "./src/tilemap.js":
/*!************************!*\
  !*** ./src/tilemap.js ***!
  \************************/
/*! exports provided: FovOctants, FovQuadrants, getFovQuadrant, Tile, TileMap */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FovOctants\", function() { return FovOctants; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FovQuadrants\", function() { return FovQuadrants; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getFovQuadrant\", function() { return getFovQuadrant; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Tile\", function() { return Tile; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TileMap\", function() { return TileMap; });\n/* harmony import */ var _cell_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./cell.js */ \"./src/cell.js\");\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n\n\n\n// MRPAS\n// Mingos' Restrictive Precise Angle Shadowcasting\n// https://bitbucket.org/mingos/mrpas/overview\n\n\n/**\n * The FovOctants constants provide bitmasks for various directions.\n *\n *     \\ 4 | 3 /\n *      \\  |  /\n *    5  \\ | /  2\n *        \\|/\n *   ------+-------\n *        /|\\\n *    6  / | \\  1\n *      /  |  \\\n *     / 7 | 0 \\\n *\n */\nconst FovOctants = {\n  OCTANT_SOUTH_SOUTHEAST: 0x001,\n  OCTANT_EAST_SOUTHEAST: 0x002,\n  OCTANT_EAST_NORTHTHEAST: 0x004,\n  OCTANT_NORTH_NORTHEAST: 0x008,\n  OCTANT_NORTH_NORTHWEST: 0x010,\n  OCTANT_WEST_NORTHEAST: 0x020,\n  OCTANT_WEST_SOUTHWEST: 0x040,\n  OCTANT_SOUTH_SOUTHWEST: 0x080\n};\n\nconst FovQuadrants = {\n  QUADRANT_SOUTHEAST: 0x001 + 0x002,\n  QUADRANT_EAST: 0x002 + 0x004,\n  QUADRANT_NORTHEAST: 0x004 + 0x008,\n  QUADRANT_NORTH: 0x008 + 0x010,\n  QUADRANT_NORTHWEST: 0x010 + 0x020,\n  QUADRANT_WEST: 0x020 + 0x040,\n  QUADRANT_SOUTHWEST: 0x040 + 0x080,\n  QUADRANT_SOUTH: 0x080 + 0x001,\n};\n\nfunction getFovQuadrant(dx, dy) {\n  if (dx > 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHEAST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_EAST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHEAST;\n    }\n  } else if (dx < 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHWEST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_WEST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHWEST;\n    }\n  } else {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTH;\n    } else {\n      return FovQuadrants.QUADRANT_NORTH;\n    }\n  }\n}\n\nclass Tile extends _cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"] {\n\n  constructor(x, y) {\n    super();\n    this.x = x;\n    this.y = y;\n    this.blocked = false;\n    this.blockSight = false;\n    this.explored = false;\n    this.visible = false;\n    this.pathId = -1;\n    this.g = 0.0;\n    this.h = 0.0;\n    this.prev = null;\n  }\n}\n\nclass TileMap extends _console_js__WEBPACK_IMPORTED_MODULE_1__[\"Console\"] {\n\n  /**\n   * Creates a new FOV map.\n   * @param width\n   * @param height\n   * @param blockedFunc\n   */\n  constructor(width, height, blockedFunc) {\n    super(width, height, Tile);\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  setBlocked(x, y, blocked) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  setBlockSight(x, y, blockSight) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blockSight = blockSight;\n    }\n  }\n\n  isVisible(x, y) {\n    if (x < this.minX || x > this.maxX || y < this.minY || y > this.maxY) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  computeOctantY(deltaX, deltaY) {\n    const startSlopes = [];\n    const endSlopes = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (y = this.originY + deltaY; y >= this.minY && y <= this.maxY;\n         y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          x = this.originX + (processedCell * deltaX);\n           processedCell <= iteration && x >= this.minX && x <= this.maxX;\n           x += deltaX, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y - deltaY][x].visible &&\n                !this.grid[y - deltaY][x].blockSight) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blockSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  computeOctantX(deltaX, deltaY) {\n    const startSlopes = [];\n    const endSlopes = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (x = this.originX + deltaX; x >= this.minX && x <= this.maxX;\n         x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          y = this.originY + (processedCell * deltaY);\n           processedCell <= iteration && y >= this.minY && y <= this.maxY;\n           y += deltaY, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y][x - deltaX].visible &&\n                !this.grid[y][x - deltaX].blockSight) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blockSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX, originY, radius, opt_noClear, opt_octants) {\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n\n    if (opt_noClear) {\n      this.minX = Math.min(this.minX, Math.max(0, originX - radius));\n      this.minY = Math.min(this.minY, Math.max(0, originY - radius));\n      this.maxX = Math.max(this.maxX, Math.min(this.width - 1, originX + radius));\n      this.maxY = Math.max(this.maxY, Math.min(this.height - 1, originY + radius));\n\n    } else {\n      this.minX = Math.max(0, originX - radius);\n      this.minY = Math.max(0, originY - radius);\n      this.maxX = Math.min(this.width - 1, originX + radius);\n      this.maxY = Math.min(this.height - 1, originY + radius);\n\n      for (let y = this.minY; y <= this.maxY; y++) {\n        for (let x = this.minX; x <= this.maxX; x++) {\n          this.grid[y][x].visible = false;\n        }\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n\n    if (opt_octants === undefined) {\n        this.computeOctantY(1, 1);\n        this.computeOctantX(1, 1);\n        this.computeOctantX(1, -1);\n        this.computeOctantY(1, -1);\n        this.computeOctantY(-1, -1);\n        this.computeOctantX(-1, -1);\n        this.computeOctantX(-1, 1);\n        this.computeOctantY(-1, 1);\n    } else {\n      //   \\ 4 | 3 /\n      //    \\  |  /\n      //  5  \\ | /  2\n      //      \\|/\n      // ------+-------\n      //      /|\\\n      //  6  / | \\  1\n      //    /  |  \\\n      //   / 7 | 0 \\\n      if (opt_octants & 0x001) {\n        this.computeOctantY(1, 1);\n      }\n\n      if (opt_octants & 0x002) {\n        this.computeOctantX(1, 1);\n      }\n\n      if (opt_octants & 0x004) {\n        this.computeOctantX(1, -1);\n      }\n\n      if (opt_octants & 0x008) {\n        this.computeOctantY(1, -1);\n      }\n\n      if (opt_octants & 0x010) {\n        this.computeOctantY(-1, -1);\n      }\n\n      if (opt_octants & 0x020) {\n        this.computeOctantX(-1, -1);\n      }\n\n      if (opt_octants & 0x040) {\n        this.computeOctantX(-1, 1);\n      }\n\n      if (opt_octants & 0x080) {\n        this.computeOctantY(-1, 1);\n      }\n    }\n  }\n\n  /**\n   * All visible tiles are marked as explored.\n   */\n  updateExplored() {\n    for (let y = this.minY; y <= this.maxY; y++) {\n      for (let x = this.minX; x <= this.maxX; x++) {\n        const tile = this.grid[y][x];\n        tile.explored |= tile.visible;\n      }\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/tilemap.js?");

/***/ })

/******/ });
});