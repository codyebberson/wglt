{"version":3,"file":"alpha.min.js","mappings":"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","sources":["webpack://wglt/webpack/universalModuleDefinition","webpack://wglt/webpack/bootstrap","webpack://wglt/webpack/runtime/make namespace object","webpack://wglt/./src/blendmode.ts","webpack://wglt/./src/color.ts","webpack://wglt/./src/colors.ts","webpack://wglt/./src/cell.ts","webpack://wglt/./src/chars.ts","webpack://wglt/./src/console.ts","webpack://wglt/./src/font.ts","webpack://wglt/./src/input.ts","webpack://wglt/./src/keys.ts","webpack://wglt/./src/point.ts","webpack://wglt/./src/rect.ts","webpack://wglt/./src/mouse.ts","webpack://wglt/./src/terminal.ts","webpack://wglt/./examples/alpha.ts","webpack://wglt/./src/shaders.ts","webpack://wglt/./src/rng.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"wglt\"] = factory();\n\telse\n\t\troot[\"wglt\"] = factory();\n})(globalThis, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nexport enum BlendMode {\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None = 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend = 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add = 2\n}\n","\nexport type Color = number;\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromRgb(r: number, g: number, b: number, a?: number): Color {\n  if (a === undefined) {\n    a = 255;\n  }\n  return ((r << 24) + (g << 16) + (b << 8) + a);\n}\n\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nexport function fromHsv(h: number, s: number, v: number, a?: number): Color {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      r = v, g = t, b = p;\n      break;\n    case 1:\n      r = q, g = v, b = p;\n      break;\n    case 2:\n      r = p, g = v, b = t;\n      break;\n    case 3:\n      r = p, g = q, b = v;\n      break;\n    case 4:\n      r = t, g = p, b = v;\n      break;\n    case 5:\n      r = v, g = p, b = q;\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n","\nimport { fromRgb } from './color';\n\nexport const Colors = {\n  BLACK: fromRgb(0, 0, 0),\n  WHITE: fromRgb(0xff, 0xff, 0xff),\n  LIGHT_GRAY: fromRgb(0xaa, 0xaa, 0xaa),\n  DARK_GRAY: fromRgb(0x55, 0x55, 0x55),\n  YELLOW: fromRgb(0xff, 0xff, 0x55),\n  BROWN: fromRgb(0xaa, 0x55, 0x00),\n  LIGHT_RED: fromRgb(0xff, 0x55, 0x55),\n  DARK_RED: fromRgb(0xaa, 0x00, 0x00),\n  LIGHT_GREEN: fromRgb(0x55, 0xff, 0x55),\n  DARK_GREEN: fromRgb(0x00, 0xaa, 0x00),\n  LIGHT_CYAN: fromRgb(0x55, 0xff, 0xff),\n  DARK_CYAN: fromRgb(0x00, 0xaa, 0xaa),\n  LIGHT_BLUE: fromRgb(0x55, 0x55, 0xff),\n  DARK_BLUE: fromRgb(0x00, 0x00, 0xaa),\n  LIGHT_MAGENTA: fromRgb(0xff, 0x55, 0xff),\n  DARK_MAGENTA: fromRgb(0xaa, 0x00, 0xaa),\n  ORANGE: fromRgb(0xff, 0x88, 0x00),\n};\n","\nimport { BlendMode } from './blendmode';\nimport { Colors } from './colors';\nimport { Color, fromRgb } from './color';\n\nfunction convertCharCode(charCode: string | number): number {\n  if ((typeof charCode === 'string') && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode as number;\n  }\n}\n\nexport class Cell {\n  readonly x: number;\n  readonly y: number;\n  charCode: number;\n  fg: Color;\n  bg: Color;\n  dirty: boolean;\n  blocked: boolean;\n  blockedSight: boolean;\n  explored: boolean;\n  visible: boolean;\n  pathId: number;\n  g: number;\n  h: number;\n  prev: Cell | null;\n\n  constructor(x: number, y: number, charCode?: string | number, fg?: Color, bg?: Color) {\n    this.x = x;\n    this.y = y;\n\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode);\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = Colors.WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = Colors.BLACK;\n    }\n\n    this.dirty = true;\n    this.blocked = false;\n    this.blockedSight = false;\n    this.explored = false;\n    this.visible = false;\n    this.pathId = -1;\n    this.g = 0;\n    this.h = 0;\n    this.prev = null;\n  }\n\n  setCharCode(charCode: number): void {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg: Color): void {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg: Color): void {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setValue(charCode: string | number, fg?: Color, bg?: Color): boolean {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n\n      if (fg !== undefined) {\n        this.setForeground(fg);\n      }\n      if (bg !== undefined) {\n        this.setBackground(bg);\n      }\n    } else {\n      this.drawCell(charCode, BlendMode.None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell: Cell, blendMode?: BlendMode): void {\n    const alpha = otherCell.bg & 0xFF;\n\n    if (blendMode === BlendMode.None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === BlendMode.None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n  }\n\n  private blendColors(c1: Color, c2: Color, blendMode?: BlendMode): Color {\n    const alpha = c2 & 0xFF;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xFF;\n    const g1 = (c1 >> 16) & 0xFF;\n    const b1 = (c1 >> 8) & 0xFF;\n    const r2 = (c2 >> 24) & 0xFF;\n    const g2 = (c2 >> 16) & 0xFF;\n    const b2 = (c2 >> 8) & 0xFF;\n\n    switch (blendMode) {\n      case BlendMode.Blend:\n        return fromRgb(\n          (w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0,\n          (w1 * b1 + w2 * b2) | 0);\n\n      case BlendMode.Add:\n        return fromRgb(\n          this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0),\n          this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  private clamp(x: number): number {\n    return Math.min(255, x);\n  }\n}\n","\n\n// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nexport enum Chars {\n  SMILEY = 1,\n  INVERSE_SMILEY = 2,\n  HEART = 3,\n  DIAMOND = 4,\n  CLUB = 5,\n  SPADE = 6,\n  BULLET = 7,\n  INVERSE_BULLET = 8,\n\n  LIGHT_SHADE = 176,\n  MEDIUM_SHADE = 177,\n  DARK_SHADE = 178,\n\n  BOX_SINGLE_VERTICAL = 179,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT = 180,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT = 185,\n  BOX_DOUBLE_VERTICAL = 186,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT = 187,\n  BOX_DOUBLE_UP_AND_DOUBLE_LEFT = 188,\n  BOX_SINGLE_DOWN_AND_SINGLE_LEFT = 191,\n  BOX_SINGLE_UP_AND_SINGLE_RIGHT = 192,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP = 193,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN = 194,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT = 195,\n  BOX_SINGLE_HORIZONTAL = 196,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL = 197,\n  BOX_DOUBLE_UP_AND_DOUBLE_RIGHT = 200,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT = 201,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP = 202,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN = 203,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT = 204,\n  BOX_DOUBLE_HORIZONTAL = 205,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL = 206,\n  BOX_SINGLE_UP_AND_SINGLE_LEFT = 13 * 16 + 9,\n  BOX_SINGLE_DOWN_AND_SINGLE_RIGHT = 13 * 16 + 10,\n\n  BLOCK_FULL = 219,\n  BLOCK_BOTTOM_HALF = 13 * 16 + 12,\n  BLOCK_LEFT_HALF = 13 * 16 + 13,\n  BLOCK_RIGHT_HALF = 13 * 16 + 14,\n  BLOCK_TOP_HALF = 13 * 16 + 15,\n}\n","\nimport { BlendMode } from './blendmode';\nimport { Cell } from './cell';\nimport { Chars } from './chars';\nimport { Color } from './color';\n\nexport class Console {\n  readonly width: number;\n  readonly height: number;\n  readonly grid: Cell[][];\n  originX: number;\n  originY: number;\n  minX: number;\n  maxX: number;\n  minY: number;\n  maxY: number;\n  radius: number;\n\n  constructor(width: number, height: number, blockedFunc?: (x: number, y: number) => boolean) {\n    this.width = width;\n    this.height = height;\n    this.grid = [];\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    for (let y = 0; y < height; y++) {\n      const row = [];\n      for (let x = 0; x < width; x++) {\n        row.push(new Cell(x, y));\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = this.grid[y][x].blockedSight = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  clear(): void {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x: number, y: number): Cell|undefined {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  getCharCode(x: number, y: number): number|undefined {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x].charCode;\n  }\n\n  drawChar(x: number, y: number, c: string | number, fg?: Color, bg?: Color): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y | 0][x | 0].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x: number, y: number, str: string, fg?: Color, bg?: Color): void {\n    const lines = str.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      for (let j = 0; j < line.length; j++) {\n        this.drawChar(x + j, y + i, line.charCodeAt(j), fg, bg);\n      }\n    }\n  }\n\n  drawCenteredString(x: number, y: number, str: string, fg?: Color, bg?: Color): void {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawHLine(x: number, y: number, width: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(x: number, y: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(x: number, y: number, width: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n    x: number, y: number, width: number, height: number,\n    topChar: number, rightChar: number, bottomChar: number, leftChar: number,\n    topLeftChar: number, topRightChar: number, bottomRightChar: number, bottomLeftChar: number,\n    fg?: Color, bg?: Color): void {\n    this.fillRect(x, y, width, height, 0, fg, bg);\n\n    this.drawHLine(x, y, width, topChar);\n    this.drawHLine(x, y + height - 1, width, bottomChar);\n\n    this.drawVLine(x, y, height, leftChar);\n    this.drawVLine(x + width - 1, y, height, rightChar);\n\n    this.drawChar(x, y, topLeftChar);\n    this.drawChar(x + width - 1, y, topRightChar);\n    this.drawChar(x, y + height - 1, bottomLeftChar);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar);\n  }\n\n  drawSingleBox(x: number, y: number, width: number, height: number, fg?: Color, bg?: Color): void {\n    this.drawBox(\n      x, y, width, height, Chars.BOX_SINGLE_HORIZONTAL,\n      Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_HORIZONTAL,\n      Chars.BOX_SINGLE_VERTICAL, Chars.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n      Chars.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n      Chars.BOX_SINGLE_UP_AND_SINGLE_LEFT,\n      Chars.BOX_SINGLE_UP_AND_SINGLE_RIGHT, fg, bg);\n  }\n\n  drawDoubleBox(x: number, y: number, width: number, height: number, fg?: Color, bg?: Color): void {\n    this.drawBox(\n      x, y, width, height, Chars.BOX_DOUBLE_HORIZONTAL,\n      Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_HORIZONTAL,\n      Chars.BOX_DOUBLE_VERTICAL, Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n      Chars.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n      Chars.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n      Chars.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT, fg, bg);\n  }\n\n  fillRect(x: number, y: number, width: number, height: number, c: string | number, fg?: Color, bg?: Color): void {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n    dstX: number, dstY: number,\n    srcConsole: Console,\n    srcX: number, srcY: number, srcWidth: number, srcHeight: number,\n    blendMode?: BlendMode): void {\n\n    blendMode = blendMode || BlendMode.None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  drawCell(x: number, y: number, cell: Cell, blendMode?: BlendMode): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n\n  setBlocked(x: number, y: number, blocked: boolean): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  setBlockedSight(x: number, y: number, blockedSight: boolean): void {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blockedSight = blockedSight;\n    }\n  }\n\n  isVisible(x: number, y: number): boolean {\n    if (x < this.minX || x > this.maxX || y < this.minY || y > this.maxY) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  isBlocked(x: number, y: number): boolean {\n    if (x < 0 || x > this.width || y < 0 || y > this.height) {\n      return true;\n    }\n    return this.grid[y][x].blocked;\n  }\n\n  isBlockedSight(x: number, y: number): boolean {\n    if (x < 0 || x > this.width || y < 0 || y > this.height) {\n      return true;\n    }\n    return this.grid[y][x].blockedSight;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  private computeOctantY(deltaX: number, deltaY: number): void {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (y = this.originY + deltaY; y >= this.minY && y <= this.maxY;\n      y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n        x = this.originX + (processedCell * deltaX);\n        processedCell <= iteration && x >= this.minX && x <= this.maxX;\n        x += deltaX, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y - deltaY][x].visible &&\n            !this.grid[y - deltaY][x].blockedSight) &&\n            !(this.grid[y - deltaY][x - deltaX].visible &&\n              !this.grid[y - deltaY][x - deltaX].blockedSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockedSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                    centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                    endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockedSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  private computeOctantX(deltaX: number, deltaY: number): void {\n    const startSlopes: number[] = [];\n    const endSlopes: number[] = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (x = this.originX + deltaX; x >= this.minX && x <= this.maxX;\n      x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n        y = this.originY + (processedCell * deltaY);\n        processedCell <= iteration && y >= this.minY && y <= this.maxY;\n        y += deltaY, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y][x - deltaX].visible &&\n            !this.grid[y][x - deltaX].blockedSight) &&\n            !(this.grid[y - deltaY][x - deltaX].visible &&\n              !this.grid[y - deltaY][x - deltaX].blockedSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockedSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                    centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                    endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockedSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX: number, originY: number, radius: number, opt_noClear?: boolean, opt_octants?: number): void {\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n\n    if (opt_noClear) {\n      this.minX = Math.min(this.minX, Math.max(0, originX - radius));\n      this.minY = Math.min(this.minY, Math.max(0, originY - radius));\n      this.maxX = Math.max(this.maxX, Math.min(this.width - 1, originX + radius));\n      this.maxY = Math.max(this.maxY, Math.min(this.height - 1, originY + radius));\n\n    } else {\n      this.minX = Math.max(0, originX - radius);\n      this.minY = Math.max(0, originY - radius);\n      this.maxX = Math.min(this.width - 1, originX + radius);\n      this.maxY = Math.min(this.height - 1, originY + radius);\n\n      for (let y = this.minY; y <= this.maxY; y++) {\n        for (let x = this.minX; x <= this.maxX; x++) {\n          this.grid[y][x].visible = false;\n        }\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n\n    if (opt_octants === undefined) {\n      this.computeOctantY(1, 1);\n      this.computeOctantX(1, 1);\n      this.computeOctantX(1, -1);\n      this.computeOctantY(1, -1);\n      this.computeOctantY(-1, -1);\n      this.computeOctantX(-1, -1);\n      this.computeOctantX(-1, 1);\n      this.computeOctantY(-1, 1);\n    } else {\n      //   \\ 4 | 3 /\n      //    \\  |  /\n      //  5  \\ | /  2\n      //      \\|/\n      // ------+-------\n      //      /|\\\n      //  6  / | \\  1\n      //    /  |  \\\n      //   / 7 | 0 \\\n      if (opt_octants & 0x001) {\n        this.computeOctantY(1, 1);\n      }\n\n      if (opt_octants & 0x002) {\n        this.computeOctantX(1, 1);\n      }\n\n      if (opt_octants & 0x004) {\n        this.computeOctantX(1, -1);\n      }\n\n      if (opt_octants & 0x008) {\n        this.computeOctantY(1, -1);\n      }\n\n      if (opt_octants & 0x010) {\n        this.computeOctantY(-1, -1);\n      }\n\n      if (opt_octants & 0x020) {\n        this.computeOctantX(-1, -1);\n      }\n\n      if (opt_octants & 0x040) {\n        this.computeOctantX(-1, 1);\n      }\n\n      if (opt_octants & 0x080) {\n        this.computeOctantY(-1, 1);\n      }\n    }\n  }\n\n  /**\n   * All visible tiles are marked as explored.\n   */\n  updateExplored(): void {\n    for (let y = this.minY; y <= this.maxY; y++) {\n      for (let x = this.minX; x <= this.maxX; x++) {\n        const tile = this.grid[y][x];\n        tile.explored = tile.explored || tile.visible;\n      }\n    }\n  }\n}\n","\nexport class Font {\n  readonly url: string;\n  readonly charWidth: number;\n  readonly charHeight: number;\n  readonly scale: number;\n  readonly graphical: boolean;\n\n  constructor(\n    url: string, charWidth: number, charHeight: number,\n    scale?: number, graphical?: boolean) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n    this.graphical = !!graphical;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQ' +\n  'MAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8' +\n  'QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY' +\n  '09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1' +\n  'zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eIC' +\n  'JsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBq' +\n  'ucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqh' +\n  'JRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvh' +\n  'A1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL' +\n  '0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu' +\n  '2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIz' +\n  'CAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsW' +\n  'IE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBW' +\n  'l5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h' +\n  '5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtL' +\n  'ji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb' +\n  '2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O' +\n  '3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2f' +\n  'otTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZ' +\n  'UghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2G' +\n  'AzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc' +\n  '4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJ' +\n  'G199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJI' +\n  'lipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC';\n\nexport const DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n","\n/**\n * The delay in frames before input repeating.\n * Time in milliseconds.\n */\nconst INPUT_REPEAT_DELAY = 200.0;\n\n/**\n * The delay between subsequent repeat firing.\n * Time in milliseconds.\n */\nconst INPUT_REPEAT_RATE = 1000.0 / 15.0;\n\n/**\n * The Input class represents a pysical input.\n * Example: keyboard key or mouse button.\n */\nexport class Input {\n  down: boolean;\n  downTime: number;\n  repeat: boolean;\n  repeatTime: number;\n  downCount: number;\n  upCount: number;\n\n  constructor() {\n    this.down = false;\n    this.downTime = 0;\n    this.repeat = false;\n    this.repeatTime = 0;\n    this.downCount = 0;\n    this.upCount = 100;\n  }\n\n  setDown(down: boolean): void {\n    if (this.down !== down) {\n      this.down = down;\n      this.repeat = false;\n      this.downTime = this.repeatTime = performance.now();\n    }\n  }\n\n  update(time: number): void {\n    this.repeat = false;\n    if (this.down) {\n      this.downCount++;\n      this.upCount = 0;\n      if (time - this.downTime >= INPUT_REPEAT_DELAY && time - this.repeatTime >= INPUT_REPEAT_RATE) {\n        this.repeat = true;\n        this.repeatTime = time;\n      }\n    } else {\n      this.downCount = 0;\n      this.upCount++;\n    }\n  }\n\n  /**\n   * Returns true if the input is \"pressed\".\n   * Pressed is a one time event when the input first goes down.\n   * It then repeats on repeat delay.\n   */\n  isPressed(): boolean {\n    return this.downCount === 1 || this.repeat;\n    // const count = this.downCount;\n    // return count === 1 || (count > INPUT_REPEAT_DELAY && count % INPUT_REPEAT_RATE === 0);\n  }\n\n  /**\n   * Returns true if the input is \"clicked\".\n   * Clicked is a one time event when the input first goes up.\n   */\n  isClicked(): boolean {\n    return this.upCount === 1;\n  }\n}\n","import { Input } from './input';\n\n/**\n * Number of keys to track.\n */\nconst KEY_COUNT = 256;\n\nexport class Keyboard {\n  readonly keys: Input[];\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el: HTMLElement) {\n    this.keys = new Array(KEY_COUNT);\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i] = new Input();\n    }\n\n    el.addEventListener('keydown', e => this.setKey(e, true));\n    el.addEventListener('keyup', e => this.setKey(e, false));\n  }\n\n\n  setKey(e: KeyboardEvent, state: boolean): void {\n    const keyCode = e.keyCode;\n    if (keyCode === Keys.VK_F11) {\n      // Allow fullscreen requests to go through\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    if (keyCode >= 0 && keyCode < KEY_COUNT) {\n      this.keys[keyCode].setDown(state);\n    }\n  }\n\n  updateKeys(time: number): void {\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i].update(time);\n    }\n  }\n\n  getKey(keyCode: number): Input | null {\n    return keyCode >= 0 && keyCode < KEY_COUNT ? this.keys[keyCode] : null;\n  }\n}\n\nexport enum Keys {\n  VK_CANCEL = 3,\n  VK_HELP = 6,\n  VK_BACK_SPACE = 8,\n  VK_TAB = 9,\n  VK_CLEAR = 12,\n  VK_ENTER = 13,\n  VK_SHIFT = 16,\n  VK_CONTROL = 17,\n  VK_ALT = 18,\n  VK_PAUSE = 19,\n  VK_CAPS_LOCK = 20,\n  VK_ESCAPE = 27,\n  VK_SPACE = 32,\n  VK_PAGE_UP = 33,\n  VK_PAGE_DOWN = 34,\n  VK_END = 35,\n  VK_HOME = 36,\n  VK_LEFT = 37,\n  VK_UP = 38,\n  VK_RIGHT = 39,\n  VK_DOWN = 40,\n  VK_PRINTSCREEN = 44,\n  VK_INSERT = 45,\n  VK_DELETE = 46,\n  VK_0 = 48,\n  VK_1 = 49,\n  VK_2 = 50,\n  VK_3 = 51,\n  VK_4 = 52,\n  VK_5 = 53,\n  VK_6 = 54,\n  VK_7 = 55,\n  VK_8 = 56,\n  VK_9 = 57,\n  VK_COLON = 58,\n  VK_SEMICOLON = 59,\n  VK_LESS_THAN = 60,\n  VK_EQUALS = 61,\n  VK_GREATER_THAN = 62,\n  VK_QUESTION_MARK = 63,\n  VK_AT = 64,\n  VK_A = 65,\n  VK_B = 66,\n  VK_C = 67,\n  VK_D = 68,\n  VK_E = 69,\n  VK_F = 70,\n  VK_G = 71,\n  VK_H = 72,\n  VK_I = 73,\n  VK_J = 74,\n  VK_K = 75,\n  VK_L = 76,\n  VK_M = 77,\n  VK_N = 78,\n  VK_O = 79,\n  VK_P = 80,\n  VK_Q = 81,\n  VK_R = 82,\n  VK_S = 83,\n  VK_T = 84,\n  VK_U = 85,\n  VK_V = 86,\n  VK_W = 87,\n  VK_X = 88,\n  VK_Y = 89,\n  VK_Z = 90,\n  VK_CONTEXT_MENU = 93,\n  VK_NUMPAD0 = 96,\n  VK_NUMPAD1 = 97,\n  VK_NUMPAD2 = 98,\n  VK_NUMPAD3 = 99,\n  VK_NUMPAD4 = 100,\n  VK_NUMPAD5 = 101,\n  VK_NUMPAD6 = 102,\n  VK_NUMPAD7 = 103,\n  VK_NUMPAD8 = 104,\n  VK_NUMPAD9 = 105,\n  VK_MULTIPLY = 106,\n  VK_ADD = 107,\n  VK_SEPARATOR = 108,\n  VK_SUBTRACT = 109,\n  VK_DECIMAL = 110,\n  VK_DIVIDE = 111,\n  VK_F1 = 112,\n  VK_F2 = 113,\n  VK_F3 = 114,\n  VK_F4 = 115,\n  VK_F5 = 116,\n  VK_F6 = 117,\n  VK_F7 = 118,\n  VK_F8 = 119,\n  VK_F9 = 120,\n  VK_F10 = 121,\n  VK_F11 = 122,\n  VK_F12 = 123,\n  VK_F13 = 124,\n  VK_F14 = 125,\n  VK_F15 = 126,\n  VK_F16 = 127,\n  VK_F17 = 128,\n  VK_F18 = 129,\n  VK_F19 = 130,\n  VK_F20 = 131,\n  VK_F21 = 132,\n  VK_F22 = 133,\n  VK_F23 = 134,\n  VK_F24 = 135,\n  VK_NUM_LOCK = 144,\n  VK_SCROLL_LOCK = 145,\n  VK_CIRCUMFLEX = 160,\n  VK_EXCLAMATION = 161,\n  VK_DOUBLE_QUOTE = 162,\n  VK_HASH = 163,\n  VK_DOLLAR = 164,\n  VK_PERCENT = 165,\n  VK_AMPERSAND = 166,\n  VK_UNDERSCORE = 167,\n  VK_OPEN_PAREN = 168,\n  VK_CLOSE_PAREN = 169,\n  VK_ASTERISK = 170,\n  VK_PLUS = 171,\n  VK_PIPE = 172,\n  VK_HYPHEN_MINUS = 173,\n  VK_OPEN_CURLY_BRACKET = 174,\n  VK_CLOSE_CURLY_BRACKET = 175,\n  VK_TILDE = 176,\n  VK_COMMA = 188,\n  VK_PERIOD = 190,\n  VK_SLASH = 191,\n  VK_BACK_QUOTE = 192,\n  VK_OPEN_BRACKET = 219,\n  VK_BACK_SLASH = 220,\n  VK_CLOSE_BRACKET = 221,\n  VK_QUOTE = 222,\n  VK_META = 224,\n  VK_ALTGR = 225,\n  VK_WIN = 91,\n  VK_KANA = 21,\n  VK_HANGUL = 21,\n  VK_EISU = 22,\n  VK_JUNJA = 23,\n  VK_FINAL = 24,\n  VK_HANJA = 25,\n  VK_KANJI = 25,\n  VK_CONVERT = 28,\n  VK_NONCONVERT = 29,\n  VK_ACCEPT = 30,\n  VK_MODECHANGE = 31,\n  VK_SELECT = 41,\n  VK_PRINT = 42,\n  VK_EXECUTE = 43,\n  VK_SLEEP = 95,\n}\n","\nexport class Point {\n  readonly x: number;\n  readonly y: number;\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n}\n","import { Point } from './point';\n\nexport class Rect {\n  readonly x: number;\n  readonly y: number;\n  readonly width: number;\n  readonly height: number;\n  readonly left: number;\n  readonly top: number;\n  readonly x2: number;\n  readonly y2: number;\n\n  constructor(x: number, y: number, width: number, height: number) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n    this.x2 = x + width;\n    this.y2 = y + height;\n  }\n\n  getCenter(): Point {\n    return new Point(this.x + (this.width / 2) | 0, this.y + (this.height / 2) | 0);\n  }\n\n  intersects(other: Rect): boolean {\n    return this.x <= other.x2 && this.x2 >= other.x && this.y <= other.y2 && this.y2 >= other.y;\n  }\n\n  contains(point: Point | Rect): boolean {\n    return point.x >= this.x && point.x < this.x2 && point.y >= this.y && point.y < this.y2;\n  }\n}\n","\nimport { Rect } from './rect';\nimport { Input } from './input';\nimport { Terminal } from './terminal';\n\nexport class Mouse {\n  readonly el: HTMLCanvasElement;\n  readonly width: number;\n  readonly height: number;\n  private prevX: number;\n  private prevY: number;\n  x: number;\n  y: number;\n  dx: number;\n  dy: number;\n  readonly buttons: Input[];\n\n  constructor(terminal: Terminal) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.buttons = [new Input(), new Input(), new Input()];\n\n    const el = this.el;\n    el.addEventListener('mousedown', e => this.handleEvent(e));\n    el.addEventListener('mouseup', e => this.handleEvent(e));\n    el.addEventListener('mousemove', e => this.handleEvent(e));\n    el.addEventListener('contextmenu', e => this.handleEvent(e));\n\n    const touchEventHandler = this.handleTouchEvent.bind(this);\n    el.addEventListener('touchstart', touchEventHandler);\n    el.addEventListener('touchend', touchEventHandler);\n    el.addEventListener('touchcancel', touchEventHandler);\n    el.addEventListener('touchmove', touchEventHandler);\n  }\n\n  private handleTouchEvent(e: TouchEvent): void {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons[0].setDown(true);\n    } else {\n      this.buttons[0].setDown(false);\n    }\n  }\n\n  private handleEvent(e: MouseEvent): void {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons[e.button].setDown(true);\n      this.el.focus();\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons[e.button].setDown(false);\n    }\n  }\n\n  private updatePosition(clientX: number, clientY: number): void {\n    let rect: Rect | DOMRect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new Rect(Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new Rect(0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = (this.width * (clientX - rect.left) / rect.width) | 0;\n    this.y = (this.height * (clientY - rect.top) / rect.height) | 0;\n  }\n\n  update(time: number): void {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n\n    for (let i = 0; i < this.buttons.length; i++) {\n      this.buttons[i].update(time);\n    }\n  }\n}","import { Console } from \"./console\";\nimport { Cell } from \"./cell\";\nimport { DEFAULT_FONT, Font } from \"./font\";\nimport { Keyboard, Keys } from \"./keys\";\nimport { Mouse } from \"./mouse\";\nimport { FRAGMENT_SHADER_SOURCE, VERTEX_SHADER_SOURCE } from \"./shaders\";\nimport { Point } from \"./point\";\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i: number, max: number) {\n  return -1.0 + 2.0 * (i / max);\n}\n\ninterface TerminalOptions {\n  font?: Font;\n}\n\nconst DEFAULT_OPTIONS = {\n  font: DEFAULT_FONT,\n};\n\nexport class Terminal extends Console {\n  readonly canvas: HTMLCanvasElement;\n  readonly font: Font;\n  readonly pixelWidth: number;\n  readonly pixelHeight: number;\n  readonly keys: Keyboard;\n  readonly mouse: Mouse;\n  readonly gl: WebGLRenderingContext;\n  readonly program: WebGLProgram;\n  readonly positionAttribLocation: number;\n  readonly textureAttribLocation: number;\n  readonly fgColorAttribLocation: number;\n  readonly bgColorAttribLocation: number;\n  readonly positionsArray: Float32Array;\n  readonly indexArray: Uint16Array;\n  readonly textureArray: Float32Array;\n  readonly foregroundUint8Array: Uint8Array;\n  readonly foregroundDataView: DataView;\n  readonly backgroundUint8Array: Uint8Array;\n  readonly backgroundDataView: DataView;\n  readonly positionBuffer: WebGLBuffer;\n  readonly indexBuffer: WebGLBuffer;\n  readonly textureBuffer: WebGLBuffer;\n  readonly foregroundBuffer: WebGLBuffer;\n  readonly backgroundBuffer: WebGLBuffer;\n  readonly texture: WebGLTexture;\n  private lastRenderTime: number;\n  private renderDelta: number;\n  fps: number;\n  averageFps: number;\n  update?: () => void;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    width: number,\n    height: number,\n    options?: TerminalOptions\n  ) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || DEFAULT_FONT;\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n\n    canvas.width = this.pixelWidth;\n    canvas.height = this.pixelHeight;\n    canvas.style.imageRendering = \"pixelated\";\n    canvas.style.outline = \"none\";\n    canvas.tabIndex = 0;\n    this.handleResize();\n    window.addEventListener(\"resize\", () => this.handleResize());\n\n    this.keys = new Keyboard(canvas);\n    this.mouse = new Mouse(this);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext(\"webgl2\", { antialias: false });\n    if (!gl) {\n      throw new Error(\n        \"Unable to initialize WebGL. Your browser may not support it.\"\n      );\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error(\n        \"Unable to initialize WebGL. Your browser may not support it.\"\n      );\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(\n      program,\n      this.buildShader(gl.VERTEX_SHADER, VERTEX_SHADER_SOURCE)\n    );\n    gl.attachShader(\n      program,\n      this.buildShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER_SOURCE)\n    );\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (this.font.graphical) {\n      // Set the flag to ignore foreground/background colors, and use texture\n      // directly\n      gl.uniform1i(gl.getUniformLocation(program, \"h\"), 1);\n    }\n\n    this.positionAttribLocation = this.getAttribLocation(\"a\");\n    this.textureAttribLocation = this.getAttribLocation(\"b\");\n    this.fgColorAttribLocation = this.getAttribLocation(\"c\");\n    this.bgColorAttribLocation = this.getAttribLocation(\"d\");\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer() as WebGLBuffer;\n    this.indexBuffer = gl.createBuffer() as WebGLBuffer;\n    this.textureBuffer = gl.createBuffer() as WebGLBuffer;\n    this.foregroundBuffer = gl.createBuffer() as WebGLBuffer;\n    this.backgroundBuffer = gl.createBuffer() as WebGLBuffer;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url);\n\n    this.lastRenderTime = 0;\n    this.renderDelta = 0;\n    this.fps = 0;\n    this.averageFps = 0;\n\n    this.requestAnimationFrame();\n  }\n\n  private handleResize() {\n    const parent = this.canvas.parentElement;\n    if (!parent) {\n      return;\n    }\n    const widthFactor = parent.offsetWidth / this.pixelWidth;\n    const heightFactor = parent.offsetHeight / this.pixelHeight;\n    const factor = Math.min(widthFactor, heightFactor);\n    const width = (factor * this.pixelWidth) | 0;\n    const height = (factor * this.pixelHeight) | 0;\n    this.canvas.style.width = width + \"px\";\n    this.canvas.style.height = height + \"px\";\n  }\n\n  private getAttribLocation(name: string) {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  private flush() {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y) as Cell;\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = cell.charCode % 16;\n        const textureY = (cell.charCode / 16) | 0;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(keyCode: number): boolean {\n    const key = this.keys.getKey(keyCode);\n    return !!key && key.down;\n  }\n\n  isKeyPressed(keyCode: number): boolean {\n    const key = this.keys.getKey(keyCode);\n    return !!key && key.isPressed();\n  }\n\n  getKeyDownCount(keyCode: number): number {\n    const key = this.keys.getKey(keyCode);\n    return key ? key.downCount : 0;\n  }\n\n  /**\n   * Returns a standard roguelike movement key if pressed.\n   * Implemented control systems:\n   * 1) Numpad arrows\n   * 2) VIM keys\n   * 3) Normal arrows (4 directions only)\n   * 4) Numpad 5 and '.' (period) for \"wait\"\n   * If a key is pressed, returns the movement delta.\n   * If no key is pressed, returns undefined.\n   * See: http://www.roguebasin.com/index.php?title=Preferred_Key_Controls\n   */\n  getMovementKey(): Point | undefined {\n    if (this.isKeyPressed(Keys.VK_NUMPAD1) || this.isKeyPressed(Keys.VK_B)) {\n      return new Point(-1, 1);\n    }\n    if (\n      this.isKeyPressed(Keys.VK_NUMPAD2) ||\n      this.isKeyPressed(Keys.VK_J) ||\n      this.isKeyPressed(Keys.VK_DOWN)\n    ) {\n      return new Point(0, 1);\n    }\n    if (this.isKeyPressed(Keys.VK_NUMPAD3) || this.isKeyPressed(Keys.VK_N)) {\n      return new Point(1, 1);\n    }\n    if (\n      this.isKeyPressed(Keys.VK_NUMPAD4) ||\n      this.isKeyPressed(Keys.VK_H) ||\n      this.isKeyPressed(Keys.VK_LEFT)\n    ) {\n      return new Point(-1, 0);\n    }\n    if (\n      this.isKeyPressed(Keys.VK_NUMPAD5) ||\n      this.isKeyPressed(Keys.VK_PERIOD)\n    ) {\n      return new Point(0, 0);\n    }\n    if (\n      this.isKeyPressed(Keys.VK_NUMPAD6) ||\n      this.isKeyPressed(Keys.VK_L) ||\n      this.isKeyPressed(Keys.VK_RIGHT)\n    ) {\n      return new Point(1, 0);\n    }\n    if (this.isKeyPressed(Keys.VK_NUMPAD7) || this.isKeyPressed(Keys.VK_Y)) {\n      return new Point(-1, -1);\n    }\n    if (\n      this.isKeyPressed(Keys.VK_NUMPAD8) ||\n      this.isKeyPressed(Keys.VK_K) ||\n      this.isKeyPressed(Keys.VK_UP)\n    ) {\n      return new Point(0, -1);\n    }\n    if (this.isKeyPressed(Keys.VK_NUMPAD9) || this.isKeyPressed(Keys.VK_U)) {\n      return new Point(1, -1);\n    }\n    return undefined;\n  }\n\n  private buildShader(type: number, source: string) {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error(\"An error occurred compiling the shader: \");\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error(\n        \"An error occurred compiling the shader: \" + gl.getShaderInfoLog(sh)\n      );\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  private loadTexture(url: string) {\n    const gl = this.gl;\n    const texture = gl.createTexture() as WebGLTexture;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]); // opaque black\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      level,\n      internalFormat,\n      width,\n      height,\n      border,\n      srcFormat,\n      srcType,\n      pixel\n    );\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        srcFormat,\n        srcType,\n        image\n      );\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  private render() {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(\n        this.positionAttribLocation,\n        numComponents,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n        this.textureAttribLocation,\n        numComponents,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(\n        gl.ARRAY_BUFFER,\n        this.foregroundUint8Array,\n        gl.DYNAMIC_DRAW\n      );\n      gl.vertexAttribPointer(\n        this.fgColorAttribLocation,\n        numComponents,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(\n        gl.ARRAY_BUFFER,\n        this.backgroundUint8Array,\n        gl.DYNAMIC_DRAW\n      );\n      gl.vertexAttribPointer(\n        this.bgColorAttribLocation,\n        numComponents,\n        type,\n        normalize,\n        stride,\n        offset\n      );\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  private requestAnimationFrame() {\n    window.requestAnimationFrame((t) => this.renderLoop(t));\n  }\n\n  private renderLoop(time: number) {\n    if (this.lastRenderTime === 0) {\n      this.lastRenderTime = time;\n      this.fps = 0;\n    } else {\n      this.renderDelta = time - this.lastRenderTime;\n      this.lastRenderTime = time;\n      this.fps = 1000.0 / this.renderDelta;\n      this.averageFps = 0.95 * this.averageFps + 0.05 * this.fps;\n    }\n\n    this.keys.updateKeys(time);\n    this.mouse.update(time);\n    if (this.update) {\n      this.update();\n    }\n    this.flush();\n    this.render();\n    this.requestAnimationFrame();\n  }\n}\n","\nimport { BlendMode } from '../src/blendmode';\nimport { fromHsv } from '../src/color';\nimport { Colors } from '../src/colors';\nimport { Console } from '../src/console';\nimport { RNG } from '../src/rng';\nimport { Terminal } from '../src/terminal';\n\nconst SCREEN_WIDTH = 80;\nconst SCREEN_HEIGHT = 45;\n\nconst RADIUS = 30;\nconst SIZE = 1 + 2 * RADIUS;\nconst CENTER = RADIUS;\nconst BRIGHTNESS = 0.35;\n\nfunction createLightConsole(h: number, s: number, v: number) {\n  const c = new Console(SIZE, SIZE);\n\n  for (let y = 0; y < SIZE; y++) {\n    for (let x = 0; x < SIZE; x++) {\n      const distance = Math.hypot(x - CENTER, y - CENTER);\n      const inverseDistance = Math.max(0.0, Math.min(1.0, 1.0 - distance / RADIUS));\n      const alpha = BRIGHTNESS * inverseDistance * inverseDistance;\n      const bg = fromHsv(h, s, v, alpha);\n      c.drawChar(x, y, 0, 0, bg);\n    }\n  }\n\n  c.drawChar(CENTER, CENTER, '*'.charCodeAt(0), fromHsv(h, s, v));\n  return c;\n}\n\nconst term = new Terminal(\n  document.querySelector('canvas') as HTMLCanvasElement,\n  SCREEN_WIDTH,\n  SCREEN_HEIGHT);\n\nconst rng = new RNG();\n\nconst lights = [{\n  x: 10,\n  y: 10,\n  console: createLightConsole(0.0, 0.0, 1.0)\n}];\n\nfor (let i = 0; i < 6; i++) {\n  lights.push({\n    x: 15 + i * 10,\n    y: 22,\n    console: createLightConsole(i / 6.0, 1.0, 1.0)\n  });\n}\n\ninterface Raindrop {\n  x: number,\n  y: number,\n  speed: number\n}\n\nconst rain: Raindrop[] = [];\n\nfor (let i = 0; i < 500; i++) {\n  rain.push({\n    x: rng.nextRange(0, SCREEN_WIDTH * 2),\n    y: rng.nextRange(-SCREEN_HEIGHT, SCREEN_HEIGHT),\n    speed: rng.nextRange(5, 10) / 5.0\n  });\n}\n\nterm.update = function () {\n  const moveKey = term.getMovementKey();\n  if (moveKey) {\n    lights[0].x += moveKey.x;\n    lights[0].y += moveKey.y;\n  }\n  if (term.mouse.dx !== 0 || term.mouse.dy !== 0) {\n    lights[0].x = term.mouse.x;\n    lights[0].y = term.mouse.y;\n  }\n\n  term.fillRect(0, 0, 80, 45, 0, Colors.BLACK, Colors.BLACK);\n\n  for (let i = 0; i < rain.length; i++) {\n    const raindrop = rain[i];\n    term.drawString(Math.round(raindrop.x), Math.round(raindrop.y), '/', Colors.DARK_GRAY);\n    raindrop.x -= raindrop.speed;\n    raindrop.y += raindrop.speed;\n    if (raindrop.x < 0 || raindrop.y > SCREEN_HEIGHT) {\n      raindrop.x += SCREEN_WIDTH;\n      raindrop.y -= SCREEN_WIDTH;\n    }\n  }\n\n  for (let i = lights.length - 1; i >= 0; i--) {\n    const light = lights[i];\n    term.drawConsole(\n      light.x - RADIUS,\n      light.y - RADIUS,\n      light.console,\n      0,\n      0,\n      SIZE,\n      SIZE,\n      BlendMode.Add);\n  }\n\n  term.drawString(1, 1, 'Hello world!', Colors.YELLOW);\n  term.drawString(1, 3, 'Use arrow keys to move', Colors.YELLOW);\n};\n","/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nexport const VERTEX_SHADER_SOURCE =\n  '#version 300 es\\n' +\n  'precision highp float;' +\n  'in vec2 a;' +\n  'in vec2 b;' +\n  'in vec3 c;' +\n  'in vec3 d;' +\n  'out vec2 e;' +\n  'out vec4 f;' +\n  'out vec4 g;' +\n  'void main(void){' +\n  'gl_Position=vec4(a.x,a.y,0,1);' +\n  'e=b/16.0;' +\n  'f=vec4(c.r,c.g,c.b,1);' +\n  'g=vec4(d.r,d.g,d.b,1);' +\n  '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * h = uniform bool uGraphicalTiles;\n * s = uniform sampler2D uSampler;\n * o = out vec4 oColor;\n */\nexport const FRAGMENT_SHADER_SOURCE =\n  '#version 300 es\\n' +\n  'precision highp float;' +\n  'in vec2 e;' +\n  'in vec4 f;' +\n  'in vec4 g;' +\n  'uniform bool h;' +\n  'uniform sampler2D s;' +\n  'out vec4 o;' +\n  'void main(void){' +\n  'o=texture(s,e);' +\n  'if(h){' +\n  // Using graphical tiles\n  'if(o.a<0.1){' +\n  // The current pixel of the foreground sprite is transparent.\n  // Draw the background tile instead.\n  // Use the background red channel for the tile X coordinate.\n  // Use the background green channel for the tile Y coordinate.\n  // Use the fractional component of the texture coord for the pixel offset.\n  'o=texture(s,g.rg*16.0+fract(e*16.0)/16.0);' +\n  '}' +\n  '}else{' +\n  // Using ASCII characters\n  'if(o.r<0.1) {' +\n  // Black background, so use bgColor\n  'o=g;' +\n  '} else {' +\n  // White background, so use fgColor\n  'o=f;' +\n  '}' +\n  '}' +\n  '}';\n","\n/**\n * Random number generator.\n *\n * LCG\n * https://stackoverflow.com/a/424445/2051724\n */\nexport class RNG {\n  private m: number;\n  private a: number;\n  private c: number;\n  private state: number;\n\n  /**\n   * Creates a new random number generator.\n   *\n   * @param seed The integer seed.\n   */\n  constructor(seed?: number) {\n    // LCG using GCC's constants\n    this.m = 0x80000000;  // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n    this.state = seed || 1;\n  }\n\n  nextInt(): number {\n    this.state = (this.a * this.state + this.c) % this.m;\n    return this.state;\n  }\n\n  /**\n   * Returns a floating point number between 0.0 and 1.0.\n   */\n  nextFloat(): number {\n    // returns in range [0,1]\n    return this.nextInt() / (this.m - 1);\n  }\n\n  /**\n   * Returns an integer in the range start (inclusive) to end (exclusive).\n   * @param start Lower bound, inclusive.\n   * @param end Upper bound, exclusive.\n   */\n  nextRange(start: number, end: number): number {\n    // returns in range [start, end): including start, excluding end\n    // can't modulu nextInt because of weak randomness in lower bits\n    const rangeSize = end - start;\n    const randomUnder1 = this.nextInt() / this.m;\n    const result = start + ((randomUnder1 * rangeSize) | 0);\n    if (isNaN(result)) {\n      throw new Error('rand nan');\n    }\n    return result;\n  }\n\n  chooseIndex(chances: number[]): number {\n    const total = chances.reduce((a, b) => a + b);\n    const roll = this.nextRange(1, total + 1);\n    let runningTotal = 0;\n\n    for (let i = 0; i < chances.length; i++) {\n      runningTotal += chances[i];\n      if (roll <= runningTotal) {\n        return i;\n      }\n    }\n\n    return chances.length - 1;\n  }\n\n  chooseKey(chancesMap: Record<string, number>): string {\n    const values = Object.keys(chancesMap);\n    const chances = values.map(value => chancesMap[value]);\n    return values[this.chooseIndex(chances)];\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","globalThis","__webpack_require__","Symbol","toStringTag","Object","defineProperty","value","BlendMode","fromRgb","r","g","b","a","undefined","fromHsv","h","s","v","i","f","p","q","t","Colors","BLACK","WHITE","LIGHT_GRAY","DARK_GRAY","YELLOW","BROWN","LIGHT_RED","DARK_RED","LIGHT_GREEN","DARK_GREEN","LIGHT_CYAN","DARK_CYAN","LIGHT_BLUE","DARK_BLUE","LIGHT_MAGENTA","DARK_MAGENTA","ORANGE","Cell","constructor","x","y","charCode","fg","bg","this","length","charCodeAt","convertCharCode","dirty","blocked","blockedSight","explored","visible","pathId","prev","setCharCode","setForeground","setBackground","setValue","drawCell","None","otherCell","blendMode","alpha","blendColors","c1","c2","w1","w2","r1","g1","b1","r2","g2","b2","Blend","Add","clamp","Math","min","Chars","Console","width","height","blockedFunc","grid","originX","originY","minX","maxX","minY","maxY","radius","row","push","clear","drawChar","getCell","getCharCode","c","drawString","str","lines","split","line","j","drawCenteredString","floor","drawHLine","xi","drawVLine","yi","drawRect","drawBox","topChar","rightChar","bottomChar","leftChar","topLeftChar","topRightChar","bottomRightChar","bottomLeftChar","fillRect","drawSingleBox","BOX_SINGLE_HORIZONTAL","BOX_SINGLE_VERTICAL","BOX_SINGLE_DOWN_AND_SINGLE_RIGHT","BOX_SINGLE_DOWN_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_LEFT","BOX_SINGLE_UP_AND_SINGLE_RIGHT","drawDoubleBox","BOX_DOUBLE_HORIZONTAL","BOX_DOUBLE_VERTICAL","BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT","BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_LEFT","BOX_DOUBLE_UP_AND_DOUBLE_RIGHT","drawConsole","dstX","dstY","srcConsole","srcX","srcY","srcWidth","srcHeight","cell","setBlocked","setBlockedSight","isVisible","isBlocked","isBlockedSight","computeOctantY","deltaX","deltaY","startSlopes","endSlopes","halfSlope","processedCell","extended","centreSlope","startSlope","endSlope","previousEndSlope","iteration","totalObstacles","obstaclesInLastLine","minSlope","idx","max","computeOctantX","computeFov","opt_noClear","opt_octants","updateExplored","tile","DEFAULT_FONT","url","charWidth","charHeight","scale","graphical","Input","down","downTime","repeat","repeatTime","downCount","upCount","setDown","performance","now","update","time","isPressed","isClicked","KEY_COUNT","Keyboard","el","keys","Array","addEventListener","e","setKey","state","keyCode","Keys","VK_F11","stopPropagation","preventDefault","updateKeys","getKey","Point","Rect","left","top","x2","y2","getCenter","intersects","other","contains","point","Mouse","terminal","canvas","prevX","prevY","dx","dy","buttons","handleEvent","touchEventHandler","handleTouchEvent","bind","touches","touch","updatePosition","clientX","clientY","type","button","focus","rect","getBoundingClientRect","terminalAspectRatio","rectAspectRatio","actualWidth","excess","actualHeight","interpolate","DEFAULT_OPTIONS","font","SIZE","createLightConsole","distance","hypot","inverseDistance","term","options","super","pixelWidth","pixelHeight","style","imageRendering","outline","tabIndex","handleResize","window","mouse","gl","getContext","antialias","Error","program","createProgram","attachShader","buildShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","useProgram","uniform1i","getUniformLocation","positionAttribLocation","getAttribLocation","textureAttribLocation","fgColorAttribLocation","bgColorAttribLocation","cellCount","positionsArray","Float32Array","indexArray","Uint16Array","textureArray","foregroundUint8Array","Uint8Array","foregroundDataView","DataView","buffer","backgroundUint8Array","backgroundDataView","k","positionBuffer","createBuffer","indexBuffer","textureBuffer","foregroundBuffer","backgroundBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","texture","loadTexture","lastRenderTime","renderDelta","fps","averageFps","requestAnimationFrame","parent","parentElement","widthFactor","offsetWidth","heightFactor","offsetHeight","factor","name","location","enableVertexAttribArray","flush","textureArrayIndex","colorArrayIndex","textureX","textureY","setUint32","isKeyDown","key","isKeyPressed","getKeyDownCount","getMovementKey","VK_NUMPAD1","VK_B","VK_NUMPAD2","VK_J","VK_DOWN","VK_NUMPAD3","VK_N","VK_NUMPAD4","VK_H","VK_LEFT","VK_NUMPAD5","VK_PERIOD","VK_NUMPAD6","VK_L","VK_RIGHT","VK_NUMPAD7","VK_Y","VK_NUMPAD8","VK_K","VK_UP","VK_NUMPAD9","VK_U","source","sh","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createTexture","bindTexture","TEXTURE_2D","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","pixel","texImage2D","image","Image","onload","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","src","render","clearColor","clearDepth","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","viewport","numComponents","FLOAT","normalize","stride","offset","vertexAttribPointer","DYNAMIC_DRAW","activeTexture","TEXTURE0","vertexCount","UNSIGNED_SHORT","drawElements","TRIANGLES","renderLoop","document","querySelector","rng","seed","m","nextInt","nextFloat","nextRange","start","end","rangeSize","result","isNaN","chooseIndex","chances","total","reduce","roll","runningTotal","chooseKey","chancesMap","values","map","lights","console","rain","SCREEN_WIDTH","speed","moveKey","raindrop","round","light"],"sourceRoot":""}