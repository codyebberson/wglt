!function(t,s){if("object"===typeof exports&&"object"===typeof module)module.t=s();else if("function"===typeof define&&define.amd)define([],s);else{var i=s();for(var e in i)("object"===typeof exports?exports:t)[e]=i[e]}}(window,(function(){return function(t){var s={};function i(e){if(s[e])return s[e].t;var h=s[e]={s:e,i:!1,t:{}};return t[e].call(h.t,h,h.t,i),h.i=!0,h.t}return i.h=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{l:!0,get:e})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"_",{value:!0})},i.u=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t._)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{l:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t._?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.K="",i(i.A=0)}([function(t,s,i){"use strict";function e(t,s,i,e){return void 0===e&&(e=255),(t<<24)+(s<<16)+(i<<8)+e}i.r(s);const h={V:e(0,0,0),O:e(255,255,255),L:e(170,170,170),N:e(85,85,85),T:e(255,255,85),g:e(170,85,0),D:e(255,85,85),C:e(170,0,0),I:e(85,255,85),B:e(0,170,0),M:e(85,255,255),R:e(0,170,170),U:e(85,85,255),S:e(0,0,170),p:e(255,85,255),v:e(170,0,170),m:e(255,136,0)};class n{constructor(t,s){this.x=t,this.y=s}}class o{constructor(t,s,i,e){this.x=this.left=t,this.y=this.top=s,this.width=i,this.height=e,this.x2=t+i,this.y2=s+e}G(){return new n(this.x+this.width/2|0,this.y+this.height/2|0)}P(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.y<this.x2&&t.y>=this.y&&t.y<this.y2}}class r{constructor(t,s,i){this.F=t,this.rect=s,this.H=i,this.open=!1,this.count=0}}class c{k(t,s){const i=s.Y.width+4,e=s.Y.height+4,h=(t.width-i)/2|0,c=(t.height-e)/2|0;return new r(s,new o(h,c,i,e),new n(h+2,c+2))}X(t,s){const i=s.F,{x:e,y:n,width:o,height:r}=s.rect;t.fillRect(e,n,o,r,0,h.O,h.V),t.W(e,n,o,r),t.J(e+o/2|0,n," "+i.title+" "),i.j(t,s.H)}}class l{constructor(){this.Z=!1,this.q=0,this.$=0}update(){this.Z?(this.q++,this.$=0):(this.q=0,this.$++)}tt(){const t=this.q;return 1===t||t>6&&t%1===0}st(){return 1===this.$}}class _{constructor(t){this.keys=new Array(256);for(let t=0;t<256;t++)this.keys[t]=new l;t.addEventListener("keydown",t=>this.it(t,!0)),t.addEventListener("keyup",t=>this.it(t,!1))}it(t,s){const i=t.keyCode;i!==u.et&&(t.stopPropagation(),t.preventDefault(),i>=0&&i<256&&(this.keys[i].Z=s))}ht(){for(let t=0;t<256;t++)this.keys[t].update()}getKey(t){return t>=0&&t<256?this.keys[t]:null}}const u={nt:3,ot:6,rt:8,ct:9,lt:12,_t:13,ut:16,at:17,ft:18,Kt:19,At:20,Et:27,Vt:32,Ot:33,dt:34,Lt:35,Nt:36,wt:37,Tt:38,gt:39,Dt:40,Ct:44,It:45,Bt:46,Mt:48,Rt:49,Ut:50,St:51,pt:52,vt:53,Gt:54,bt:55,yt:56,Pt:57,Ft:58,Ht:59,xt:60,kt:61,Yt:62,Xt:63,Wt:64,Qt:65,zt:66,Jt:67,jt:68,Zt:69,qt:70,$t:71,ts:72,ss:73,es:74,hs:75,ns:76,os:77,rs:78,cs:79,ls:80,_s:81,us:82,as:83,fs:84,Ks:85,As:86,Es:87,Vs:88,Os:89,ds:90,Ls:93,Ns:96,ws:97,Ts:98,gs:99,Ds:100,Cs:101,Is:102,Bs:103,Ms:104,Rs:105,Us:106,Ss:107,ps:108,vs:109,ms:110,Gs:111,bs:112,ys:113,Ps:114,Fs:115,Hs:116,xs:117,ks:118,Ys:119,Xs:120,Ws:121,et:122,Qs:123,zs:124,Js:125,js:126,Zs:127,qs:128,$s:129,ti:130,si:131,ii:132,ei:133,hi:134,ni:135,oi:144,ri:145,ci:160,li:161,_i:162,ui:163,ai:164,fi:165,Ki:166,Ai:167,Ei:168,Vi:169,Oi:170,di:171,Li:172,Ni:173,wi:174,Ti:175,gi:176,Di:188,Ci:190,Ii:191,Bi:192,Mi:219,Ri:220,Ui:221,Si:222,pi:224,vi:225,mi:91,Gi:21,bi:21,yi:22,Pi:23,Fi:24,Hi:25,xi:25,ki:28,Yi:29,Xi:30,Wi:31,Qi:41,zi:42,Ji:43,ji:95},a={Zi:1,qi:2,$i:3,te:4,se:5,ie:6,ee:7,he:8,ne:176,oe:177,re:178,ce:179,le:180,_e:185,ue:186,ae:187,fe:188,Ke:191,Ae:192,Ee:193,Ve:194,Oe:195,de:196,Le:197,Ne:200,we:201,Te:202,ge:203,De:204,Ce:205,Ie:206,Be:217,Me:218,Re:219,Ue:220,Se:221,pe:222,ve:223},f=0,K=1,A=2;class E{constructor(t,s,i,e){this.charCode=void 0!==t?function(t){return"string"===typeof t&&t.length>0?t.charCodeAt(0):t}(t):" ".charCodeAt(0),this.me=void 0!==s?s:h.O,this.Ge=void 0!==i?i:h.V,void 0!==e&&(this.be=e),this.ye=!0}Pe(t){this.charCode!==t&&(this.charCode=t,this.ye=!0)}Fe(t){void 0!==t&&null!==t&&t!==this.me&&(this.me=t,this.ye=!0)}He(t){void 0!==t&&null!==t&&t!==this.Ge&&(this.Ge=t,this.ye=!0)}xe(t){void 0!==t&&(this.be=t,this.ye=!0)}ke(t,s,i,e){return"string"===typeof t&&(t=t.charCodeAt(0)),"number"===typeof t?(this.Pe(t),this.Fe(s),this.He(i),this.xe(e)):this.Ye(t,f),this.ye}Ye(t,s){const i=255&t.Ge;s===f||t.charCode>0?(this.Pe(t.charCode),this.Fe(t.me)):i>0&&i<255&&this.Fe(this.Xe(this.me,t.Ge,s)),s===f||255===i?this.He(t.Ge):i>0&&this.He(this.Xe(this.Ge,t.Ge,s)),this.xe(t.be)}Xe(t,s,i){const h=(255-(255&s))/255,n=1-h,o=t>>24&255,r=t>>16&255,c=t>>8&255,l=s>>24&255,_=s>>16&255,u=s>>8&255;switch(i){case K:return e(h*o+n*l|0,h*r+n*_|0,h*c+n*u|0);case A:return e(this.We(o+n*l|0),this.We(r+n*_|0),this.We(c+n*u|0));default:return s}}We(t){return Math.min(255,t)}}class V{constructor(t,s,i){this.width=t,this.height=s,this.Qe=new Array;const e=i||E;for(let i=0;i<s;i++){const s=new Array;for(let h=0;h<t;h++)s.push(new e(h,i));this.Qe.push(s)}this.clear()}clear(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)this.ze(s,t,0)}Je(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.Qe[s][t]}je(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.Qe[s][t].charCode}ze(t,s,i,e,h){t>=0&&t<this.width&&s>=0&&s<this.height&&this.Qe[s][t].ke(i,e,h)}Ze(t,s,i,e,h){const n=i.split("\n");for(let i=0;i<n.length;i++){const o=n[i];for(let n=0;n<o.length;n++)this.ze(t+n,s+i,o.charCodeAt(n),e,h)}}J(t,s,i,e,h){this.Ze(t-Math.floor(i.length/2),s,i,e,h)}qe(t,s,i,e,h,n){for(let o=t;o<t+i;o++)this.ze(o,s,e,h,n)}$e(t,s,i,e,h,n){for(let o=s;o<s+i;o++)this.ze(t,o,e,h,n)}th(t,s,i,e,h,n,o){this.qe(t,s,i,h,n,o),this.qe(t,s+e-1,i,h,n,o),this.$e(t,s,e,h,n,o),this.$e(t+i-1,s,e,h,n,o)}sh(t,s,i,e,h,n,o,r,c,l,_,u,a,f){this.fillRect(t,s,i,e,0,a,f),this.qe(t,s,i,h),this.qe(t,s+e-1,i,o),this.$e(t,s,e,r),this.$e(t+i-1,s,e,n),this.ze(t,s,c),this.ze(t+i-1,s,l),this.ze(t,s+e-1,u),this.ze(t+i-1,s+e-1,_)}W(t,s,i,e,h,n){this.sh(t,s,i,e,a.de,a.ce,a.de,a.ce,a.Me,a.Ke,a.Be,a.Ae,h,n)}ih(t,s,i,e,h,n){this.sh(t,s,i,e,a.Ce,a.ue,a.Ce,a.ue,a.we,a.ae,a.fe,a.Ne,h,n)}fillRect(t,s,i,e,h,n,o){for(let r=s;r<s+e;r++)this.qe(t,r,i,h,n,o)}eh(t,s,i,e,h,n,o,r){r=r||f;for(let c=0;c<o;c++)for(let o=0;o<n;o++){const n=i.Je(e+o,h+c);n&&this.Ye(t+o,s+c,n,r)}}Ye(t,s,i,e){t>=0&&t<this.width&&s>=0&&s<this.height&&this.Qe[s][t].Ye(i,e)}}const O=[{charCode:a.ve,active:[1,1,0,0]},{charCode:a.pe,active:[0,1,0,1]}];function d(t){const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const i=s.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data}function L(t,s,i,e,h){const n=4*(e*h+i),o=4*(e*h+i+1),r=4*((e+1)*h+i),c=4*((e+1)*h+i+1),l=[[s[n],s[n+1],s[n+2]],[s[o],s[o+1],s[o+2]],[s[r],s[r+1],s[r+2]],[s[c],s[c+1],s[c+2]]];let _=Number.MAX_VALUE,u=0,a=null,f=null;for(let t=0;t<O.length;t++){const s=O[t],i=N(s.active,l);i.error<_&&(_=i.error,u=s.charCode,a=i.Ge,f=i.me)}t.ze(i/2,e/2,u,w(f),w(a))}function N(t,s){const i=[[0,0,0],[0,0,0]],e=[[0,0,0],[0,0,0]],h=[0,0];for(let e=0;e<4;e++){for(let h=0;h<3;h++)i[t[e]][h]+=s[e][h];h[t[e]]++}for(let t=0;t<2;t++)for(let s=0;s<3;s++)e[t][s]=i[t][s]/h[t];let n=0;for(let i=0;i<4;i++){let h=0;for(let n=0;n<3;n++){const o=s[i][n]-e[t[i]][n];h+=o*o}n+=Math.sqrt(h)}return{Ge:e[0],me:e[1],error:n}}function w(t){return e(t[0],t[1],t[2])}class T{constructor(t,s){this.Y=t,this.title=s}j(t,s){}hh(t,s){}}class g extends T{constructor(t,s){const i=s.split("\n");let e=t.length;for(let t=0;t<i.length;t++)e=Math.max(e,i[t].length);const h=i.length;super(new o(0,0,e,h),t),this.nh=i}j(t,s){for(let i=0;i<this.nh.length;i++)t.Ze(s.x,s.y+i,this.nh[i])}hh(t,s){return t.oh(u.Et)}}class D{constructor(t){this.h=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}rh(){return this.state=(this.a*this.state+this.c)%this.h,this.state}lh(){return this.rh()/(this.h-1)}_h(t,s){const i=s-t,e=t+(this.rh()/this.h*i|0);if(isNaN(e))throw new Error("rand nan");return e}uh(t){const s=t.reduce((t,s)=>t+s),i=this._h(1,s+1);let e=0;for(let s=0;s<t.length;s++)if(e+=t[s],i<=e)return s;return t.length-1}ah(t){const s=[],i=[];for(const e in t)t.hasOwnProperty(e)&&(s.push(e),i.push(t[e]));return s[this.uh(i)]}}class C extends T{constructor(t,s,i){let e=t.length;for(let t=0;t<s.length;t++)e=Math.max(e,s[t].length+4);const h=s.length;super(new o(0,0,e,h),t),this.options=s,this.fh=i}j(t,s){for(let i=0;i<this.options.length;i++){const e=String.fromCharCode(65+i)+" - "+this.options[i];t.Ze(s.x,s.y+i,e)}}hh(t,s){for(let s=0;s<this.options.length;s++)if(t.oh(u.Qt+s))return this.fh(s),!0;return t.oh(u.Et)}}const I=new class{constructor(t,s,i,e,h){this.url=t,this.Kh=s,this.Ah=i,this.scale=e||1,this.Eh=!!h}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);class B{constructor(t,s){this.Vh=t.canvas,this.width=t.width,this.height=t.height,this.options=s,this.Oh=0,this.dh=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.buttons=[new l,new l,new l];const i=this.Vh;i.addEventListener("mousedown",t=>this.Lh(t)),i.addEventListener("mouseup",t=>this.Lh(t)),i.addEventListener("mousemove",t=>this.Lh(t)),i.addEventListener("contextmenu",t=>this.Lh(t));const e=this.Nh.bind(this);i.addEventListener("touchstart",e),i.addEventListener("touchend",e),i.addEventListener("touchcancel",e),i.addEventListener("touchmove",e)}Nh(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type&&this.options.requestFullscreen&&this.requestFullscreen(),t.touches.length>0){const s=t.touches[0];this.wh(s.clientX,s.clientY),this.buttons[0].Z=!0}else this.buttons[0].Z=!1}Lh(t){t.stopPropagation(),t.preventDefault(),this.wh(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons[t.button].Z=!0,this.Vh.focus(),this.options.requestFullscreen&&this.requestFullscreen()),"mouseup"===t.type&&(this.buttons[t.button].Z=!1)}wh(t,s){let i=this.Vh.getBoundingClientRect();const e=this.width/this.height,h=i.width/i.height;if(h-e>.01){const t=e*i.height,s=i.width-t;i=new o(Math.floor(s/2),0,t,i.height)}if(h-e<-.01){const t=i.width/e,s=i.height-t;i=new o(0,Math.floor(s/2),i.width,t)}this.x=this.width*(t-i.left)/i.width|0,this.y=this.height*(s-i.top)/i.height|0}requestFullscreen(){const t=this.Vh;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()}update(){this.dx=this.x-this.Oh,this.dy=this.y-this.dh,this.Oh=this.x,this.dh=this.y;for(let t=0;t<this.buttons.length;t++)this.buttons[t].update()}}function M(t,s){return t/s*2-1}const R={font:I,requestFullscreen:!1};class U extends E{constructor(t,s){super(),this.x=t,this.y=s,this.Th=!1,this.gh=!1,this.Dh=!1,this.visible=!1,this.Ch=-1,this.Ih=0,this.Bh=0,this.Mh=null}}class S extends V{constructor(t,s,i){if(super(t,s,U),this.Rh=0,this.Uh=0,this.Sh=0,this.ph=0,this.vh=0,this.mh=0,this.Gh=0,i)for(let e=0;e<s;e++)for(let s=0;s<t;s++)this.Qe[e][s].Th=this.Qe[e][s].gh=i(s,e)}bh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.Qe[s][t].Th=i)}yh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.Qe[s][t].gh=i)}Ph(t,s){return!(t<this.Sh||t>this.ph||s<this.vh||s>this.mh)&&this.Qe[s][t].visible}Fh(t,s){const i=[],e=[];let h,n,o,r,c,l,_,u,a,f,K=1,A=0,E=0,V=0;for(n=this.Uh+s;n>=this.vh&&n<=this.mh;n+=s,E=A,++K)for(o=.5/K,f=-1,r=Math.floor(V*K+.5),h=this.Rh+r*t;r<=K&&h>=this.Sh&&h<=this.ph;h+=t,++r,f=a){if(c=!0,l=!1,_=r/K,u=f,a=_+o,E>0)if(this.Qe[n-s][h].visible&&!this.Qe[n-s][h].gh||this.Qe[n-s][h-t].visible&&!this.Qe[n-s][h-t].gh){for(let t=0;t<E&&c;++t)if(u<=e[t]&&a>=i[t])if(this.Qe[n][h].gh){if(u>=i[t]&&a<=e[t]){c=!1;break}i[t]=Math.min(i[t],u),e[t]=Math.max(e[t],a),l=!0}else if(_>i[t]&&_<e[t]){c=!1;break}}else c=!1;c&&(this.Qe[n][h].visible=!0,this.Qe[n][h].gh&&(V>=u?V=a:l||(i[A]=u,e[A++]=a)))}}Hh(t,s){const i=[],e=[];let h,n,o,r,c,l,_,u,a,f,K=1,A=0,E=0,V=0;for(h=this.Rh+t;h>=this.Sh&&h<=this.ph;h+=t,E=A,++K)for(o=.5/K,f=-1,r=Math.floor(V*K+.5),n=this.Uh+r*s;r<=K&&n>=this.vh&&n<=this.mh;n+=s,++r,f=a){if(c=!0,l=!1,_=r/K,u=f,a=_+o,E>0)if(this.Qe[n][h-t].visible&&!this.Qe[n][h-t].gh||this.Qe[n-s][h-t].visible&&!this.Qe[n-s][h-t].gh){for(let t=0;t<E&&c;++t)if(u<=e[t]&&a>=i[t])if(this.Qe[n][h].gh){if(u>=i[t]&&a<=e[t]){c=!1;break}i[t]=Math.min(i[t],u),e[t]=Math.max(e[t],a),l=!0}else if(_>i[t]&&_<e[t]){c=!1;break}}else c=!1;c&&(this.Qe[n][h].visible=!0,this.Qe[n][h].gh&&(V>=u?V=a:l||(i[A]=u,e[A++]=a)))}}xh(t,s,i,e,h){if(this.Rh=t,this.Uh=s,this.Gh=i,e)this.Sh=Math.min(this.Sh,Math.max(0,t-i)),this.vh=Math.min(this.vh,Math.max(0,s-i)),this.ph=Math.max(this.ph,Math.min(this.width-1,t+i)),this.mh=Math.max(this.mh,Math.min(this.height-1,s+i));else{this.Sh=Math.max(0,t-i),this.vh=Math.max(0,s-i),this.ph=Math.min(this.width-1,t+i),this.mh=Math.min(this.height-1,s+i);for(let t=this.vh;t<=this.mh;t++)for(let s=this.Sh;s<=this.ph;s++)this.Qe[t][s].visible=!1}this.Qe[s][t].visible=!0,void 0===h?(this.Fh(1,1),this.Hh(1,1),this.Hh(1,-1),this.Fh(1,-1),this.Fh(-1,-1),this.Hh(-1,-1),this.Hh(-1,1),this.Fh(-1,1)):(1&h&&this.Fh(1,1),2&h&&this.Hh(1,1),4&h&&this.Hh(1,-1),8&h&&this.Fh(1,-1),16&h&&this.Fh(-1,-1),32&h&&this.Hh(-1,-1),64&h&&this.Hh(-1,1),128&h&&this.Fh(-1,1))}kh(){for(let t=this.vh;t<=this.mh;t++)for(let s=this.Sh;s<=this.ph;s++){const i=this.Qe[t][s];i.Dh|=i.visible}}}const p=e(0,0,100),v=e(130,110,50),m=e(50,50,150),G=e(200,180,50);class b{constructor(t,s,i,e,h,n,o){if(this.x=t,this.y=s,this.char=i,this.name=e,this.color=h,this.Yh=!!n,o)for(var r in o)o.hasOwnProperty(r)&&(this[r]=o[r],this[r].Xh=this)}move(t,s){(function(t,s){if(Ot.Qe[s][t].Th)return!0;for(let i=0;i<At.length;i++){const e=At[i];if(e.Yh&&e.x===t&&e.y===s)return!0}return!1})(this.x+t,this.y+s)||(this.x+=t,this.y+=s)}Wh(t,s){const i=t-this.x,e=s-this.y,h=Math.hypot(i,e);this.move(Math.round(i/h),Math.round(e/h))}Qh(t){return Math.hypot(t.x-this.x,t.y-this.y)}zh(t,s){return Math.hypot(t-this.x,s-this.y)}Jh(){this.remove(),At.unshift(this)}remove(){At.splice(At.indexOf(this),1)}X(){Ot.Ph(this.x,this.y)&&_t.Ze(this.x,this.y,this.char,this.color)}}class y{constructor(t,s,i,e,h){this.Xh=null,this.jh=t,this.Zh=s,this.qh=i,this.$h=t,this.tn=e,this.sn=h||null}attack(t){const s=this.qh-t.in.Zh;s>0?(z(J(this.Xh.name)+" attacks "+t.name+" for "+s+" hit points."),t.in.en(s)):z(J(this.Xh.name)+" attacks "+t.name+" but it has no effect!")}en(t){this.$h-=t,this.$h<=0&&(this.$h=0,this.sn&&this.sn(this.Xh),this.Xh!==ft&&(ft.in.tn+=this.tn,function(){const t=200+150*ft.level;if(ft.in.tn>=t){ft.level++,ft.in.tn-=t,z("Your battle skills grow stronger! You reached level "+ft.level+"!",h.T);const s=["Constitution (+20 HP, from "+ft.in.jh+")","Strength (+1 attack, from "+ft.in.qh+")","Agility (+1 defense, from "+ft.in.Zh+")"];ut.add(new C("LEVEL UP",s,t=>{0===t?(ft.in.jh+=20,ft.in.$h+=20):1===t?ft.in.qh+=1:2===t&&(ft.in.Zh+=1)}))}}()))}hn(t){this.$h=Math.min(this.$h+t,this.jh)}}class P{constructor(){this.Xh=null}nn(){const t=this.Xh;Ot.Ph(t.x,t.y)&&(t.Qh(ft)>=2?t.Wh(ft.x,ft.y):ft.in.$h>0&&t.in.attack(ft))}}class F{constructor(t){this.Xh=null,this.on=t,this.rn=10}nn(){this.rn>0?(this.Xh.move(at._h(-1,1),at._h(-1,1)),this.rn--):(this.Xh.cn=this.on,z("The "+this.Xh.name+" is no longer confused!",h.D))}}class H{constructor(t){this.ln=t}_n(){Lt.length>=26?z("Your inventory is full, cannot pick up "+this.Xh.name+".",h.D):(Lt.push(this.Xh),this.Xh.remove(),z("You picked up a "+this.Xh.name+"!",h.I))}un(){this.ln?this.ln(this):z("The "+this.Xh.name+" cannot be used.")}remove(){Lt.splice(Lt.indexOf(this.Xh),1)}}function x(t,s){for(let i=s.y+1;i<s.y2;i++)for(let e=s.x+1;e<s.x2;e++)t.Qe[i][e].Th=!1,t.Qe[i][e].gh=!1}function k(t,s,i,e){for(let h=Math.min(s,i);h<=Math.max(s,i);h++)t.Qe[e][h].Th=!1,t.Qe[e][h].gh=!1}function Y(t,s,i,e){for(let h=Math.min(s,i);h<=Math.max(s,i);h++)t.Qe[h][e].Th=!1,t.Qe[h][e].gh=!1}function X(){const t=new S(80,43);for(let s=0;s<43;s++)for(let i=0;i<80;i++)t.Qe[s][i].Th=!0,t.Qe[s][i].gh=!0;const s=[];for(let i=0;i<30;i++){const i=at._h(6,10),e=at._h(6,10),h=at._h(0,80-i-1),n=at._h(0,43-e-1),r=new o(h,n,i,e);let c=!1;for(let t=0;t<s.length;t++)if(r.P(s[t])){c=!0;break}if(!c){x(t,r);const i=r.G();if(0===s.length)ft.x=i.x,ft.y=i.y;else{const e=s[s.length-1].G();1===at._h(0,1)?(k(t,e.x,i.x,e.y),Y(t,e.y,i.y,i.x)):(Y(t,e.y,i.y,e.x),k(t,e.x,i.x,i.y))}W(r),s.push(r)}}const i=s[s.length-1].G();return Kt=new b(i.x,i.y,"<","stairs",h.O),At.push(Kt),Kt.Jh(),t}function W(t){const s=at._h(0,3);for(let i=0;i<s;i++){const s=at._h(t.x+1,t.x2-1),i=at._h(t.y+1,t.y2-1);let e=null;if(at._h(0,100)<80){const t=new y(10,0,3,35,tt),n=new P;e=new b(s,i,"o","orc",h.I,!0,{in:t,cn:n})}else{const t=new y(16,1,4,100,tt),n=new P;e=new b(s,i,"T","troll",h.B,!0,{in:t,cn:n})}At.push(e)}const i=at._h(0,2);for(let s=0;s<i;s++){const s=at._h(t.x+1,t.x2-1),i=at._h(t.y+1,t.y2-1),e=at._h(0,100);let n=null;n=e<50?new b(s,i,"!","healing potion",h.v,!1,{item:new H(it)}):e<70?new b(s,i,"#","scroll of lightning bolt",h.T,!1,{item:new H(et)}):e<85?new b(s,i,"#","scroll of fireball",h.T,!1,{item:new H(ht)}):new b(s,i,"#","scroll of confusion",h.T,!1,{item:new H(nt)}),At.push(n),n.Jh()}}function Q(t,s,i,e,n,o,r,c){const l=Math.round(n/o*i);_t.fillRect(t,s,i,1,0,0,c),l>0&&_t.fillRect(t,s,l,1,0,0,r),_t.J(t+i/2,s,e+": "+n+"/"+o,h.O)}function z(t,s){for(;Et.length>=6;)Et.shift();Et.push({text:t,color:s||h.O})}function J(t){return t?t.charAt(0).toUpperCase()+t.slice(1):t}function j(t,s){const i=ft.x+t,e=ft.y+s;let h=null;for(let t=0;t<At.length;t++){const s=At[t];if(s.in&&s.x===i&&s.y===e){h=s;break}}h?ft.in.attack(h):(ft.move(t,s),dt=!0);for(let t=0;t<At.length;t++){const s=At[t];s.cn&&s.cn.nn()}}function Z(){if(!(ft.in.$h<=0)&&!ut.hh()){if(Nt)return(_t.oh(u._t)||_t.an.buttons[0].st())&&(t=wt.x,s=wt.y,Nt(t,s),rt()),(_t.oh(u.Et)||_t.an.buttons[2].st())&&rt(),_t.oh(u.Tt)&&wt.y--,_t.oh(u.wt)&&wt.x--,_t.oh(u.gt)&&wt.x++,_t.oh(u.Dt)&&wt.y++,void(0===_t.an.dx&&0===_t.an.dy||(wt.x=_t.an.x,wt.y=_t.an.y));var t,s;if(_t.oh(u.Et)&&(Tt="menu"),_t.oh(u.Tt)&&j(0,-1),_t.oh(u.wt)&&j(-1,0),_t.oh(u.gt)&&j(1,0),_t.oh(u.Dt)&&j(0,1),_t.oh(u.$t))for(let t=0;t<At.length;t++){const s=At[t];s.x===ft.x&&s.y===ft.y&&s.item&&s.item._n()}if(_t.oh(u.ss))if(0===Lt.length)ut.add(new g("ALERT","Inventory is empty"));else{const t=Lt.map(t=>t.name);ut.add(new C("INVENTORY",t,q))}if(_t.oh(u.Jt)){const t=200+150*ft.level;ut.add(new g("CHARACTER","Level: "+ft.level+"\nExperience: "+ft.in.tn+"\nExperience to level up: "+t+"\n\nMaximum HP: "+ft.in.jh+"\nAttack: "+ft.in.qh+"\nDefense: "+ft.in.Zh))}_t.oh(u.Di)&&ft.x===Kt.x&&ft.y===Kt.y&&(z("You take a moment to rest, and recover your strength.",h.p),ft.in.hn(ft.in.jh/2),Vt++,z("After a rare moment of peace, you descend deeper...",h.D),At=[ft],Ot=X(),dt=!0)}}function q(t){t>=0&&Lt[t].item.un()}function $(t){z("You died!",h.D)}function tt(t){z(J(t.name)+" is dead! You gain "+t.in.tn+" XP.",h.m),t.char="%",t.color=h.C,t.Yh=!1,t.in=null,t.cn=null,t.name="remains of "+t.name,t.Jh()}function st(t,s,i){let e=i+1,h=null;for(let i=0;i<At.length;i++){const n=At[i];if(n.in&&n!==ft){const i=n.zh(t,s);i<e&&(e=i,h=n)}}return h}function it(t){ft.in.$h!==ft.in.jh?(z("Your wounds start to feel better!",h.p),ft.in.hn(40),t.remove()):z("You are already at full health.",h.C)}function et(t){const s=st(ft.x,ft.y,5);s?(z("A lightning bolt strikes the "+s.name+" with a loud thunder!",h.U),z("The damage is 40 hit points",h.U),s.in.en(40),t.remove()):z("No enemy is close enough to strike.",h.D)}function ht(t){z("Left-click to cast fireball, or right-click to cancel.",h.M),ot((s,i)=>{if(ft.zh(s,i)>10)z("Target out of range.",h.L);else{z("The fireball explodes, burning everything within 3 tiles!",h.m);for(let t=0;t<At.length;t++){const e=At[t];e.in&&e.zh(s,i)<=3&&(z("The "+e.name+" gets burned for 25 hit points.",h.m),e.in.en(25))}t.remove()}})}function nt(t){z("Left-click to cast confuse, or right-click to cancel.",h.M),ot((s,i)=>{if(ft.zh(s,i)>8)return void z("Target out of range.",h.L);const e=function(t,s){return st(t,s,0)}(s,i);e?(e.cn=new F(e.cn),e.cn.Xh=e,z("The eyes of the "+e.name+" look vacant, as he stumbles around!",h.I),t.remove()):z("No monster there.",h.L)})}function ot(t){Nt=t,wt.x=ft.x,wt.y=ft.y}function rt(){Nt=null}function ct(){dt&&(Ot.xh(ft.x,ft.y,10),dt=!1);for(let t=0;t<43;t++)for(let s=0;s<80;s++){const i=Ot.Ph(s,t),e=Ot.Qe[t][s].gh;let n=h.V;i?(n=e?v:G,Ot.Qe[t][s].Dh=!0):Ot.Qe[t][s].Dh&&(n=e?p:m),_t.ze(s,t,0,0,n)}for(let t=0;t<At.length;t++)At[t].X();_t.fillRect(0,38,80,7,0,h.O,h.V);let t=39;for(let s=0;s<Et.length;s++){const i=Et[s];_t.Ze(22,t,i.text,i.color),t++}Q(1,39,20,"HP",ft.in.$h,ft.in.jh,h.D,h.C),Q(1,40,20,"XP",ft.in.tn,200+150*ft.level,h.p,h.v),_t.Ze(1,42,"Dungeon level "+Vt,h.m),_t.Ze(1,38,function(){const t=_t.an.x,s=_t.an.y;if(!Ot.Ph(t,s))return"";const i=[];for(let e=0;e<At.length;e++){const h=At[e];h.x===t&&h.y===s&&i.push(h.name)}return J(i.join(", "))}(),h.L),Nt&&_t.Je(wt.x,wt.y).He(h.O),ut.X()}function lt(){if(0===ut.fn.length){const t=["Play a new game","Continue last game"];ut.add(new C("MAIN MENU",t,t=>{0===t?(at=new D(Date.now()),ft=new b(40,25,"@","player",h.O,!0,{in:new y(20,2,5,0,$)}),ft.level=1,At=[ft],Et=[],Vt=1,Ot=X(),dt=!0,Lt=[],z("Welcome stranger! Prepare to perish!",h.C),Tt="game"):1===t&&ft&&(Tt="game")}))}ut.hh(),_t.clear(),gt&&_t.eh(0,0,gt,0,0,80,50),_t.J(40,10,"TOMBS OF THE ANCIENT KINGS",h.T),_t.J(40,12,"By Jotaf",h.T),ut.X()}const _t=new class extends V{constructor(t,s,i,e){super(s,i),e=e||R,this.canvas=t,this.font=e.font||I,this.pixelWidth=s*this.font.Kh,this.pixelHeight=i*this.font.Ah,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.font.scale*this.pixelWidth+"px",t.style.height=this.font.scale*this.pixelHeight+"px",t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.Kn(),window.addEventListener("resize",()=>this.Kn()),this.keys=new _(t),this.an=new B(this,e);const h=t.getContext("webgl",{An:!1});if(!h)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=h.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.En=h,this.Vn=n,h.attachShader(n,this.On(h.VERTEX_SHADER,"attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),h.attachShader(n,this.On(h.FRAGMENT_SHADER,"varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform bool h;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(h){if(gl_FragColor.a<0.1){gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}}")),h.linkProgram(n),h.useProgram(n),this.font.Eh&&h.uniform1i(h.getUniformLocation(n,"h"),1),this.dn=this.getAttribLocation("a"),this.Ln=this.getAttribLocation("b"),this.Nn=this.getAttribLocation("c"),this.wn=this.getAttribLocation("d");const o=s*i;this.Tn=new Float32Array(3*o*4),this.gn=new Uint16Array(6*o),this.Dn=new Float32Array(2*o*4),this.Cn=new Uint8Array(4*o*4),this.In=new DataView(this.Cn.buffer),this.Bn=new Uint8Array(4*o*4),this.Mn=new DataView(this.Bn.buffer);let r=0,c=0,l=0;for(let t=0;t<i;t++)for(let e=0;e<s;e++)this.Tn[r++]=M(e,s),this.Tn[r++]=-M(t,i),this.Tn[r++]=M(e+1,s),this.Tn[r++]=-M(t,i),this.Tn[r++]=M(e+1,s),this.Tn[r++]=-M(t+1,i),this.Tn[r++]=M(e,s),this.Tn[r++]=-M(t+1,i),this.gn[c++]=l+0,this.gn[c++]=l+1,this.gn[c++]=l+2,this.gn[c++]=l+0,this.gn[c++]=l+2,this.gn[c++]=l+3,l+=4;this.Rn=h.createBuffer(),this.Un=h.createBuffer(),this.Sn=h.createBuffer(),this.pn=h.createBuffer(),this.vn=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,this.Rn),h.bufferData(h.ARRAY_BUFFER,this.Tn,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.Un),h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.gn,h.STATIC_DRAW),this.mn=this.Gn(this.font.url),window.setInterval(()=>this.bn(),1e3/30)}Kn(){const t=this.canvas.parentElement.offsetWidth/this.pixelWidth,s=this.canvas.parentElement.offsetHeight/this.pixelHeight,i=Math.min(t,s),e=i*this.pixelWidth|0,h=i*this.pixelHeight|0;this.canvas.style.width=e+"px",this.canvas.style.height=h+"px"}getAttribLocation(t){const s=this.En.getAttribLocation(this.Vn,t);return this.En.enableVertexAttribArray(s),s}flush(){let t=0,s=0;for(let i=0;i<this.height;i++)for(let e=0;e<this.width;e++){const h=this.Je(e,i);if(!h.ye){t+=8,s+=16;continue}const n=h.charCode%16,o=h.charCode/16|0;this.Dn[t++]=n,this.Dn[t++]=o,this.Dn[t++]=n+1,this.Dn[t++]=o,this.Dn[t++]=n+1,this.Dn[t++]=o+1,this.Dn[t++]=n,this.Dn[t++]=o+1;for(let t=0;t<4;t++)this.In.setUint32(s,h.me,!1),this.Mn.setUint32(s,h.Ge,!1),s+=4;h.ye=!1}}yn(t){const s=this.keys.getKey(t);return s&&s.Z}oh(t){const s=this.keys.getKey(t);return s&&s.tt()}Pn(t){const s=this.keys.getKey(t);return s?s.q:0}On(t,s){const i=this.En,e=i.createShader(t);if(!e)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(e,s),i.compileShader(e),!i.getShaderParameter(e,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(e));return e}Gn(t){const s=this.En,i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const e=s.RGBA,h=s.RGBA,n=s.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);s.texImage2D(s.TEXTURE_2D,0,e,1,1,0,h,n,o);const r=new Image;return r.onload=()=>{s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,e,h,n,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)},r.src=t,i}Fn(){const t=this.En;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=2,i=t.FLOAT,e=!1,h=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Rn),t.vertexAttribPointer(this.dn,s,i,e,h,n)}{const s=2,i=t.FLOAT,e=!1,h=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Sn),t.bufferData(t.ARRAY_BUFFER,this.Dn,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ln,s,i,e,h,n)}{const s=4,i=t.UNSIGNED_BYTE,e=!0,h=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.pn),t.bufferData(t.ARRAY_BUFFER,this.Cn,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Nn,s,i,e,h,n)}{const s=4,i=t.UNSIGNED_BYTE,e=!0,h=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.vn),t.bufferData(t.ARRAY_BUFFER,this.Bn,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.wn,s,i,e,h,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.Un),t.useProgram(this.Vn),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.mn);{const s=this.width*this.height*6,i=t.UNSIGNED_SHORT,e=0;t.drawElements(t.TRIANGLES,s,i,e)}}bn(){this.keys.ht(),this.an.update(),this.update&&this.update(),this.state&&this.state.update(),this.flush(),this.Fn()}}(document.querySelector("canvas"),80,45),ut=new class{constructor(t,s){this.Hn=t,this.xn=s||new c,this.fn=[]}add(t){this.fn.push(this.xn.k(this.Hn,t))}hh(){if(0===this.fn.length)return!1;const t=this.fn.length-1,s=this.fn[this.fn.length-1];return s.F.hh(this.Hn,s.H)&&this.fn.splice(t,1),!0}X(){for(let t=0;t<this.fn.length;t++)this.xn.X(this.Hn,this.fn[t])}}(_t);let at=null,ft=null,Kt=null,At=null,Et=null,Vt=0,Ot=null,dt=!0,Lt=null,Nt=null,wt={x:0,y:0},Tt="menu",gt=null;!function(t,s){const i=new Image;i.onload=()=>{const t=i.width,e=i.height,h=d(i),n=new V(t/2,e/2);for(let s=0;s<e;s+=2)for(let i=0;i<t;i+=2)L(n,h,i,s,t);s(n)},i.src=t}("menu.png",t=>{gt=t}),_t.update=function(){switch(Tt){case"menu":lt();break;case"game":Z(),ct()}}}])}));