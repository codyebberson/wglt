<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 5</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
    <canvas></canvas>
	<p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_5">Part 5: Preparing for combat</a></p>
	<p>Place some orcs and trolls around the dungeon (they won't stay there for long!). Also, deal with blocking objects and game states, which are important before coding the next part.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part4.js	2019-02-16 11:55:04.000000000 -0800</div>
<div class="c2">+++ part5.js	2019-02-16 11:58:20.000000000 -0800</div>
<div class="c1">@@ -11,6 +11,8 @@</div>
<div class="c0"> const ROOM_MAX_SIZE = 10;</div>
<div class="c0"> const ROOM_MIN_SIZE = 6;</div>
<div class="c0"> const MAX_ROOMS = 30;</div>
<div class="c2">+const MAX_ROOM_MONSTERS = 3;</div>
<div class="c2">+const TORCH_RADIUS = 10;</div>
<div class="c0"> </div>
<div class="c0"> function createRoom(map, room) {</div>
<div class="c0">     for (let y = room.y1 + 1; y &lt; room.y2; y++) {</div>
<div class="c1">@@ -95,12 +97,39 @@</div>
<div class="c0">                 }</div>
<div class="c0">             }</div>
<div class="c0"> </div>
<div class="c2">+            // Add some contents to this room, such as monsters</div>
<div class="c2">+            placeObjects(newRoom);</div>
<div class="c2">+</div>
<div class="c0">             // Finally, append the new room to the list</div>
<div class="c0">             rooms.push(newRoom);</div>
<div class="c0">         }</div>
<div class="c0">     }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c2">+function placeObjects(room) {</div>
<div class="c2">+    // Choose random number of monsters</div>
<div class="c2">+    const numMonsters = rng.nextRange(0, MAX_ROOM_MONSTERS);</div>
<div class="c2">+</div>
<div class="c2">+    for (let i = 0; i &lt; numMonsters; i++) {</div>
<div class="c2">+        // Choose random spot for this monster</div>
<div class="c2">+        const x = rng.nextRange(room.x1 + 1, room.x2 - 1);</div>
<div class="c2">+        const y = rng.nextRange(room.y1 + 1, room.y2 - 1);</div>
<div class="c2">+        let monster = null;</div>
<div class="c2">+</div>
<div class="c2">+        // Only place it if the tile is not blocked</div>
<div class="c2">+        // 80% chance of getting an orc</div>
<div class="c2">+        if (rng.nextRange(0, 100) &lt; 80) {</div>
<div class="c2">+            // Create an orc</div>
<div class="c2">+            monster = new wglt.Entity(game, x, y, &#x27;Orc&#x27;, new wglt.Sprite(32, 16, 16, 16, 2, true), true);</div>
<div class="c2">+        } else {</div>
<div class="c2">+            // Create a troll</div>
<div class="c2">+            monster = new wglt.Entity(game, x, y, &#x27;Troll&#x27;, new wglt.Sprite(64, 16, 16, 16, 2, true), true);</div>
<div class="c2">+        }</div>
<div class="c2">+</div>
<div class="c2">+        game.entities.push(monster);</div>
<div class="c2">+    }</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> const app = new wglt.App({</div>
<div class="c0">     canvas: document.querySelector(&#x27;canvas&#x27;),</div>
<div class="c0">     imageUrl: &#x27;../graphics.png&#x27;,</div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.js"></script>
	<script src="part5.js"></script>
</body>

</html>
