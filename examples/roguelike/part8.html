<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 8</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
	<canvas></canvas>
	<p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_8">Part 8: Items and Inventory</a></p>
	<p>The player gets to collect ("borrow") items from the dungeon and use them, with a neat inventory screen. More items added in the next part.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part7.js	2019-02-16 12:00:06.000000000 -0800</div>
<div class="c2">+++ part8.js	2019-02-16 12:00:13.000000000 -0800</div>
<div class="c1">@@ -12,6 +12,7 @@</div>
<div class="c0"> const ROOM_MIN_SIZE = 6;</div>
<div class="c0"> const MAX_ROOMS = 30;</div>
<div class="c0"> const MAX_ROOM_MONSTERS = 3;</div>
<div class="c2">+const MAX_ROOM_ITEMS = 2;</div>
<div class="c0"> const TORCH_RADIUS = 10;</div>
<div class="c0"> </div>
<div class="c0"> function createRoom(map, room) {</div>
<div class="c1">@@ -132,6 +133,37 @@</div>
<div class="c0">         monster.onDeath = monsterDeath;</div>
<div class="c0">         game.entities.push(monster);</div>
<div class="c0">     }</div>
<div class="c2">+</div>
<div class="c2">+    // Choose random number of items</div>
<div class="c2">+    const numItems = rng.nextRange(0, MAX_ROOM_ITEMS);</div>
<div class="c2">+</div>
<div class="c2">+    for (let i = 0; i &lt; numItems; i++) {</div>
<div class="c2">+        // Choose random spot for this item</div>
<div class="c2">+        const x = rng.nextRange(room.x1 + 1, room.x2 - 1);</div>
<div class="c2">+        const y = rng.nextRange(room.y1 + 1, room.y2 - 1);</div>
<div class="c2">+</div>
<div class="c2">+        // Create a healing potion</div>
<div class="c2">+        const item = new wglt.Item(app, x, y, &#x27;healing potion&#x27;, new wglt.Sprite(128, 16, 16, 16, 1));</div>
<div class="c2">+        item.onPickup = pickupCallback;</div>
<div class="c2">+        item.onUse = castHeal;</div>
<div class="c2">+        app.items.push(item);</div>
<div class="c2">+    }</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function pickupCallback(entity, item) {</div>
<div class="c2">+    messageLog.add(entity.name + &#x27; picked up a &#x27; + item.name, wglt.Colors.LIGHT_GREEN);</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function castHeal(item, entity) {</div>
<div class="c2">+    // Heal the player</div>
<div class="c2">+    if (entity.health === entity.maxHealth) {</div>
<div class="c2">+        messageLog.add(&#x27;You are already at full health.&#x27;, wglt.Colors.DARK_RED);</div>
<div class="c2">+        return;</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    messageLog.add(&#x27;Your wounds start to feel better!&#x27;, wglt.Colors.LIGHT_MAGENTA);</div>
<div class="c2">+    entity.health += HEAL_AMOUNT;</div>
<div class="c2">+    item.remove();</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function attackCallback(attacker, target, damage) {</div>
<div class="c1">@@ -151,7 +183,6 @@</div>
<div class="c0">     monster.char = &#x27;%&#x27;;</div>
<div class="c0">     monster.color = wglt.Colors.DARK_RED;</div>
<div class="c0">     monster.blocks = false;</div>
<div class="c3">-    monster.fighter = null;</div>
<div class="c0">     monster.ai = null;</div>
<div class="c0">     monster.name = &#x27;remains of &#x27; + monster.name;</div>
<div class="c0">     monster.sendToBack();</div>
<div class="c1">@@ -169,6 +200,8 @@</div>
<div class="c0">     tileHeight: 16</div>
<div class="c0"> });</div>
<div class="c0"> </div>
<div class="c2">+app.gui.renderer.baseRect = new wglt.Rect(0, 64, 24, 24);</div>
<div class="c2">+</div>
<div class="c0"> const rng = new wglt.RNG(1);</div>
<div class="c0"> const sprite = new wglt.Sprite(0, 16, 16, 16, 2, true);</div>
<div class="c0"> const player = new wglt.Entity(game, 30, 20, &#x27;Player&#x27;, sprite, true);</div>
<div class="c1">@@ -185,7 +218,7 @@</div>
<div class="c0"> game.gui.add(messageLog);</div>
<div class="c0"> </div>
<div class="c0"> const playerStats = new wglt.Panel(game.gui, new wglt.Rect(1, 1, 100, 100));</div>
<div class="c3">-playerStats.drawContents = function() {</div>
<div class="c2">+playerStats.drawContents = function () {</div>
<div class="c0">     const frameY = 0;</div>
<div class="c0">     const hpPercent = player.health / player.maxHealth;</div>
<div class="c0">     app.drawString(player.name, 1, frameY);</div>
<div class="c1">@@ -195,6 +228,20 @@</div>
<div class="c0"> };</div>
<div class="c0"> game.gui.add(playerStats);</div>
<div class="c0"> </div>
<div class="c2">+game.onUpdate = function () {</div>
<div class="c2">+    if (app.isKeyPressed(wglt.Keys.VK_I)) {</div>
<div class="c2">+        // Show inventory</div>
<div class="c2">+        game.gui.add(new wglt.SelectDialog(</div>
<div class="c2">+            game.gui,</div>
<div class="c2">+            new wglt.Rect(40, 40, 100, 100),</div>
<div class="c2">+            &#x27;INVENTORY&#x27;,</div>
<div class="c2">+            player.inventory,</div>
<div class="c2">+            (choice) =&gt; {</div>
<div class="c2">+                choice.use(player);</div>
<div class="c2">+            }));</div>
<div class="c2">+    }</div>
<div class="c2">+};</div>
<div class="c2">+</div>
<div class="c0"> // Generate the map</div>
<div class="c0"> createMap();</div>
<div class="c0"> </div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.js"></script>
	<script src="part8.js"></script>
</body>

</html>
