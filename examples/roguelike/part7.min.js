!function(t,s){if("object"===typeof exports&&"object"===typeof module)module.t=s();else if("function"===typeof define&&define.amd)define([],s);else{var i=s();for(var h in i)("object"===typeof exports?exports:t)[h]=i[h]}}(window,(function(){return function(t){var s={};function i(h){if(s[h])return s[h].t;var e=s[h]={s:h,i:!1,t:{}};return t[h].call(e.t,e,e.t,i),e.i=!0,e.t}return i.h=t,i.c=s,i.d=function(t,s,h){i.o(t,s)||Object.defineProperty(t,s,{l:!0,get:h})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"K",{value:!0})},i.u=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t.K)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{l:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,function(s){return t[s]}.bind(null,e));return h},i.n=function(t){var s=t&&t.K?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i._="",i(i.V=0)}([function(t,s,i){"use strict";function h(t,s,i,h){return void 0===h&&(h=255),(t<<24)+(s<<16)+(i<<8)+h}i.r(s);const e={A:h(0,0,0),C:h(255,255,255),M:h(170,170,170),g:h(85,85,85),O:h(255,255,85),N:h(170,85,0),R:h(255,85,85),T:h(170,0,0),p:h(85,255,85),v:h(0,170,0),D:h(85,255,255),U:h(0,170,170),L:h(85,85,255),F:h(0,0,170),P:h(255,85,255),S:h(170,0,170),I:h(255,136,0)};class n{constructor(){this.B=!1,this.m=0,this.G=0}update(){this.B?(this.m++,this.G=0):(this.m=0,this.G++)}H(){const t=this.m;return 1===t||t>6&&t%1===0}Y(){return 1===this.G}}class r{constructor(t){this.keys=new Array(256);for(let t=0;t<256;t++)this.keys[t]=new n;t.addEventListener("keydown",t=>this.k(t,!0)),t.addEventListener("keyup",t=>this.k(t,!1))}k(t,s){const i=t.keyCode;i!==o.W&&(t.stopPropagation(),t.preventDefault(),i>=0&&i<256&&(this.keys[i].B=s))}J(){for(let t=0;t<256;t++)this.keys[t].update()}getKey(t){return t>=0&&t<256?this.keys[t]:null}}const o={j:3,X:6,q:8,Z:9,$:12,tt:13,st:16,it:17,ht:18,et:19,nt:20,rt:27,ot:32,ct:33,lt:34,at:35,Kt:36,ut:37,_t:38,ft:39,Vt:40,At:44,Et:45,dt:46,wt:48,Ct:49,Mt:50,gt:51,Ot:52,Nt:53,Rt:54,Tt:55,pt:56,vt:57,Dt:58,Ut:59,Lt:60,bt:61,yt:62,Ft:63,Pt:64,St:65,It:66,Bt:67,Gt:68,xt:69,Ht:70,Yt:71,kt:72,Qt:73,zt:74,Wt:75,Jt:76,jt:77,Xt:78,qt:79,Zt:80,$t:81,ts:82,ss:83,hs:84,es:85,ns:86,rs:87,os:88,cs:89,ls:90,as:93,Ks:96,us:97,_s:98,fs:99,Vs:100,As:101,Es:102,ds:103,ws:104,Cs:105,Ms:106,gs:107,Os:108,Ns:109,Rs:110,Ts:111,ps:112,vs:113,Ds:114,Us:115,Ls:116,bs:117,ys:118,Fs:119,Ps:120,Ss:121,W:122,Is:123,Bs:124,ms:125,Gs:126,xs:127,Hs:128,Ys:129,ks:130,Qs:131,zs:132,Ws:133,Js:134,js:135,Xs:144,qs:145,Zs:160,$s:161,ti:162,si:163,ii:164,hi:165,ei:166,ni:167,ri:168,oi:169,ci:170,li:171,ai:172,Ki:173,ui:174,_i:175,fi:176,Vi:188,Ai:190,Ei:191,di:192,wi:219,Ci:220,Mi:221,gi:222,Oi:224,Ni:225,Ri:91,Ti:21,pi:21,vi:22,Di:23,Ui:24,Li:25,bi:25,yi:28,Fi:29,Pi:30,Si:31,Ii:41,Bi:42,mi:43,Gi:95};class c{constructor(t,s){this.x=t,this.y=s}}class l{constructor(t,s,i,h){this.x=this.left=t,this.y=this.top=s,this.width=i,this.height=h,this.x2=t+i,this.y2=s+h}xi(){return new c(this.x+this.width/2|0,this.y+this.height/2|0)}Hi(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.y<this.x2&&t.y>=this.y&&t.y<this.y2}}const a=0,K=1,u=2;class _{constructor(t,s,i,h){this.charCode=void 0!==t?function(t){return"string"===typeof t&&t.length>0?t.charCodeAt(0):t}(t):" ".charCodeAt(0),this.Yi=void 0!==s?s:e.C,this.ki=void 0!==i?i:e.A,void 0!==h&&(this.Qi=h),this.zi=!0}Wi(t){this.charCode!==t&&(this.charCode=t,this.zi=!0)}Ji(t){void 0!==t&&null!==t&&t!==this.Yi&&(this.Yi=t,this.zi=!0)}ji(t){void 0!==t&&null!==t&&t!==this.ki&&(this.ki=t,this.zi=!0)}Xi(t){void 0!==t&&(this.Qi=t,this.zi=!0)}qi(t,s,i,h){return"string"===typeof t&&(t=t.charCodeAt(0)),"number"===typeof t?(this.Wi(t),this.Ji(s),this.ji(i),this.Xi(h)):this.Zi(t,a),this.zi}Zi(t,s){const i=255&t.ki;s===a||t.charCode>0?(this.Wi(t.charCode),this.Ji(t.Yi)):i>0&&i<255&&this.Ji(this.$i(this.Yi,t.ki,s)),s===a||255===i?this.ji(t.ki):i>0&&this.ji(this.$i(this.ki,t.ki,s)),this.Xi(t.Qi)}$i(t,s,i){const e=(255-(255&s))/255,n=1-e,r=t>>24&255,o=t>>16&255,c=t>>8&255,l=s>>24&255,a=s>>16&255,_=s>>8&255;switch(i){case K:return h(e*r+n*l|0,e*o+n*a|0,e*c+n*_|0);case u:return h(this.th(r+n*l|0),this.th(o+n*a|0),this.th(c+n*_|0));default:return s}}th(t){return Math.min(255,t)}}const f=179,V=186,A=187,E=188,d=191,w=192,C=196,M=200,g=201,O=205,N=217,R=218;class T{constructor(t,s,i){this.width=t,this.height=s,this.sh=new Array;const h=i||_;for(let i=0;i<s;i++){const s=new Array;for(let e=0;e<t;e++)s.push(new h(e,i));this.sh.push(s)}this.clear()}clear(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)this.ih(s,t,0)}hh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.sh[s][t]}eh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.sh[s][t].charCode}ih(t,s,i,h,e){t>=0&&t<this.width&&s>=0&&s<this.height&&this.sh[s][t].qi(i,h,e)}nh(t,s,i,h,e){const n=i.split("\n");for(let i=0;i<n.length;i++){const r=n[i];for(let n=0;n<r.length;n++)this.ih(t+n,s+i,r.charCodeAt(n),h,e)}}rh(t,s,i,h,e){this.nh(t-Math.floor(i.length/2),s,i,h,e)}oh(t,s,i,h,e,n){for(let r=t;r<t+i;r++)this.ih(r,s,h,e,n)}lh(t,s,i,h,e,n){for(let r=s;r<s+i;r++)this.ih(t,r,h,e,n)}ah(t,s,i,h,e,n,r){this.oh(t,s,i,e,n,r),this.oh(t,s+h-1,i,e,n,r),this.lh(t,s,h,e,n,r),this.lh(t+i-1,s,h,e,n,r)}Kh(t,s,i,h,e,n,r,o,c,l,a,K,u,_){this.fillRect(t,s,i,h,0,u,_),this.oh(t,s,i,e),this.oh(t,s+h-1,i,r),this.lh(t,s,h,o),this.lh(t+i-1,s,h,n),this.ih(t,s,c),this.ih(t+i-1,s,l),this.ih(t,s+h-1,K),this.ih(t+i-1,s+h-1,a)}uh(t,s,i,h,e,n){this.Kh(t,s,i,h,C,f,C,f,R,d,N,w,e,n)}_h(t,s,i,h,e,n){this.Kh(t,s,i,h,O,V,O,V,g,A,E,M,e,n)}fillRect(t,s,i,h,e,n,r){for(let o=s;o<s+h;o++)this.oh(t,o,i,e,n,r)}fh(t,s,i,h,e,n,r,o){o=o||a;for(let c=0;c<r;c++)for(let r=0;r<n;r++){const n=i.hh(h+r,e+c);n&&this.Zi(t+r,s+c,n,o)}}Zi(t,s,i,h){t>=0&&t<this.width&&s>=0&&s<this.height&&this.sh[s][t].Zi(i,h)}}const p=new class{constructor(t,s,i,h,e){this.url=t,this.Vh=s,this.Ah=i,this.scale=h||1,this.Eh=!!e}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);class v{constructor(t,s){this.dh=t.canvas,this.width=t.width,this.height=t.height,this.options=s,this.wh=0,this.Ch=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.buttons=[new n,new n,new n];const i=this.dh;i.addEventListener("mousedown",t=>this.Mh(t)),i.addEventListener("mouseup",t=>this.Mh(t)),i.addEventListener("mousemove",t=>this.Mh(t)),i.addEventListener("contextmenu",t=>this.Mh(t));const h=this.gh.bind(this);i.addEventListener("touchstart",h),i.addEventListener("touchend",h),i.addEventListener("touchcancel",h),i.addEventListener("touchmove",h)}gh(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type&&this.options.requestFullscreen&&this.requestFullscreen(),t.touches.length>0){const s=t.touches[0];this.Oh(s.clientX,s.clientY),this.buttons[0].B=!0}else this.buttons[0].B=!1}Mh(t){t.stopPropagation(),t.preventDefault(),this.Oh(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons[t.button].B=!0,this.dh.focus(),this.options.requestFullscreen&&this.requestFullscreen()),"mouseup"===t.type&&(this.buttons[t.button].B=!1)}Oh(t,s){let i=this.dh.getBoundingClientRect();const h=this.width/this.height,e=i.width/i.height;if(e-h>.01){const t=h*i.height,s=i.width-t;i=new l(Math.floor(s/2),0,t,i.height)}if(e-h<-.01){const t=i.width/h,s=i.height-t;i=new l(0,Math.floor(s/2),i.width,t)}this.x=this.width*(t-i.left)/i.width|0,this.y=this.height*(s-i.top)/i.height|0}requestFullscreen(){const t=this.dh;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()}update(){this.dx=this.x-this.wh,this.dy=this.y-this.Ch,this.wh=this.x,this.Ch=this.y;for(let t=0;t<this.buttons.length;t++)this.buttons[t].update()}}function D(t,s){return t/s*2-1}const U={font:p,requestFullscreen:!1};class L extends _{constructor(t,s){super(),this.x=t,this.y=s,this.Nh=!1,this.Rh=!1,this.Th=!1,this.visible=!1,this.ph=-1,this.vh=0,this.Dh=0,this.Uh=null}}class b extends T{constructor(t,s,i){if(super(t,s,L),this.Lh=0,this.bh=0,this.yh=0,this.Fh=0,this.Ph=0,this.Sh=0,this.Ih=0,i)for(let h=0;h<s;h++)for(let s=0;s<t;s++)this.sh[h][s].Nh=this.sh[h][s].Rh=i(s,h)}Bh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.sh[s][t].Nh=i)}mh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.sh[s][t].Rh=i)}Gh(t,s){return!(t<this.yh||t>this.Fh||s<this.Ph||s>this.Sh)&&this.sh[s][t].visible}xh(t,s){const i=[],h=[];let e,n,r,o,c,l,a,K,u,_,f=1,V=0,A=0,E=0;for(n=this.bh+s;n>=this.Ph&&n<=this.Sh;n+=s,A=V,++f)for(r=.5/f,_=-1,o=Math.floor(E*f+.5),e=this.Lh+o*t;o<=f&&e>=this.yh&&e<=this.Fh;e+=t,++o,_=u){if(c=!0,l=!1,a=o/f,K=_,u=a+r,A>0)if(this.sh[n-s][e].visible&&!this.sh[n-s][e].Rh||this.sh[n-s][e-t].visible&&!this.sh[n-s][e-t].Rh){for(let t=0;t<A&&c;++t)if(K<=h[t]&&u>=i[t])if(this.sh[n][e].Rh){if(K>=i[t]&&u<=h[t]){c=!1;break}i[t]=Math.min(i[t],K),h[t]=Math.max(h[t],u),l=!0}else if(a>i[t]&&a<h[t]){c=!1;break}}else c=!1;c&&(this.sh[n][e].visible=!0,this.sh[n][e].Rh&&(E>=K?E=u:l||(i[V]=K,h[V++]=u)))}}Hh(t,s){const i=[],h=[];let e,n,r,o,c,l,a,K,u,_,f=1,V=0,A=0,E=0;for(e=this.Lh+t;e>=this.yh&&e<=this.Fh;e+=t,A=V,++f)for(r=.5/f,_=-1,o=Math.floor(E*f+.5),n=this.bh+o*s;o<=f&&n>=this.Ph&&n<=this.Sh;n+=s,++o,_=u){if(c=!0,l=!1,a=o/f,K=_,u=a+r,A>0)if(this.sh[n][e-t].visible&&!this.sh[n][e-t].Rh||this.sh[n-s][e-t].visible&&!this.sh[n-s][e-t].Rh){for(let t=0;t<A&&c;++t)if(K<=h[t]&&u>=i[t])if(this.sh[n][e].Rh){if(K>=i[t]&&u<=h[t]){c=!1;break}i[t]=Math.min(i[t],K),h[t]=Math.max(h[t],u),l=!0}else if(a>i[t]&&a<h[t]){c=!1;break}}else c=!1;c&&(this.sh[n][e].visible=!0,this.sh[n][e].Rh&&(E>=K?E=u:l||(i[V]=K,h[V++]=u)))}}Yh(t,s,i,h,e){if(this.Lh=t,this.bh=s,this.Ih=i,h)this.yh=Math.min(this.yh,Math.max(0,t-i)),this.Ph=Math.min(this.Ph,Math.max(0,s-i)),this.Fh=Math.max(this.Fh,Math.min(this.width-1,t+i)),this.Sh=Math.max(this.Sh,Math.min(this.height-1,s+i));else{this.yh=Math.max(0,t-i),this.Ph=Math.max(0,s-i),this.Fh=Math.min(this.width-1,t+i),this.Sh=Math.min(this.height-1,s+i);for(let t=this.Ph;t<=this.Sh;t++)for(let s=this.yh;s<=this.Fh;s++)this.sh[t][s].visible=!1}this.sh[s][t].visible=!0,void 0===e?(this.xh(1,1),this.Hh(1,1),this.Hh(1,-1),this.xh(1,-1),this.xh(-1,-1),this.Hh(-1,-1),this.Hh(-1,1),this.xh(-1,1)):(1&e&&this.xh(1,1),2&e&&this.Hh(1,1),4&e&&this.Hh(1,-1),8&e&&this.xh(1,-1),16&e&&this.xh(-1,-1),32&e&&this.Hh(-1,-1),64&e&&this.Hh(-1,1),128&e&&this.xh(-1,1))}kh(){for(let t=this.Ph;t<=this.Sh;t++)for(let s=this.yh;s<=this.Fh;s++){const i=this.sh[t][s];i.Th|=i.visible}}}const y=h(0,0,100),F=h(130,110,50),P=h(50,50,150),S=h(200,180,50);class I{constructor(t,s,i,h,e,n,r){if(this.x=t,this.y=s,this.char=i,this.name=h,this.color=e,this.Qh=!!n,r)for(var o in r)r.hasOwnProperty(o)&&(this[o]=r[o],this[o].zh=this)}move(t,s){(function(t,s){if(tt.sh[s][t].Nh)return!0;for(let i=0;i<Z.length;i++){const h=Z[i];if(h.Qh&&h.x===t&&h.y===s)return!0}return!1})(this.x+t,this.y+s)||(this.x+=t,this.y+=s)}Wh(t,s){const i=t-this.x,h=s-this.y,e=Math.hypot(i,h);this.move(Math.round(i/e),Math.round(h/e))}Jh(t){return Math.hypot(t.x-this.x,t.y-this.y)}jh(){this.remove(),Z.unshift(this)}remove(){Z.splice(Z.indexOf(this),1)}Xh(){tt.Gh(this.x,this.y)&&j.nh(this.x,this.y,this.char,this.color)}}class B{constructor(t,s,i,h){this.zh=null,this.qh=t,this.Zh=s,this.$h=i,this.te=t,this.se=h||null}attack(t){const s=this.$h-t.ie.Zh;s>0?(k(Q(this.zh.name)+" attacks "+t.name+" for "+s+" hit points."),t.ie.he(s)):k(Q(this.zh.name)+" attacks "+t.name+" but it has no effect!")}he(t){this.te-=t,this.te<=0&&(this.te=0,this.se&&this.se(this.zh))}ee(t){this.te=Math.min(this.te+t,this.qh)}}class m{constructor(){this.zh=null}ne(){const t=this.zh;tt.Gh(t.x,t.y)&&(t.Jh(q)>=2?t.Wh(q.x,q.y):q.ie.te>0&&t.ie.attack(q))}}function G(t,s){for(let i=s.y+1;i<s.y2;i++)for(let h=s.x+1;h<s.x2;h++)t.sh[i][h].Nh=!1,t.sh[i][h].Rh=!1}function x(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.sh[h][e].Nh=!1,t.sh[h][e].Rh=!1}function H(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.sh[e][h].Nh=!1,t.sh[e][h].Rh=!1}function Y(t){const s=X.re(0,3);for(let i=0;i<s;i++){const s=X.re(t.x+1,t.x2-1),i=X.re(t.y+1,t.y2-1);let h=null;if(X.re(0,100)<80){const t=new B(10,0,3,W),n=new m;h=new I(s,i,"o","orc",e.p,!0,{ie:t,oe:n})}else{const t=new B(16,1,4,W),n=new m;h=new I(s,i,"T","troll",e.v,!0,{ie:t,oe:n})}Z.push(h)}}function k(t,s){for(;$.length>=6;)$.shift();$.push({text:t,color:s||e.C})}function Q(t){return t?t.charAt(0).toUpperCase()+t.slice(1):t}function z(t,s){const i=q.x+t,h=q.y+s;let e=null;for(let t=0;t<Z.length;t++){const s=Z[t];if(s.ie&&s.x===i&&s.y===h){e=s;break}}e?q.ie.attack(e):(q.move(t,s),st=!0);for(let t=0;t<Z.length;t++){const s=Z[t];s.oe&&s.oe.ne()}}function W(t){k(Q(t.name)+" is dead!",e.N),t.char="%",t.color=e.T,t.Qh=!1,t.ie=null,t.oe=null,t.name="remains of "+t.name,t.jh()}function J(){st&&(tt.Yh(q.x,q.y,10),st=!1);for(let t=0;t<43;t++)for(let s=0;s<80;s++){const i=tt.Gh(s,t),h=tt.sh[t][s].Rh;let n=e.A;i?(n=h?F:S,tt.sh[t][s].Th=!0):tt.sh[t][s].Th&&(n=h?y:P),j.ih(s,t,0,0,n)}for(let t=0;t<Z.length;t++)Z[t].Xh();j.fillRect(0,38,80,7,0,e.C,e.A);let t=39;for(let s=0;s<$.length;s++){const i=$[s];j.nh(22,t,i.text,i.color),t++}!function(t,s,i,h,n,r,o,c){const l=Math.round(n/r*i);j.fillRect(t,s,i,1,0,0,c),l>0&&j.fillRect(t,s,l,1,0,0,o),j.rh(t+i/2,s,h+": "+n+"/"+r,e.C)}(1,39,20,"HP",q.ie.te,q.ie.qh,e.R,e.T),j.nh(1,38,function(){const t=j.ce.x,s=j.ce.y;if(!tt.Gh(t,s))return"";const i=[];for(let h=0;h<Z.length;h++){const e=Z[h];e.x===t&&e.y===s&&i.push(e.name)}return Q(i.join(", "))}(),e.M)}const j=new class extends T{constructor(t,s,i,h){super(s,i),h=h||U,this.canvas=t,this.font=h.font||p,this.pixelWidth=s*this.font.Vh,this.pixelHeight=i*this.font.Ah,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.font.scale*this.pixelWidth+"px",t.style.height=this.font.scale*this.pixelHeight+"px",t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.le(),window.addEventListener("resize",()=>this.le()),this.keys=new r(t),this.ce=new v(this,h);const e=t.getContext("webgl",{ae:!1});if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=e.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.Ke=e,this.ue=n,e.attachShader(n,this._e(e.VERTEX_SHADER,"attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),e.attachShader(n,this._e(e.FRAGMENT_SHADER,"varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform bool h;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(h){if(gl_FragColor.a<0.1){gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}}")),e.linkProgram(n),e.useProgram(n),this.font.Eh&&e.uniform1i(e.getUniformLocation(n,"h"),1),this.fe=this.getAttribLocation("a"),this.Ve=this.getAttribLocation("b"),this.Ae=this.getAttribLocation("c"),this.Ee=this.getAttribLocation("d");const o=s*i;this.de=new Float32Array(3*o*4),this.we=new Uint16Array(6*o),this.Ce=new Float32Array(2*o*4),this.Me=new Uint8Array(4*o*4),this.ge=new DataView(this.Me.buffer),this.Oe=new Uint8Array(4*o*4),this.Ne=new DataView(this.Oe.buffer);let c=0,l=0,a=0;for(let t=0;t<i;t++)for(let h=0;h<s;h++)this.de[c++]=D(h,s),this.de[c++]=-D(t,i),this.de[c++]=D(h+1,s),this.de[c++]=-D(t,i),this.de[c++]=D(h+1,s),this.de[c++]=-D(t+1,i),this.de[c++]=D(h,s),this.de[c++]=-D(t+1,i),this.we[l++]=a+0,this.we[l++]=a+1,this.we[l++]=a+2,this.we[l++]=a+0,this.we[l++]=a+2,this.we[l++]=a+3,a+=4;this.Re=e.createBuffer(),this.Te=e.createBuffer(),this.pe=e.createBuffer(),this.ve=e.createBuffer(),this.De=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.Re),e.bufferData(e.ARRAY_BUFFER,this.de,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.Te),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.we,e.STATIC_DRAW),this.Ue=this.Le(this.font.url),window.setInterval(()=>this.be(),1e3/30)}le(){const t=this.canvas.parentElement.offsetWidth/this.pixelWidth,s=this.canvas.parentElement.offsetHeight/this.pixelHeight,i=Math.min(t,s),h=i*this.pixelWidth|0,e=i*this.pixelHeight|0;this.canvas.style.width=h+"px",this.canvas.style.height=e+"px"}getAttribLocation(t){const s=this.Ke.getAttribLocation(this.ue,t);return this.Ke.enableVertexAttribArray(s),s}flush(){let t=0,s=0;for(let i=0;i<this.height;i++)for(let h=0;h<this.width;h++){const e=this.hh(h,i);if(!e.zi){t+=8,s+=16;continue}const n=e.charCode%16,r=e.charCode/16|0;this.Ce[t++]=n,this.Ce[t++]=r,this.Ce[t++]=n+1,this.Ce[t++]=r,this.Ce[t++]=n+1,this.Ce[t++]=r+1,this.Ce[t++]=n,this.Ce[t++]=r+1;for(let t=0;t<4;t++)this.ge.setUint32(s,e.Yi,!1),this.Ne.setUint32(s,e.ki,!1),s+=4;e.zi=!1}}ye(t){const s=this.keys.getKey(t);return s&&s.B}Fe(t){const s=this.keys.getKey(t);return s&&s.H()}Pe(t){const s=this.keys.getKey(t);return s?s.m:0}_e(t,s){const i=this.Ke,h=i.createShader(t);if(!h)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(h,s),i.compileShader(h),!i.getShaderParameter(h,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(h));return h}Le(t){const s=this.Ke,i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const h=s.RGBA,e=s.RGBA,n=s.UNSIGNED_BYTE,r=new Uint8Array([0,0,0,255]);s.texImage2D(s.TEXTURE_2D,0,h,1,1,0,e,n,r);const o=new Image;return o.onload=()=>{s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,h,e,n,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)},o.src=t,i}Se(){const t=this.Ke;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Re),t.vertexAttribPointer(this.fe,s,i,h,e,n)}{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.pe),t.bufferData(t.ARRAY_BUFFER,this.Ce,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ve,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.ve),t.bufferData(t.ARRAY_BUFFER,this.Me,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ae,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.De),t.bufferData(t.ARRAY_BUFFER,this.Oe,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ee,s,i,h,e,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.Te),t.useProgram(this.ue),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.Ue);{const s=this.width*this.height*6,i=t.UNSIGNED_SHORT,h=0;t.drawElements(t.TRIANGLES,s,i,h)}}be(){this.keys.J(),this.ce.update(),this.update&&this.update(),this.state&&this.state.update(),this.flush(),this.Se()}}(document.querySelector("canvas"),80,45),X=new class{constructor(t){this.h=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}Ie(){return this.state=(this.a*this.state+this.c)%this.h,this.state}Be(){return this.Ie()/(this.h-1)}re(t,s){const i=s-t,h=t+(this.Ie()/this.h*i|0);if(isNaN(h))throw new Error("rand nan");return h}me(t){const s=t.reduce((t,s)=>t+s),i=this.re(1,s+1);let h=0;for(let s=0;s<t.length;s++)if(h+=t[s],i<=h)return s;return t.length-1}Ge(t){const s=[],i=[];for(const h in t)t.hasOwnProperty(h)&&(s.push(h),i.push(t[h]));return s[this.me(i)]}}(1),q=new I(40,25,"@","player",e.C,!0,{ie:new B(20,2,5,(function(t){k("You died!",e.R)}))}),Z=[q],$=[],tt=function(){const t=new b(80,43);for(let s=0;s<43;s++)for(let i=0;i<80;i++)t.sh[s][i].Nh=!0,t.sh[s][i].Rh=!0;const s=[];for(let i=0;i<30;i++){const i=X.re(6,10),h=X.re(6,10),e=X.re(0,80-i-1),n=X.re(0,43-h-1),r=new l(e,n,i,h);let o=!1;for(let t=0;t<s.length;t++)if(r.Hi(s[t])){o=!0;break}if(!o){G(t,r);const i=r.xi();if(0===s.length)q.x=i.x,q.y=i.y;else{const h=s[s.length-1].xi();1===X.re(0,1)?(x(t,h.x,i.x,h.y),H(t,h.y,i.y,i.x)):(H(t,h.y,i.y,h.x),x(t,h.x,i.x,i.y))}Y(r),s.push(r)}}return t}();let st=!0;k("Welcome stranger! Prepare to perish!",e.T),j.update=function(){q.ie.te<=0||(j.Fe(o._t)&&z(0,-1),j.Fe(o.ut)&&z(-1,0),j.Fe(o.ft)&&z(1,0),j.Fe(o.Vt)&&z(0,1)),J()}}])}));