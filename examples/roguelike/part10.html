<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 10</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
	<canvas></canvas>
	<p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_10">Part 10: Main menu and saving</a></p>
	<p>A main menu complete with a background image and the ability to save and load the game.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part9.js	2018-11-23 16:31:18.890654700 -0800</div>
<div class="c2">+++ part10.js	2018-11-23 16:31:26.156388500 -0800</div>
<div class="c1">@@ -512,6 +512,10 @@</div>
<div class="c0">         return;</div>
<div class="c0">     }</div>
<div class="c0"> </div>
<div class="c2">+    if (term.isKeyPressed(wglt.Keys.VK_ESCAPE)) {</div>
<div class="c2">+        saveGame();</div>
<div class="c2">+        appState = 'menu';</div>
<div class="c2">+    }</div>
<div class="c0">     if (term.isKeyPressed(wglt.Keys.VK_UP)) {</div>
<div class="c0">         playerMoveOrAttack(0, -1);</div>
<div class="c0">     }</div>
<div class="c1">@@ -730,22 +734,84 @@</div>
<div class="c0">     gui.draw();</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c2">+function saveGame() {</div>
<div class="c2">+    // TODO: JSON.stringify does not support prototypes and circular references</div>
<div class="c2">+    // Investigate Cryo: https://github.com/hunterloftis/cryo</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function loadGame() {</div>
<div class="c2">+    // TODO</div>
<div class="c2">+    appState = 'game';</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function newGame() {</div>
<div class="c2">+    rng = new wglt.RNG(Date.now());</div>
<div class="c2">+    player = new Entity(40, 25, '@', 'player', wglt.Colors.WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });</div>
<div class="c2">+    entities = [player];</div>
<div class="c2">+    messages = [];</div>
<div class="c2">+    map = createMap();</div>
<div class="c2">+    fovMap = new wglt.FovMap(MAP_WIDTH, MAP_HEIGHT, (x, y) =&gt; map[y][x].blocked);</div>
<div class="c2">+    fovRecompute = true;</div>
<div class="c2">+    inventory = [];</div>
<div class="c2">+    addMessage('Welcome stranger! Prepare to perish!', wglt.Colors.DARK_RED);</div>
<div class="c2">+    appState = 'game';</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function playGame() {</div>
<div class="c2">+    handleKeys();</div>
<div class="c2">+    renderAll();</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function mainMenu() {</div>
<div class="c2">+    if (gui.dialogs.length === 0) {</div>
<div class="c2">+        const options = ['Play a new game', 'Continue last game'];</div>
<div class="c2">+        gui.add(new wglt.SelectDialog(term, 'MAIN MENU', options, (choice) =&gt; {</div>
<div class="c2">+            if (choice === 0) {</div>
<div class="c2">+                newGame();</div>
<div class="c2">+            } else if (choice === 1) {</div>
<div class="c2">+                loadGame();</div>
<div class="c2">+            }</div>
<div class="c2">+        }));</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    gui.handleInput();</div>
<div class="c2">+</div>
<div class="c2">+    term.clear();</div>
<div class="c2">+</div>
<div class="c2">+    if (menuBg) {</div>
<div class="c2">+        term.drawConsole(0, 0, menuBg, 0, 0, 80, 50);</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    term.drawCenteredString(40, 10, 'TOMBS OF THE ANCIENT KINGS', wglt.Colors.YELLOW);</div>
<div class="c2">+    term.drawCenteredString(40, 12, 'By Jotaf', wglt.Colors.YELLOW);</div>
<div class="c2">+    gui.draw();</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> const term = new wglt.Terminal(document.querySelector('canvas'), SCREEN_WIDTH, SCREEN_HEIGHT);</div>
<div class="c0"> const gui = new wglt.GUI(term);</div>
<div class="c3">-const rng = new wglt.RNG(1);</div>
<div class="c3">-const player = new Entity(40, 25, '@', 'player', wglt.Colors.WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });</div>
<div class="c3">-const entities = [player];</div>
<div class="c3">-const messages = [];</div>
<div class="c3">-const map = createMap();</div>
<div class="c3">-const fovMap = new wglt.FovMap(MAP_WIDTH, MAP_HEIGHT, (x, y) =&gt; map[y][x].blocked);</div>
<div class="c2">+let rng = null;</div>
<div class="c2">+let player = null;</div>
<div class="c2">+let entities = null;</div>
<div class="c2">+let messages = null;</div>
<div class="c2">+let map = null;</div>
<div class="c2">+let fovMap = null;</div>
<div class="c0"> let fovRecompute = true;</div>
<div class="c3">-const inventory = [];</div>
<div class="c2">+let inventory = null;</div>
<div class="c0"> let targetFunction = null;</div>
<div class="c0"> let targetCursor = { x: 0, y: 0 };</div>
<div class="c2">+let appState = 'menu';</div>
<div class="c2">+let menuBg = null;</div>
<div class="c0"> </div>
<div class="c3">-addMessage('Welcome stranger! Prepare to perish!', wglt.Colors.DARK_RED);</div>
<div class="c2">+wglt.loadImage2x('menu.png', (result) =&gt; { menuBg = result });</div>
<div class="c0"> </div>
<div class="c0"> term.update = function () {</div>
<div class="c3">-    handleKeys();</div>
<div class="c3">-    renderAll();</div>
<div class="c2">+    switch (appState) {</div>
<div class="c2">+        case 'menu':</div>
<div class="c2">+            mainMenu();</div>
<div class="c2">+            break;</div>
<div class="c2">+</div>
<div class="c2">+        case 'game':</div>
<div class="c2">+            playGame();</div>
<div class="c2">+            break;</div>
<div class="c2">+    }</div>
<div class="c0"> };</div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.umd.js"></script>
	<script src="part10.js"></script>
</body>

</html>