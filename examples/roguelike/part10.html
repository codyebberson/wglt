<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 10</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body class="example">
	<canvas></canvas>
	<p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_10">Part 10: Main menu and saving</a></p>
	<p>A main menu complete with a background image and the ability to save and load the game.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part9.ts	2020-11-23 12:54:22.760264400 -0800</div>
<div class="c2">+++ part10.ts	2020-11-23 12:54:20.462634300 -0800</div>
<div class="c1">@@ -5,6 +5,7 @@</div>
<div class="c0"> import { fromRgb } from &#x27;../../src/color&#x27;;</div>
<div class="c0"> import { GUI } from &#x27;../../src/gui&#x27;;</div>
<div class="c0"> import { Keys } from &#x27;../../src/keys&#x27;;</div>
<div class="c2">+import { loadImage2x } from &#x27;../../src/image&#x27;;</div>
<div class="c0"> import { MessageDialog } from &#x27;../../src/gui/messagedialog&#x27;;</div>
<div class="c0"> import { Rect } from &#x27;../../src/rect&#x27;;</div>
<div class="c0"> import { RNG } from &#x27;../../src/rng&#x27;;</div>
<div class="c1">@@ -64,7 +65,7 @@</div>
<div class="c0">     color: Color;</div>
<div class="c0">     blocks: boolean;</div>
<div class="c0">     fighter?: Fighter;</div>
<div class="c3">-    ai?: AI;</div>
<div class="c2">+    ai?: BasicMonster;</div>
<div class="c0">     item?: Item;</div>
<div class="c0"> </div>
<div class="c0">     constructor(x: number, y: number, char: string, name: string, color: Color, blocks: boolean, components?: any) {</div>
<div class="c1">@@ -572,6 +573,10 @@</div>
<div class="c0">         return;</div>
<div class="c0">     }</div>
<div class="c0"> </div>
<div class="c2">+    if (term.isKeyPressed(Keys.VK_ESCAPE)) {</div>
<div class="c2">+        saveGame();</div>
<div class="c2">+        appState = &#x27;menu&#x27;;</div>
<div class="c2">+    }</div>
<div class="c0">     if (term.isKeyPressed(Keys.VK_UP)) {</div>
<div class="c0">         playerMoveOrAttack(0, -1);</div>
<div class="c0">     }</div>
<div class="c1">@@ -797,21 +802,85 @@</div>
<div class="c0">     gui.draw();</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c2">+function saveGame() {</div>
<div class="c2">+    // TODO: JSON.stringify does not support prototypes and circular references</div>
<div class="c2">+    // Investigate Cryo: https://github.com/hunterloftis/cryo</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function loadGame() {</div>
<div class="c2">+    // TODO</div>
<div class="c2">+    if (!player) {</div>
<div class="c2">+        return;</div>
<div class="c2">+    }</div>
<div class="c2">+    appState = &#x27;game&#x27;;</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function newGame() {</div>
<div class="c2">+    rng = new RNG(Date.now());</div>
<div class="c2">+    player = new Entity(40, 25, &#x27;@&#x27;, &#x27;player&#x27;, Colors.WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });</div>
<div class="c2">+    entities = [player];</div>
<div class="c2">+    messages = [];</div>
<div class="c2">+    map = createMap();</div>
<div class="c2">+    fovRecompute = true;</div>
<div class="c2">+    inventory = [];</div>
<div class="c2">+    addMessage(&#x27;Welcome stranger! Prepare to perish!&#x27;, Colors.DARK_RED);</div>
<div class="c2">+    appState = &#x27;game&#x27;;</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function playGame() {</div>
<div class="c2">+    handleKeys();</div>
<div class="c2">+    renderAll();</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function mainMenu() {</div>
<div class="c2">+    if (gui.dialogs.length === 0) {</div>
<div class="c2">+        const options = [&#x27;Play a new game&#x27;, &#x27;Continue last game&#x27;];</div>
<div class="c2">+        gui.add(new SelectDialog(&#x27;MAIN MENU&#x27;, options, (choice) =&gt; {</div>
<div class="c2">+            if (choice === 0) {</div>
<div class="c2">+                newGame();</div>
<div class="c2">+            } else if (choice === 1) {</div>
<div class="c2">+                loadGame();</div>
<div class="c2">+            }</div>
<div class="c2">+        }));</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    gui.handleInput();</div>
<div class="c2">+</div>
<div class="c2">+    term.clear();</div>
<div class="c2">+</div>
<div class="c2">+    if (menuBg) {</div>
<div class="c2">+        term.drawConsole(0, 0, menuBg, 0, 0, 80, 50);</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    term.drawCenteredString(40, 10, &#x27;TOMBS OF THE ANCIENT KINGS&#x27;, Colors.YELLOW);</div>
<div class="c2">+    term.drawCenteredString(40, 12, &#x27;By Jotaf&#x27;, Colors.YELLOW);</div>
<div class="c2">+    gui.draw();</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> const term = new Terminal(document.querySelector(&#x27;canvas&#x27;) as HTMLCanvasElement, SCREEN_WIDTH, SCREEN_HEIGHT);</div>
<div class="c0"> const gui = new GUI(term);</div>
<div class="c3">-const rng = new RNG(1);</div>
<div class="c3">-const player = new Entity(40, 25, &#x27;@&#x27;, &#x27;player&#x27;, Colors.WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });</div>
<div class="c3">-const entities = [player];</div>
<div class="c3">-const messages: { text: string; color: number; }[] = [];</div>
<div class="c3">-const map = createMap();</div>
<div class="c2">+let rng = null;</div>
<div class="c2">+let player = null;</div>
<div class="c2">+let entities = null;</div>
<div class="c2">+let messages = null;</div>
<div class="c2">+let map = null;</div>
<div class="c0"> let fovRecompute = true;</div>
<div class="c3">-const inventory: Entity[] = [];</div>
<div class="c2">+let inventory = null;</div>
<div class="c0"> let targetFunction = undefined as undefined | ((x: number, y: number) =&gt; void);</div>
<div class="c0"> let targetCursor = { x: 0, y: 0 };</div>
<div class="c2">+let appState = &#x27;menu&#x27;;</div>
<div class="c2">+let menuBg = null;</div>
<div class="c0"> </div>
<div class="c3">-addMessage(&#x27;Welcome stranger! Prepare to perish!&#x27;, Colors.DARK_RED);</div>
<div class="c2">+loadImage2x(&#x27;menu.png&#x27;, (result) =&gt; { menuBg = result });</div>
<div class="c0"> </div>
<div class="c0"> term.update = function () {</div>
<div class="c3">-    handleKeys();</div>
<div class="c3">-    renderAll();</div>
<div class="c2">+    switch (appState) {</div>
<div class="c2">+        case &#x27;menu&#x27;:</div>
<div class="c2">+            mainMenu();</div>
<div class="c2">+            break;</div>
<div class="c2">+</div>
<div class="c2">+        case &#x27;game&#x27;:</div>
<div class="c2">+            playGame();</div>
<div class="c2">+            break;</div>
<div class="c2">+    }</div>
<div class="c0"> };</div>
<!--ENDDIFF-->
    </div>
	<script src="part10.min.js"></script>
</body>

</html>