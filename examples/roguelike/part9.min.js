!function(t,s){if("object"===typeof exports&&"object"===typeof module)module.t=s();else if("function"===typeof define&&define.amd)define([],s);else{var i=s();for(var h in i)("object"===typeof exports?exports:t)[h]=i[h]}}(window,(function(){return function(t){var s={};function i(h){if(s[h])return s[h].t;var e=s[h]={s:h,i:!1,t:{}};return t[h].call(e.t,e,e.t,i),e.i=!0,e.t}return i.h=t,i.c=s,i.d=function(t,s,h){i.o(t,s)||Object.defineProperty(t,s,{l:!0,get:h})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},i.K=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t.u)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{l:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,function(s){return t[s]}.bind(null,e));return h},i.n=function(t){var s=t&&t.u?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i._="",i(i.V=0)}([function(t,s,i){"use strict";function h(t,s,i,h){return void 0===h&&(h=255),(t<<24)+(s<<16)+(i<<8)+h}i.r(s);const e={A:h(0,0,0),g:h(255,255,255),C:h(170,170,170),M:h(85,85,85),p:h(255,255,85),T:h(170,85,0),N:h(255,85,85),O:h(170,0,0),v:h(85,255,85),R:h(0,170,0),D:h(85,255,255),I:h(0,170,170),L:h(85,85,255),U:h(0,0,170),S:h(255,85,255),m:h(170,0,170),F:h(255,136,0)};class n{constructor(t,s){this.x=t,this.y=s}}class o{constructor(t,s,i,h){this.x=this.left=t,this.y=this.top=s,this.width=i,this.height=h,this.x2=t+i,this.y2=s+h}P(){return new n(this.x+this.width/2|0,this.y+this.height/2|0)}B(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.y<this.x2&&t.y>=this.y&&t.y<this.y2}}class r{constructor(t,s,i){this.G=t,this.rect=s,this.k=i,this.open=!1,this.count=0}}class c{H(t,s){const i=s.Y.width+4,h=s.Y.height+4,e=(t.width-i)/2|0,c=(t.height-h)/2|0;return new r(s,new o(e,c,i,h),new n(e+2,c+2))}W(t,s){const i=s.G,{x:h,y:n,width:o,height:r}=s.rect;t.fillRect(h,n,o,r,0,e.g,e.A),t.J(h,n,o,r),t.j(h+o/2|0,n," "+i.title+" "),i.X(t,s.k)}}class l{constructor(){this.q=!1,this.Z=0,this.$=0}update(){this.q?(this.Z++,this.$=0):(this.Z=0,this.$++)}tt(){const t=this.Z;return 1===t||t>6&&t%1===0}st(){return 1===this.$}}class a{constructor(t){this.keys=new Array(256);for(let t=0;t<256;t++)this.keys[t]=new l;t.addEventListener("keydown",t=>this.it(t,!0)),t.addEventListener("keyup",t=>this.it(t,!1))}it(t,s){const i=t.keyCode;i!==u.ht&&(t.stopPropagation(),t.preventDefault(),i>=0&&i<256&&(this.keys[i].q=s))}et(){for(let t=0;t<256;t++)this.keys[t].update()}getKey(t){return t>=0&&t<256?this.keys[t]:null}}const u={nt:3,ot:6,rt:8,ct:9,lt:12,at:13,ut:16,ft:17,Kt:18,_t:19,Vt:20,At:27,dt:32,wt:33,Et:34,gt:35,Ct:36,Mt:37,pt:38,Tt:39,Nt:40,Ot:44,vt:45,Rt:46,bt:48,yt:49,Dt:50,It:51,Lt:52,Ut:53,St:54,Ft:55,Pt:56,Bt:57,xt:58,Gt:59,kt:60,Ht:61,Yt:62,Qt:63,zt:64,Wt:65,Jt:66,jt:67,Xt:68,qt:69,Zt:70,$t:71,ts:72,ss:73,hs:74,es:75,ns:76,os:77,rs:78,cs:79,ls:80,as:81,us:82,fs:83,Ks:84,_s:85,Vs:86,As:87,ds:88,ws:89,Es:90,gs:93,Cs:96,Ms:97,ps:98,Ts:99,Ns:100,Os:101,vs:102,Rs:103,bs:104,ys:105,Ds:106,Is:107,Ls:108,Us:109,Ss:110,ms:111,Fs:112,Ps:113,Bs:114,xs:115,Gs:116,ks:117,Hs:118,Ys:119,Qs:120,zs:121,ht:122,Ws:123,Js:124,js:125,Xs:126,qs:127,Zs:128,$s:129,ti:130,si:131,ii:132,hi:133,ei:134,ni:135,oi:144,ri:145,ci:160,li:161,ai:162,ui:163,fi:164,Ki:165,_i:166,Vi:167,Ai:168,di:169,wi:170,Ei:171,gi:172,Ci:173,Mi:174,pi:175,Ti:176,Ni:188,Oi:190,vi:191,Ri:192,bi:219,yi:220,Di:221,Ii:222,Li:224,Ui:225,Si:91,mi:21,Fi:21,Pi:22,Bi:23,xi:24,Gi:25,ki:25,Hi:28,Yi:29,Qi:30,zi:31,Wi:41,Ji:42,ji:43,Xi:95};class f{constructor(t,s){this.Y=t,this.title=s}X(t,s){}qi(t,s){}}class K extends f{constructor(t,s){const i=s.split("\n");let h=t.length;for(let t=0;t<i.length;t++)h=Math.max(h,i[t].length);const e=i.length;super(new o(0,0,h,e),t),this.Zi=i}X(t,s){for(let i=0;i<this.Zi.length;i++)t.$i(s.x,s.y+i,this.Zi[i])}qi(t,s){return t.th(u.At)}}class _ extends f{constructor(t,s,i){let h=t.length;for(let t=0;t<s.length;t++)h=Math.max(h,s[t].length+4);const e=s.length;super(new o(0,0,h,e),t),this.options=s,this.sh=i}X(t,s){for(let i=0;i<this.options.length;i++){const h=String.fromCharCode(65+i)+" - "+this.options[i];t.$i(s.x,s.y+i,h)}}qi(t,s){for(let s=0;s<this.options.length;s++)if(t.th(u.Wt+s))return this.sh(s),!0;return t.th(u.At)}}const V=0,A=1,d=2;class w{constructor(t,s,i,h){this.charCode=void 0!==t?function(t){return"string"===typeof t&&t.length>0?t.charCodeAt(0):t}(t):" ".charCodeAt(0),this.ih=void 0!==s?s:e.g,this.hh=void 0!==i?i:e.A,void 0!==h&&(this.eh=h),this.nh=!0}oh(t){this.charCode!==t&&(this.charCode=t,this.nh=!0)}rh(t){void 0!==t&&null!==t&&t!==this.ih&&(this.ih=t,this.nh=!0)}lh(t){void 0!==t&&null!==t&&t!==this.hh&&(this.hh=t,this.nh=!0)}ah(t){void 0!==t&&(this.eh=t,this.nh=!0)}uh(t,s,i,h){return"string"===typeof t&&(t=t.charCodeAt(0)),"number"===typeof t?(this.oh(t),this.rh(s),this.lh(i),this.ah(h)):this.fh(t,V),this.nh}fh(t,s){const i=255&t.hh;s===V||t.charCode>0?(this.oh(t.charCode),this.rh(t.ih)):i>0&&i<255&&this.rh(this.Kh(this.ih,t.hh,s)),s===V||255===i?this.lh(t.hh):i>0&&this.lh(this.Kh(this.hh,t.hh,s)),this.ah(t.eh)}Kh(t,s,i){const e=(255-(255&s))/255,n=1-e,o=t>>24&255,r=t>>16&255,c=t>>8&255,l=s>>24&255,a=s>>16&255,u=s>>8&255;switch(i){case A:return h(e*o+n*l|0,e*r+n*a|0,e*c+n*u|0);case d:return h(this._h(o+n*l|0),this._h(r+n*a|0),this._h(c+n*u|0));default:return s}}_h(t){return Math.min(255,t)}}const E=179,g=186,C=187,M=188,p=191,T=192,N=196,O=200,v=201,R=205,b=217,y=218;class D{constructor(t,s,i){this.width=t,this.height=s,this.Vh=new Array;const h=i||w;for(let i=0;i<s;i++){const s=new Array;for(let e=0;e<t;e++)s.push(new h(e,i));this.Vh.push(s)}this.clear()}clear(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)this.Ah(s,t,0)}dh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.Vh[s][t]}wh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.Vh[s][t].charCode}Ah(t,s,i,h,e){t>=0&&t<this.width&&s>=0&&s<this.height&&this.Vh[s][t].uh(i,h,e)}$i(t,s,i,h,e){const n=i.split("\n");for(let i=0;i<n.length;i++){const o=n[i];for(let n=0;n<o.length;n++)this.Ah(t+n,s+i,o.charCodeAt(n),h,e)}}j(t,s,i,h,e){this.$i(t-Math.floor(i.length/2),s,i,h,e)}Eh(t,s,i,h,e,n){for(let o=t;o<t+i;o++)this.Ah(o,s,h,e,n)}gh(t,s,i,h,e,n){for(let o=s;o<s+i;o++)this.Ah(t,o,h,e,n)}Ch(t,s,i,h,e,n,o){this.Eh(t,s,i,e,n,o),this.Eh(t,s+h-1,i,e,n,o),this.gh(t,s,h,e,n,o),this.gh(t+i-1,s,h,e,n,o)}Mh(t,s,i,h,e,n,o,r,c,l,a,u,f,K){this.fillRect(t,s,i,h,0,f,K),this.Eh(t,s,i,e),this.Eh(t,s+h-1,i,o),this.gh(t,s,h,r),this.gh(t+i-1,s,h,n),this.Ah(t,s,c),this.Ah(t+i-1,s,l),this.Ah(t,s+h-1,u),this.Ah(t+i-1,s+h-1,a)}J(t,s,i,h,e,n){this.Mh(t,s,i,h,N,E,N,E,y,p,b,T,e,n)}ph(t,s,i,h,e,n){this.Mh(t,s,i,h,R,g,R,g,v,C,M,O,e,n)}fillRect(t,s,i,h,e,n,o){for(let r=s;r<s+h;r++)this.Eh(t,r,i,e,n,o)}Th(t,s,i,h,e,n,o,r){r=r||V;for(let c=0;c<o;c++)for(let o=0;o<n;o++){const n=i.dh(h+o,e+c);n&&this.fh(t+o,s+c,n,r)}}fh(t,s,i,h){t>=0&&t<this.width&&s>=0&&s<this.height&&this.Vh[s][t].fh(i,h)}}const I=new class{constructor(t,s,i,h,e){this.url=t,this.Nh=s,this.Oh=i,this.scale=h||1,this.vh=!!e}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);class L{constructor(t,s){this.Rh=t.canvas,this.width=t.width,this.height=t.height,this.options=s,this.bh=0,this.yh=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.buttons=[new l,new l,new l];const i=this.Rh;i.addEventListener("mousedown",t=>this.Dh(t)),i.addEventListener("mouseup",t=>this.Dh(t)),i.addEventListener("mousemove",t=>this.Dh(t)),i.addEventListener("contextmenu",t=>this.Dh(t));const h=this.Ih.bind(this);i.addEventListener("touchstart",h),i.addEventListener("touchend",h),i.addEventListener("touchcancel",h),i.addEventListener("touchmove",h)}Ih(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type&&this.options.requestFullscreen&&this.requestFullscreen(),t.touches.length>0){const s=t.touches[0];this.Lh(s.clientX,s.clientY),this.buttons[0].q=!0}else this.buttons[0].q=!1}Dh(t){t.stopPropagation(),t.preventDefault(),this.Lh(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons[t.button].q=!0,this.Rh.focus(),this.options.requestFullscreen&&this.requestFullscreen()),"mouseup"===t.type&&(this.buttons[t.button].q=!1)}Lh(t,s){let i=this.Rh.getBoundingClientRect();const h=this.width/this.height,e=i.width/i.height;if(e-h>.01){const t=h*i.height,s=i.width-t;i=new o(Math.floor(s/2),0,t,i.height)}if(e-h<-.01){const t=i.width/h,s=i.height-t;i=new o(0,Math.floor(s/2),i.width,t)}this.x=this.width*(t-i.left)/i.width|0,this.y=this.height*(s-i.top)/i.height|0}requestFullscreen(){const t=this.Rh;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()}update(){this.dx=this.x-this.bh,this.dy=this.y-this.yh,this.bh=this.x,this.yh=this.y;for(let t=0;t<this.buttons.length;t++)this.buttons[t].update()}}function U(t,s){return t/s*2-1}const S={font:I,requestFullscreen:!1};class m extends w{constructor(t,s){super(),this.x=t,this.y=s,this.Uh=!1,this.Sh=!1,this.mh=!1,this.visible=!1,this.Fh=-1,this.Ph=0,this.Bh=0,this.xh=null}}class F extends D{constructor(t,s,i){if(super(t,s,m),this.Gh=0,this.kh=0,this.Hh=0,this.Yh=0,this.Qh=0,this.zh=0,this.Wh=0,i)for(let h=0;h<s;h++)for(let s=0;s<t;s++)this.Vh[h][s].Uh=this.Vh[h][s].Sh=i(s,h)}Jh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.Vh[s][t].Uh=i)}jh(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.Vh[s][t].Sh=i)}Xh(t,s){return!(t<this.Hh||t>this.Yh||s<this.Qh||s>this.zh)&&this.Vh[s][t].visible}qh(t,s){const i=[],h=[];let e,n,o,r,c,l,a,u,f,K,_=1,V=0,A=0,d=0;for(n=this.kh+s;n>=this.Qh&&n<=this.zh;n+=s,A=V,++_)for(o=.5/_,K=-1,r=Math.floor(d*_+.5),e=this.Gh+r*t;r<=_&&e>=this.Hh&&e<=this.Yh;e+=t,++r,K=f){if(c=!0,l=!1,a=r/_,u=K,f=a+o,A>0)if(this.Vh[n-s][e].visible&&!this.Vh[n-s][e].Sh||this.Vh[n-s][e-t].visible&&!this.Vh[n-s][e-t].Sh){for(let t=0;t<A&&c;++t)if(u<=h[t]&&f>=i[t])if(this.Vh[n][e].Sh){if(u>=i[t]&&f<=h[t]){c=!1;break}i[t]=Math.min(i[t],u),h[t]=Math.max(h[t],f),l=!0}else if(a>i[t]&&a<h[t]){c=!1;break}}else c=!1;c&&(this.Vh[n][e].visible=!0,this.Vh[n][e].Sh&&(d>=u?d=f:l||(i[V]=u,h[V++]=f)))}}Zh(t,s){const i=[],h=[];let e,n,o,r,c,l,a,u,f,K,_=1,V=0,A=0,d=0;for(e=this.Gh+t;e>=this.Hh&&e<=this.Yh;e+=t,A=V,++_)for(o=.5/_,K=-1,r=Math.floor(d*_+.5),n=this.kh+r*s;r<=_&&n>=this.Qh&&n<=this.zh;n+=s,++r,K=f){if(c=!0,l=!1,a=r/_,u=K,f=a+o,A>0)if(this.Vh[n][e-t].visible&&!this.Vh[n][e-t].Sh||this.Vh[n-s][e-t].visible&&!this.Vh[n-s][e-t].Sh){for(let t=0;t<A&&c;++t)if(u<=h[t]&&f>=i[t])if(this.Vh[n][e].Sh){if(u>=i[t]&&f<=h[t]){c=!1;break}i[t]=Math.min(i[t],u),h[t]=Math.max(h[t],f),l=!0}else if(a>i[t]&&a<h[t]){c=!1;break}}else c=!1;c&&(this.Vh[n][e].visible=!0,this.Vh[n][e].Sh&&(d>=u?d=f:l||(i[V]=u,h[V++]=f)))}}$h(t,s,i,h,e){if(this.Gh=t,this.kh=s,this.Wh=i,h)this.Hh=Math.min(this.Hh,Math.max(0,t-i)),this.Qh=Math.min(this.Qh,Math.max(0,s-i)),this.Yh=Math.max(this.Yh,Math.min(this.width-1,t+i)),this.zh=Math.max(this.zh,Math.min(this.height-1,s+i));else{this.Hh=Math.max(0,t-i),this.Qh=Math.max(0,s-i),this.Yh=Math.min(this.width-1,t+i),this.zh=Math.min(this.height-1,s+i);for(let t=this.Qh;t<=this.zh;t++)for(let s=this.Hh;s<=this.Yh;s++)this.Vh[t][s].visible=!1}this.Vh[s][t].visible=!0,void 0===e?(this.qh(1,1),this.Zh(1,1),this.Zh(1,-1),this.qh(1,-1),this.qh(-1,-1),this.Zh(-1,-1),this.Zh(-1,1),this.qh(-1,1)):(1&e&&this.qh(1,1),2&e&&this.Zh(1,1),4&e&&this.Zh(1,-1),8&e&&this.qh(1,-1),16&e&&this.qh(-1,-1),32&e&&this.Zh(-1,-1),64&e&&this.Zh(-1,1),128&e&&this.qh(-1,1))}te(){for(let t=this.Qh;t<=this.zh;t++)for(let s=this.Hh;s<=this.Yh;s++){const i=this.Vh[t][s];i.mh|=i.visible}}}const P=h(0,0,100),B=h(130,110,50),x=h(50,50,150),G=h(200,180,50);class k{constructor(t,s,i,h,e,n,o){if(this.x=t,this.y=s,this.char=i,this.name=h,this.color=e,this.se=!!n,o)for(var r in o)o.hasOwnProperty(r)&&(this[r]=o[r],this[r].ie=this)}move(t,s){(function(t,s){if(dt.Vh[s][t].Uh)return!0;for(let i=0;i<Vt.length;i++){const h=Vt[i];if(h.se&&h.x===t&&h.y===s)return!0}return!1})(this.x+t,this.y+s)||(this.x+=t,this.y+=s)}he(t,s){const i=t-this.x,h=s-this.y,e=Math.hypot(i,h);this.move(Math.round(i/e),Math.round(h/e))}ee(t){return Math.hypot(t.x-this.x,t.y-this.y)}ne(t,s){return Math.hypot(t-this.x,s-this.y)}oe(){this.remove(),Vt.unshift(this)}remove(){Vt.splice(Vt.indexOf(this),1)}W(){dt.Xh(this.x,this.y)&&ut.$i(this.x,this.y,this.char,this.color)}}class H{constructor(t,s,i,h){this.ie=null,this.re=t,this.ce=s,this.le=i,this.ae=t,this.ue=h||null}attack(t){const s=this.le-t.fe.ce;s>0?(q(Z(this.ie.name)+" attacks "+t.name+" for "+s+" hit points."),t.fe.Ke(s)):q(Z(this.ie.name)+" attacks "+t.name+" but it has no effect!")}Ke(t){this.ae-=t,this.ae<=0&&(this.ae=0,this.ue&&this.ue(this.ie))}_e(t){this.ae=Math.min(this.ae+t,this.re)}}class Y{constructor(){this.ie=null}Ve(){const t=this.ie;dt.Xh(t.x,t.y)&&(t.ee(_t)>=2?t.he(_t.x,_t.y):_t.fe.ae>0&&t.fe.attack(_t))}}class Q{constructor(t){this.ie=null,this.Ae=t,this.de=10}Ve(){this.de>0?(this.ie.move(Kt.we(-1,1),Kt.we(-1,1)),this.de--):(this.ie.Ee=this.Ae,q("The "+this.ie.name+" is no longer confused!",e.N))}}class z{constructor(t){this.ge=t}Ce(){Et.length>=26?q("Your inventory is full, cannot pick up "+this.ie.name+".",e.N):(Et.push(this.ie),this.ie.remove(),q("You picked up a "+this.ie.name+"!",e.v))}Me(){this.ge?this.ge(this):q("The "+this.ie.name+" cannot be used.")}remove(){Et.splice(Et.indexOf(this.ie),1)}}function W(t,s){for(let i=s.y+1;i<s.y2;i++)for(let h=s.x+1;h<s.x2;h++)t.Vh[i][h].Uh=!1,t.Vh[i][h].Sh=!1}function J(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.Vh[h][e].Uh=!1,t.Vh[h][e].Sh=!1}function j(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.Vh[e][h].Uh=!1,t.Vh[e][h].Sh=!1}function X(t){const s=Kt.we(0,3);for(let i=0;i<s;i++){const s=Kt.we(t.x+1,t.x2-1),i=Kt.we(t.y+1,t.y2-1);let h=null;if(Kt.we(0,100)<80){const t=new H(10,0,3,it),n=new Y;h=new k(s,i,"o","orc",e.v,!0,{fe:t,Ee:n})}else{const t=new H(16,1,4,it),n=new Y;h=new k(s,i,"T","troll",e.R,!0,{fe:t,Ee:n})}Vt.push(h)}const i=Kt.we(0,2);for(let s=0;s<i;s++){const s=Kt.we(t.x+1,t.x2-1),i=Kt.we(t.y+1,t.y2-1),h=Kt.we(0,100);let n=null;n=h<50?new k(s,i,"!","healing potion",e.m,!1,{item:new z(et)}):h<70?new k(s,i,"#","scroll of lightning bolt",e.p,!1,{item:new z(nt)}):h<85?new k(s,i,"#","scroll of fireball",e.p,!1,{item:new z(ot)}):new k(s,i,"#","scroll of confusion",e.p,!1,{item:new z(rt)}),Vt.push(n),n.oe()}}function q(t,s){for(;At.length>=6;)At.shift();At.push({text:t,color:s||e.g})}function Z(t){return t?t.charAt(0).toUpperCase()+t.slice(1):t}function $(t,s){const i=_t.x+t,h=_t.y+s;let e=null;for(let t=0;t<Vt.length;t++){const s=Vt[t];if(s.fe&&s.x===i&&s.y===h){e=s;break}}e?_t.fe.attack(e):(_t.move(t,s),wt=!0);for(let t=0;t<Vt.length;t++){const s=Vt[t];s.Ee&&s.Ee.Ve()}}function tt(){if(!(_t.fe.ae<=0)&&!ft.qi()){if(gt)return(ut.th(u.at)||ut.pe.buttons[0].st())&&(t=Ct.x,s=Ct.y,gt(t,s),lt()),(ut.th(u.At)||ut.pe.buttons[2].st())&&lt(),ut.th(u.pt)&&Ct.y--,ut.th(u.Mt)&&Ct.x--,ut.th(u.Tt)&&Ct.x++,ut.th(u.Nt)&&Ct.y++,void(0===ut.pe.dx&&0===ut.pe.dy||(Ct.x=ut.pe.x,Ct.y=ut.pe.y));var t,s;if(ut.th(u.pt)&&$(0,-1),ut.th(u.Mt)&&$(-1,0),ut.th(u.Tt)&&$(1,0),ut.th(u.Nt)&&$(0,1),ut.th(u.$t))for(let t=0;t<Vt.length;t++){const s=Vt[t];s.x===_t.x&&s.y===_t.y&&s.item&&s.item.Ce()}if(ut.th(u.ss))if(0===Et.length)ft.add(new K("ALERT","Inventory is empty"));else{const t=Et.map(t=>t.name);ft.add(new _("INVENTORY",t,st))}}}function st(t){t>=0&&Et[t].item.Me()}function it(t){q(Z(t.name)+" is dead!",e.T),t.char="%",t.color=e.O,t.se=!1,t.fe=null,t.Ee=null,t.name="remains of "+t.name,t.oe()}function ht(t,s,i){let h=i+1,e=null;for(let i=0;i<Vt.length;i++){const n=Vt[i];if(n.fe&&n!==_t){const i=n.ne(t,s);i<h&&(h=i,e=n)}}return e}function et(t){_t.fe.ae!==_t.fe.re?(q("Your wounds start to feel better!",e.S),_t.fe._e(4),t.remove()):q("You are already at full health.",e.O)}function nt(t){const s=ht(_t.x,_t.y,5);s?(q("A lightning bolt strikes the "+s.name+" with a loud thunder!",e.L),q("The damage is 20 hit points",e.L),s.fe.Ke(20),t.remove()):q("No enemy is close enough to strike.",e.N)}function ot(t){q("Left-click to cast fireball, or right-click to cancel.",e.D),ct((s,i)=>{if(_t.ne(s,i)>10)q("Target out of range.",e.C);else{q("The fireball explodes, burning everything within 3 tiles!",e.F);for(let t=0;t<Vt.length;t++){const h=Vt[t];h.fe&&h.ne(s,i)<=3&&(q("The "+h.name+" gets burned for 12 hit points.",e.F),h.fe.Ke(12))}t.remove()}})}function rt(t){q("Left-click to cast confuse, or right-click to cancel.",e.D),ct((s,i)=>{if(_t.ne(s,i)>8)return void q("Target out of range.",e.C);const h=function(t,s){return ht(t,s,0)}(s,i);h?(h.Ee=new Q(h.Ee),h.Ee.ie=h,q("The eyes of the "+h.name+" look vacant, as he stumbles around!",e.v),t.remove()):q("No monster there.",e.C)})}function ct(t){gt=t,Ct.x=_t.x,Ct.y=_t.y}function lt(){gt=null}function at(){wt&&(dt.$h(_t.x,_t.y,10),wt=!1);for(let t=0;t<43;t++)for(let s=0;s<80;s++){const i=dt.Xh(s,t),h=dt.Vh[t][s].Sh;let n=e.A;i?(n=h?B:G,dt.Vh[t][s].mh=!0):dt.Vh[t][s].mh&&(n=h?P:x),ut.Ah(s,t,0,0,n)}for(let t=0;t<Vt.length;t++)Vt[t].W();ut.fillRect(0,38,80,7,0,e.g,e.A);let t=39;for(let s=0;s<At.length;s++){const i=At[s];ut.$i(22,t,i.text,i.color),t++}!function(t,s,i,h,n,o,r,c){const l=Math.round(n/o*i);ut.fillRect(t,s,i,1,0,0,c),l>0&&ut.fillRect(t,s,l,1,0,0,r),ut.j(t+i/2,s,h+": "+n+"/"+o,e.g)}(1,39,20,"HP",_t.fe.ae,_t.fe.re,e.N,e.O),ut.$i(1,38,function(){const t=ut.pe.x,s=ut.pe.y;if(!dt.Xh(t,s))return"";const i=[];for(let h=0;h<Vt.length;h++){const e=Vt[h];e.x===t&&e.y===s&&i.push(e.name)}return Z(i.join(", "))}(),e.C),gt&&ut.dh(Ct.x,Ct.y).lh(e.g),ft.W()}const ut=new class extends D{constructor(t,s,i,h){super(s,i),h=h||S,this.canvas=t,this.font=h.font||I,this.pixelWidth=s*this.font.Nh,this.pixelHeight=i*this.font.Oh,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.font.scale*this.pixelWidth+"px",t.style.height=this.font.scale*this.pixelHeight+"px",t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.Te(),window.addEventListener("resize",()=>this.Te()),this.keys=new a(t),this.pe=new L(this,h);const e=t.getContext("webgl",{Ne:!1});if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=e.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.Oe=e,this.ve=n,e.attachShader(n,this.Re(e.VERTEX_SHADER,"attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),e.attachShader(n,this.Re(e.FRAGMENT_SHADER,"varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform bool h;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(h){if(gl_FragColor.a<0.1){gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}}")),e.linkProgram(n),e.useProgram(n),this.font.vh&&e.uniform1i(e.getUniformLocation(n,"h"),1),this.be=this.getAttribLocation("a"),this.ye=this.getAttribLocation("b"),this.De=this.getAttribLocation("c"),this.Ie=this.getAttribLocation("d");const o=s*i;this.Le=new Float32Array(3*o*4),this.Ue=new Uint16Array(6*o),this.Se=new Float32Array(2*o*4),this.me=new Uint8Array(4*o*4),this.Fe=new DataView(this.me.buffer),this.Pe=new Uint8Array(4*o*4),this.Be=new DataView(this.Pe.buffer);let r=0,c=0,l=0;for(let t=0;t<i;t++)for(let h=0;h<s;h++)this.Le[r++]=U(h,s),this.Le[r++]=-U(t,i),this.Le[r++]=U(h+1,s),this.Le[r++]=-U(t,i),this.Le[r++]=U(h+1,s),this.Le[r++]=-U(t+1,i),this.Le[r++]=U(h,s),this.Le[r++]=-U(t+1,i),this.Ue[c++]=l+0,this.Ue[c++]=l+1,this.Ue[c++]=l+2,this.Ue[c++]=l+0,this.Ue[c++]=l+2,this.Ue[c++]=l+3,l+=4;this.xe=e.createBuffer(),this.Ge=e.createBuffer(),this.ke=e.createBuffer(),this.He=e.createBuffer(),this.Ye=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.xe),e.bufferData(e.ARRAY_BUFFER,this.Le,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.Ge),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.Ue,e.STATIC_DRAW),this.Qe=this.ze(this.font.url),window.setInterval(()=>this.We(),1e3/30)}Te(){const t=this.canvas.parentElement.offsetWidth/this.pixelWidth,s=this.canvas.parentElement.offsetHeight/this.pixelHeight,i=Math.min(t,s),h=i*this.pixelWidth|0,e=i*this.pixelHeight|0;this.canvas.style.width=h+"px",this.canvas.style.height=e+"px"}getAttribLocation(t){const s=this.Oe.getAttribLocation(this.ve,t);return this.Oe.enableVertexAttribArray(s),s}flush(){let t=0,s=0;for(let i=0;i<this.height;i++)for(let h=0;h<this.width;h++){const e=this.dh(h,i);if(!e.nh){t+=8,s+=16;continue}const n=e.charCode%16,o=e.charCode/16|0;this.Se[t++]=n,this.Se[t++]=o,this.Se[t++]=n+1,this.Se[t++]=o,this.Se[t++]=n+1,this.Se[t++]=o+1,this.Se[t++]=n,this.Se[t++]=o+1;for(let t=0;t<4;t++)this.Fe.setUint32(s,e.ih,!1),this.Be.setUint32(s,e.hh,!1),s+=4;e.nh=!1}}Je(t){const s=this.keys.getKey(t);return s&&s.q}th(t){const s=this.keys.getKey(t);return s&&s.tt()}je(t){const s=this.keys.getKey(t);return s?s.Z:0}Re(t,s){const i=this.Oe,h=i.createShader(t);if(!h)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(h,s),i.compileShader(h),!i.getShaderParameter(h,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(h));return h}ze(t){const s=this.Oe,i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const h=s.RGBA,e=s.RGBA,n=s.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);s.texImage2D(s.TEXTURE_2D,0,h,1,1,0,e,n,o);const r=new Image;return r.onload=()=>{s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,h,e,n,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)},r.src=t,i}Xe(){const t=this.Oe;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.xe),t.vertexAttribPointer(this.be,s,i,h,e,n)}{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.ke),t.bufferData(t.ARRAY_BUFFER,this.Se,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.ye,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.He),t.bufferData(t.ARRAY_BUFFER,this.me,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.De,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Ye),t.bufferData(t.ARRAY_BUFFER,this.Pe,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ie,s,i,h,e,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.Ge),t.useProgram(this.ve),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.Qe);{const s=this.width*this.height*6,i=t.UNSIGNED_SHORT,h=0;t.drawElements(t.TRIANGLES,s,i,h)}}We(){this.keys.et(),this.pe.update(),this.update&&this.update(),this.state&&this.state.update(),this.flush(),this.Xe()}}(document.querySelector("canvas"),80,45),ft=new class{constructor(t,s){this.qe=t,this.Ze=s||new c,this.$e=[]}add(t){this.$e.push(this.Ze.H(this.qe,t))}qi(){if(0===this.$e.length)return!1;const t=this.$e.length-1,s=this.$e[this.$e.length-1];return s.G.qi(this.qe,s.k)&&this.$e.splice(t,1),!0}W(){for(let t=0;t<this.$e.length;t++)this.Ze.W(this.qe,this.$e[t])}}(ut),Kt=new class{constructor(t){this.h=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}tn(){return this.state=(this.a*this.state+this.c)%this.h,this.state}sn(){return this.tn()/(this.h-1)}we(t,s){const i=s-t,h=t+(this.tn()/this.h*i|0);if(isNaN(h))throw new Error("rand nan");return h}in(t){const s=t.reduce((t,s)=>t+s),i=this.we(1,s+1);let h=0;for(let s=0;s<t.length;s++)if(h+=t[s],i<=h)return s;return t.length-1}hn(t){const s=[],i=[];for(const h in t)t.hasOwnProperty(h)&&(s.push(h),i.push(t[h]));return s[this.in(i)]}}(1),_t=new k(40,25,"@","player",e.g,!0,{fe:new H(20,2,5,(function(t){q("You died!",e.N)}))}),Vt=[_t],At=[],dt=function(){const t=new F(80,43);for(let s=0;s<43;s++)for(let i=0;i<80;i++)t.Vh[s][i].Uh=!0,t.Vh[s][i].Sh=!0;const s=[];for(let i=0;i<30;i++){const i=Kt.we(6,10),h=Kt.we(6,10),e=Kt.we(0,80-i-1),n=Kt.we(0,43-h-1),r=new o(e,n,i,h);let c=!1;for(let t=0;t<s.length;t++)if(r.B(s[t])){c=!0;break}if(!c){W(t,r);const i=r.P();if(0===s.length)_t.x=i.x,_t.y=i.y;else{const h=s[s.length-1].P();1===Kt.we(0,1)?(J(t,h.x,i.x,h.y),j(t,h.y,i.y,i.x)):(j(t,h.y,i.y,h.x),J(t,h.x,i.x,i.y))}X(r),s.push(r)}}return t}();let wt=!0;const Et=[];let gt=null,Ct={x:0,y:0};q("Welcome stranger! Prepare to perish!",e.O),ut.update=function(){tt(),at()}}])}));