<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>WGLT - Roguelike Tutorial - Part 2</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
    <canvas></canvas>
    <p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_2">Part 2: The object and the map</a></p>
    <p>This introduces two new concepts: the generic object system that will be the basis for the whole game, and a general map object that you'll use to hold your dungeon.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part1.js	2018-11-22 14:06:47.009119000 -0800</div>
<div class="c2">+++ part2.js	2018-11-22 14:06:51.386855500 -0800</div>
<div class="c1">@@ -3,33 +3,92 @@</div>
<div class="c0"> const SCREEN_WIDTH = 80;</div>
<div class="c0"> const SCREEN_HEIGHT = 50;</div>
<div class="c0"> </div>
<div class="c2">+// Size of the map</div>
<div class="c2">+const MAP_WIDTH = 80;</div>
<div class="c2">+const MAP_HEIGHT = 45;</div>
<div class="c2">+</div>
<div class="c2">+const COLOR_DARK_WALL = wglt.fromRgb(0, 0, 100);</div>
<div class="c2">+const COLOR_DARK_GROUND = wglt.fromRgb(50, 50, 150);</div>
<div class="c2">+</div>
<div class="c2">+function Tile(blocked) {</div>
<div class="c2">+    this.blocked = blocked;</div>
<div class="c2">+    this.blockSight = blocked;</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function Entity(x, y, char, color) {</div>
<div class="c2">+    this.x = x;</div>
<div class="c2">+    this.y = y;</div>
<div class="c2">+    this.char = char;</div>
<div class="c2">+    this.color = color;</div>
<div class="c2">+</div>
<div class="c2">+    this.move = function (dx, dy) {</div>
<div class="c2">+        if (map[this.y + dy][this.x + dx].blocked) {</div>
<div class="c2">+            return;</div>
<div class="c2">+        }</div>
<div class="c2">+        this.x += dx;</div>
<div class="c2">+        this.y += dy;</div>
<div class="c2">+    };</div>
<div class="c2">+</div>
<div class="c2">+    this.draw = function () {</div>
<div class="c2">+        term.drawString(this.x, this.y, this.char, this.color);</div>
<div class="c2">+    };</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function createMap() {</div>
<div class="c2">+    const map = new Array(MAP_HEIGHT);</div>
<div class="c2">+    for (let y = 0; y &lt; MAP_HEIGHT; y++) {</div>
<div class="c2">+        map[y] = new Array(MAP_WIDTH);</div>
<div class="c2">+        for (let x = 0; x &lt; MAP_WIDTH; x++) {</div>
<div class="c2">+            map[y][x] = new Tile(false);</div>
<div class="c2">+        }</div>
<div class="c2">+    }</div>
<div class="c2">+    return map;</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> function handleKeys() {</div>
<div class="c0">     if (term.isKeyPressed(wglt.Keys.VK_UP)) {</div>
<div class="c3">-        y--;</div>
<div class="c2">+        player.move(0, -1);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(wglt.Keys.VK_LEFT)) {</div>
<div class="c3">-        x--;</div>
<div class="c2">+        player.move(-1, 0);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(wglt.Keys.VK_RIGHT)) {</div>
<div class="c3">-        x++;</div>
<div class="c2">+        player.move(1, 0);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(wglt.Keys.VK_DOWN)) {</div>
<div class="c3">-        y++;</div>
<div class="c2">+        player.move(0, 1);</div>
<div class="c0">     }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function renderAll() {</div>
<div class="c0">     term.clear();</div>
<div class="c3">-    term.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT, 0, wglt.Colors.YELLOW, wglt.Colors.DARK_BLUE)</div>
<div class="c3">-    term.drawString(1, 1, 'Hello world!');</div>
<div class="c3">-    term.drawString(1, 3, 'Use arrow keys to move');</div>
<div class="c3">-    term.drawString(x, y, '@');</div>
<div class="c2">+</div>
<div class="c2">+    for (let y = 0; y &lt; MAP_HEIGHT; y++) {</div>
<div class="c2">+        for (let x = 0; x &lt; MAP_WIDTH; x++) {</div>
<div class="c2">+            let wall = map[y][x].blockSight;</div>
<div class="c2">+            if (wall) {</div>
<div class="c2">+                term.drawChar(x, y, 0, 0, COLOR_DARK_WALL);</div>
<div class="c2">+            } else {</div>
<div class="c2">+                term.drawChar(x, y, 0, 0, COLOR_DARK_GROUND);</div>
<div class="c2">+            }</div>
<div class="c2">+        }</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    for (let i = 0; i &lt; entities.length; i++) {</div>
<div class="c2">+        entities[i].draw();</div>
<div class="c2">+    }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> const term = new wglt.Terminal(document.querySelector('canvas'), SCREEN_WIDTH, SCREEN_HEIGHT);</div>
<div class="c2">+const player = new Entity(40, 25, '@', wglt.Colors.WHITE);</div>
<div class="c2">+const npc = new Entity(40, 20, '@', wglt.Colors.YELLOW);</div>
<div class="c2">+const entities = [player, npc];</div>
<div class="c2">+const map = createMap();</div>
<div class="c0"> </div>
<div class="c3">-let x = 10;</div>
<div class="c3">-let y = 10;</div>
<div class="c2">+map[22][30].blocked = true;</div>
<div class="c2">+map[22][30].blockSight = true;</div>
<div class="c2">+map[22][50].blocked = true;</div>
<div class="c2">+map[22][50].blockSight = true;</div>
<div class="c0"> </div>
<div class="c0"> term.update = function () {</div>
<div class="c0">     handleKeys();</div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.umd.js"></script>
    <script src="part2.js"></script>
</body>

</html>