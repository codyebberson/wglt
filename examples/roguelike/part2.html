<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>WGLT - Roguelike Tutorial - Part 2</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
    <canvas></canvas>
    <p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_2">Part 2: The object and the map</a></p>
    <p>This introduces two new concepts: the generic object system that will be the basis for the whole game, and a general map object that you'll use to hold your dungeon.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part1.js	2019-12-15 15:45:59.811441100 -0800</div>
<div class="c2">+++ part2.js	2019-12-15 15:46:23.992039700 -0800</div>
<div class="c1">@@ -1,38 +1,84 @@</div>
<div class="c0"> </div>
<div class="c0"> import {Colors} from &#x27;../../src/colors.js&#x27;;</div>
<div class="c2">+import {fromRgb} from &#x27;../../src/color.js&#x27;;</div>
<div class="c0"> import {Keys} from &#x27;../../src/keys.js&#x27;;</div>
<div class="c0"> import {Terminal} from &#x27;../../src/terminal.js&#x27;;</div>
<div class="c2">+import {TileMap} from &#x27;../../src/tilemap.js&#x27;;</div>
<div class="c0"> </div>
<div class="c0"> // Actual size of the window</div>
<div class="c0"> const SCREEN_WIDTH = 80;</div>
<div class="c0"> const SCREEN_HEIGHT = 45;</div>
<div class="c0"> </div>
<div class="c2">+// Size of the map</div>
<div class="c2">+const MAP_WIDTH = 80;</div>
<div class="c2">+const MAP_HEIGHT = 45;</div>
<div class="c2">+</div>
<div class="c2">+const COLOR_DARK_WALL = fromRgb(0, 0, 100);</div>
<div class="c2">+const COLOR_DARK_GROUND = fromRgb(50, 50, 150);</div>
<div class="c2">+</div>
<div class="c2">+class Entity {
    x: number;
    y: number;
    char: string;
    name: string;
    color: Color;
    blocks: boolean;
</div>
<div class="c2">+    constructor(x: number, y: number, char: string, color: Color) {</div>
<div class="c2">+        this.x = x;</div>
<div class="c2">+        this.y = y;</div>
<div class="c2">+        this.char = char;</div>
<div class="c2">+        this.color = color;</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    move(dx: number, dy: number) {</div>
<div class="c2">+        if (map.grid[this.y + dy][this.x + dx].blocked) {</div>
<div class="c2">+            return;</div>
<div class="c2">+        }</div>
<div class="c2">+        this.x += dx;</div>
<div class="c2">+        this.y += dy;</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    draw() {</div>
<div class="c2">+        term.drawString(this.x, this.y, this.char, this.color);</div>
<div class="c2">+    }</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> function handleKeys() {</div>
<div class="c0">     if (term.isKeyPressed(Keys.VK_UP)) {</div>
<div class="c3">-        y--;</div>
<div class="c2">+        player.move(0, -1);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(Keys.VK_LEFT)) {</div>
<div class="c3">-        x--;</div>
<div class="c2">+        player.move(-1, 0);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(Keys.VK_RIGHT)) {</div>
<div class="c3">-        x++;</div>
<div class="c2">+        player.move(1, 0);</div>
<div class="c0">     }</div>
<div class="c0">     if (term.isKeyPressed(Keys.VK_DOWN)) {</div>
<div class="c3">-        y++;</div>
<div class="c2">+        player.move(0, 1);</div>
<div class="c0">     }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function renderAll() {</div>
<div class="c3">-    term.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT, 0, Colors.YELLOW, Colors.DARK_BLUE)</div>
<div class="c3">-    term.drawString(1, 1, &#x27;Hello world!&#x27;);</div>
<div class="c3">-    term.drawString(1, 3, &#x27;Use arrow keys to move&#x27;);</div>
<div class="c3">-    term.drawString(x, y, &#x27;@&#x27;);</div>
<div class="c2">+    for (let y = 0; y &lt; MAP_HEIGHT; y++) {</div>
<div class="c2">+        for (let x = 0; x &lt; MAP_WIDTH; x++) {</div>
<div class="c2">+            let wall = map.grid[y][x].blockedSight;</div>
<div class="c2">+            if (wall) {</div>
<div class="c2">+                term.drawChar(x, y, 0, 0, COLOR_DARK_WALL);</div>
<div class="c2">+            } else {</div>
<div class="c2">+                term.drawChar(x, y, 0, 0, COLOR_DARK_GROUND);</div>
<div class="c2">+            }</div>
<div class="c2">+        }</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    for (let i = 0; i &lt; entities.length; i++) {</div>
<div class="c2">+        entities[i].draw();</div>
<div class="c2">+    }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> const term = new Terminal(document.querySelector(&#x27;canvas&#x27;), SCREEN_WIDTH, SCREEN_HEIGHT);</div>
<div class="c3">-</div>
<div class="c3">-let x = 10;</div>
<div class="c3">-let y = 10;</div>
<div class="c2">+const player = new Entity(40, 25, &#x27;@&#x27;, Colors.WHITE);</div>
<div class="c2">+const npc = new Entity(40, 20, &#x27;@&#x27;, Colors.YELLOW);</div>
<div class="c2">+const entities = [player, npc];</div>
<div class="c2">+const map = new Console(MAP_WIDTH, MAP_HEIGHT);</div>
<div class="c2">+</div>
<div class="c2">+map.grid[22][30].blocked = true;</div>
<div class="c2">+map.grid[22][30].blockedSight = true;</div>
<div class="c2">+map.grid[22][50].blocked = true;</div>
<div class="c2">+map.grid[22][50].blockedSight = true;</div>
<div class="c0"> </div>
<div class="c0"> term.update = function () {</div>
<div class="c0">     handleKeys();</div>
<!--ENDDIFF-->
    </div>
    <script src="part2.min.js"></script>
</body>

</html>