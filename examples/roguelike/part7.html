<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 7</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
    <canvas></canvas>
    <p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_7">Part 7: The GUI</a></p>
    <p>A juicy Graphical User Interface with status bars and a colored message log for maximum eye-candy. Also, the infamous "look" command, with a twist: you can use the mouse.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part6.js	2019-02-16 11:58:24.000000000 -0800</div>
<div class="c2">+++ part7.js	2019-02-16 12:00:06.000000000 -0800</div>
<div class="c1">@@ -128,17 +128,26 @@</div>
<div class="c0"> </div>
<div class="c0">         monster.health = 20;</div>
<div class="c0">         monster.ai = new wglt.BasicMonster(monster);</div>
<div class="c2">+        monster.onAttack = attackCallback;</div>
<div class="c0">         monster.onDeath = monsterDeath;</div>
<div class="c0">         game.entities.push(monster);</div>
<div class="c0">     }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c2">+function attackCallback(attacker, target, damage) {</div>
<div class="c2">+    if (damage &gt; 0) {</div>
<div class="c2">+        messageLog.add(attacker.name + &#x27; attacks &#x27; + target.name + &#x27; for &#x27; + damage + &#x27; hit points.&#x27;, 0x808080FF);</div>
<div class="c2">+    } else {</div>
<div class="c2">+        messageLog.add(attacker.name + &#x27; attacks &#x27; + target.name + &#x27; but it has no effect!&#x27;, 0x808080FF);</div>
<div class="c2">+    }</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> function playerDeath(player) {</div>
<div class="c3">-    console.log(&#x27;You died!&#x27;);</div>
<div class="c2">+    messageLog.add(&#x27;You died!&#x27;);</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function monsterDeath(monster) {</div>
<div class="c3">-    console.log(monster.name + &#x27; is dead&#x27;);</div>
<div class="c2">+    messageLog.add(monster.name + &#x27; is dead&#x27;);</div>
<div class="c0">     monster.char = &#x27;%&#x27;;</div>
<div class="c0">     monster.color = wglt.Colors.DARK_RED;</div>
<div class="c0">     monster.blocks = false;</div>
<div class="c1">@@ -163,16 +172,29 @@</div>
<div class="c0"> const rng = new wglt.RNG(1);</div>
<div class="c0"> const sprite = new wglt.Sprite(0, 16, 16, 16, 2, true);</div>
<div class="c0"> const player = new wglt.Entity(game, 30, 20, &#x27;Player&#x27;, sprite, true);</div>
<div class="c2">+player.onAttack = attackCallback;</div>
<div class="c2">+player.onDeath = playerDeath;</div>
<div class="c2">+</div>
<div class="c0"> const map = new wglt.TileMap(app.gl, MAP_WIDTH, MAP_HEIGHT, 1);</div>
<div class="c0"> game.tileMap = map;</div>
<div class="c0"> game.player = player;</div>
<div class="c0"> game.entities.push(player);</div>
<div class="c0"> </div>
<div class="c3">-const messageLog = new wglt.MessageLog(game.gui, new wglt.Rect(1, 1, 100, 100));</div>
<div class="c3">-messageLog.add(&#x27;Hello world!&#x27;);</div>
<div class="c3">-messageLog.add(&#x27;Use arrow keys to move&#x27;);</div>
<div class="c2">+const messageLog = new wglt.MessageLog(game.gui, new wglt.Rect(1, 224 - 50, 100, 100));</div>
<div class="c2">+messageLog.add(&#x27;Welcome stranger! Prepare to perish!&#x27;, wglt.Colors.DARK_RED);</div>
<div class="c0"> game.gui.add(messageLog);</div>
<div class="c0"> </div>
<div class="c2">+const playerStats = new wglt.Panel(game.gui, new wglt.Rect(1, 1, 100, 100));</div>
<div class="c2">+playerStats.drawContents = function() {</div>
<div class="c2">+    const frameY = 0;</div>
<div class="c2">+    const hpPercent = player.health / player.maxHealth;</div>
<div class="c2">+    app.drawString(player.name, 1, frameY);</div>
<div class="c2">+    app.drawImage(0, frameY + 7, 32, 64, 32, 12);</div>
<div class="c2">+    app.drawImage(2, frameY + 9, 32, 80, 8, 8, undefined, Math.round(hpPercent * 28));</div>
<div class="c2">+    app.drawString(player.health + &#x27;/&#x27; + player.maxHealth, 3, frameY + 10);</div>
<div class="c2">+};</div>
<div class="c2">+game.gui.add(playerStats);</div>
<div class="c2">+</div>
<div class="c0"> // Generate the map</div>
<div class="c0"> createMap();</div>
<div class="c0"> </div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.js"></script>
	<script src="part7.js"></script>
</body>

</html>
