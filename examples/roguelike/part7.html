<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<title>WGLT - Roguelike Tutorial - Part 7</title>
    <link href="../../styles.css" rel="stylesheet">
</head>

<body>
    <canvas></canvas>
    <p><a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod,_part_7">Part 7: The GUI</a></p>
    <p>A juicy Graphical User Interface with status bars and a colored message log for maximum eye-candy. Also, the infamous "look" command, with a twist: you can use the mouse.</p>
    <div class="diff">
        <!--STARTDIFF--><div class="c3">--- part6.js	2018-11-22 14:08:07.811906200 -0800</div>
<div class="c2">+++ part7.js	2018-11-23 16:31:04.465235000 -0800</div>
<div class="c1">@@ -5,7 +5,15 @@</div>
<div class="c0"> </div>
<div class="c0"> // Size of the map</div>
<div class="c0"> const MAP_WIDTH = 80;</div>
<div class="c3">-const MAP_HEIGHT = 45;</div>
<div class="c2">+const MAP_HEIGHT = 43;</div>
<div class="c2">+</div>
<div class="c2">+// Sizes and coordinates relevant for the GUI</div>
<div class="c2">+const BAR_WIDTH = 20;</div>
<div class="c2">+const PANEL_HEIGHT = 7;</div>
<div class="c2">+const PANEL_Y = SCREEN_HEIGHT - PANEL_HEIGHT;</div>
<div class="c2">+const MSG_X = BAR_WIDTH + 2;</div>
<div class="c2">+const MSG_WIDTH = SCREEN_WIDTH - BAR_WIDTH - 2;</div>
<div class="c2">+const MSG_HEIGHT = PANEL_HEIGHT - 1;</div>
<div class="c0"> </div>
<div class="c0"> // Parameters for dungeon generator</div>
<div class="c0"> const ROOM_MAX_SIZE = 10;</div>
<div class="c1">@@ -110,10 +118,10 @@</div>
<div class="c0">         const damage = this.power - target.fighter.defense;</div>
<div class="c0"> </div>
<div class="c0">         if (damage &gt; 0) {</div>
<div class="c3">-            console.log(this.owner.name + ' attacks ' + target.name + ' for ' + damage + ' hit points.');</div>
<div class="c2">+            addMessage(capitalize(this.owner.name) + ' attacks ' + target.name + ' for ' + damage + ' hit points.');</div>
<div class="c0">             target.fighter.takeDamage(damage);</div>
<div class="c0">         } else {</div>
<div class="c3">-            console.log(this.owner.name + ' attacks ' + target.name + ' but it has no effect!');</div>
<div class="c2">+            addMessage(capitalize(this.owner.name) + ' attacks ' + target.name + ' but it has no effect!');</div>
<div class="c0">         }</div>
<div class="c0">     };</div>
<div class="c0"> </div>
<div class="c1">@@ -294,6 +302,57 @@</div>
<div class="c0">     }</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c2">+function renderBar(x, y, totalWidth, name, value, maximum, barColor, backColor) {</div>
<div class="c2">+    // Render a bar (HP, experience, etc). first calculate the width of the bar</div>
<div class="c2">+    const barWidth = Math.round(value / maximum * totalWidth);</div>
<div class="c2">+</div>
<div class="c2">+    // Render the background first</div>
<div class="c2">+    term.fillRect(x, y, totalWidth, 1, 0, 0, backColor);</div>
<div class="c2">+</div>
<div class="c2">+    // Now render the bar on top</div>
<div class="c2">+    if (barWidth &gt; 0) {</div>
<div class="c2">+        term.fillRect(x, y, barWidth, 1, 0, 0, barColor);</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    // Finally, some centered text with the values</div>
<div class="c2">+    // term.fillForegroundRect(x, y, totalWidth, 1, wglt.Colors.WHITE);</div>
<div class="c2">+    term.drawCenteredString(x + totalWidth / 2, y, name + ': ' + value + '/' + maximum, wglt.Colors.WHITE);</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function getNamesUnderMouse() {</div>
<div class="c2">+    const x = term.mouse.x;</div>
<div class="c2">+    const y = term.mouse.y;</div>
<div class="c2">+</div>
<div class="c2">+    if (!fovMap.isVisible(x, y)) {</div>
<div class="c2">+        return '';</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    const names = [];</div>
<div class="c2">+</div>
<div class="c2">+    for (let i = 0; i &lt; entities.length; i++) {</div>
<div class="c2">+        const entity = entities[i];</div>
<div class="c2">+        if (entity.x === x &amp;&amp; entity.y === y) {</div>
<div class="c2">+            names.push(entity.name);</div>
<div class="c2">+        }</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    return capitalize(names.join(', '));</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function addMessage(msg, opt_color) {</div>
<div class="c2">+    while (messages.length &gt;= MSG_HEIGHT) {</div>
<div class="c2">+        messages.shift();</div>
<div class="c2">+    }</div>
<div class="c2">+    messages.push({ text: msg, color: (opt_color || wglt.Colors.WHITE) });</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c2">+function capitalize(str) {</div>
<div class="c2">+    if (!str) {</div>
<div class="c2">+        return str;</div>
<div class="c2">+    }</div>
<div class="c2">+    return str.charAt(0).toUpperCase() + str.slice(1);</div>
<div class="c2">+}</div>
<div class="c2">+</div>
<div class="c0"> function playerMoveOrAttack(dx, dy) {</div>
<div class="c0">     const x = player.x + dx;</div>
<div class="c0">     const y = player.y + dy;</div>
<div class="c1">@@ -341,11 +400,11 @@</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function playerDeath(player) {</div>
<div class="c3">-    console.log('You died!');</div>
<div class="c2">+    addMessage('You died!', wglt.Colors.LIGHT_RED);</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> function monsterDeath(monster) {</div>
<div class="c3">-    console.log(monster.name + ' is dead');</div>
<div class="c2">+    addMessage(capitalize(monster.name) + ' is dead!', wglt.Colors.BROWN);</div>
<div class="c0">     monster.char = '%';</div>
<div class="c0">     monster.color = wglt.Colors.DARK_RED;</div>
<div class="c0">     monster.blocks = false;</div>
<div class="c1">@@ -385,16 +444,39 @@</div>
<div class="c0">     for (let i = 0; i &lt; entities.length; i++) {</div>
<div class="c0">         entities[i].draw();</div>
<div class="c0">     }</div>
<div class="c2">+</div>
<div class="c2">+    // Prepare to render the GUI panel</div>
<div class="c2">+    term.fillRect(0, PANEL_Y, SCREEN_WIDTH, PANEL_HEIGHT, 0, wglt.Colors.WHITE, wglt.Colors.BLACK);</div>
<div class="c2">+</div>
<div class="c2">+    // Print the game messages, one line at a time</div>
<div class="c2">+    y = PANEL_Y + 1;</div>
<div class="c2">+    for (let i = 0; i &lt; messages.length; i++) {</div>
<div class="c2">+        const message = messages[i];</div>
<div class="c2">+        term.drawString(MSG_X, y, message.text, message.color);</div>
<div class="c2">+        y++;</div>
<div class="c2">+    }</div>
<div class="c2">+</div>
<div class="c2">+    // Show the player's stats</div>
<div class="c2">+    renderBar(</div>
<div class="c2">+        1, PANEL_Y + 1, BAR_WIDTH,</div>
<div class="c2">+        'HP', player.fighter.hp, player.fighter.maxHp,</div>
<div class="c2">+        wglt.Colors.LIGHT_RED, wglt.Colors.DARK_RED);</div>
<div class="c2">+</div>
<div class="c2">+    // Display names of objects under the mouse</div>
<div class="c2">+    term.drawString(1, PANEL_Y, getNamesUnderMouse(), wglt.Colors.LIGHT_GRAY);</div>
<div class="c0"> }</div>
<div class="c0"> </div>
<div class="c0"> const term = new wglt.Terminal(document.querySelector('canvas'), SCREEN_WIDTH, SCREEN_HEIGHT);</div>
<div class="c0"> const rng = new wglt.RNG(1);</div>
<div class="c0"> const player = new Entity(40, 25, '@', 'player', wglt.Colors.WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });</div>
<div class="c0"> const entities = [player];</div>
<div class="c2">+const messages = [];</div>
<div class="c0"> const map = createMap();</div>
<div class="c0"> const fovMap = new wglt.FovMap(MAP_WIDTH, MAP_HEIGHT, (x, y) =&gt; map[y][x].blocked);</div>
<div class="c0"> let fovRecompute = true;</div>
<div class="c0"> </div>
<div class="c2">+addMessage('Welcome stranger! Prepare to perish!', wglt.Colors.DARK_RED);</div>
<div class="c2">+</div>
<div class="c0"> term.update = function () {</div>
<div class="c0">     handleKeys();</div>
<div class="c0">     renderAll();</div>
<!--ENDDIFF-->
    </div>
    <script src="../../dist/index.umd.js"></script>
	<script src="part7.js"></script>
</body>

</html>