!function(t,s){if("object"===typeof exports&&"object"===typeof module)module.t=s();else if("function"===typeof define&&define.amd)define([],s);else{var i=s();for(var h in i)("object"===typeof exports?exports:t)[h]=i[h]}}(window,(function(){return function(t){var s={};function i(h){if(s[h])return s[h].t;var e=s[h]={s:h,i:!1,t:{}};return t[h].call(e.t,e,e.t,i),e.i=!0,e.t}return i.h=t,i.c=s,i.d=function(t,s,h){i.o(t,s)||Object.defineProperty(t,s,{l:!0,get:h})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"_",{value:!0})},i.u=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"===typeof t&&t&&t._)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{l:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,function(s){return t[s]}.bind(null,e));return h},i.n=function(t){var s=t&&t._?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.K="",i(i.A=0)}([function(t,s,i){"use strict";function h(t,s,i,h){return void 0===h&&(h=255),(t<<24)+(s<<16)+(i<<8)+h}i.r(s);const e={V:h(0,0,0),O:h(255,255,255),L:h(170,170,170),N:h(85,85,85),T:h(255,255,85),D:h(170,85,0),I:h(255,85,85),C:h(170,0,0),g:h(85,255,85),B:h(0,170,0),M:h(85,255,255),R:h(0,170,170),U:h(85,85,255),S:h(0,0,170),p:h(255,85,255),v:h(170,0,170),G:h(255,136,0)};class n{constructor(t,s){this.x=t,this.y=s}}class o{constructor(t,s,i,h){this.x=this.left=t,this.y=this.top=s,this.width=i,this.height=h,this.x2=t+i,this.y2=s+h}F(){return new n(this.x+this.width/2|0,this.y+this.height/2|0)}m(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.y<this.x2&&t.y>=this.y&&t.y<this.y2}}class r{constructor(t,s,i){this.P=t,this.rect=s,this.H=i,this.open=!1,this.count=0}}class c{k(t,s){const i=s.Y.width+4,h=s.Y.height+4,e=(t.width-i)/2|0,c=(t.height-h)/2|0;return new r(s,new o(e,c,i,h),new n(e+2,c+2))}X(t,s){const i=s.P,{x:h,y:n,width:o,height:r}=s.rect;t.fillRect(h,n,o,r,0,e.O,e.V),t.W(h,n,o,r),t.J(h+o/2|0,n," "+i.title+" "),i.j(t,s.H)}}class l{constructor(){this.Z=!1,this.q=0,this.$=0}update(){this.Z?(this.q++,this.$=0):(this.q=0,this.$++)}tt(){const t=this.q;return 1===t||t>6&&t%1===0}st(){return 1===this.$}}class _{constructor(t){this.keys=new Array(256);for(let t=0;t<256;t++)this.keys[t]=new l;t.addEventListener("keydown",t=>this.it(t,!0)),t.addEventListener("keyup",t=>this.it(t,!1))}it(t,s){const i=t.keyCode;i!==u.ht&&(t.stopPropagation(),t.preventDefault(),i>=0&&i<256&&(this.keys[i].Z=s))}et(){for(let t=0;t<256;t++)this.keys[t].update()}getKey(t){return t>=0&&t<256?this.keys[t]:null}}const u={nt:3,ot:6,rt:8,ct:9,lt:12,_t:13,ut:16,at:17,ft:18,Kt:19,At:20,Et:27,Vt:32,Ot:33,dt:34,Lt:35,Nt:36,wt:37,Tt:38,Dt:39,It:40,Ct:44,gt:45,Bt:46,Mt:48,Rt:49,Ut:50,St:51,pt:52,vt:53,Gt:54,bt:55,Ft:56,yt:57,Pt:58,Ht:59,xt:60,kt:61,Yt:62,Xt:63,Wt:64,Qt:65,zt:66,Jt:67,jt:68,Zt:69,qt:70,$t:71,ts:72,ss:73,hs:74,es:75,ns:76,os:77,rs:78,cs:79,ls:80,_s:81,us:82,as:83,fs:84,Ks:85,As:86,Es:87,Vs:88,Os:89,ds:90,Ls:93,Ns:96,ws:97,Ts:98,Ds:99,Is:100,Cs:101,gs:102,Bs:103,Ms:104,Rs:105,Us:106,Ss:107,ps:108,vs:109,Gs:110,bs:111,Fs:112,ms:113,ys:114,Ps:115,Hs:116,xs:117,ks:118,Ys:119,Xs:120,Ws:121,ht:122,Qs:123,zs:124,Js:125,js:126,Zs:127,qs:128,$s:129,ti:130,si:131,ii:132,hi:133,ei:134,ni:135,oi:144,ri:145,ci:160,li:161,_i:162,ui:163,ai:164,fi:165,Ki:166,Ai:167,Ei:168,Vi:169,Oi:170,di:171,Li:172,Ni:173,wi:174,Ti:175,Di:176,Ii:188,Ci:190,gi:191,Bi:192,Mi:219,Ri:220,Ui:221,Si:222,pi:224,vi:225,Gi:91,bi:21,Fi:21,mi:22,yi:23,Pi:24,Hi:25,xi:25,ki:28,Yi:29,Xi:30,Wi:31,Qi:41,zi:42,Ji:43,ji:95},a={Zi:1,qi:2,$i:3,th:4,sh:5,ih:6,hh:7,eh:8,nh:176,oh:177,rh:178,lh:179,_h:180,uh:185,ah:186,fh:187,Kh:188,Ah:191,Eh:192,Vh:193,Oh:194,dh:195,Lh:196,Nh:197,wh:200,Th:201,Dh:202,Ih:203,Ch:204,gh:205,Bh:206,Mh:217,Rh:218,Uh:219,Sh:220,ph:221,vh:222,Gh:223},f=0,K=1,A=2;class E{constructor(t,s,i,h){this.charCode=void 0!==t?function(t){return"string"===typeof t&&t.length>0?t.charCodeAt(0):t}(t):" ".charCodeAt(0),this.bh=void 0!==s?s:e.O,this.Fh=void 0!==i?i:e.V,void 0!==h&&(this.mh=h),this.yh=!0}Ph(t){this.charCode!==t&&(this.charCode=t,this.yh=!0)}Hh(t){void 0!==t&&null!==t&&t!==this.bh&&(this.bh=t,this.yh=!0)}xh(t){void 0!==t&&null!==t&&t!==this.Fh&&(this.Fh=t,this.yh=!0)}kh(t){void 0!==t&&(this.mh=t,this.yh=!0)}Yh(t,s,i,h){return"string"===typeof t&&(t=t.charCodeAt(0)),"number"===typeof t?(this.Ph(t),this.Hh(s),this.xh(i),this.kh(h)):this.Xh(t,f),this.yh}Xh(t,s){const i=255&t.Fh;s===f||t.charCode>0?(this.Ph(t.charCode),this.Hh(t.bh)):i>0&&i<255&&this.Hh(this.Wh(this.bh,t.Fh,s)),s===f||255===i?this.xh(t.Fh):i>0&&this.xh(this.Wh(this.Fh,t.Fh,s)),this.kh(t.mh)}Wh(t,s,i){const e=(255-(255&s))/255,n=1-e,o=t>>24&255,r=t>>16&255,c=t>>8&255,l=s>>24&255,_=s>>16&255,u=s>>8&255;switch(i){case K:return h(e*o+n*l|0,e*r+n*_|0,e*c+n*u|0);case A:return h(this.Qh(o+n*l|0),this.Qh(r+n*_|0),this.Qh(c+n*u|0));default:return s}}Qh(t){return Math.min(255,t)}}class V{constructor(t,s,i){this.width=t,this.height=s,this.zh=new Array;const h=i||E;for(let i=0;i<s;i++){const s=new Array;for(let e=0;e<t;e++)s.push(new h(e,i));this.zh.push(s)}this.clear()}clear(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++)this.Jh(s,t,0)}jh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.zh[s][t]}Zh(t,s){if(!(t<0||s<0||t>=this.width||s>=this.height))return this.zh[s][t].charCode}Jh(t,s,i,h,e){t>=0&&t<this.width&&s>=0&&s<this.height&&this.zh[s][t].Yh(i,h,e)}qh(t,s,i,h,e){const n=i.split("\n");for(let i=0;i<n.length;i++){const o=n[i];for(let n=0;n<o.length;n++)this.Jh(t+n,s+i,o.charCodeAt(n),h,e)}}J(t,s,i,h,e){this.qh(t-Math.floor(i.length/2),s,i,h,e)}$h(t,s,i,h,e,n){for(let o=t;o<t+i;o++)this.Jh(o,s,h,e,n)}te(t,s,i,h,e,n){for(let o=s;o<s+i;o++)this.Jh(t,o,h,e,n)}se(t,s,i,h,e,n,o){this.$h(t,s,i,e,n,o),this.$h(t,s+h-1,i,e,n,o),this.te(t,s,h,e,n,o),this.te(t+i-1,s,h,e,n,o)}ie(t,s,i,h,e,n,o,r,c,l,_,u,a,f){this.fillRect(t,s,i,h,0,a,f),this.$h(t,s,i,e),this.$h(t,s+h-1,i,o),this.te(t,s,h,r),this.te(t+i-1,s,h,n),this.Jh(t,s,c),this.Jh(t+i-1,s,l),this.Jh(t,s+h-1,u),this.Jh(t+i-1,s+h-1,_)}W(t,s,i,h,e,n){this.ie(t,s,i,h,a.Lh,a.lh,a.Lh,a.lh,a.Rh,a.Ah,a.Mh,a.Eh,e,n)}he(t,s,i,h,e,n){this.ie(t,s,i,h,a.gh,a.ah,a.gh,a.ah,a.Th,a.fh,a.Kh,a.wh,e,n)}fillRect(t,s,i,h,e,n,o){for(let r=s;r<s+h;r++)this.$h(t,r,i,e,n,o)}ee(t,s,i,h,e,n,o,r){r=r||f;for(let c=0;c<o;c++)for(let o=0;o<n;o++){const n=i.jh(h+o,e+c);n&&this.Xh(t+o,s+c,n,r)}}Xh(t,s,i,h){t>=0&&t<this.width&&s>=0&&s<this.height&&this.zh[s][t].Xh(i,h)}}const O=[{charCode:a.Gh,active:[1,1,0,0]},{charCode:a.vh,active:[0,1,0,1]}];function d(t){const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const i=s.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data}function L(t,s,i,h,e){const n=4*(h*e+i),o=4*(h*e+i+1),r=4*((h+1)*e+i),c=4*((h+1)*e+i+1),l=[[s[n],s[n+1],s[n+2]],[s[o],s[o+1],s[o+2]],[s[r],s[r+1],s[r+2]],[s[c],s[c+1],s[c+2]]];let _=Number.MAX_VALUE,u=0,a=null,f=null;for(let t=0;t<O.length;t++){const s=O[t],i=N(s.active,l);i.error<_&&(_=i.error,u=s.charCode,a=i.Fh,f=i.bh)}t.Jh(i/2,h/2,u,w(f),w(a))}function N(t,s){const i=[[0,0,0],[0,0,0]],h=[[0,0,0],[0,0,0]],e=[0,0];for(let h=0;h<4;h++){for(let e=0;e<3;e++)i[t[h]][e]+=s[h][e];e[t[h]]++}for(let t=0;t<2;t++)for(let s=0;s<3;s++)h[t][s]=i[t][s]/e[t];let n=0;for(let i=0;i<4;i++){let e=0;for(let n=0;n<3;n++){const o=s[i][n]-h[t[i]][n];e+=o*o}n+=Math.sqrt(e)}return{Fh:h[0],bh:h[1],error:n}}function w(t){return h(t[0],t[1],t[2])}class T{constructor(t,s){this.Y=t,this.title=s}j(t,s){}ne(t,s){}}class D extends T{constructor(t,s){const i=s.split("\n");let h=t.length;for(let t=0;t<i.length;t++)h=Math.max(h,i[t].length);const e=i.length;super(new o(0,0,h,e),t),this.oe=i}j(t,s){for(let i=0;i<this.oe.length;i++)t.qh(s.x,s.y+i,this.oe[i])}ne(t,s){return t.re(u.Et)}}class I{constructor(t){this.h=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}ce(){return this.state=(this.a*this.state+this.c)%this.h,this.state}le(){return this.ce()/(this.h-1)}_e(t,s){const i=s-t,h=t+(this.ce()/this.h*i|0);if(isNaN(h))throw new Error("rand nan");return h}ue(t){const s=t.reduce((t,s)=>t+s),i=this._e(1,s+1);let h=0;for(let s=0;s<t.length;s++)if(h+=t[s],i<=h)return s;return t.length-1}ae(t){const s=[],i=[];for(const h in t)t.hasOwnProperty(h)&&(s.push(h),i.push(t[h]));return s[this.ue(i)]}}class C extends T{constructor(t,s,i){let h=t.length;for(let t=0;t<s.length;t++)h=Math.max(h,s[t].length+4);const e=s.length;super(new o(0,0,h,e),t),this.options=s,this.fe=i}j(t,s){for(let i=0;i<this.options.length;i++){const h=String.fromCharCode(65+i)+" - "+this.options[i];t.qh(s.x,s.y+i,h)}}ne(t,s){for(let s=0;s<this.options.length;s++)if(t.re(u.Qt+s))return this.fe(s),!0;return t.re(u.Et)}}const g=new class{constructor(t,s,i,h,e){this.url=t,this.Ke=s,this.Ae=i,this.scale=h||1,this.Ee=!!e}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8);class B{constructor(t,s){this.Ve=t.canvas,this.width=t.width,this.height=t.height,this.options=s,this.Oe=0,this.de=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.buttons=[new l,new l,new l];const i=this.Ve;i.addEventListener("mousedown",t=>this.Le(t)),i.addEventListener("mouseup",t=>this.Le(t)),i.addEventListener("mousemove",t=>this.Le(t)),i.addEventListener("contextmenu",t=>this.Le(t));const h=this.Ne.bind(this);i.addEventListener("touchstart",h),i.addEventListener("touchend",h),i.addEventListener("touchcancel",h),i.addEventListener("touchmove",h)}Ne(t){if(t.stopPropagation(),t.preventDefault(),"touchend"===t.type&&this.options.requestFullscreen&&this.requestFullscreen(),t.touches.length>0){const s=t.touches[0];this.we(s.clientX,s.clientY),this.buttons[0].Z=!0}else this.buttons[0].Z=!1}Le(t){t.stopPropagation(),t.preventDefault(),this.we(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons[t.button].Z=!0,this.Ve.focus(),this.options.requestFullscreen&&this.requestFullscreen()),"mouseup"===t.type&&(this.buttons[t.button].Z=!1)}we(t,s){let i=this.Ve.getBoundingClientRect();const h=this.width/this.height,e=i.width/i.height;if(e-h>.01){const t=h*i.height,s=i.width-t;i=new o(Math.floor(s/2),0,t,i.height)}if(e-h<-.01){const t=i.width/h,s=i.height-t;i=new o(0,Math.floor(s/2),i.width,t)}this.x=this.width*(t-i.left)/i.width|0,this.y=this.height*(s-i.top)/i.height|0}requestFullscreen(){const t=this.Ve;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()}update(){this.dx=this.x-this.Oe,this.dy=this.y-this.de,this.Oe=this.x,this.de=this.y;for(let t=0;t<this.buttons.length;t++)this.buttons[t].update()}}function M(t,s){return t/s*2-1}const R={font:g,requestFullscreen:!1};class U extends E{constructor(t,s){super(),this.x=t,this.y=s,this.Te=!1,this.De=!1,this.Ie=!1,this.visible=!1,this.Ce=-1,this.ge=0,this.Be=0,this.Me=null}}class S extends V{constructor(t,s,i){if(super(t,s,U),this.Re=0,this.Ue=0,this.Se=0,this.pe=0,this.ve=0,this.Ge=0,this.be=0,i)for(let h=0;h<s;h++)for(let s=0;s<t;s++)this.zh[h][s].Te=this.zh[h][s].De=i(s,h)}Fe(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.zh[s][t].Te=i)}me(t,s,i){t>=0&&t<this.width&&s>=0&&s<this.height&&(this.zh[s][t].De=i)}ye(t,s){return!(t<this.Se||t>this.pe||s<this.ve||s>this.Ge)&&this.zh[s][t].visible}Pe(t,s){const i=[],h=[];let e,n,o,r,c,l,_,u,a,f,K=1,A=0,E=0,V=0;for(n=this.Ue+s;n>=this.ve&&n<=this.Ge;n+=s,E=A,++K)for(o=.5/K,f=-1,r=Math.floor(V*K+.5),e=this.Re+r*t;r<=K&&e>=this.Se&&e<=this.pe;e+=t,++r,f=a){if(c=!0,l=!1,_=r/K,u=f,a=_+o,E>0)if(this.zh[n-s][e].visible&&!this.zh[n-s][e].De||this.zh[n-s][e-t].visible&&!this.zh[n-s][e-t].De){for(let t=0;t<E&&c;++t)if(u<=h[t]&&a>=i[t])if(this.zh[n][e].De){if(u>=i[t]&&a<=h[t]){c=!1;break}i[t]=Math.min(i[t],u),h[t]=Math.max(h[t],a),l=!0}else if(_>i[t]&&_<h[t]){c=!1;break}}else c=!1;c&&(this.zh[n][e].visible=!0,this.zh[n][e].De&&(V>=u?V=a:l||(i[A]=u,h[A++]=a)))}}He(t,s){const i=[],h=[];let e,n,o,r,c,l,_,u,a,f,K=1,A=0,E=0,V=0;for(e=this.Re+t;e>=this.Se&&e<=this.pe;e+=t,E=A,++K)for(o=.5/K,f=-1,r=Math.floor(V*K+.5),n=this.Ue+r*s;r<=K&&n>=this.ve&&n<=this.Ge;n+=s,++r,f=a){if(c=!0,l=!1,_=r/K,u=f,a=_+o,E>0)if(this.zh[n][e-t].visible&&!this.zh[n][e-t].De||this.zh[n-s][e-t].visible&&!this.zh[n-s][e-t].De){for(let t=0;t<E&&c;++t)if(u<=h[t]&&a>=i[t])if(this.zh[n][e].De){if(u>=i[t]&&a<=h[t]){c=!1;break}i[t]=Math.min(i[t],u),h[t]=Math.max(h[t],a),l=!0}else if(_>i[t]&&_<h[t]){c=!1;break}}else c=!1;c&&(this.zh[n][e].visible=!0,this.zh[n][e].De&&(V>=u?V=a:l||(i[A]=u,h[A++]=a)))}}xe(t,s,i,h,e){if(this.Re=t,this.Ue=s,this.be=i,h)this.Se=Math.min(this.Se,Math.max(0,t-i)),this.ve=Math.min(this.ve,Math.max(0,s-i)),this.pe=Math.max(this.pe,Math.min(this.width-1,t+i)),this.Ge=Math.max(this.Ge,Math.min(this.height-1,s+i));else{this.Se=Math.max(0,t-i),this.ve=Math.max(0,s-i),this.pe=Math.min(this.width-1,t+i),this.Ge=Math.min(this.height-1,s+i);for(let t=this.ve;t<=this.Ge;t++)for(let s=this.Se;s<=this.pe;s++)this.zh[t][s].visible=!1}this.zh[s][t].visible=!0,void 0===e?(this.Pe(1,1),this.He(1,1),this.He(1,-1),this.Pe(1,-1),this.Pe(-1,-1),this.He(-1,-1),this.He(-1,1),this.Pe(-1,1)):(1&e&&this.Pe(1,1),2&e&&this.He(1,1),4&e&&this.He(1,-1),8&e&&this.Pe(1,-1),16&e&&this.Pe(-1,-1),32&e&&this.He(-1,-1),64&e&&this.He(-1,1),128&e&&this.Pe(-1,1))}ke(){for(let t=this.ve;t<=this.Ge;t++)for(let s=this.Se;s<=this.pe;s++){const i=this.zh[t][s];i.Ie|=i.visible}}}const p=h(0,0,100),v=h(130,110,50),G=h(50,50,150),b=h(200,180,50);class F{constructor(t,s,i,h,e,n,o){if(this.x=t,this.y=s,this.char=i,this.name=h,this.color=e,this.Ye=!!n,o)for(var r in o)o.hasOwnProperty(r)&&(this[r]=o[r],this[r].Xe=this)}move(t,s){(function(t,s){if(At.zh[s][t].Te)return!0;for(let i=0;i<ft.length;i++){const h=ft[i];if(h.Ye&&h.x===t&&h.y===s)return!0}return!1})(this.x+t,this.y+s)||(this.x+=t,this.y+=s)}We(t,s){const i=t-this.x,h=s-this.y,e=Math.hypot(i,h);this.move(Math.round(i/e),Math.round(h/e))}Qe(t){return Math.hypot(t.x-this.x,t.y-this.y)}ze(t,s){return Math.hypot(t-this.x,s-this.y)}Je(){this.remove(),ft.unshift(this)}remove(){ft.splice(ft.indexOf(this),1)}X(){At.ye(this.x,this.y)&&lt.qh(this.x,this.y,this.char,this.color)}}class m{constructor(t,s,i,h){this.Xe=null,this.je=t,this.Ze=s,this.qe=i,this.$e=t,this.tn=h||null}attack(t){const s=this.qe-t.sn.Ze;s>0?(W(Q(this.Xe.name)+" attacks "+t.name+" for "+s+" hit points."),t.sn.in(s)):W(Q(this.Xe.name)+" attacks "+t.name+" but it has no effect!")}in(t){this.$e-=t,this.$e<=0&&(this.$e=0,this.tn&&this.tn(this.Xe))}hn(t){this.$e=Math.min(this.$e+t,this.je)}}class y{constructor(){this.Xe=null}en(){const t=this.Xe;At.ye(t.x,t.y)&&(t.Qe(at)>=2?t.We(at.x,at.y):at.sn.$e>0&&t.sn.attack(at))}}class P{constructor(t){this.Xe=null,this.nn=t,this.on=10}en(){this.on>0?(this.Xe.move(ut._e(-1,1),ut._e(-1,1)),this.on--):(this.Xe.rn=this.nn,W("The "+this.Xe.name+" is no longer confused!",e.I))}}class H{constructor(t){this.cn=t}ln(){Vt.length>=26?W("Your inventory is full, cannot pick up "+this.Xe.name+".",e.I):(Vt.push(this.Xe),this.Xe.remove(),W("You picked up a "+this.Xe.name+"!",e.g))}_n(){this.cn?this.cn(this):W("The "+this.Xe.name+" cannot be used.")}remove(){Vt.splice(Vt.indexOf(this.Xe),1)}}function x(t,s){for(let i=s.y+1;i<s.y2;i++)for(let h=s.x+1;h<s.x2;h++)t.zh[i][h].Te=!1,t.zh[i][h].De=!1}function k(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.zh[h][e].Te=!1,t.zh[h][e].De=!1}function Y(t,s,i,h){for(let e=Math.min(s,i);e<=Math.max(s,i);e++)t.zh[e][h].Te=!1,t.zh[e][h].De=!1}function X(t){const s=ut._e(0,3);for(let i=0;i<s;i++){const s=ut._e(t.x+1,t.x2-1),i=ut._e(t.y+1,t.y2-1);let h=null;if(ut._e(0,100)<80){const t=new m(10,0,3,q),n=new y;h=new F(s,i,"o","orc",e.g,!0,{sn:t,rn:n})}else{const t=new m(16,1,4,q),n=new y;h=new F(s,i,"T","troll",e.B,!0,{sn:t,rn:n})}ft.push(h)}const i=ut._e(0,2);for(let s=0;s<i;s++){const s=ut._e(t.x+1,t.x2-1),i=ut._e(t.y+1,t.y2-1),h=ut._e(0,100);let n=null;n=h<50?new F(s,i,"!","healing potion",e.v,!1,{item:new H(tt)}):h<70?new F(s,i,"#","scroll of lightning bolt",e.T,!1,{item:new H(st)}):h<85?new F(s,i,"#","scroll of fireball",e.T,!1,{item:new H(it)}):new F(s,i,"#","scroll of confusion",e.T,!1,{item:new H(ht)}),ft.push(n),n.Je()}}function W(t,s){for(;Kt.length>=6;)Kt.shift();Kt.push({text:t,color:s||e.O})}function Q(t){return t?t.charAt(0).toUpperCase()+t.slice(1):t}function z(t,s){const i=at.x+t,h=at.y+s;let e=null;for(let t=0;t<ft.length;t++){const s=ft[t];if(s.sn&&s.x===i&&s.y===h){e=s;break}}e?at.sn.attack(e):(at.move(t,s),Et=!0);for(let t=0;t<ft.length;t++){const s=ft[t];s.rn&&s.rn.en()}}function J(){if(!(at.sn.$e<=0)&&!_t.ne()){if(Ot)return(lt.re(u._t)||lt.un.buttons[0].st())&&(t=dt.x,s=dt.y,Ot(t,s),nt()),(lt.re(u.Et)||lt.un.buttons[2].st())&&nt(),lt.re(u.Tt)&&dt.y--,lt.re(u.wt)&&dt.x--,lt.re(u.Dt)&&dt.x++,lt.re(u.It)&&dt.y++,void(0===lt.un.dx&&0===lt.un.dy||(dt.x=lt.un.x,dt.y=lt.un.y));var t,s;if(lt.re(u.Et)&&(Lt="menu"),lt.re(u.Tt)&&z(0,-1),lt.re(u.wt)&&z(-1,0),lt.re(u.Dt)&&z(1,0),lt.re(u.It)&&z(0,1),lt.re(u.$t))for(let t=0;t<ft.length;t++){const s=ft[t];s.x===at.x&&s.y===at.y&&s.item&&s.item.ln()}if(lt.re(u.ss))if(0===Vt.length)_t.add(new D("ALERT","Inventory is empty"));else{const t=Vt.map(t=>t.name);_t.add(new C("INVENTORY",t,j))}}}function j(t){t>=0&&Vt[t].item._n()}function Z(t){W("You died!",e.I)}function q(t){W(Q(t.name)+" is dead!",e.D),t.char="%",t.color=e.C,t.Ye=!1,t.sn=null,t.rn=null,t.name="remains of "+t.name,t.Je()}function $(t,s,i){let h=i+1,e=null;for(let i=0;i<ft.length;i++){const n=ft[i];if(n.sn&&n!==at){const i=n.ze(t,s);i<h&&(h=i,e=n)}}return e}function tt(t){at.sn.$e!==at.sn.je?(W("Your wounds start to feel better!",e.p),at.sn.hn(4),t.remove()):W("You are already at full health.",e.C)}function st(t){const s=$(at.x,at.y,5);s?(W("A lightning bolt strikes the "+s.name+" with a loud thunder!",e.U),W("The damage is 20 hit points",e.U),s.sn.in(20),t.remove()):W("No enemy is close enough to strike.",e.I)}function it(t){W("Left-click to cast fireball, or right-click to cancel.",e.M),et((s,i)=>{if(at.ze(s,i)>10)W("Target out of range.",e.L);else{W("The fireball explodes, burning everything within 3 tiles!",e.G);for(let t=0;t<ft.length;t++){const h=ft[t];h.sn&&h.ze(s,i)<=3&&(W("The "+h.name+" gets burned for 12 hit points.",e.G),h.sn.in(12))}t.remove()}})}function ht(t){W("Left-click to cast confuse, or right-click to cancel.",e.M),et((s,i)=>{if(at.ze(s,i)>8)return void W("Target out of range.",e.L);const h=function(t,s){return $(t,s,0)}(s,i);h?(h.rn=new P(h.rn),h.rn.Xe=h,W("The eyes of the "+h.name+" look vacant, as he stumbles around!",e.g),t.remove()):W("No monster there.",e.L)})}function et(t){Ot=t,dt.x=at.x,dt.y=at.y}function nt(){Ot=null}function ot(){Et&&(At.xe(at.x,at.y,10),Et=!1);for(let t=0;t<43;t++)for(let s=0;s<80;s++){const i=At.ye(s,t),h=At.zh[t][s].De;let n=e.V;i?(n=h?v:b,At.zh[t][s].Ie=!0):At.zh[t][s].Ie&&(n=h?p:G),lt.Jh(s,t,0,0,n)}for(let t=0;t<ft.length;t++)ft[t].X();lt.fillRect(0,38,80,7,0,e.O,e.V);let t=39;for(let s=0;s<Kt.length;s++){const i=Kt[s];lt.qh(22,t,i.text,i.color),t++}!function(t,s,i,h,n,o,r,c){const l=Math.round(n/o*i);lt.fillRect(t,s,i,1,0,0,c),l>0&&lt.fillRect(t,s,l,1,0,0,r),lt.J(t+i/2,s,h+": "+n+"/"+o,e.O)}(1,39,20,"HP",at.sn.$e,at.sn.je,e.I,e.C),lt.qh(1,38,function(){const t=lt.un.x,s=lt.un.y;if(!At.ye(t,s))return"";const i=[];for(let h=0;h<ft.length;h++){const e=ft[h];e.x===t&&e.y===s&&i.push(e.name)}return Q(i.join(", "))}(),e.L),Ot&&lt.jh(dt.x,dt.y).xh(e.O),_t.X()}function rt(){ut=new I(Date.now()),at=new F(40,25,"@","player",e.O,!0,{sn:new m(20,2,5,Z)}),ft=[at],Kt=[],At=function(){const t=new S(80,43);for(let s=0;s<43;s++)for(let i=0;i<80;i++)t.zh[s][i].Te=!0,t.zh[s][i].De=!0;const s=[];for(let i=0;i<30;i++){const i=ut._e(6,10),h=ut._e(6,10),e=ut._e(0,80-i-1),n=ut._e(0,43-h-1),r=new o(e,n,i,h);let c=!1;for(let t=0;t<s.length;t++)if(r.m(s[t])){c=!0;break}if(!c){x(t,r);const i=r.F();if(0===s.length)at.x=i.x,at.y=i.y;else{const h=s[s.length-1].F();1===ut._e(0,1)?(k(t,h.x,i.x,h.y),Y(t,h.y,i.y,i.x)):(Y(t,h.y,i.y,h.x),k(t,h.x,i.x,i.y))}X(r),s.push(r)}}return t}(),Et=!0,Vt=[],W("Welcome stranger! Prepare to perish!",e.C),Lt="game"}function ct(){if(0===_t.an.length){const t=["Play a new game","Continue last game"];_t.add(new C("MAIN MENU",t,t=>{0===t?rt():1===t&&at&&(Lt="game")}))}_t.ne(),lt.clear(),Nt&&lt.ee(0,0,Nt,0,0,80,50),lt.J(40,10,"TOMBS OF THE ANCIENT KINGS",e.T),lt.J(40,12,"By Jotaf",e.T),_t.X()}const lt=new class extends V{constructor(t,s,i,h){super(s,i),h=h||R,this.canvas=t,this.font=h.font||g,this.pixelWidth=s*this.font.Ke,this.pixelHeight=i*this.font.Ae,t.width=this.pixelWidth,t.height=this.pixelHeight,t.style.width=this.font.scale*this.pixelWidth+"px",t.style.height=this.font.scale*this.pixelHeight+"px",t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.fn(),window.addEventListener("resize",()=>this.fn()),this.keys=new _(t),this.un=new B(this,h);const e=t.getContext("webgl",{Kn:!1});if(!e)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const n=e.createProgram();if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.An=e,this.En=n,e.attachShader(n,this.Vn(e.VERTEX_SHADER,"attribute vec2 a;attribute vec2 b;attribute vec3 c;attribute vec3 d;varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}")),e.attachShader(n,this.Vn(e.FRAGMENT_SHADER,"varying highp vec2 e;varying highp vec4 f;varying highp vec4 g;uniform bool h;uniform sampler2D s;void main(void){gl_FragColor=texture2D(s,e);if(h){if(gl_FragColor.a<0.1){gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(gl_FragColor.r<0.1) {gl_FragColor=g;} else {gl_FragColor=f;}}}")),e.linkProgram(n),e.useProgram(n),this.font.Ee&&e.uniform1i(e.getUniformLocation(n,"h"),1),this.On=this.getAttribLocation("a"),this.dn=this.getAttribLocation("b"),this.Ln=this.getAttribLocation("c"),this.Nn=this.getAttribLocation("d");const o=s*i;this.wn=new Float32Array(3*o*4),this.Tn=new Uint16Array(6*o),this.Dn=new Float32Array(2*o*4),this.In=new Uint8Array(4*o*4),this.Cn=new DataView(this.In.buffer),this.gn=new Uint8Array(4*o*4),this.Bn=new DataView(this.gn.buffer);let r=0,c=0,l=0;for(let t=0;t<i;t++)for(let h=0;h<s;h++)this.wn[r++]=M(h,s),this.wn[r++]=-M(t,i),this.wn[r++]=M(h+1,s),this.wn[r++]=-M(t,i),this.wn[r++]=M(h+1,s),this.wn[r++]=-M(t+1,i),this.wn[r++]=M(h,s),this.wn[r++]=-M(t+1,i),this.Tn[c++]=l+0,this.Tn[c++]=l+1,this.Tn[c++]=l+2,this.Tn[c++]=l+0,this.Tn[c++]=l+2,this.Tn[c++]=l+3,l+=4;this.Mn=e.createBuffer(),this.Rn=e.createBuffer(),this.Un=e.createBuffer(),this.Sn=e.createBuffer(),this.pn=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.Mn),e.bufferData(e.ARRAY_BUFFER,this.wn,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.Rn),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.Tn,e.STATIC_DRAW),this.vn=this.Gn(this.font.url),window.setInterval(()=>this.bn(),1e3/30)}fn(){const t=this.canvas.parentElement.offsetWidth/this.pixelWidth,s=this.canvas.parentElement.offsetHeight/this.pixelHeight,i=Math.min(t,s),h=i*this.pixelWidth|0,e=i*this.pixelHeight|0;this.canvas.style.width=h+"px",this.canvas.style.height=e+"px"}getAttribLocation(t){const s=this.An.getAttribLocation(this.En,t);return this.An.enableVertexAttribArray(s),s}flush(){let t=0,s=0;for(let i=0;i<this.height;i++)for(let h=0;h<this.width;h++){const e=this.jh(h,i);if(!e.yh){t+=8,s+=16;continue}const n=e.charCode%16,o=e.charCode/16|0;this.Dn[t++]=n,this.Dn[t++]=o,this.Dn[t++]=n+1,this.Dn[t++]=o,this.Dn[t++]=n+1,this.Dn[t++]=o+1,this.Dn[t++]=n,this.Dn[t++]=o+1;for(let t=0;t<4;t++)this.Cn.setUint32(s,e.bh,!1),this.Bn.setUint32(s,e.Fh,!1),s+=4;e.yh=!1}}Fn(t){const s=this.keys.getKey(t);return s&&s.Z}re(t){const s=this.keys.getKey(t);return s&&s.tt()}mn(t){const s=this.keys.getKey(t);return s?s.q:0}Vn(t,s){const i=this.An,h=i.createShader(t);if(!h)throw new Error("An error occurred compiling the shader: ");if(i.shaderSource(h,s),i.compileShader(h),!i.getShaderParameter(h,i.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+i.getShaderInfoLog(h));return h}Gn(t){const s=this.An,i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);const h=s.RGBA,e=s.RGBA,n=s.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);s.texImage2D(s.TEXTURE_2D,0,h,1,1,0,e,n,o);const r=new Image;return r.onload=()=>{s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,h,e,n,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)},r.src=t,i}yn(){const t=this.An;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Mn),t.vertexAttribPointer(this.On,s,i,h,e,n)}{const s=2,i=t.FLOAT,h=!1,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Un),t.bufferData(t.ARRAY_BUFFER,this.Dn,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.dn,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.Sn),t.bufferData(t.ARRAY_BUFFER,this.In,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Ln,s,i,h,e,n)}{const s=4,i=t.UNSIGNED_BYTE,h=!0,e=0,n=0;t.bindBuffer(t.ARRAY_BUFFER,this.pn),t.bufferData(t.ARRAY_BUFFER,this.gn,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.Nn,s,i,h,e,n)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.Rn),t.useProgram(this.En),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.vn);{const s=this.width*this.height*6,i=t.UNSIGNED_SHORT,h=0;t.drawElements(t.TRIANGLES,s,i,h)}}bn(){this.keys.et(),this.un.update(),this.update&&this.update(),this.state&&this.state.update(),this.flush(),this.yn()}}(document.querySelector("canvas"),80,45),_t=new class{constructor(t,s){this.Pn=t,this.Hn=s||new c,this.an=[]}add(t){this.an.push(this.Hn.k(this.Pn,t))}ne(){if(0===this.an.length)return!1;const t=this.an.length-1,s=this.an[this.an.length-1];return s.P.ne(this.Pn,s.H)&&this.an.splice(t,1),!0}X(){for(let t=0;t<this.an.length;t++)this.Hn.X(this.Pn,this.an[t])}}(lt);let ut=null,at=null,ft=null,Kt=null,At=null,Et=!0,Vt=null,Ot=null,dt={x:0,y:0},Lt="menu",Nt=null;!function(t,s){const i=new Image;i.onload=()=>{const t=i.width,h=i.height,e=d(i),n=new V(t/2,h/2);for(let s=0;s<h;s+=2)for(let i=0;i<t;i+=2)L(n,e,i,s,t);s(n)},i.src=t}("menu.png",t=>{Nt=t}),lt.update=function(){switch(Lt){case"menu":ct();break;case"game":J(),ot()}}}])}));