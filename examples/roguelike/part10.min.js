(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./examples/roguelike/part10.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./examples/roguelike/part10.js":
/*!**************************************!*\
  !*** ./examples/roguelike/part10.js ***!
  \**************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _src_colors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/colors.js */ \"./src/colors.js\");\n/* harmony import */ var _src_color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/color.js */ \"./src/color.js\");\n/* harmony import */ var _src_gui_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/gui.js */ \"./src/gui.js\");\n/* harmony import */ var _src_keys_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../src/keys.js */ \"./src/keys.js\");\n/* harmony import */ var _src_image_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../src/image.js */ \"./src/image.js\");\n/* harmony import */ var _src_gui_messagedialog_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../src/gui/messagedialog.js */ \"./src/gui/messagedialog.js\");\n/* harmony import */ var _src_rect_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../src/rect.js */ \"./src/rect.js\");\n/* harmony import */ var _src_rng_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../src/rng.js */ \"./src/rng.js\");\n/* harmony import */ var _src_gui_selectdialog_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../src/gui/selectdialog.js */ \"./src/gui/selectdialog.js\");\n/* harmony import */ var _src_terminal_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../src/terminal.js */ \"./src/terminal.js\");\n/* harmony import */ var _src_tilemap_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../src/tilemap.js */ \"./src/tilemap.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Actual size of the window\nconst SCREEN_WIDTH = 80;\nconst SCREEN_HEIGHT = 50;\n\n// Size of the map\nconst MAP_WIDTH = 80;\nconst MAP_HEIGHT = 43;\n\n// Sizes and coordinates relevant for the GUI\nconst BAR_WIDTH = 20;\nconst PANEL_HEIGHT = 7;\nconst PANEL_Y = SCREEN_HEIGHT - PANEL_HEIGHT;\nconst MSG_X = BAR_WIDTH + 2;\nconst MSG_WIDTH = SCREEN_WIDTH - BAR_WIDTH - 2;\nconst MSG_HEIGHT = PANEL_HEIGHT - 1;\n\n// Parameters for dungeon generator\nconst ROOM_MAX_SIZE = 10;\nconst ROOM_MIN_SIZE = 6;\nconst MAX_ROOMS = 30;\nconst MAX_ROOM_MONSTERS = 3;\nconst MAX_ROOM_ITEMS = 2;\nconst TORCH_RADIUS = 10;\n\n// Spell values\nconst HEAL_AMOUNT = 4;\nconst LIGHTNING_DAMAGE = 20;\nconst LIGHTNING_RANGE = 5;\nconst CONFUSE_RANGE = 8;\nconst CONFUSE_NUM_TURNS = 10;\nconst FIREBALL_RANGE = 10;\nconst FIREBALL_RADIUS = 3;\nconst FIREBALL_DAMAGE = 12;\n\nconst COLOR_DARK_WALL = Object(_src_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(0, 0, 100);\nconst COLOR_LIGHT_WALL = Object(_src_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(130, 110, 50);\nconst COLOR_DARK_GROUND = Object(_src_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(50, 50, 150);\nconst COLOR_LIGHT_GROUND = Object(_src_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(200, 180, 50);\n\nclass Entity {\n    constructor(x, y, char, name, color, blocks, components) {\n        this.x = x;\n        this.y = y;\n        this.char = char;\n        this.name = name;\n        this.color = color;\n        this.blocks = !!blocks;\n\n        if (components) {\n            for (var property in components) {\n                if (components.hasOwnProperty(property)) {\n                    this[property] = components[property];\n                    this[property].owner = this;\n                }\n            }\n        }\n    }\n\n    move(dx, dy) {\n        if (isBlocked(this.x + dx, this.y + dy)) {\n            return;\n        }\n        this.x += dx;\n        this.y += dy;\n    }\n\n    moveToward(targetX, targetY) {\n        const dx = targetX - this.x;\n        const dy = targetY - this.y;\n        const distance = Math.hypot(dx, dy);\n        this.move(Math.round(dx / distance), Math.round(dy / distance));\n    }\n\n    distanceTo(other) {\n        return Math.hypot(other.x - this.x, other.y - this.y);\n    }\n\n    distance(x, y) {\n        return Math.hypot(x - this.x, y - this.y);\n    }\n\n    sendToBack() {\n        this.remove();\n        entities.unshift(this);\n    }\n\n    remove() {\n        entities.splice(entities.indexOf(this), 1);\n    }\n\n    draw() {\n        if (map.isVisible(this.x, this.y)) {\n            term.drawString(this.x, this.y, this.char, this.color);\n        }\n    }\n}\n\nclass Fighter {\n    constructor(hp, defense, power, deathFunction) {\n        this.owner = null;\n        this.maxHp = hp;\n        this.defense = defense;\n        this.power = power;\n        this.hp = hp;\n        this.deathFunction = deathFunction || null;\n    }\n\n    attack(target) {\n        const damage = this.power - target.fighter.defense;\n\n        if (damage > 0) {\n            addMessage(capitalize(this.owner.name) + ' attacks ' + target.name + ' for ' + damage + ' hit points.');\n            target.fighter.takeDamage(damage);\n        } else {\n            addMessage(capitalize(this.owner.name) + ' attacks ' + target.name + ' but it has no effect!');\n        }\n    }\n\n    takeDamage(damage) {\n        this.hp -= damage;\n\n        // Check for death. if there's a death function, call it\n        if (this.hp <= 0) {\n            this.hp = 0;\n            if (this.deathFunction) {\n                this.deathFunction(this.owner);\n            }\n        }\n    }\n\n    heal(amount) {\n        this.hp = Math.min(this.hp + amount, this.maxHp);\n    }\n}\n\nclass BasicMonster {\n    constructor() {\n        this.owner = null;\n    }\n\n    takeTurn() {\n        const monster = this.owner;\n\n        // A basic monster takes its turn. if you can see it, it can see you\n        if (map.isVisible(monster.x, monster.y)) {\n\n            if (monster.distanceTo(player) >= 2) {\n                // Move towards player if far away\n                monster.moveToward(player.x, player.y);\n\n            } else if (player.fighter.hp > 0) {\n                // Close enough, attack! (if the player is still alive.)\n                monster.fighter.attack(player);\n            }\n        }\n    }\n}\n\nclass ConfusedMonster {\n    constructor(oldAi) {\n        this.owner = null;\n        this.oldAi = oldAi;\n        this.numTurns = CONFUSE_NUM_TURNS;\n    }\n\n    takeTurn() {\n        if (this.numTurns > 0) {\n            // Still confused...\n            // Move in a random direction, and decrease the number of turns confused\n            this.owner.move(rng.nextRange(-1, 1), rng.nextRange(-1, 1));\n            this.numTurns--;\n        } else {\n            this.owner.ai = this.oldAi;\n            addMessage('The ' + this.owner.name + ' is no longer confused!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED);\n        }\n    }\n}\n\nclass Item {\n    constructor(useFunction) {\n        this.useFunction = useFunction;\n    }\n\n    pickUp() {\n        if (inventory.length >= 26) {\n            addMessage('Your inventory is full, cannot pick up ' + this.owner.name + '.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED);\n        } else {\n            inventory.push(this.owner);\n            this.owner.remove();\n            addMessage('You picked up a ' + this.owner.name + '!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN);\n        }\n    }\n\n    use() {\n        if (this.useFunction) {\n            this.useFunction(this);\n        } else {\n            addMessage('The ' + this.owner.name + ' cannot be used.');\n        }\n    }\n\n    remove() {\n        inventory.splice(inventory.indexOf(this.owner), 1);\n    }\n}\n\nfunction isBlocked(x, y) {\n    // First test the map tile\n    if (map.grid[y][x].blocked) {\n        return true;\n    }\n\n    // Now check for any blocking objects\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        if (entity.blocks && entity.x === x && entity.y === y) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction createRoom(map, room) {\n    for (let y = room.y + 1; y < room.y2; y++) {\n        for (let x = room.x + 1; x < room.x2; x++) {\n            map.grid[y][x].blocked = false;\n            map.grid[y][x].blockSight = false;\n        }\n    }\n}\n\nfunction createHTunnel(map, x1, x2, y) {\n    for (let x = Math.min(x1, x2); x <= Math.max(x1, x2); x++) {\n        map.grid[y][x].blocked = false;\n        map.grid[y][x].blockSight = false;\n    }\n}\n\nfunction createVTunnel(map, y1, y2, x) {\n    for (let y = Math.min(y1, y2); y <= Math.max(y1, y2); y++) {\n        map.grid[y][x].blocked = false;\n        map.grid[y][x].blockSight = false;\n    }\n}\n\nfunction createMap() {\n    const map = new _src_tilemap_js__WEBPACK_IMPORTED_MODULE_10__[\"TileMap\"](MAP_WIDTH, MAP_HEIGHT);\n    for (let y = 0; y < MAP_HEIGHT; y++) {\n        for (let x = 0; x < MAP_WIDTH; x++) {\n            map.grid[y][x].blocked = true;\n            map.grid[y][x].blockSight = true;\n        }\n    }\n\n    const rooms = [];\n\n    for (let r = 0; r < MAX_ROOMS; r++) {\n        // Random width and height\n        const w = rng.nextRange(ROOM_MIN_SIZE, ROOM_MAX_SIZE);\n        const h = rng.nextRange(ROOM_MIN_SIZE, ROOM_MAX_SIZE);\n\n        // Random position without going out of the boundaries of the map\n        const x = rng.nextRange(0, MAP_WIDTH - w - 1);\n        const y = rng.nextRange(0, MAP_HEIGHT - h - 1);\n\n        // \"Rect\" class makes rectangles easier to work with\n        const newRoom = new _src_rect_js__WEBPACK_IMPORTED_MODULE_6__[\"Rect\"](x, y, w, h);\n\n        // Run through the other rooms and see if they intersect with this one\n        let failed = false;\n        for (let j = 0; j < rooms.length; j++) {\n            if (newRoom.intersects(rooms[j])) {\n                failed = true;\n                break;\n            }\n        }\n\n        if (!failed) {\n            // This means there are no intersections, so this room is valid\n\n            // \"paint\" it to the map's tiles\n            createRoom(map, newRoom);\n\n            // Center coordinates of new room, will be useful later\n            const center = newRoom.getCenter();\n\n            if (rooms.length === 0) {\n                // This is the first room, where the player starts at\n                player.x = center.x;\n                player.y = center.y;\n            } else {\n                // All rooms after the first:\n                // Connect it to the previous room with a tunnel\n\n                // Center coordinates of previous room\n                const prev = rooms[rooms.length - 1].getCenter();\n\n                // Draw a coin (random number that is either 0 or 1)\n                if (rng.nextRange(0, 1) === 1) {\n                    // First move horizontally, then vertically\n                    createHTunnel(map, prev.x, center.x, prev.y);\n                    createVTunnel(map, prev.y, center.y, center.x);\n                } else {\n                    // First move vertically, then horizontally\n                    createVTunnel(map, prev.y, center.y, prev.x);\n                    createHTunnel(map, prev.x, center.x, center.y);\n                }\n            }\n\n            // Add some contents to this room, such as monsters\n            placeObjects(newRoom);\n\n            // Finally, append the new room to the list\n            rooms.push(newRoom);\n        }\n    }\n\n    return map;\n}\n\nfunction placeObjects(room) {\n    // Choose random number of monsters\n    const numMonsters = rng.nextRange(0, MAX_ROOM_MONSTERS);\n\n    for (let i = 0; i < numMonsters; i++) {\n        // Choose random spot for this monster\n        const x = rng.nextRange(room.x + 1, room.x2 - 1);\n        const y = rng.nextRange(room.y + 1, room.y2 - 1);\n        let monster = null;\n\n        // Only place it if the tile is not blocked\n        // 80% chance of getting an orc\n        if (rng.nextRange(0, 100) < 80) {\n            // Create an orc\n            const fighter = new Fighter(10, 0, 3, monsterDeath);\n            const ai = new BasicMonster();\n            monster = new Entity(x, y, 'o', 'orc', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN, true, { fighter: fighter, ai: ai });\n        } else {\n            // Create a troll\n            const fighter = new Fighter(16, 1, 4, monsterDeath);\n            const ai = new BasicMonster();\n            monster = new Entity(x, y, 'T', 'troll', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_GREEN, true, { fighter: fighter, ai: ai });\n        }\n\n        entities.push(monster);\n    }\n\n    // Choose random number of items\n    const numItems = rng.nextRange(0, MAX_ROOM_ITEMS);\n\n    for (let i = 0; i < numItems; i++) {\n        // Choose random spot for this item\n        const x = rng.nextRange(room.x + 1, room.x2 - 1)\n        const y = rng.nextRange(room.y + 1, room.y2 - 1)\n\n        const dice = rng.nextRange(0, 100);\n        let item = null;\n\n        if (dice < 50) {\n            // Create a healing potion (50% chance)\n            item = new Entity(x, y, '!', 'healing potion', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_MAGENTA, false, { item: new Item(castHeal) });\n\n        } else if (dice < 50 + 20) {\n            // Create a lightning bolt scroll (20% chance)\n            item = new Entity(x, y, '#', 'scroll of lightning bolt', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW, false, { item: new Item(castLightning) });\n\n        } else if (dice < 50 + 20 + 15) {\n            // Create a fireball scroll (15% chance)\n            item = new Entity(x, y, '#', 'scroll of fireball', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW, false, { item: new Item(castFireball) });\n\n        } else {\n            // Create a confuse scroll (15% chance)\n            item = new Entity(x, y, '#', 'scroll of confusion', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW, false, { item: new Item(castConfuse) });\n        }\n\n        entities.push(item);\n        item.sendToBack();  // items appear below other objects\n    }\n}\n\nfunction renderBar(x, y, totalWidth, name, value, maximum, barColor, backColor) {\n    // Render a bar (HP, experience, etc). first calculate the width of the bar\n    const barWidth = Math.round(value / maximum * totalWidth);\n\n    // Render the background first\n    term.fillRect(x, y, totalWidth, 1, 0, 0, backColor);\n\n    // Now render the bar on top\n    if (barWidth > 0) {\n        term.fillRect(x, y, barWidth, 1, 0, 0, barColor);\n    }\n\n    // Finally, some centered text with the values\n    // term.fillForegroundRect(x, y, totalWidth, 1, Colors.WHITE);\n    term.drawCenteredString(x + totalWidth / 2, y, name + ': ' + value + '/' + maximum, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n}\n\nfunction getNamesUnderMouse() {\n    const x = term.mouse.x;\n    const y = term.mouse.y;\n\n    if (!map.isVisible(x, y)) {\n        return '';\n    }\n\n    const names = [];\n\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        if (entity.x === x && entity.y === y) {\n            names.push(entity.name);\n        }\n    }\n\n    return capitalize(names.join(', '));\n}\n\nfunction addMessage(msg, opt_color) {\n    while (messages.length >= MSG_HEIGHT) {\n        messages.shift();\n    }\n    messages.push({ text: msg, color: (opt_color || _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE) });\n}\n\nfunction capitalize(str) {\n    if (!str) {\n        return str;\n    }\n    return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction playerMoveOrAttack(dx, dy) {\n    const x = player.x + dx;\n    const y = player.y + dy;\n\n    let target = null;\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        if (entity.fighter && entity.x === x && entity.y === y) {\n            target = entity;\n            break;\n        }\n    }\n\n    if (target) {\n        player.fighter.attack(target);\n    } else {\n        player.move(dx, dy);\n        fovRecompute = true;\n    }\n\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        if (entity.ai) {\n            entity.ai.takeTurn();\n        }\n    }\n}\n\nfunction handleKeys() {\n    if (player.fighter.hp <= 0) {\n        return;\n    }\n\n    if (gui.handleInput()) {\n        return;\n    }\n\n    if (targetFunction) {\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_ENTER) || term.mouse.buttons[0].isClicked()) {\n            endTargeting(targetCursor.x, targetCursor.y);\n        }\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_ESCAPE) || term.mouse.buttons[2].isClicked()) {\n            cancelTargeting();\n        }\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_UP)) {\n            targetCursor.y--;\n        }\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_LEFT)) {\n            targetCursor.x--;\n        }\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_RIGHT)) {\n            targetCursor.x++;\n        }\n        if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_DOWN)) {\n            targetCursor.y++;\n        }\n        if (term.mouse.dx !== 0 || term.mouse.dy !== 0) {\n            targetCursor.x = term.mouse.x;\n            targetCursor.y = term.mouse.y;\n        }\n        return;\n    }\n\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_ESCAPE)) {\n        saveGame();\n        appState = 'menu';\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_UP)) {\n        playerMoveOrAttack(0, -1);\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_LEFT)) {\n        playerMoveOrAttack(-1, 0);\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_RIGHT)) {\n        playerMoveOrAttack(1, 0);\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_DOWN)) {\n        playerMoveOrAttack(0, 1);\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_G)) {\n        // Pick up an item\n        for (let i = 0; i < entities.length; i++) {\n            const entity = entities[i];\n            if (entity.x === player.x && entity.y === player.y && entity.item) {\n                entity.item.pickUp();\n            }\n        }\n    }\n    if (term.isKeyPressed(_src_keys_js__WEBPACK_IMPORTED_MODULE_3__[\"Keys\"].VK_I)) {\n        if (inventory.length === 0) {\n            gui.add(new _src_gui_messagedialog_js__WEBPACK_IMPORTED_MODULE_5__[\"MessageDialog\"]('ALERT', 'Inventory is empty'));\n        } else {\n            const options = inventory.map(item => item.name);\n            gui.add(new _src_gui_selectdialog_js__WEBPACK_IMPORTED_MODULE_8__[\"SelectDialog\"]('INVENTORY', options, useInventory));\n        }\n    }\n}\n\nfunction useInventory(choice) {\n    if (choice >= 0) {\n        inventory[choice].item.use();\n    }\n}\n\nfunction playerDeath(player) {\n    addMessage('You died!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED);\n}\n\nfunction monsterDeath(monster) {\n    addMessage(capitalize(monster.name) + ' is dead!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BROWN);\n    monster.char = '%';\n    monster.color = _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_RED;\n    monster.blocks = false;\n    monster.fighter = null;\n    monster.ai = null;\n    monster.name = 'remains of ' + monster.name;\n    monster.sendToBack();\n}\n\nfunction getClosestMonster(x, y, range) {\n    let minDist = range + 1;\n    let result = null;\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        if (entity.fighter && entity !== player) {\n            const dist = entity.distance(x, y);\n            if (dist < minDist) {\n                minDist = dist;\n                result = entity;\n            }\n        }\n    }\n    return result;\n}\n\nfunction getMonsterAt(x, y) {\n    return getClosestMonster(x, y, 0);\n}\n\nfunction castHeal(item) {\n    // Heal the player\n    if (player.fighter.hp === player.fighter.maxHp) {\n        addMessage('You are already at full health.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_RED);\n        return;\n    }\n\n    addMessage('Your wounds start to feel better!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_MAGENTA);\n    player.fighter.heal(HEAL_AMOUNT);\n    item.remove();\n}\n\nfunction castLightning(item) {\n    // Find closest enemy (inside a maximum range) and damage it\n    const monster = getClosestMonster(player.x, player.y, LIGHTNING_RANGE);\n    if (!monster) {\n        addMessage('No enemy is close enough to strike.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED);\n        return;\n    }\n\n    // Zap it!\n    addMessage('A lightning bolt strikes the ' + monster.name + ' with a loud thunder!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_BLUE);\n    addMessage('The damage is ' + LIGHTNING_DAMAGE + ' hit points', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_BLUE);\n    monster.fighter.takeDamage(LIGHTNING_DAMAGE);\n    item.remove();\n}\n\nfunction castFireball(item) {\n    // Ask the player for a target tile to throw a fireball at\n    addMessage('Left-click to cast fireball, or right-click to cancel.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_CYAN);\n    startTargeting((x, y) => {\n        if (player.distance(x, y) > FIREBALL_RANGE) {\n            addMessage('Target out of range.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GRAY);\n            return;\n        }\n\n        addMessage('The fireball explodes, burning everything within ' + FIREBALL_RADIUS + ' tiles!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].ORANGE);\n\n        for (let i = 0; i < entities.length; i++) {\n            const entity = entities[i];\n            if (entity.fighter && entity.distance(x, y) <= FIREBALL_RADIUS) {\n                addMessage('The ' + entity.name + ' gets burned for ' + FIREBALL_DAMAGE + ' hit points.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].ORANGE);\n                entity.fighter.takeDamage(FIREBALL_DAMAGE);\n            }\n        }\n\n        item.remove();\n    });\n}\n\nfunction castConfuse(item) {\n    // Ask the player for a target to confuse\n    addMessage('Left-click to cast confuse, or right-click to cancel.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_CYAN);\n    startTargeting((x, y) => {\n        if (player.distance(x, y) > CONFUSE_RANGE) {\n            addMessage('Target out of range.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GRAY);\n            return;\n        }\n\n        const monster = getMonsterAt(x, y);\n        if (!monster) {\n            addMessage('No monster there.', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GRAY);\n            return;\n        }\n\n        monster.ai = new ConfusedMonster(monster.ai);\n        monster.ai.owner = monster;\n        addMessage('The eyes of the ' + monster.name + ' look vacant, as he stumbles around!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GREEN);\n        item.remove();\n    });\n}\n\nfunction startTargeting(callback) {\n    targetFunction = callback;\n    targetCursor.x = player.x;\n    targetCursor.y = player.y;\n}\n\nfunction endTargeting(x, y) {\n    targetFunction(x, y);\n    cancelTargeting();\n}\n\nfunction cancelTargeting() {\n    targetFunction = null;\n}\n\nfunction renderAll() {\n    if (fovRecompute) {\n        map.computeFov(player.x, player.y, TORCH_RADIUS);\n        fovRecompute = false;\n    }\n\n    for (let y = 0; y < MAP_HEIGHT; y++) {\n        for (let x = 0; x < MAP_WIDTH; x++) {\n            const visible = map.isVisible(x, y);\n            const wall = map.grid[y][x].blockSight;\n            let color = _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BLACK;\n\n            if (visible) {\n                // It's visible\n                color = wall ? COLOR_LIGHT_WALL : COLOR_LIGHT_GROUND;\n                map.grid[y][x].explored = true;\n            } else if (map.grid[y][x].explored) {\n                // It's remembered\n                color = wall ? COLOR_DARK_WALL : COLOR_DARK_GROUND;\n            }\n\n            term.drawChar(x, y, 0, 0, color);\n        }\n    }\n\n    for (let i = 0; i < entities.length; i++) {\n        entities[i].draw();\n    }\n\n    // Prepare to render the GUI panel\n    term.fillRect(0, PANEL_Y, SCREEN_WIDTH, PANEL_HEIGHT, 0, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BLACK);\n\n    // Print the game messages, one line at a time\n    let y = PANEL_Y + 1;\n    for (let i = 0; i < messages.length; i++) {\n        const message = messages[i];\n        term.drawString(MSG_X, y, message.text, message.color);\n        y++;\n    }\n\n    // Show the player's stats\n    renderBar(\n        1, PANEL_Y + 1, BAR_WIDTH,\n        'HP', player.fighter.hp, player.fighter.maxHp,\n        _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_RED, _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_RED);\n\n    // Display names of objects under the mouse\n    term.drawString(1, PANEL_Y, getNamesUnderMouse(), _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].LIGHT_GRAY);\n\n    if (targetFunction) {\n        term.getCell(targetCursor.x, targetCursor.y).setBackground(_src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE);\n    }\n\n    // Draw dialog boxes\n    gui.draw();\n}\n\nfunction saveGame() {\n    // TODO: JSON.stringify does not support prototypes and circular references\n    // Investigate Cryo: https://github.com/hunterloftis/cryo\n}\n\nfunction loadGame() {\n    // TODO\n    if (!player) {\n        return;\n    }\n    appState = 'game';\n}\n\nfunction newGame() {\n    rng = new _src_rng_js__WEBPACK_IMPORTED_MODULE_7__[\"RNG\"](Date.now());\n    player = new Entity(40, 25, '@', 'player', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE, true, { fighter: new Fighter(20, 2, 5, playerDeath) });\n    entities = [player];\n    messages = [];\n    map = createMap();\n    fovRecompute = true;\n    inventory = [];\n    addMessage('Welcome stranger! Prepare to perish!', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].DARK_RED);\n    appState = 'game';\n}\n\nfunction playGame() {\n    handleKeys();\n    renderAll();\n}\n\nfunction mainMenu() {\n    if (gui.dialogs.length === 0) {\n        const options = ['Play a new game', 'Continue last game'];\n        gui.add(new _src_gui_selectdialog_js__WEBPACK_IMPORTED_MODULE_8__[\"SelectDialog\"]('MAIN MENU', options, (choice) => {\n            if (choice === 0) {\n                newGame();\n            } else if (choice === 1) {\n                loadGame();\n            }\n        }));\n    }\n\n    gui.handleInput();\n\n    term.clear();\n\n    if (menuBg) {\n        term.drawConsole(0, 0, menuBg, 0, 0, 80, 50);\n    }\n\n    term.drawCenteredString(40, 10, 'TOMBS OF THE ANCIENT KINGS', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW);\n    term.drawCenteredString(40, 12, 'By Jotaf', _src_colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].YELLOW);\n    gui.draw();\n}\n\nconst term = new _src_terminal_js__WEBPACK_IMPORTED_MODULE_9__[\"Terminal\"](document.querySelector('canvas'), SCREEN_WIDTH, SCREEN_HEIGHT);\nconst gui = new _src_gui_js__WEBPACK_IMPORTED_MODULE_2__[\"GUI\"](term);\nlet rng = null;\nlet player = null;\nlet entities = null;\nlet messages = null;\nlet map = null;\nlet fovRecompute = true;\nlet inventory = null;\nlet targetFunction = null;\nlet targetCursor = { x: 0, y: 0 };\nlet appState = 'menu';\nlet menuBg = null;\n\nObject(_src_image_js__WEBPACK_IMPORTED_MODULE_4__[\"loadImage2x\"])('menu.png', (result) => { menuBg = result });\n\nterm.update = function () {\n    switch (appState) {\n        case 'menu':\n            mainMenu();\n            break;\n\n        case 'game':\n            playGame();\n            break;\n    }\n};\n\n\n//# sourceURL=webpack:///./examples/roguelike/part10.js?");

/***/ }),

/***/ "./src/blendmode.js":
/*!**************************!*\
  !*** ./src/blendmode.js ***!
  \**************************/
/*! exports provided: BlendMode */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BlendMode\", function() { return BlendMode; });\n\n/**\n * The BlendMode enum defines how translucent cells are rendered.\n */\nconst BlendMode = {\n\n  /**\n   * No blending.  Alpha is ignored.\n   */\n  None: 0,\n\n  /**\n   * Alpha blending.\n   *\n   * dstRGB = (srcRGB * srcA) + (dstRGB * (1-srcA))\n   *\n   * dstA = srcA + (dstA * (1-srcA))\n   */\n  Blend: 1,\n\n  /**\n   * Additive blending.\n   *\n   * dstRGB = (srcRGB * srcA) + dstRGB\n   *\n   * dstA = dstA\n   */\n  Add: 2\n};\n\n\n//# sourceURL=webpack:///./src/blendmode.js?");

/***/ }),

/***/ "./src/cell.js":
/*!*********************!*\
  !*** ./src/cell.js ***!
  \*********************/
/*! exports provided: Cell */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Cell\", function() { return Cell; });\n/* harmony import */ var _blendmode_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./blendmode.js */ \"./src/blendmode.js\");\n/* harmony import */ var _colors_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./colors.js */ \"./src/colors.js\");\n/* harmony import */ var _color_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./color.js */ \"./src/color.js\");\n\n\n\n\n\nfunction convertCharCode(charCode) {\n  if ((typeof charCode === 'string') && charCode.length > 0) {\n    return charCode.charCodeAt(0);\n  } else {\n    return charCode;\n  }\n}\n\nclass Cell {\n\n  constructor(charCode, fg, bg, meta) {\n    if (charCode !== undefined) {\n      this.charCode = convertCharCode(charCode);\n    } else {\n      this.charCode = ' '.charCodeAt(0);\n    }\n\n    if (fg !== undefined) {\n      this.fg = fg;\n    } else {\n      this.fg = _colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].WHITE;\n    }\n\n    if (bg !== undefined) {\n      this.bg = bg;\n    } else {\n      this.bg = _colors_js__WEBPACK_IMPORTED_MODULE_1__[\"Colors\"].BLACK;\n    }\n\n    if (meta !== undefined) {\n      this.meta = meta;\n    }\n\n    this.dirty = true;\n  }\n\n  setCharCode(charCode) {\n    if (this.charCode !== charCode) {\n      this.charCode = charCode;\n      this.dirty = true;\n    }\n  }\n\n  setForeground(fg) {\n    if (fg !== undefined && fg !== null && fg !== this.fg) {\n      this.fg = fg;\n      this.dirty = true;\n    }\n  }\n\n  setBackground(bg) {\n    if (bg !== undefined && bg !== null && bg !== this.bg) {\n      this.bg = bg;\n      this.dirty = true;\n    }\n  }\n\n  setMeta(meta) {\n    if (meta !== undefined) {\n      this.meta = meta;\n      this.dirty = true;\n    }\n  }\n\n  setValue(\n      charCode, fg, bg, meta) {\n    if (typeof charCode === 'string') {\n      charCode = charCode.charCodeAt(0);\n    }\n    if (typeof charCode === 'number') {\n      this.setCharCode(charCode);\n      this.setForeground(fg);\n      this.setBackground(bg);\n      this.setMeta(meta);\n    } else {\n      this.drawCell(charCode, _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None);\n    }\n    return this.dirty;\n  }\n\n  drawCell(otherCell, blendMode) {\n    const alpha = otherCell.bg & 0xFF;\n\n    if (blendMode === _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None || otherCell.charCode > 0) {\n      this.setCharCode(otherCell.charCode);\n      this.setForeground(otherCell.fg);\n    } else if (alpha > 0 && alpha < 255) {\n      this.setForeground(this.blendColors(this.fg, otherCell.bg, blendMode));\n    }\n\n    if (blendMode === _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None || alpha === 255) {\n      this.setBackground(otherCell.bg);\n    } else if (alpha > 0) {\n      this.setBackground(this.blendColors(this.bg, otherCell.bg, blendMode));\n    }\n\n    this.setMeta(otherCell.meta);\n  }\n\n  blendColors(c1, c2, blendMode) {\n    const alpha = c2 & 0xFF;\n    const w1 = (255 - alpha) / 255.0;\n    const w2 = 1.0 - w1;\n    const r1 = (c1 >> 24) & 0xFF;\n    const g1 = (c1 >> 16) & 0xFF;\n    const b1 = (c1 >> 8) & 0xFF;\n    const r2 = (c2 >> 24) & 0xFF;\n    const g2 = (c2 >> 16) & 0xFF;\n    const b2 = (c2 >> 8) & 0xFF;\n\n    switch (blendMode) {\n      case _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].Blend:\n        return Object(_color_js__WEBPACK_IMPORTED_MODULE_2__[\"fromRgb\"])(\n            (w1 * r1 + w2 * r2) | 0, (w1 * g1 + w2 * g2) | 0,\n            (w1 * b1 + w2 * b2) | 0);\n\n      case _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].Add:\n        return Object(_color_js__WEBPACK_IMPORTED_MODULE_2__[\"fromRgb\"])(\n            this.clamp((r1 + w2 * r2) | 0), this.clamp((g1 + w2 * g2) | 0),\n            this.clamp((b1 + w2 * b2) | 0));\n\n      default:\n        return c2;\n    }\n  }\n\n  clamp(x) {\n    return Math.min(255, x);\n  }\n}\n\n\n//# sourceURL=webpack:///./src/cell.js?");

/***/ }),

/***/ "./src/chars.js":
/*!**********************!*\
  !*** ./src/chars.js ***!
  \**********************/
/*! exports provided: Chars */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Chars\", function() { return Chars; });\n\n\n// https://en.wikipedia.org/wiki/Code_page_437\n// https://en.wikipedia.org/wiki/Block_Elements\n// https://en.wikipedia.org/wiki/Box-drawing_character\n\nconst Chars = {\n  SMILEY: 1,\n  INVERSE_SMILEY: 2,\n  HEART: 3,\n  DIAMOND: 4,\n  CLUB: 5,\n  SPADE: 6,\n  BULLET: 7,\n  INVERSE_BULLET: 8,\n\n  LIGHT_SHADE: 176,\n  MEDIUM_SHADE: 177,\n  DARK_SHADE: 178,\n\n  BOX_SINGLE_VERTICAL: 179,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT: 180,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT: 185,\n  BOX_DOUBLE_VERTICAL: 186,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT: 187,\n  BOX_DOUBLE_UP_AND_DOUBLE_LEFT: 188,\n  BOX_SINGLE_DOWN_AND_SINGLE_LEFT: 191,\n  BOX_SINGLE_UP_AND_SINGLE_RIGHT: 192,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP: 193,\n  BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN: 194,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT: 195,\n  BOX_SINGLE_HORIZONTAL: 196,\n  BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL: 197,\n  BOX_DOUBLE_UP_AND_DOUBLE_RIGHT: 200,\n  BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT: 201,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP: 202,\n  BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN: 203,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT: 204,\n  BOX_DOUBLE_HORIZONTAL: 205,\n  BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL: 206,\n  BOX_SINGLE_UP_AND_SINGLE_LEFT: 13 * 16 + 9,\n  BOX_SINGLE_DOWN_AND_SINGLE_RIGHT: 13 * 16 + 10,\n\n  BLOCK_BOTTOM_HALF: 13 * 16 + 12,\n  BLOCK_LEFT_HALF: 13 * 16 + 13,\n  BLOCK_RIGHT_HALF: 13 * 16 + 14,\n  BLOCK_TOP_HALF: 13 * 16 + 15,\n}\n\n\n//# sourceURL=webpack:///./src/chars.js?");

/***/ }),

/***/ "./src/color.js":
/*!**********************!*\
  !*** ./src/color.js ***!
  \**********************/
/*! exports provided: fromRgb, fromHsv */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fromRgb\", function() { return fromRgb; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fromHsv\", function() { return fromHsv; });\n\n/**\n * Creates a big-endian 32-bit RGBA color from red, green, and blue components.\n * @param r Red (0-255).\n * @param g Green (0-255).\n * @param b Blue (0-255).\n * @param a Optional alpha (0-255).\n * @return A 32-bit unsigned integer color.\n */\nfunction fromRgb(r, g, b, a) {\n  if (a === undefined) {\n    a = 255;\n  }\n  return ((r << 24) + (g << 16) + (b << 8) + a);\n}\n\n\n/**\n * Converts a color from HSV format to RGBA format.\n *\n * Based on: https://stackoverflow.com/a/17243070/2051724\n *\n * @param h Hue (0.0 - 1.0).\n * @param s Saturation (0.0 - 1.0).\n * @param v Value (0.0 - 1.0).\n * @param a Optional alpha (0.0 - 1.0).\n * @return A 32-bit unsigned integer color.\n */\nfunction fromHsv(h, s, v, a) {\n  const i = (h * 6) | 0;\n  const f = h * 6 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - f * s);\n  const t = v * (1 - (1 - f) * s);\n  let r, g, b;\n  switch (i % 6) {\n    case 0:\n      r = v, g = t, b = p;\n      break;\n    case 1:\n      r = q, g = v, b = p;\n      break;\n    case 2:\n      r = p, g = v, b = t;\n      break;\n    case 3:\n      r = p, g = q, b = v;\n      break;\n    case 4:\n      r = t, g = p, b = v;\n      break;\n    case 5:\n      r = v, g = p, b = q;\n      break;\n    default:\n      r = 0;\n      g = 0;\n      b = 0;\n  }\n  if (a === undefined) {\n    a = 1.0;\n  }\n  return fromRgb((r * 255) | 0, (g * 255) | 0, (b * 255) | 0, (a * 255) | 0);\n}\n\n\n//# sourceURL=webpack:///./src/color.js?");

/***/ }),

/***/ "./src/colors.js":
/*!***********************!*\
  !*** ./src/colors.js ***!
  \***********************/
/*! exports provided: Colors */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Colors\", function() { return Colors; });\n/* harmony import */ var _color_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./color.js */ \"./src/color.js\");\n\n\n\nconst Colors = {\n  BLACK: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0, 0, 0),\n  WHITE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0xff, 0xff),\n  LIGHT_GRAY: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0xaa, 0xaa),\n  DARK_GRAY: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0x55, 0x55),\n  YELLOW: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0xff, 0x55),\n  BROWN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x55, 0x00),\n  LIGHT_RED: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x55, 0x55),\n  DARK_RED: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x00, 0x00),\n  LIGHT_GREEN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0xff, 0x55),\n  DARK_GREEN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0xaa, 0x00),\n  LIGHT_CYAN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0xff, 0xff),\n  DARK_CYAN: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0xaa, 0xaa),\n  LIGHT_BLUE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x55, 0x55, 0xff),\n  DARK_BLUE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0x00, 0x00, 0xaa),\n  LIGHT_MAGENTA: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x55, 0xff),\n  DARK_MAGENTA: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xaa, 0x00, 0xaa),\n  ORANGE: Object(_color_js__WEBPACK_IMPORTED_MODULE_0__[\"fromRgb\"])(0xff, 0x88, 0x00),\n};\n\n\n//# sourceURL=webpack:///./src/colors.js?");

/***/ }),

/***/ "./src/console.js":
/*!************************!*\
  !*** ./src/console.js ***!
  \************************/
/*! exports provided: Console */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Console\", function() { return Console; });\n/* harmony import */ var _blendmode_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./blendmode.js */ \"./src/blendmode.js\");\n/* harmony import */ var _cell_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./cell.js */ \"./src/cell.js\");\n/* harmony import */ var _chars_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chars.js */ \"./src/chars.js\");\n\n\n\n\n\nclass Console {\n\n  constructor(width, height, opt_cellClass) {\n    this.width = width;\n    this.height = height;\n    this.grid = new Array();\n\n    const cellClass = opt_cellClass || _cell_js__WEBPACK_IMPORTED_MODULE_1__[\"Cell\"];\n\n    for (let y = 0; y < height; y++) {\n      const row = new Array();\n      for (let x = 0; x < width; x++) {\n        row.push(new cellClass(x, y));\n      }\n      this.grid.push(row);\n    }\n\n    this.clear();\n  }\n\n  clear() {\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        this.drawChar(x, y, 0);\n      }\n    }\n  }\n\n  getCell(x, y) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x];\n  }\n\n  getCharCode(x, y) {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return undefined;\n    }\n    return this.grid[y][x].charCode;\n  }\n\n  drawChar(x, y, c, fg, bg) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].setValue(c, fg, bg);\n    }\n  }\n\n  drawString(x, y, str, fg, bg) {\n    const lines = str.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      for (let j = 0; j < line.length; j++) {\n        this.drawChar(x + j, y + i, line.charCodeAt(j), fg, bg);\n      }\n    }\n  }\n\n  drawCenteredString(x, y, str, fg, bg) {\n    this.drawString(x - Math.floor(str.length / 2), y, str, fg, bg);\n  }\n\n  drawHLine(x, y, width, c, fg, bg) {\n    for (let xi = x; xi < x + width; xi++) {\n      this.drawChar(xi, y, c, fg, bg);\n    }\n  }\n\n  drawVLine(x, y, height, c, fg, bg) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawChar(x, yi, c, fg, bg);\n    }\n  }\n\n  drawRect(x, y, width, height, c, fg, bg) {\n    this.drawHLine(x, y, width, c, fg, bg);\n    this.drawHLine(x, y + height - 1, width, c, fg, bg);\n    this.drawVLine(x, y, height, c, fg, bg);\n    this.drawVLine(x + width - 1, y, height, c, fg, bg);\n  }\n\n  drawBox(\n      x, y, width, height, topChar,\n      rightChar, bottomChar, leftChar,\n      topLeftChar, topRightChar, bottomRightChar,\n      bottomLeftChar, fg, bg) {\n    this.fillRect(x, y, width, height, 0, fg, bg);\n\n    this.drawHLine(x, y, width, topChar);\n    this.drawHLine(x, y + height - 1, width, bottomChar);\n\n    this.drawVLine(x, y, height, leftChar);\n    this.drawVLine(x + width - 1, y, height, rightChar);\n\n    this.drawChar(x, y, topLeftChar);\n    this.drawChar(x + width - 1, y, topRightChar);\n    this.drawChar(x, y + height - 1, bottomLeftChar);\n    this.drawChar(x + width - 1, y + height - 1, bottomRightChar);\n  }\n\n  drawSingleBox(x, y, width, height, fg, bg) {\n    this.drawBox(\n        x, y, width, height, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_DOWN_AND_SINGLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_UP_AND_SINGLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_SINGLE_UP_AND_SINGLE_RIGHT, fg, bg);\n  }\n\n  drawDoubleBox(x, y, width, height, fg, bg) {\n    this.drawBox(\n        x, y, width, height, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_HORIZONTAL,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_VERTICAL, _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_UP_AND_DOUBLE_LEFT,\n        _chars_js__WEBPACK_IMPORTED_MODULE_2__[\"Chars\"].BOX_DOUBLE_UP_AND_DOUBLE_RIGHT, fg, bg);\n  }\n\n  fillRect(x, y, width, height, c, fg, bg) {\n    for (let yi = y; yi < y + height; yi++) {\n      this.drawHLine(x, yi, width, c, fg, bg);\n    }\n  }\n\n  drawConsole(\n      dstX, dstY, srcConsole, srcX,\n      srcY, srcWidth, srcHeight,\n      blendMode) {\n    blendMode = blendMode || _blendmode_js__WEBPACK_IMPORTED_MODULE_0__[\"BlendMode\"].None;\n\n    for (let y = 0; y < srcHeight; y++) {\n      for (let x = 0; x < srcWidth; x++) {\n        const cell = srcConsole.getCell(srcX + x, srcY + y);\n        if (cell) {\n          this.drawCell(dstX + x, dstY + y, cell, blendMode);\n        }\n      }\n    }\n  }\n\n  drawCell(x, y, cell, blendMode) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].drawCell(cell, blendMode);\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/console.js?");

/***/ }),

/***/ "./src/font.js":
/*!*********************!*\
  !*** ./src/font.js ***!
  \*********************/
/*! exports provided: Font, DEFAULT_FONT */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Font\", function() { return Font; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DEFAULT_FONT\", function() { return DEFAULT_FONT; });\n\nclass Font {\n\n  constructor(\n      url, charWidth, charHeight, scale,\n      graphical) {\n    this.url = url;\n    this.charWidth = charWidth;\n    this.charHeight = charHeight;\n    this.scale = scale || 1.0;\n    this.graphical = !!graphical;\n  }\n}\n\n/**\n * Font image as data URL.\n * IBM terminal font.\n * See img/font.png.\n */\nconst FONT_IMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQ' +\n    'MAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8' +\n    'QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY' +\n    '09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1' +\n    'zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eIC' +\n    'JsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBq' +\n    'ucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqh' +\n    'JRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvh' +\n    'A1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL' +\n    '0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu' +\n    '2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIz' +\n    'CAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsW' +\n    'IE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBW' +\n    'l5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h' +\n    '5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtL' +\n    'ji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb' +\n    '2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O' +\n    '3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2f' +\n    'otTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZ' +\n    'UghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2G' +\n    'AzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc' +\n    '4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJ' +\n    'G199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJI' +\n    'lipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC';\n\nconst DEFAULT_FONT = new Font(FONT_IMAGE, 8, 8);\n\n\n//# sourceURL=webpack:///./src/font.js?");

/***/ }),

/***/ "./src/gui.js":
/*!********************!*\
  !*** ./src/gui.js ***!
  \********************/
/*! exports provided: GUI */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GUI\", function() { return GUI; });\n/* harmony import */ var _gui_defaultdialogrenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./gui/defaultdialogrenderer.js */ \"./src/gui/defaultdialogrenderer.js\");\n\n\n\nclass GUI {\n\n  constructor(terminal, renderer) {\n    this.terminal = terminal;\n    this.renderer = renderer || new _gui_defaultdialogrenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"DefaultDialogRenderer\"]();\n    this.dialogs = [];\n  }\n\n  add(dialog) {\n    this.dialogs.push(this.renderer.getState(this.terminal, dialog));\n  }\n\n  handleInput() {\n    if (this.dialogs.length === 0) {\n      return false;\n    }\n\n    const activeIndex = this.dialogs.length - 1;\n    const activeState = this.dialogs[this.dialogs.length - 1];\n    const activeDialog = activeState.dialog;\n    if (activeDialog.handleInput(this.terminal, activeState.contentsOffset)) {\n      this.dialogs.splice(activeIndex, 1);\n    }\n\n    return true;\n  }\n\n  draw() {\n    for (let i = 0; i < this.dialogs.length; i++) {\n      this.renderer.draw(this.terminal, this.dialogs[i]);\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/gui.js?");

/***/ }),

/***/ "./src/gui/defaultdialogrenderer.js":
/*!******************************************!*\
  !*** ./src/gui/defaultdialogrenderer.js ***!
  \******************************************/
/*! exports provided: DefaultDialogRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DefaultDialogRenderer\", function() { return DefaultDialogRenderer; });\n/* harmony import */ var _colors_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../colors.js */ \"./src/colors.js\");\n/* harmony import */ var _point_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../point.js */ \"./src/point.js\");\n/* harmony import */ var _rect_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../rect.js */ \"./src/rect.js\");\n/* harmony import */ var _dialogstate_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dialogstate.js */ \"./src/gui/dialogstate.js\");\n\n\n\n;\n\n\nclass DefaultDialogRenderer {\n  getState(terminal, dialog) {\n    const width = dialog.contentsRect.width + 4;\n    const height = dialog.contentsRect.height + 4;\n    const x = ((terminal.width - width) / 2) | 0;\n    const y = ((terminal.height - height) / 2) | 0;\n    return new _dialogstate_js__WEBPACK_IMPORTED_MODULE_3__[\"DialogState\"](\n        dialog, new _rect_js__WEBPACK_IMPORTED_MODULE_2__[\"Rect\"](x, y, width, height), new _point_js__WEBPACK_IMPORTED_MODULE_1__[\"Point\"](x + 2, y + 2));\n  }\n\n  draw(term, dialogState) {\n    const dialog = dialogState.dialog;\n    const {x, y, width, height} = dialogState.rect;\n    term.fillRect(x, y, width, height, 0, _colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].WHITE, _colors_js__WEBPACK_IMPORTED_MODULE_0__[\"Colors\"].BLACK);\n    term.drawSingleBox(x, y, width, height);\n    term.drawCenteredString(x + (width / 2) | 0, y, ' ' + dialog.title + ' ');\n    dialog.drawContents(term, dialogState.contentsOffset);\n  }\n}\n\n//# sourceURL=webpack:///./src/gui/defaultdialogrenderer.js?");

/***/ }),

/***/ "./src/gui/dialog.js":
/*!***************************!*\
  !*** ./src/gui/dialog.js ***!
  \***************************/
/*! exports provided: Dialog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Dialog\", function() { return Dialog; });\n\nclass Dialog {\n\n  constructor(contentsRect, title) {\n    this.contentsRect = contentsRect;\n    this.title = title;\n  }\n\n  drawContents(console, offset) {}\n\n  handleInput(terminal, offset) {}\n}\n\n\n//# sourceURL=webpack:///./src/gui/dialog.js?");

/***/ }),

/***/ "./src/gui/dialogstate.js":
/*!********************************!*\
  !*** ./src/gui/dialogstate.js ***!
  \********************************/
/*! exports provided: DialogState */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DialogState\", function() { return DialogState; });\n\nclass DialogState {\n\n  constructor(dialog, rect, contentsOffset) {\n    this.dialog = dialog;\n    this.rect = rect;\n    this.contentsOffset = contentsOffset;\n    this.open = false;\n    this.count = 0;\n  }\n}\n\n\n//# sourceURL=webpack:///./src/gui/dialogstate.js?");

/***/ }),

/***/ "./src/gui/messagedialog.js":
/*!**********************************!*\
  !*** ./src/gui/messagedialog.js ***!
  \**********************************/
/*! exports provided: MessageDialog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MessageDialog\", function() { return MessageDialog; });\n/* harmony import */ var _keys_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../keys.js */ \"./src/keys.js\");\n/* harmony import */ var _rect_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../rect.js */ \"./src/rect.js\");\n/* harmony import */ var _dialog_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dialog.js */ \"./src/gui/dialog.js\");\n\n\n\n\n\nclass MessageDialog extends _dialog_js__WEBPACK_IMPORTED_MODULE_2__[\"Dialog\"] {\n\n  constructor(title, message) {\n    const lines = message.split('\\n');\n    let width = title.length;\n    for (let i = 0; i < lines.length; i++) {\n      width = Math.max(width, lines[i].length);\n    }\n\n    const height = lines.length;\n    const rect = new _rect_js__WEBPACK_IMPORTED_MODULE_1__[\"Rect\"](0, 0, width, height);\n    super(rect, title);\n    this.lines = lines;\n  }\n\n  drawContents(console, offset) {\n    for (let i = 0; i < this.lines.length; i++) {\n      console.drawString(offset.x, offset.y + i, this.lines[i]);\n    }\n  }\n\n  handleInput(terminal, offset) {\n    return terminal.isKeyPressed(_keys_js__WEBPACK_IMPORTED_MODULE_0__[\"Keys\"].VK_ESCAPE);\n  }\n}\n\n\n//# sourceURL=webpack:///./src/gui/messagedialog.js?");

/***/ }),

/***/ "./src/gui/selectdialog.js":
/*!*********************************!*\
  !*** ./src/gui/selectdialog.js ***!
  \*********************************/
/*! exports provided: SelectDialog */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SelectDialog\", function() { return SelectDialog; });\n/* harmony import */ var _keys_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../keys.js */ \"./src/keys.js\");\n/* harmony import */ var _rect_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../rect.js */ \"./src/rect.js\");\n/* harmony import */ var _dialog_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dialog.js */ \"./src/gui/dialog.js\");\n\n\n\n\n\nclass SelectDialog extends _dialog_js__WEBPACK_IMPORTED_MODULE_2__[\"Dialog\"] {\n\n  constructor(\n      title, options, callback) {\n    let width = title.length;\n    for (let i = 0; i < options.length; i++) {\n      width = Math.max(width, options[i].length + 4);\n    }\n\n    const height = options.length;\n    const rect = new _rect_js__WEBPACK_IMPORTED_MODULE_1__[\"Rect\"](0, 0, width, height);\n    super(rect, title);\n    this.options = options;\n    this.callback = callback;\n  }\n\n  drawContents(console, offset) {\n    for (let i = 0; i < this.options.length; i++) {\n      const str = String.fromCharCode(65 + i) + ' - ' + this.options[i];\n      console.drawString(offset.x, offset.y + i, str);\n    }\n  }\n\n  handleInput(terminal, offset) {\n    for (let i = 0; i < this.options.length; i++) {\n      if (terminal.isKeyPressed(_keys_js__WEBPACK_IMPORTED_MODULE_0__[\"Keys\"].VK_A + i)) {\n        this.callback(i);\n        return true;\n      }\n    }\n    return terminal.isKeyPressed(_keys_js__WEBPACK_IMPORTED_MODULE_0__[\"Keys\"].VK_ESCAPE);\n  }\n}\n\n\n//# sourceURL=webpack:///./src/gui/selectdialog.js?");

/***/ }),

/***/ "./src/image.js":
/*!**********************!*\
  !*** ./src/image.js ***!
  \**********************/
/*! exports provided: loadImage, loadImage2x */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadImage\", function() { return loadImage; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadImage2x\", function() { return loadImage2x; });\n/* harmony import */ var _chars_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chars.js */ \"./src/chars.js\");\n/* harmony import */ var _color_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./color.js */ \"./src/color.js\");\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n\n\n\n\n\n/**\n * All available 2x2 patterns for 2x image loading.\n * Note: The strict IBM CGA font only has halves, not quadrants.\n */\nconst PATTERNS = [\n  {charCode: _chars_js__WEBPACK_IMPORTED_MODULE_0__[\"Chars\"].BLOCK_TOP_HALF, active: [1, 1, 0, 0]},\n  {charCode: _chars_js__WEBPACK_IMPORTED_MODULE_0__[\"Chars\"].BLOCK_RIGHT_HALF, active: [0, 1, 0, 1]},\n];\n\nfunction loadImage(url, callback) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new _console_js__WEBPACK_IMPORTED_MODULE_2__[\"Console\"](w, h);\n    let i = 0;\n\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        const cell = result.getCell(x, y);\n        cell.setBackground(Object(_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(data[i++], data[i++], data[i++], data[i++]));\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nfunction loadImage2x(url, callback) {\n  const img = new Image();\n  img.onload = () => {\n    const w = img.width;\n    const h = img.height;\n    const data = getImageData(img);\n    const result = new _console_js__WEBPACK_IMPORTED_MODULE_2__[\"Console\"](w / 2, h / 2);\n\n    for (let y = 0; y < h; y += 2) {\n      for (let x = 0; x < w; x += 2) {\n        draw2x2(result, data, x, y, w);\n      }\n    }\n\n    callback(result);\n  };\n  img.src = url;\n}\n\nfunction getImageData(img) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d');\n  ctx.drawImage(img, 0, 0);\n\n  return ctx.getImageData(0, 0, img.width, img.height).data;\n}\n\nfunction draw2x2(\n    con, data, x, y, w) {\n  // Top left\n  const i1 = 4 * (y * w + x);\n  const r1 = data[i1];\n  const g1 = data[i1 + 1];\n  const b1 = data[i1 + 2];\n\n  // Top right\n  const i2 = 4 * (y * w + x + 1);\n  const r2 = data[i2];\n  const g2 = data[i2 + 1];\n  const b2 = data[i2 + 2];\n\n  // Bottom left\n  const i3 = 4 * ((y + 1) * w + x);\n  const r3 = data[i3];\n  const g3 = data[i3 + 1];\n  const b3 = data[i3 + 2];\n\n  // Bottom right\n  const i4 = 4 * ((y + 1) * w + x + 1);\n  const r4 = data[i4];\n  const g4 = data[i4 + 1];\n  const b4 = data[i4 + 2];\n\n  const colors = [[r1, g1, b1], [r2, g2, b2], [r3, g3, b3], [r4, g4, b4]];\n\n  // For each possible pattern, calculate the total error\n  // Find the pattern with minum error\n\n  let minError = Number.MAX_VALUE;\n  let bestCharCode = 0;\n  let bestBg = null;\n  let bestFg = null;\n\n  for (let i = 0; i < PATTERNS.length; i++) {\n    const pattern = PATTERNS[i];\n    const patternColors = computeColors(pattern.active, colors);\n    if (patternColors.error < minError) {\n      minError = patternColors.error;\n      bestCharCode = pattern.charCode;\n      bestBg = patternColors.bg;\n      bestFg = patternColors.fg;\n    }\n  }\n\n  con.drawChar(x / 2, y / 2, bestCharCode, arrayToColor(bestFg), arrayToColor(bestBg));\n}\n\nfunction computeColors(pattern, colors) {\n  const sum = [[0, 0, 0], [0, 0, 0]];\n  const avg = [[0, 0, 0], [0, 0, 0]];\n  const count = [0, 0];\n\n  for (let i = 0; i < 4; i++) {\n    for (let j = 0; j < 3; j++) {\n      sum[pattern[i]][j] += colors[i][j];\n    }\n    count[pattern[i]]++;\n  }\n\n  for (let i = 0; i < 2; i++) {\n    for (let j = 0; j < 3; j++) {\n      avg[i][j] = sum[i][j] / count[i];\n    }\n  }\n\n  let error = 0.0;\n\n  for (let i = 0; i < 4; i++) {\n    let cellError = 0.0;\n    for (let j = 0; j < 3; j++) {\n      const delta = colors[i][j] - avg[pattern[i]][j];\n      cellError += delta * delta;\n    }\n    error += Math.sqrt(cellError);\n  }\n\n  return {bg: avg[0], fg: avg[1], error};\n}\n\nfunction arrayToColor(rgb) {\n  return Object(_color_js__WEBPACK_IMPORTED_MODULE_1__[\"fromRgb\"])(rgb[0], rgb[1], rgb[2]);\n}\n\n\n//# sourceURL=webpack:///./src/image.js?");

/***/ }),

/***/ "./src/input.js":
/*!**********************!*\
  !*** ./src/input.js ***!
  \**********************/
/*! exports provided: Input */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Input\", function() { return Input; });\n\n/**\n * The delay in frames before input repeating.\n * Assume 60 FPS.\n */\nconst INPUT_REPEAT_DELAY = 6;\n\n/**\n * The delay between subsequent repeat firing.\n * Assume 60 FPS.\n */\nconst INPUT_REPEAT_RATE = 1;\n\n/**\n * The Input class represents a pysical input.\n * Example: keyboard key or mouse button.\n */\nclass Input {\n    constructor() {\n        this.down = false;\n        this.downCount = 0;\n        this.upCount = 0;\n    }\n\n    update() {\n        if (this.down) {\n            this.downCount++;\n            this.upCount = 0;\n        } else {\n            this.downCount = 0;\n            this.upCount++;\n        }\n    }\n\n    /**\n     * Returns true if the input is \"pressed\".\n     * Pressed is a one time event when the input first goes down.\n     * It then repeats on repeat delay.\n     */\n    isPressed() {\n        const count = this.downCount;\n        return count === 1 || (count > INPUT_REPEAT_DELAY && count % INPUT_REPEAT_RATE === 0);\n    }\n\n    /**\n     * Returns true if the input is \"clicked\".\n     * Clicked is a one time event when the input first goes up.\n     */\n    isClicked() {\n        return this.upCount === 1;\n    }\n}\n\n\n//# sourceURL=webpack:///./src/input.js?");

/***/ }),

/***/ "./src/keys.js":
/*!*********************!*\
  !*** ./src/keys.js ***!
  \*********************/
/*! exports provided: Keyboard, Keys */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Keyboard\", function() { return Keyboard; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Keys\", function() { return Keys; });\n/* harmony import */ var _input_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./input.js */ \"./src/input.js\");\n\n\n/**\n * Number of keys to track.\n */\nconst KEY_COUNT = 256;\n\nclass Keyboard {\n\n  /**\n   * Creates a new keyboard module.\n   *\n   * @param el DOM el to attach listeners.\n   */\n  constructor(el) {\n    this.keys = new Array(KEY_COUNT);\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i] = new _input_js__WEBPACK_IMPORTED_MODULE_0__[\"Input\"]();\n    }\n\n    el.addEventListener('keydown', e => this.setKey(e, true));\n    el.addEventListener('keyup', e => this.setKey(e, false));\n  }\n\n\n  setKey(e, state) {\n    const keyCode = e.keyCode;\n    if (keyCode === Keys.VK_F11) {\n      // Allow fullscreen requests to go through\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    if (keyCode >= 0 && keyCode < KEY_COUNT) {\n      this.keys[keyCode].down = state;\n    }\n  }\n\n  updateKeys() {\n    for (let i = 0; i < KEY_COUNT; i++) {\n      this.keys[i].update();\n    }\n  }\n\n  getKey(keyCode) {\n    return keyCode >= 0 && keyCode < KEY_COUNT ? this.keys[keyCode] : null;\n  }\n}\n\nconst Keys = {\n  VK_CANCEL: 3,\n  VK_HELP: 6,\n  VK_BACK_SPACE: 8,\n  VK_TAB: 9,\n  VK_CLEAR: 12,\n  VK_ENTER: 13,\n  VK_SHIFT: 16,\n  VK_CONTROL: 17,\n  VK_ALT: 18,\n  VK_PAUSE: 19,\n  VK_CAPS_LOCK: 20,\n  VK_ESCAPE: 27,\n  VK_SPACE: 32,\n  VK_PAGE_UP: 33,\n  VK_PAGE_DOWN: 34,\n  VK_END: 35,\n  VK_HOME: 36,\n  VK_LEFT: 37,\n  VK_UP: 38,\n  VK_RIGHT: 39,\n  VK_DOWN: 40,\n  VK_PRINTSCREEN: 44,\n  VK_INSERT: 45,\n  VK_DELETE: 46,\n  VK_0: 48,\n  VK_1: 49,\n  VK_2: 50,\n  VK_3: 51,\n  VK_4: 52,\n  VK_5: 53,\n  VK_6: 54,\n  VK_7: 55,\n  VK_8: 56,\n  VK_9: 57,\n  VK_COLON: 58,\n  VK_SEMICOLON: 59,\n  VK_LESS_THAN: 60,\n  VK_EQUALS: 61,\n  VK_GREATER_THAN: 62,\n  VK_QUESTION_MARK: 63,\n  VK_AT: 64,\n  VK_A: 65,\n  VK_B: 66,\n  VK_C: 67,\n  VK_D: 68,\n  VK_E: 69,\n  VK_F: 70,\n  VK_G: 71,\n  VK_H: 72,\n  VK_I: 73,\n  VK_J: 74,\n  VK_K: 75,\n  VK_L: 76,\n  VK_M: 77,\n  VK_N: 78,\n  VK_O: 79,\n  VK_P: 80,\n  VK_Q: 81,\n  VK_R: 82,\n  VK_S: 83,\n  VK_T: 84,\n  VK_U: 85,\n  VK_V: 86,\n  VK_W: 87,\n  VK_X: 88,\n  VK_Y: 89,\n  VK_Z: 90,\n  VK_CONTEXT_MENU: 93,\n  VK_NUMPAD0: 96,\n  VK_NUMPAD1: 97,\n  VK_NUMPAD2: 98,\n  VK_NUMPAD3: 99,\n  VK_NUMPAD4: 100,\n  VK_NUMPAD5: 101,\n  VK_NUMPAD6: 102,\n  VK_NUMPAD7: 103,\n  VK_NUMPAD8: 104,\n  VK_NUMPAD9: 105,\n  VK_MULTIPLY: 106,\n  VK_ADD: 107,\n  VK_SEPARATOR: 108,\n  VK_SUBTRACT: 109,\n  VK_DECIMAL: 110,\n  VK_DIVIDE: 111,\n  VK_F1: 112,\n  VK_F2: 113,\n  VK_F3: 114,\n  VK_F4: 115,\n  VK_F5: 116,\n  VK_F6: 117,\n  VK_F7: 118,\n  VK_F8: 119,\n  VK_F9: 120,\n  VK_F10: 121,\n  VK_F11: 122,\n  VK_F12: 123,\n  VK_F13: 124,\n  VK_F14: 125,\n  VK_F15: 126,\n  VK_F16: 127,\n  VK_F17: 128,\n  VK_F18: 129,\n  VK_F19: 130,\n  VK_F20: 131,\n  VK_F21: 132,\n  VK_F22: 133,\n  VK_F23: 134,\n  VK_F24: 135,\n  VK_NUM_LOCK: 144,\n  VK_SCROLL_LOCK: 145,\n  VK_CIRCUMFLEX: 160,\n  VK_EXCLAMATION: 161,\n  VK_DOUBLE_QUOTE: 162,\n  VK_HASH: 163,\n  VK_DOLLAR: 164,\n  VK_PERCENT: 165,\n  VK_AMPERSAND: 166,\n  VK_UNDERSCORE: 167,\n  VK_OPEN_PAREN: 168,\n  VK_CLOSE_PAREN: 169,\n  VK_ASTERISK: 170,\n  VK_PLUS: 171,\n  VK_PIPE: 172,\n  VK_HYPHEN_MINUS: 173,\n  VK_OPEN_CURLY_BRACKET: 174,\n  VK_CLOSE_CURLY_BRACKET: 175,\n  VK_TILDE: 176,\n  VK_COMMA: 188,\n  VK_PERIOD: 190,\n  VK_SLASH: 191,\n  VK_BACK_QUOTE: 192,\n  VK_OPEN_BRACKET: 219,\n  VK_BACK_SLASH: 220,\n  VK_CLOSE_BRACKET: 221,\n  VK_QUOTE: 222,\n  VK_META: 224,\n  VK_ALTGR: 225,\n  VK_WIN: 91,\n  VK_KANA: 21,\n  VK_HANGUL: 21,\n  VK_EISU: 22,\n  VK_JUNJA: 23,\n  VK_FINAL: 24,\n  VK_HANJA: 25,\n  VK_KANJI: 25,\n  VK_CONVERT: 28,\n  VK_NONCONVERT: 29,\n  VK_ACCEPT: 30,\n  VK_MODECHANGE: 31,\n  VK_SELECT: 41,\n  VK_PRINT: 42,\n  VK_EXECUTE: 43,\n  VK_SLEEP: 95,\n};\n\n\n//# sourceURL=webpack:///./src/keys.js?");

/***/ }),

/***/ "./src/mouse.js":
/*!**********************!*\
  !*** ./src/mouse.js ***!
  \**********************/
/*! exports provided: Mouse */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Mouse\", function() { return Mouse; });\n/* harmony import */ var _rect_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rect.js */ \"./src/rect.js\");\n/* harmony import */ var _input_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./input.js */ \"./src/input.js\");\n\n\n\n\nclass Mouse {\n\n  constructor(terminal, options) {\n    this.el = terminal.canvas;\n    this.width = terminal.width;\n    this.height = terminal.height;\n    this.options = options;\n    this.prevX = 0;\n    this.prevY = 0;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.buttons = [new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"](), new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"](), new _input_js__WEBPACK_IMPORTED_MODULE_1__[\"Input\"]()];\n\n    const el = this.el;\n    el.addEventListener('mousedown', e => this.handleEvent(e));\n    el.addEventListener('mouseup', e => this.handleEvent(e));\n    el.addEventListener('mousemove', e => this.handleEvent(e));\n    el.addEventListener('contextmenu', e => this.handleEvent(e));\n\n    const touchEventHandler = this.handleTouchEvent.bind(this);\n    el.addEventListener('touchstart', touchEventHandler);\n    el.addEventListener('touchend', touchEventHandler);\n    el.addEventListener('touchcancel', touchEventHandler);\n    el.addEventListener('touchmove', touchEventHandler);\n  }\n\n  handleTouchEvent(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.type === 'touchend' && this.options.requestFullscreen) {\n      this.requestFullscreen();\n    }\n\n    if (e.touches.length > 0) {\n      const touch = e.touches[0];\n      this.updatePosition(touch.clientX, touch.clientY);\n      this.buttons[0].down = true;\n    } else {\n      this.buttons[0].down = false;\n    }\n  }\n\n  handleEvent(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.updatePosition(e.clientX, e.clientY);\n\n    if (e.type === 'mousedown') {\n      this.buttons[e.button].down = true;\n\n      this.el.focus();\n\n      if (this.options.requestFullscreen) {\n        this.requestFullscreen();\n      }\n    }\n\n    if (e.type === 'mouseup') {\n      this.buttons[e.button].down = false;\n    }\n  }\n\n  updatePosition(clientX, clientY) {\n    let rect = this.el.getBoundingClientRect();\n\n    // If the client rect is not the same aspect ratio as canvas,\n    // then we are fullscreen.\n    // Need to update client rect accordingly.\n\n    const terminalAspectRatio = this.width / this.height;\n    const rectAspectRatio = rect.width / rect.height;\n\n    if (rectAspectRatio - terminalAspectRatio > 0.01) {\n      const actualWidth = terminalAspectRatio * rect.height;\n      const excess = rect.width - actualWidth;\n      rect = new _rect_js__WEBPACK_IMPORTED_MODULE_0__[\"Rect\"](Math.floor(excess / 2), 0, actualWidth, rect.height);\n    }\n\n    if (rectAspectRatio - terminalAspectRatio < -0.01) {\n      const actualHeight = rect.width / terminalAspectRatio;\n      const excess = rect.height - actualHeight;\n      rect = new _rect_js__WEBPACK_IMPORTED_MODULE_0__[\"Rect\"](0, Math.floor(excess / 2), rect.width, actualHeight);\n    }\n\n    this.x = (this.width * (clientX - rect.left) / rect.width) | 0;\n    this.y = (this.height * (clientY - rect.top) / rect.height) | 0;\n  }\n\n  requestFullscreen() {\n    const canvas = this.el;\n    if (canvas.requestFullscreen) {\n      canvas.requestFullscreen();\n    } else if (canvas.webkitRequestFullscreen) {\n      canvas.webkitRequestFullscreen();\n    } else if (canvas.mozRequestFullScreen) {\n      canvas.mozRequestFullScreen();\n    }\n  }\n\n  update() {\n    this.dx = this.x - this.prevX;\n    this.dy = this.y - this.prevY;\n    this.prevX = this.x;\n    this.prevY = this.y;\n\n    for (let i = 0; i < this.buttons.length; i++) {\n      this.buttons[i].update();\n    }\n  }\n}\n\n//# sourceURL=webpack:///./src/mouse.js?");

/***/ }),

/***/ "./src/point.js":
/*!**********************!*\
  !*** ./src/point.js ***!
  \**********************/
/*! exports provided: Point */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Point\", function() { return Point; });\n\nclass Point {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n}\n\n\n//# sourceURL=webpack:///./src/point.js?");

/***/ }),

/***/ "./src/rect.js":
/*!*********************!*\
  !*** ./src/rect.js ***!
  \*********************/
/*! exports provided: Rect */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Rect\", function() { return Rect; });\n/* harmony import */ var _point_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./point.js */ \"./src/point.js\");\n\n\nclass Rect {\n  constructor(x, y, width, height) {\n    this.x = this.left = x;\n    this.y = this.top = y;\n    this.width = width;\n    this.height = height;\n    this.x2 = x + width;\n    this.y2 = y + height;\n  }\n\n  getCenter() {\n    return new _point_js__WEBPACK_IMPORTED_MODULE_0__[\"Point\"](this.x + (this.width / 2) | 0, this.y + (this.height / 2) | 0);\n  }\n\n  intersects(other) {\n    return this.x <= other.x2 && this.x2 >= other.x && this.y <= other.y2 && this.y2 >= other.y;\n  }\n\n  contains(point) {\n    return point.x >= this.x && point.y < this.x2 && point.y >= this.y && point.y < this.y2;\n  }\n}\n\n\n//# sourceURL=webpack:///./src/rect.js?");

/***/ }),

/***/ "./src/rng.js":
/*!********************!*\
  !*** ./src/rng.js ***!
  \********************/
/*! exports provided: RNG */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RNG\", function() { return RNG; });\n\n/**\n * Random number generator.\n *\n * LCG\n * https://stackoverflow.com/a/424445/2051724\n */\nclass RNG {\n\n  /**\n   * Creates a new random number generator.\n   *\n   * @param seed The integer seed.\n   */\n  constructor(seed) {\n    // LCG using GCC's constants\n    this.m = 0x80000000;  // 2**31;\n    this.a = 1103515245;\n    this.c = 12345;\n    this.state = seed || 1;\n  }\n\n  nextInt() {\n    this.state = (this.a * this.state + this.c) % this.m;\n    return this.state;\n  }\n\n  /**\n   * Returns a floating point number between 0.0 and 1.0.\n   */\n  nextFloat() {\n    // returns in range [0,1]\n    return this.nextInt() / (this.m - 1);\n  }\n\n  /**\n   * Returns an integer in the range start (inclusive) to end (exclusive).\n   * @param start Lower bound, inclusive.\n   * @param end Upper bound, exclusive.\n   */\n  nextRange(start, end) {\n    // returns in range [start, end): including start, excluding end\n    // can't modulu nextInt because of weak randomness in lower bits\n    const rangeSize = end - start;\n    const randomUnder1 = this.nextInt() / this.m;\n    const result = start + ((randomUnder1 * rangeSize) | 0);\n    if (isNaN(result)) {\n      throw new Error('rand nan');\n    }\n    return result;\n  }\n\n  chooseIndex(chances) {\n    const total = chances.reduce((a, b) => a + b);\n    const roll = this.nextRange(1, total + 1);\n    let runningTotal = 0;\n\n    for (let i = 0; i < chances.length; i++) {\n      runningTotal += chances[i];\n      if (roll <= runningTotal) {\n        return i;\n      }\n    }\n\n    return chances.length - 1;\n  }\n\n  chooseKey(chancesMap) {\n    const values = [];\n    const chances = [];\n\n    for (const property in chancesMap) {\n      if (chancesMap.hasOwnProperty(property)) {\n        values.push(property);\n        chances.push(chancesMap[property]);\n      }\n    }\n\n    return values[this.chooseIndex(chances)];\n  }\n}\n\n\n//# sourceURL=webpack:///./src/rng.js?");

/***/ }),

/***/ "./src/shaders.js":
/*!************************!*\
  !*** ./src/shaders.js ***!
  \************************/
/*! exports provided: VERTEX_SHADER_SOURCE, FRAGMENT_SHADER_SOURCE */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"VERTEX_SHADER_SOURCE\", function() { return VERTEX_SHADER_SOURCE; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FRAGMENT_SHADER_SOURCE\", function() { return FRAGMENT_SHADER_SOURCE; });\n\n/**\n * Vertex shader program.\n *\n * a = attribute vec2 aVertexPosition;\n * b = attribute vec2 aTextureCoord;\n * c = attribute vec3 aFgColor;\n * d = attribute vec3 aBgColor;\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n */\nconst VERTEX_SHADER_SOURCE = 'attribute vec2 a;' +\n    'attribute vec2 b;' +\n    'attribute vec3 c;' +\n    'attribute vec3 d;' +\n    'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'void main(void){' +\n    'gl_Position=vec4(a.x,a.y,0,1);' +\n    'e=b/16.0;' +\n    'f=vec4(c.r,c.g,c.b,1);' +\n    'g=vec4(d.r,d.g,d.b,1);' +\n    '}';\n\n/**\n * Fragment shader program.\n *\n * e = varying vec2 vTextureCoord;\n * f = varying vec4 vFgColor;\n * g = varying vec4 vBgColor;\n * h = uniform bool uGraphicalTiles;\n * s = uniform sampler2D uSampler;\n */\nconst FRAGMENT_SHADER_SOURCE = 'varying highp vec2 e;' +\n    'varying highp vec4 f;' +\n    'varying highp vec4 g;' +\n    'uniform bool h;' +\n    'uniform sampler2D s;' +\n    'void main(void){' +\n    'gl_FragColor=texture2D(s,e);' +\n    'if(h){' +\n    // Using graphical tiles\n    'if(gl_FragColor.a<0.1){' +\n    // The current pixel of the foreground sprite is transparent.\n    // Draw the background tile instead.\n    // Use the background red channel for the tile X coordinate.\n    // Use the background green channel for the tile Y coordinate.\n    // Use the fractional component of the texture coord for the pixel offset.\n    'gl_FragColor=texture2D(s,g.rg*16.0+fract(e*16.0)/16.0);' +\n    '}' +\n    '}else{' +\n    // Using ASCII characters\n    'if(gl_FragColor.r<0.1) {' +\n    // Black background, so use bgColor\n    'gl_FragColor=g;' +\n    '} else {' +\n    // White background, so use fgColor\n    'gl_FragColor=f;' +\n    '}' +\n    '}' +\n    '}';\n\n\n//# sourceURL=webpack:///./src/shaders.js?");

/***/ }),

/***/ "./src/terminal.js":
/*!*************************!*\
  !*** ./src/terminal.js ***!
  \*************************/
/*! exports provided: Terminal */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Terminal\", function() { return Terminal; });\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n/* harmony import */ var _font_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./font.js */ \"./src/font.js\");\n/* harmony import */ var _keys_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./keys.js */ \"./src/keys.js\");\n/* harmony import */ var _mouse_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./mouse.js */ \"./src/mouse.js\");\n/* harmony import */ var _shaders_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./shaders.js */ \"./src/shaders.js\");\n\n\n\n\n\n\n\n/**\n * Linearly interpolates a number in the range 0-max to -1.0-1.0.\n *\n * @param i The value between 0 and max.\n * @param max The maximum value.\n * @returns The interpolated value between -1.0 and 1.0.\n */\nfunction interpolate(i, max) {\n  return -1.0 + 2.0 * (i / max);\n}\n\nconst DEFAULT_OPTIONS = {\n  font: _font_js__WEBPACK_IMPORTED_MODULE_1__[\"DEFAULT_FONT\"],\n  requestFullscreen: false\n};\n\nclass Terminal extends _console_js__WEBPACK_IMPORTED_MODULE_0__[\"Console\"] {\n  constructor(canvas, width, height, options) {\n    super(width, height);\n\n    options = options || DEFAULT_OPTIONS;\n\n    this.canvas = canvas;\n    this.font = options.font || _font_js__WEBPACK_IMPORTED_MODULE_1__[\"DEFAULT_FONT\"];\n    this.pixelWidth = width * this.font.charWidth;\n    this.pixelHeight = height * this.font.charHeight;\n\n    canvas.width = this.pixelWidth;\n    canvas.height = this.pixelHeight;\n    canvas.style.width = (this.font.scale * this.pixelWidth) + 'px';\n    canvas.style.height = (this.font.scale * this.pixelHeight) + 'px';\n    canvas.style.imageRendering = 'pixelated';\n    canvas.style.outline = 'none';\n    canvas.tabIndex = 0;\n    this.handleResize();\n    window.addEventListener('resize', () => this.handleResize());\n\n    this.keys = new _keys_js__WEBPACK_IMPORTED_MODULE_2__[\"Keyboard\"](canvas);\n    this.mouse = new _mouse_js__WEBPACK_IMPORTED_MODULE_3__[\"Mouse\"](this, options);\n\n    // Get the WebGL context from the canvas\n    const gl = canvas.getContext('webgl', {antialias: false});\n    if (!gl) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    const program = gl.createProgram();\n    if (!program) {\n      throw new Error(\n          'Unable to initialize WebGL. Your browser may not support it.');\n    }\n\n    this.gl = gl;\n    this.program = program;\n\n    gl.attachShader(program, this.buildShader(gl.VERTEX_SHADER, _shaders_js__WEBPACK_IMPORTED_MODULE_4__[\"VERTEX_SHADER_SOURCE\"]));\n    gl.attachShader(program, this.buildShader(gl.FRAGMENT_SHADER, _shaders_js__WEBPACK_IMPORTED_MODULE_4__[\"FRAGMENT_SHADER_SOURCE\"]));\n    gl.linkProgram(program);\n    gl.useProgram(program);\n\n    if (this.font.graphical) {\n      // Set the flag to ignore foreground/background colors, and use texture\n      // directly\n      gl.uniform1i(gl.getUniformLocation(program, 'h'), 1);\n    }\n\n    this.positionAttribLocation = this.getAttribLocation('a');\n    this.textureAttribLocation = this.getAttribLocation('b');\n    this.fgColorAttribLocation = this.getAttribLocation('c');\n    this.bgColorAttribLocation = this.getAttribLocation('d');\n\n    const cellCount = width * height;\n    this.positionsArray = new Float32Array(cellCount * 3 * 4);\n    this.indexArray = new Uint16Array(cellCount * 6);\n    this.textureArray = new Float32Array(cellCount * 2 * 4);\n    this.foregroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.foregroundDataView = new DataView(this.foregroundUint8Array.buffer);\n    this.backgroundUint8Array = new Uint8Array(cellCount * 4 * 4);\n    this.backgroundDataView = new DataView(this.backgroundUint8Array.buffer);\n\n    // Init the positions buffer\n    let i = 0;\n    let j = 0;\n    let k = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        // Top-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Top-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y, height);\n\n        // Bottom-right\n        this.positionsArray[i++] = interpolate(x + 1, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        // Bottom-left\n        this.positionsArray[i++] = interpolate(x, width);\n        this.positionsArray[i++] = -interpolate(y + 1, height);\n\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 1;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 0;\n        this.indexArray[j++] = k + 2;\n        this.indexArray[j++] = k + 3;\n\n        k += 4;\n      }\n    }\n\n    this.positionBuffer = gl.createBuffer();\n    this.indexBuffer = gl.createBuffer();\n    this.textureBuffer = gl.createBuffer();\n    this.foregroundBuffer = gl.createBuffer();\n    this.backgroundBuffer = gl.createBuffer();\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positionsArray, gl.STATIC_DRAW);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indexArray, gl.STATIC_DRAW);\n\n    this.texture = this.loadTexture(this.font.url);\n\n    this.frameDelay = options.frameDelay || 0;\n    this.frameIndex = 0;\n\n    this.renderLoop();\n  }\n\n  handleResize() {\n    const width = this.canvas.parentElement.offsetWidth;\n    const height = width * this.pixelHeight / this.pixelWidth;\n    this.canvas.style.width = width + 'px';\n    this.canvas.style.height = height + 'px';\n  }\n\n  getAttribLocation(name) {\n    const location = this.gl.getAttribLocation(this.program, name);\n    this.gl.enableVertexAttribArray(location);\n    return location;\n  }\n\n  flush() {\n    let textureArrayIndex = 0;\n    let colorArrayIndex = 0;\n\n    for (let y = 0; y < this.height; y++) {\n      for (let x = 0; x < this.width; x++) {\n        const cell = this.getCell(x, y);\n\n        if (!cell.dirty) {\n          textureArrayIndex += 8;\n          colorArrayIndex += 16;\n          continue;\n        }\n\n        const textureX = (cell.charCode % 16);\n        const textureY = ((cell.charCode / 16) | 0);\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY;\n\n        this.textureArray[textureArrayIndex++] = textureX + 1;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        this.textureArray[textureArrayIndex++] = textureX;\n        this.textureArray[textureArrayIndex++] = textureY + 1;\n\n        for (let i = 0; i < 4; i++) {\n          this.foregroundDataView.setUint32(colorArrayIndex, cell.fg, false);\n          this.backgroundDataView.setUint32(colorArrayIndex, cell.bg, false);\n          colorArrayIndex += 4;\n        }\n\n        cell.dirty = false;\n      }\n    }\n  }\n\n  isKeyDown(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.down;\n  }\n\n  isKeyPressed(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key && key.isPressed();\n  }\n\n  getKeyDownCount(keyCode) {\n    const key = this.keys.getKey(keyCode);\n    return key ? key.downCount : 0;\n  }\n\n  buildShader(type, source) {\n    const gl = this.gl;\n    const sh = gl.createShader(type);\n    if (!sh) {\n      throw new Error('An error occurred compiling the shader: ');\n    }\n    gl.shaderSource(sh, source);\n    gl.compileShader(sh);\n    if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n      throw new Error(\n          'An error occurred compiling the shader: ' + gl.getShaderInfoLog(sh));\n    }\n    return sh;\n  }\n\n  /**\n   * Initialize a texture and load an image.\n   * When the image finished loading copy it into the texture.\n   * @param url\n   */\n  loadTexture(url) {\n    const gl = this.gl;\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // Because images have to be download over the internet\n    // they might take a moment until they are ready.\n    // Until then put a single pixel in the texture so we can\n    // use it immediately. When the image has finished downloading\n    // we'll update the texture with the contents of the image.\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const width = 1;\n    const height = 1;\n    const border = 0;\n    const srcFormat = gl.RGBA;\n    const srcType = gl.UNSIGNED_BYTE;\n    const pixel = new Uint8Array([0, 0, 0, 255]);  // opaque black\n    gl.texImage2D(\n        gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat,\n        srcType, pixel);\n\n    const image = new Image();\n    image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(\n          gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    };\n    image.src = url;\n\n    return texture;\n  }\n\n  //\n  // Draw the scene.\n  //\n  render() {\n    const gl = this.gl;\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, this.pixelWidth, this.pixelHeight);\n\n    // Tell WebGL how to pull out the positions from the position\n    // buffer into the vertexPosition attribute\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      gl.vertexAttribPointer(\n          this.positionAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL how to pull out the texture coordinates from\n    // the texture coordinate buffer into the textureCoord attribute.\n    {\n      const numComponents = 2;\n      const type = gl.FLOAT;\n      const normalize = false;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.textureBuffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.textureArray, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.textureAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Foreground color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.foregroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.foregroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.fgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Background color\n    {\n      const numComponents = 4;\n      const type = gl.UNSIGNED_BYTE;\n      const normalize = true;\n      const stride = 0;\n      const offset = 0;\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.backgroundBuffer);\n      gl.bufferData(\n          gl.ARRAY_BUFFER, this.backgroundUint8Array, gl.DYNAMIC_DRAW);\n      gl.vertexAttribPointer(\n          this.bgColorAttribLocation, numComponents, type, normalize, stride,\n          offset);\n    }\n\n    // Tell WebGL which indices to use to index the vertices\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n\n    // Tell WebGL to use our program when drawing\n    gl.useProgram(this.program);\n\n    // Tell WebGL we want to affect texture unit 0\n    gl.activeTexture(gl.TEXTURE0);\n\n    // Bind the texture to texture unit 0\n    gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n    // Tell the shader we bound the texture to texture unit 0\n    {\n      const vertexCount = this.width * this.height * 6;\n      const type = gl.UNSIGNED_SHORT;\n      const offset = 0;\n      gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n    }\n  }\n\n  renderLoop() {\n    this.frameIndex++;\n    if (this.frameIndex >= this.frameDelay) {\n      this.keys.updateKeys();\n      this.mouse.update();\n      if (this.update) {\n        this.update();\n      }\n      this.flush();\n      this.render();\n      this.frameIndex = 0;\n    }\n    requestAnimationFrame(this.renderLoop.bind(this));\n  }\n}\n\n\n//# sourceURL=webpack:///./src/terminal.js?");

/***/ }),

/***/ "./src/tilemap.js":
/*!************************!*\
  !*** ./src/tilemap.js ***!
  \************************/
/*! exports provided: FovOctants, FovQuadrants, getFovQuadrant, Tile, TileMap */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FovOctants\", function() { return FovOctants; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FovQuadrants\", function() { return FovQuadrants; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getFovQuadrant\", function() { return getFovQuadrant; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Tile\", function() { return Tile; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TileMap\", function() { return TileMap; });\n/* harmony import */ var _cell_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./cell.js */ \"./src/cell.js\");\n/* harmony import */ var _console_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./console.js */ \"./src/console.js\");\n\n\n\n// MRPAS\n// Mingos' Restrictive Precise Angle Shadowcasting\n// https://bitbucket.org/mingos/mrpas/overview\n\n\n/**\n * The FovOctants constants provide bitmasks for various directions.\n *\n *     \\ 4 | 3 /\n *      \\  |  /\n *    5  \\ | /  2\n *        \\|/\n *   ------+-------\n *        /|\\\n *    6  / | \\  1\n *      /  |  \\\n *     / 7 | 0 \\\n *\n */\nconst FovOctants = {\n  OCTANT_SOUTH_SOUTHEAST: 0x001,\n  OCTANT_EAST_SOUTHEAST: 0x002,\n  OCTANT_EAST_NORTHTHEAST: 0x004,\n  OCTANT_NORTH_NORTHEAST: 0x008,\n  OCTANT_NORTH_NORTHWEST: 0x010,\n  OCTANT_WEST_NORTHEAST: 0x020,\n  OCTANT_WEST_SOUTHWEST: 0x040,\n  OCTANT_SOUTH_SOUTHWEST: 0x080\n};\n\nconst FovQuadrants = {\n  QUADRANT_SOUTHEAST: 0x001 + 0x002,\n  QUADRANT_EAST: 0x002 + 0x004,\n  QUADRANT_NORTHEAST: 0x004 + 0x008,\n  QUADRANT_NORTH: 0x008 + 0x010,\n  QUADRANT_NORTHWEST: 0x010 + 0x020,\n  QUADRANT_WEST: 0x020 + 0x040,\n  QUADRANT_SOUTHWEST: 0x040 + 0x080,\n  QUADRANT_SOUTH: 0x080 + 0x001,\n};\n\nfunction getFovQuadrant(dx, dy) {\n  if (dx > 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHEAST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_EAST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHEAST;\n    }\n  } else if (dx < 0) {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTHWEST;\n    } else if (dy === 0) {\n      return FovQuadrants.QUADRANT_WEST;\n    } else {\n      return FovQuadrants.QUADRANT_NORTHWEST;\n    }\n  } else {\n    if (dy > 0) {\n      return FovQuadrants.QUADRANT_SOUTH;\n    } else {\n      return FovQuadrants.QUADRANT_NORTH;\n    }\n  }\n}\n\nclass Tile extends _cell_js__WEBPACK_IMPORTED_MODULE_0__[\"Cell\"] {\n\n  constructor(x, y) {\n    super();\n    this.x = x;\n    this.y = y;\n    this.blocked = false;\n    this.blockSight = false;\n    this.explored = false;\n    this.visible = false;\n    this.pathId = -1;\n    this.g = 0.0;\n    this.h = 0.0;\n    this.prev = null;\n  }\n}\n\nclass TileMap extends _console_js__WEBPACK_IMPORTED_MODULE_1__[\"Console\"] {\n\n  /**\n   * Creates a new FOV map.\n   * @param width\n   * @param height\n   * @param blockedFunc\n   */\n  constructor(width, height, blockedFunc) {\n    super(width, height, Tile);\n    this.originX = 0;\n    this.originY = 0;\n    this.minX = 0;\n    this.maxX = 0;\n    this.minY = 0;\n    this.maxY = 0;\n    this.radius = 0;\n\n    if (blockedFunc) {\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          this.grid[y][x].blocked = blockedFunc(x, y);\n        }\n      }\n    }\n  }\n\n  setBlocked(x, y, blocked) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blocked = blocked;\n    }\n  }\n\n  setBlockSight(x, y, blockSight) {\n    if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n      this.grid[y][x].blockSight = blockSight;\n    }\n  }\n\n  isVisible(x, y) {\n    if (x < this.minX || x > this.maxX || y < this.minY || y > this.maxY) {\n      return false;\n    }\n    return this.grid[y][x].visible;\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the Y axis\n   */\n  computeOctantY(deltaX, deltaY) {\n    const startSlopes = [];\n    const endSlopes = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (y = this.originY + deltaY; y >= this.minY && y <= this.maxY;\n         y += deltaY, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          x = this.originX + (processedCell * deltaX);\n           processedCell <= iteration && x >= this.minX && x <= this.maxX;\n           x += deltaX, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y - deltaY][x].visible &&\n                !this.grid[y - deltaY][x].blockSight) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blockSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Compute the FOV in an octant adjacent to the X axis\n   */\n  computeOctantX(deltaX, deltaY) {\n    const startSlopes = [];\n    const endSlopes = [];\n    let iteration = 1;\n    let totalObstacles = 0;\n    let obstaclesInLastLine = 0;\n    let minSlope = 0;\n    let x;\n    let y;\n    let halfSlope;\n    let processedCell;\n    let visible;\n    let extended;\n    let centreSlope;\n    let startSlope;\n    let endSlope;\n    let previousEndSlope;\n\n    for (x = this.originX + deltaX; x >= this.minX && x <= this.maxX;\n         x += deltaX, obstaclesInLastLine = totalObstacles, ++iteration) {\n      halfSlope = 0.5 / iteration;\n      previousEndSlope = -1;\n      for (processedCell = Math.floor(minSlope * iteration + 0.5),\n          y = this.originY + (processedCell * deltaY);\n           processedCell <= iteration && y >= this.minY && y <= this.maxY;\n           y += deltaY, ++processedCell, previousEndSlope = endSlope) {\n        visible = true;\n        extended = false;\n        centreSlope = processedCell / iteration;\n        startSlope = previousEndSlope;\n        endSlope = centreSlope + halfSlope;\n\n        if (obstaclesInLastLine > 0) {\n          if (!(this.grid[y][x - deltaX].visible &&\n                !this.grid[y][x - deltaX].blockSight) &&\n              !(this.grid[y - deltaY][x - deltaX].visible &&\n                !this.grid[y - deltaY][x - deltaX].blockSight)) {\n            visible = false;\n          } else {\n            for (let idx = 0; idx < obstaclesInLastLine && visible; ++idx) {\n              if (startSlope <= endSlopes[idx] &&\n                  endSlope >= startSlopes[idx]) {\n                if (!this.grid[y][x].blockSight) {\n                  if (centreSlope > startSlopes[idx] &&\n                      centreSlope < endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  }\n                } else {\n                  if (startSlope >= startSlopes[idx] &&\n                      endSlope <= endSlopes[idx]) {\n                    visible = false;\n                    break;\n                  } else {\n                    startSlopes[idx] = Math.min(startSlopes[idx], startSlope);\n                    endSlopes[idx] = Math.max(endSlopes[idx], endSlope);\n                    extended = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (visible) {\n          this.grid[y][x].visible = true;\n          if (this.grid[y][x].blockSight) {\n            if (minSlope >= startSlope) {\n              minSlope = endSlope;\n            } else if (!extended) {\n              startSlopes[totalObstacles] = startSlope;\n              endSlopes[totalObstacles++] = endSlope;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  computeFov(originX, originY, radius, opt_noClear, opt_octants) {\n    this.originX = originX;\n    this.originY = originY;\n    this.radius = radius;\n\n    if (opt_noClear) {\n      this.minX = Math.min(this.minX, Math.max(0, originX - radius));\n      this.minY = Math.min(this.minY, Math.max(0, originY - radius));\n      this.maxX = Math.max(this.maxX, Math.min(this.width - 1, originX + radius));\n      this.maxY = Math.max(this.maxY, Math.min(this.height - 1, originY + radius));\n\n    } else {\n      this.minX = Math.max(0, originX - radius);\n      this.minY = Math.max(0, originY - radius);\n      this.maxX = Math.min(this.width - 1, originX + radius);\n      this.maxY = Math.min(this.height - 1, originY + radius);\n\n      for (let y = this.minY; y <= this.maxY; y++) {\n        for (let x = this.minX; x <= this.maxX; x++) {\n          this.grid[y][x].visible = false;\n        }\n      }\n    }\n\n    this.grid[originY][originX].visible = true;\n\n    if (opt_octants === undefined) {\n        this.computeOctantY(1, 1);\n        this.computeOctantX(1, 1);\n        this.computeOctantX(1, -1);\n        this.computeOctantY(1, -1);\n        this.computeOctantY(-1, -1);\n        this.computeOctantX(-1, -1);\n        this.computeOctantX(-1, 1);\n        this.computeOctantY(-1, 1);\n    } else {\n      //   \\ 4 | 3 /\n      //    \\  |  /\n      //  5  \\ | /  2\n      //      \\|/\n      // ------+-------\n      //      /|\\\n      //  6  / | \\  1\n      //    /  |  \\\n      //   / 7 | 0 \\\n      if (opt_octants & 0x001) {\n        this.computeOctantY(1, 1);\n      }\n\n      if (opt_octants & 0x002) {\n        this.computeOctantX(1, 1);\n      }\n\n      if (opt_octants & 0x004) {\n        this.computeOctantX(1, -1);\n      }\n\n      if (opt_octants & 0x008) {\n        this.computeOctantY(1, -1);\n      }\n\n      if (opt_octants & 0x010) {\n        this.computeOctantY(-1, -1);\n      }\n\n      if (opt_octants & 0x020) {\n        this.computeOctantX(-1, -1);\n      }\n\n      if (opt_octants & 0x040) {\n        this.computeOctantX(-1, 1);\n      }\n\n      if (opt_octants & 0x080) {\n        this.computeOctantY(-1, 1);\n      }\n    }\n  }\n\n  /**\n   * All visible tiles are marked as explored.\n   */\n  updateExplored() {\n    for (let y = this.minY; y <= this.maxY; y++) {\n      for (let x = this.minX; x <= this.maxX; x++) {\n        const tile = this.grid[y][x];\n        tile.explored |= tile.visible;\n      }\n    }\n  }\n}\n\n\n//# sourceURL=webpack:///./src/tilemap.js?");

/***/ })

/******/ });
});